import { useState, useRef, useEffect, useCallback } from 'react'
import './InstructionsPanel.css'
import page1 from '../assets/images/pages/1.png'
import page2 from '../assets/images/pages/2.png'
import page3 from '../assets/images/pages/3.png'
import page4 from '../assets/images/pages/4.png'
import page5 from '../assets/images/pages/5.png'
import page5_1 from '../assets/images/pages/5.1.png'
import page6 from '../assets/images/pages/6.png'
import page7 from '../assets/images/pages/7.png'
import page7_1 from '../assets/images/pages/7.1.png'
import page8 from '../assets/images/pages/8.png'
import page8_1 from '../assets/images/pages/8.1.png'
import page9 from '../assets/images/pages/9.png'
import page10 from '../assets/images/pages/10.png'
import page10_1 from '../assets/images/pages/10.1.png'
import page11 from '../assets/images/pages/11.png'
import page12 from '../assets/images/pages/12.png'
import page12_1 from '../assets/images/pages/12.1.png'
import page13 from '../assets/images/pages/13.png'
import page14 from '../assets/images/pages/14.png'
import page15 from '../assets/images/pages/15.png'
import page15_1 from '../assets/images/pages/15.1.png'
import page16 from '../assets/images/pages/16.png'
import page17 from '../assets/images/pages/17.png'
import page18 from '../assets/images/pages/18.png'
import page18_1 from '../assets/images/pages/18.1.png'
import page19 from '../assets/images/pages/19.png'
import page20 from '../assets/images/pages/20.png'
import page21 from '../assets/images/pages/21.png'
import page21_1 from '../assets/images/pages/21.1.png'
import page21_2 from '../assets/images/pages/21.2.png'
import page22 from '../assets/images/pages/22.png'
import page23 from '../assets/images/pages/23.png'
import page23_1 from '../assets/images/pages/23.1.png'
import page24 from '../assets/images/pages/24.png'
import page24_1 from '../assets/images/pages/24.1.png'
import page25 from '../assets/images/pages/25.png'
import page26 from '../assets/images/pages/26.png'
import page27 from '../assets/images/pages/27.png'
import page28 from '../assets/images/pages/28.png'
import page29 from '../assets/images/pages/29.png'
import page30 from '../assets/images/pages/30.png'
import page31 from '../assets/images/pages/31.png'
import page32 from '../assets/images/pages/32.png'
import safetyGlasses from '../assets/images/safety-glasses.png'

const DEFAULT_PAGE_ASPECT = 0.75
const STAGE_FRAME_PADDING = 6
const START_BUTTON_SMALL_THRESHOLD = 80 // px width threshold to shrink border

function InstructionsPanel({ editorMode, onDimensionsCapture, onRefresh, onPageSelect }) {
  const [currentPage, setCurrentPage] = useState(0)
  const [zoom, setZoom] = useState(100)
  const [hasStarted, setHasStarted] = useState(false)
  // Track which pages have been visited/completed (button clicked)
  const [visitedPages, setVisitedPages] = useState(new Set())
  // Track page 3 button state
  const [page3ButtonClicked, setPage3ButtonClicked] = useState(false)
  // Track page 3 second button state
  const [page3SecondButtonClicked, setPage3SecondButtonClicked] = useState(false)
  // Track page 4 button states
  const [page4Button1Clicked, setPage4Button1Clicked] = useState(false)
  const [page4Button2Clicked, setPage4Button2Clicked] = useState(false)
  const [page4Button3Clicked, setPage4Button3Clicked] = useState(false)
  const [page4Button4Clicked, setPage4Button4Clicked] = useState(false)
  const [page4Button5Clicked, setPage4Button5Clicked] = useState(false)
  // Track page 4 speech bubble button state
  const [page4SpeechBubbleClicked, setPage4SpeechBubbleClicked] = useState(false)
  // Track page 4 checkbox states (team member checkboxes in large button)
  const [page4Checkbox1, setPage4Checkbox1] = useState(false)
  const [page4Checkbox2, setPage4Checkbox2] = useState(false)
  const [page4Checkbox3, setPage4Checkbox3] = useState(false)
  // Track page 5 button states
  const [page5Button1Clicked, setPage5Button1Clicked] = useState(false)
  const [page5Button2Clicked, setPage5Button2Clicked] = useState(false)
  // Track page 5 blue edge dot selection
  const [page5BlueDotSelected, setPage5BlueDotSelected] = useState(false)
  // Track page 5 green dot connection selection
  const [page5GreenDotSelected, setPage5GreenDotSelected] = useState(false)
  // Track if page 5 should temporarily show 5.1.png (when "Need Help?" is clicked)
  const [page5ShowHelpImage, setPage5ShowHelpImage] = useState(false)
  const [page21ShowHelpImage, setPage21ShowHelpImage] = useState(false)
  // Track page 6 button states
  const [page6Button1Clicked, setPage6Button1Clicked] = useState(false)
  const [page6Button2Clicked, setPage6Button2Clicked] = useState(false)
  // Track page 7 box states
  const [page7Box1Selected, setPage7Box1Selected] = useState(false)
  const [page7Box2Selected, setPage7Box2Selected] = useState(false)
  const [page7Box3Selected, setPage7Box3Selected] = useState(false)
  const [page7Box4Selected, setPage7Box4Selected] = useState(false)
  const [page7Box4Hovered, setPage7Box4Hovered] = useState(false)
  // Track if page 7 has been visited (to hide white box on subsequent visits)
  const [page7Visited, setPage7Visited] = useState(false)
  // Track if box 4 has ever been selected (to enable Next button on 7.png after visiting 7.1.png)
  const [page7Box4EverSelected, setPage7Box4EverSelected] = useState(false)
  // Track page 8 box states
  const [page8Box1Selected, setPage8Box1Selected] = useState(false)
  const [page8Box2Selected, setPage8Box2Selected] = useState(false)
  const [page8Box3Selected, setPage8Box3Selected] = useState(false)
  const [page8Box4Selected, setPage8Box4Selected] = useState(false)
  // Track if white box should be hidden (1 second delay after box 1 is selected)
  const [page8WhiteBoxHidden, setPage8WhiteBoxHidden] = useState(false)
  // Track if white box on 8.1.png should be hidden (hidden after box 3 is selected)
  const [page8Box3WhiteBoxHidden, setPage8Box3WhiteBoxHidden] = useState(false)
  // Track box selections on page 9
  const [page9Box1Selected, setPage9Box1Selected] = useState(false)
  const [page9Box2Selected, setPage9Box2Selected] = useState(false)
  const [page9Box2bSelected, setPage9Box2bSelected] = useState(false)
  const [page9Box3Selected, setPage9Box3Selected] = useState(false)
  // Track if white boxes on page 9 should be hidden (hidden after box 1 is selected)
  const [page9WhiteBoxesHidden, setPage9WhiteBoxesHidden] = useState(false)
  // Track if right white box on page 9 should be hidden (hidden 0.75s after box 2b is selected)
  const [page9RightWhiteBoxHidden, setPage9RightWhiteBoxHidden] = useState(false)
  // Track page 10 box state (when selected, switches from 10.1.png to 10.png)
  const [page10BoxSelected, setPage10BoxSelected] = useState(false)
  // Track if button/LED/ground boxes should be visible on 10.1.png
  const [page10BoxesVisible, setPage10BoxesVisible] = useState(false)
  // Track page 10 box selections
  const [page10Box1Selected, setPage10Box1Selected] = useState(false)
  const [page10Box2Selected, setPage10Box2Selected] = useState(false)
  const [page10Box3Selected, setPage10Box3Selected] = useState(false)
  const [page10Box4Selected, setPage10Box4Selected] = useState(false)
  // Track if white boxes on page 10.1 should be hidden (hidden after both box 1 and box 2 are selected)
  const [page10WhiteBoxesHidden, setPage10WhiteBoxesHidden] = useState(false)
  // Track if white box 1 on page 10.1 should be hidden (hidden after box 2 is selected)
  const [page10WhiteBox1Hidden, setPage10WhiteBox1Hidden] = useState(false)
  // Track if white box over "Need Help?" box on page 10.1 should be visible (visible after box 2 is selected, hidden when box 1 is selected)
  const [page10NeedHelpWhiteBoxVisible, setPage10NeedHelpWhiteBoxVisible] = useState(false)
  // Track if white box 3 on page 10.1 should be hidden (hidden after box 1 is selected)
  const [page10WhiteBox3Hidden, setPage10WhiteBox3Hidden] = useState(false)
  // Track if new white box on page 10.1 should be hidden (hidden after box 2 is selected)
  const [page10NewWhiteBoxHidden, setPage10NewWhiteBoxHidden] = useState(false)
  // Track page 11 box selection
  const [page11BoxSelected, setPage11BoxSelected] = useState(false)
  const [page11Box2Selected, setPage11Box2Selected] = useState(false)
  const [page11Box3Selected, setPage11Box3Selected] = useState(false)
  const [page11Box4Selected, setPage11Box4Selected] = useState(false)
  // Track page 12 box selection
  const [page12Box1Selected, setPage12Box1Selected] = useState(false)
  const [page12Box2Selected, setPage12Box2Selected] = useState(false)
  const [page12Box3Selected, setPage12Box3Selected] = useState(false)
  const [page12Box4Selected, setPage12Box4Selected] = useState(false)
  // Track page 12.1 box selection
  const [page12_1BoxSelected, setPage12_1BoxSelected] = useState(false)
  // Track page 13 box selection
  const [page13Box1Selected, setPage13Box1Selected] = useState(false)
  const [page13Box2Selected, setPage13Box2Selected] = useState(false)
  const [page13Box3Selected, setPage13Box3Selected] = useState(false)
  const [page13Box4Selected, setPage13Box4Selected] = useState(false)
  // Track page 14 box selection
  const [page14Box1Selected, setPage14Box1Selected] = useState(false)
  const [page14Box2Selected, setPage14Box2Selected] = useState(false)
  const [page14Box3Selected, setPage14Box3Selected] = useState(false)
  const [page14Box4Selected, setPage14Box4Selected] = useState(false)
  const [page14Box4bSelected, setPage14Box4bSelected] = useState(false)
  const [page14Box5Selected, setPage14Box5Selected] = useState(false)
  // Track page 15 box selection
  const [page15BoxSelected, setPage15BoxSelected] = useState(false)
  // Track if button/LED boxes should be visible on 15.1.png
  const [page15BoxesVisible, setPage15BoxesVisible] = useState(false)
  // Track page 16 box selection
  const [page16Box1Selected, setPage16Box1Selected] = useState(false)
  const [page16Box2Selected, setPage16Box2Selected] = useState(false)
  const [page16Box3Selected, setPage16Box3Selected] = useState(false)
  // Track page 17 box selection
  const [page17Box1Selected, setPage17Box1Selected] = useState(false)
  const [page17Box2Selected, setPage17Box2Selected] = useState(false)
  const [page17Box3Selected, setPage17Box3Selected] = useState(false)
  const [page17Box4Selected, setPage17Box4Selected] = useState(false)
  const [page17Box4bSelected, setPage17Box4bSelected] = useState(false)
  const [page18Box1Selected, setPage18Box1Selected] = useState(false)
  const [page18Box2Selected, setPage18Box2Selected] = useState(false)
  const [page18Box3Selected, setPage18Box3Selected] = useState(false)
  const [page18Box4Selected, setPage18Box4Selected] = useState(false)
  // Track if button/LED/ground boxes should be visible on 18.1.png
  const [page18BoxesVisible, setPage18BoxesVisible] = useState(false)
  // Track if "Need Help?" text should be shown (hidden after first click)
  const [page18ShowHelpText, setPage18ShowHelpText] = useState(true)
  // Track which image to show based on Need Help button clicks (0 = 18.1.png, 1 = 18.png, 2 = 18.1.png)
  const [page18HelpImageState, setPage18HelpImageState] = useState(0)
  // Track page 19 box state
  const [page19Box1Selected, setPage19Box1Selected] = useState(false)
  const [page19Box2Selected, setPage19Box2Selected] = useState(false)
  const [page19Box3Selected, setPage19Box3Selected] = useState(false)
  // Track page 20 box state
  const [page20Box1Selected, setPage20Box1Selected] = useState(false)
  const [page20Box2Selected, setPage20Box2Selected] = useState(false)
  const [page20Box3Selected, setPage20Box3Selected] = useState(false)
  const [page20Box4Selected, setPage20Box4Selected] = useState(false)
  const [page20Box5Selected, setPage20Box5Selected] = useState(false)
  const [page20Box6Selected, setPage20Box6Selected] = useState(false)
  // Track page 21 box state (for 21.1.png)
  const [page21Box1Selected, setPage21Box1Selected] = useState(false)
  const [page21Box2Selected, setPage21Box2Selected] = useState(false)
  // Track if "Need Help?" text should be shown on page 21.1 (hidden after first click)
  const [page21ShowHelpText, setPage21ShowHelpText] = useState(true)
  // Track if boxes should be visible on 21.png (when Need Help button is clicked second time)
  const [page21BoxesVisible, setPage21BoxesVisible] = useState(false)
  // Track if 21.2.png should be displayed (toggled by duplicate button at bottom left)
  const [page21Show21_2Image, setPage21Show21_2Image] = useState(false)
  // Track page 22 box state
  const [page22Box1Selected, setPage22Box1Selected] = useState(false)
  const [page22Box2Selected, setPage22Box2Selected] = useState(false)
  const [page22Box3Selected, setPage22Box3Selected] = useState(false)
  const [page22Box4Selected, setPage22Box4Selected] = useState(false)
  const [page22Box5Selected, setPage22Box5Selected] = useState(false)
  const [page22Box6Selected, setPage22Box6Selected] = useState(false)
  // Track page 23 box state
  const [page23Box1Selected, setPage23Box1Selected] = useState(false)
  const [page23Box2Selected, setPage23Box2Selected] = useState(false)
  const [page23Box3Selected, setPage23Box3Selected] = useState(false)
  // Track page 24 box state
  const [page24Box1Selected, setPage24Box1Selected] = useState(false)
  // Track if page 24 should show the main image (24.png) instead of initial (24.1.png)
  const [page24ShowMainImage, setPage24ShowMainImage] = useState(false)
  // Track if "Need Help?" text should be shown on page 24.1 (hidden after first click)
  const [page24ShowHelpText, setPage24ShowHelpText] = useState(true)
  // Track if "Need Help?" text should be shown (hidden after first click)
  const [page15ShowHelpText, setPage15ShowHelpText] = useState(true)
  // Track page 15 box selections
  const [page15Box1Selected, setPage15Box1Selected] = useState(false)
  const [page15Box2Selected, setPage15Box2Selected] = useState(false)
  const [page15Box3Selected, setPage15Box3Selected] = useState(false)
  // Track selected green boxes on page 3
  const [selectedGreenBoxes, setSelectedGreenBoxes] = useState(new Set())
  // Track if returning from page 3 to page 2
  const [returningFromPage3, setReturningFromPage3] = useState(false)
  // Track if returning from page 2 to page 1
  const [returningFromPage2, setReturningFromPage2] = useState(false)
  // Track if returning to page 3 after second button was clicked
  const [returningToPage3AfterSecondButton, setReturningToPage3AfterSecondButton] = useState(false)
  // Track white box fade states for page 2
  const [box1Fading, setBox1Fading] = useState(false)
  const [box2Fading, setBox2Fading] = useState(false)
  const [box3Fading, setBox3Fading] = useState(false)
  // Track white box fade states for page 4
  const [page4Box1Fading, setPage4Box1Fading] = useState(false)
  const [page4Box2Fading, setPage4Box2Fading] = useState(false)
  const [page4Box3Fading, setPage4Box3Fading] = useState(false)
  // Track if page 4 has been visited for the first time
  const [page4FirstVisit, setPage4FirstVisit] = useState(false)
  // Track if safety glasses should animate (pop effect)
  const [safetyGlassesPop, setSafetyGlassesPop] = useState(false)
  // Default box position - will be set based on current page
  const getDefaultBoxPosition = (pageIndex) => {
    if (pageIndex === 0) {
      // Page 1 specific dimensions
      return { left: 36.82, top: 70.73, width: 26.76, height: 8.24 }
    }
    // Default for other pages
    return { left: 40, top: 40, width: 20, height: 15 }
  }
  
  const [boxPosition, setBoxPosition] = useState(getDefaultBoxPosition(0))
  const [isDragging, setIsDragging] = useState(false)
  const [isResizing, setIsResizing] = useState(false)
  const [resizeHandle, setResizeHandle] = useState(null) // 'n', 's', 'e', 'w'
  const [dragStart, setDragStart] = useState({ x: 0, y: 0 })
  const [boxStart, setBoxStart] = useState({ left: 0, top: 0, width: 0, height: 0 })
  // Dot positions along the perimeter (0-100%, where 0% = top-left, 25% = top-right, 50% = bottom-right, 75% = bottom-left)
  const [dot1Position, setDot1Position] = useState(10) // Start at 10% along perimeter
  const [dot2Position, setDot2Position] = useState(60) // Start at 60% along perimeter
  const [isDraggingDot, setIsDraggingDot] = useState(null) // null, 'dot1', 'dot2', or 'dot3'
  const [dotDragStart, setDotDragStart] = useState({ x: 0, y: 0, perimeter: 0 })
  // Third dot position (x, y as percentages relative to image)
  const [dot3Position, setDot3Position] = useState({ x: 50, y: 50 }) // Start at center
  const stageRef = useRef(null)
  const stageFrameRef = useRef(null)
  const imgRef = useRef(null)
  const boxRef = useRef(null)
  const page8WhiteBoxTimeoutRef = useRef(null)
  const page9RightWhiteBoxTimeoutRef = useRef(null)
  const page5HelpImageTimeoutRef = useRef(null)
  const page7HelpImageTimeoutRef = useRef(null)
  const page10HelpImageTimeoutRef = useRef(null)
  const pages = [page1, page2, page3, page4, page5, page6, page7, page8, page9, page10, page11, page12, page13, page14, page15_1, page16, page17, page18, page19, page20, page21, page22, page23, page24, page25, page26, page27, page28, page29, page30, page31, page32]

  const handlePrevious = () => {
    if (currentPage > 0) {
      const previousPage = currentPage - 1
      // Reset page 5 help image state when navigating away from page 5
      if (currentPage === 4) {
        setPage5ShowHelpImage(false)
        if (page5HelpImageTimeoutRef.current) {
          clearTimeout(page5HelpImageTimeoutRef.current)
          page5HelpImageTimeoutRef.current = null
        }
      }
      // Reset page 21 help image state when navigating away from page 20
      if (currentPage === 20) {
        setPage21ShowHelpImage(false)
        setPage21Box1Selected(false)
        setPage21Box2Selected(false)
      }
      // Mark page 7 as visited when navigating back to it from page 8
      if (currentPage === 7) {
        setPage7Visited(true)
        // Reset white box state when navigating away from page 8
        setPage8WhiteBoxHidden(false)
        if (page8WhiteBoxTimeoutRef.current) {
          clearTimeout(page8WhiteBoxTimeoutRef.current)
          page8WhiteBoxTimeoutRef.current = null
        }
      }
      // Reset right white box state when navigating away from page 9
      if (currentPage === 8) {
        setPage9RightWhiteBoxHidden(false)
        if (page9RightWhiteBoxTimeoutRef.current) {
          clearTimeout(page9RightWhiteBoxTimeoutRef.current)
          page9RightWhiteBoxTimeoutRef.current = null
        }
      }
      // Reset page 10 state when navigating away from page 10
      if (currentPage === 9) {
        setPage10BoxSelected(false)
        setPage10BoxesVisible(false)
        setPage10Box1Selected(false)
        setPage10Box2Selected(false)
        setPage10Box3Selected(false)
        setPage10WhiteBoxesHidden(false)
        setPage10WhiteBox1Hidden(false)
        setPage10NeedHelpWhiteBoxVisible(false)
        setPage10WhiteBox3Hidden(false)
        setPage10NewWhiteBoxHidden(false)
      }
      // Reset page 15 state when navigating away from page 15
      if (currentPage === 14) {
        setPage15BoxSelected(false)
        setPage15BoxesVisible(false)
        setPage15ShowHelpText(true)
        setPage15Box1Selected(false)
        setPage15Box2Selected(false)
        setPage15Box3Selected(false)
      }
      // Reset page 18 state when navigating away from page 18
      if (currentPage === 17) {
        setPage18BoxesVisible(false)
        setPage18ShowHelpText(true)
        setPage18HelpImageState(0)
      }
      // Track if we're returning from page 3 to page 2
      if (currentPage === 2) {
        setReturningFromPage3(true)
        setReturningFromPage2(false)
        setReturningToPage3AfterSecondButton(false)
      } else if (currentPage === 1) {
        // Track if we're returning from page 2 to page 1
        setReturningFromPage2(true)
        setReturningFromPage3(false)
        setReturningToPage3AfterSecondButton(false)
      } else {
        setReturningFromPage3(false)
        setReturningFromPage2(false)
        // returningToPage3AfterSecondButton will be set in useEffect when arriving at page 3
      }
      setCurrentPage(prev => prev - 1)
      setZoom(100)
    }
  }

  const handleNext = () => {
    // If on page 1 (index 0), require start button to be clicked first (only on first visit)
    if (currentPage === 0 && !visitedPages.has(0)) {
      return
    }
    // For page 1 (index 1), require button click only on first visit
    if (currentPage === 1 && !visitedPages.has(1)) {
      return
    }
    // For page 3 (index 2), require both buttons to be clicked
    if (currentPage === 2 && (!page3ButtonClicked || !page3SecondButtonClicked)) {
      return
    }
    // For page 5 (index 4), require green active button to be selected
    if (currentPage === 4 && !page5GreenDotSelected) {
      return
    }
    // For page 6 (index 5), require both buttons to be clicked
    if (currentPage === 5 && (!page6Button1Clicked || !page6Button2Clicked)) {
      return
    }
    // For page 7 (index 6), require box 4 to have been selected at least once (visited 7.1.png)
    if (currentPage === 6 && !page7Box4EverSelected) {
      return
    }
    // For page 8 (index 7), when showing 8.1.png, require box 4 to be selected
    if (currentPage === 7 && page8Box2Selected && !page8Box4Selected) {
      return
    }
    // For page 10 (index 9), require box 4 to be selected (on both 10.1.png and 10.png)
    if (currentPage === 9 && !page10Box4Selected) {
      return
    }
    // For page 11 (index 10), require box 4 to be selected
    if (currentPage === 10 && !page11Box4Selected) {
      return
    }
    // For page 12 (index 11), require box 4 to be selected to proceed
    // Box 3 selection shows 12.1.png, but box 4 must be selected to continue
    if (currentPage === 11 && !page12Box4Selected) {
      return
    }
    // For page 13 (index 12), require box 1 to be selected
    if (currentPage === 12 && !page13Box1Selected) {
      return
    }
    // For page 15 (index 14), require box 3 to be selected
    if (currentPage === 14 && !page15Box3Selected) {
      return
    }
    // For page 17 (index 16), require box 4b to be selected
    if (currentPage === 16 && !page17Box4bSelected) {
      return
    }
    // For page 18 (index 17), require all 4 boxes to be selected
    if (currentPage === 17 && (!page18Box1Selected || !page18Box2Selected || !page18Box3Selected || !page18Box4Selected)) {
      return
    }
    // For page 21.1 (index 20), require box 2 to be selected
    if (currentPage === 20 && !page21Box2Selected) {
      return
    }
    // For page 22 (index 21), require box 5 to be selected
    if (currentPage === 21 && !page22Box6Selected) {
      return
    }
    if (currentPage < pages.length - 1) {
      // Reset page 5 help image state when navigating away from page 5
      if (currentPage === 4) {
        setPage5ShowHelpImage(false)
        if (page5HelpImageTimeoutRef.current) {
          clearTimeout(page5HelpImageTimeoutRef.current)
          page5HelpImageTimeoutRef.current = null
        }
      }
      // Reset page 21 help image state when navigating away from page 20
      if (currentPage === 20) {
        setPage21ShowHelpImage(false)
        setPage21Box1Selected(false)
        setPage21Box2Selected(false)
      }
      // Mark page 7 as visited when navigating to it from page 6
      if (currentPage === 5) {
        setPage7Visited(true)
      }
      // Reset white box state when navigating away from page 8
      if (currentPage === 7) {
        setPage8WhiteBoxHidden(false)
        if (page8WhiteBoxTimeoutRef.current) {
          clearTimeout(page8WhiteBoxTimeoutRef.current)
          page8WhiteBoxTimeoutRef.current = null
        }
      }
      // Reset right white box state when navigating away from page 9
      if (currentPage === 8) {
        setPage9RightWhiteBoxHidden(false)
        if (page9RightWhiteBoxTimeoutRef.current) {
          clearTimeout(page9RightWhiteBoxTimeoutRef.current)
          page9RightWhiteBoxTimeoutRef.current = null
        }
      }
      // Reset page 10 state when navigating away from page 10
      if (currentPage === 9) {
        setPage10BoxSelected(false)
        setPage10BoxesVisible(false)
        setPage10Box1Selected(false)
        setPage10Box2Selected(false)
        setPage10Box3Selected(false)
        setPage10WhiteBoxesHidden(false)
        setPage10WhiteBox1Hidden(false)
        setPage10NeedHelpWhiteBoxVisible(false)
        setPage10WhiteBox3Hidden(false)
        setPage10NewWhiteBoxHidden(false)
      }
      // Reset page 15 state when navigating away from page 15
      if (currentPage === 14) {
        setPage15BoxSelected(false)
        setPage15BoxesVisible(false)
        setPage15ShowHelpText(true)
        setPage15Box1Selected(false)
        setPage15Box2Selected(false)
        setPage15Box3Selected(false)
      }
      // Reset returning states when navigating forward (except returningToPage3AfterSecondButton which is set in useEffect)
      setReturningFromPage3(false)
      setReturningFromPage2(false)
      // Don't reset returningToPage3AfterSecondButton here - it will be set in useEffect when arriving at page 3
      setCurrentPage(prev => prev + 1)
      setZoom(100)
    }
  }

  const handleStart = () => {
    // Reset returning state when button is clicked
    setReturningFromPage2(false)
    setHasStarted(true)
    // Mark page 0 as visited
    setVisitedPages(prev => new Set(prev).add(0))
    // Move to next page after clicking Start
    if (currentPage < pages.length - 1) {
      setCurrentPage(1)
      setZoom(100)
    }
  }

  // Development refresh function - resets only the current page's boxes and interactive elements
  const handleRefresh = useCallback(() => {
    // Keep current page - only reset boxes and interactive elements on the displayed image
    
    // Reset box position to default for current page
    setBoxPosition(getDefaultBoxPosition(currentPage))
    setIsDragging(false)
    setIsResizing(false)
    setResizeHandle(null)
    setDragStart({ x: 0, y: 0 })
    setBoxStart({ left: 0, top: 0, width: 0, height: 0 })
    
    // Reset dot positions
    setDot1Position(10)
    setDot2Position(60)
    setDot3Position({ x: 50, y: 50 })
    setIsDraggingDot(null)
    setDotDragStart({ x: 0, y: 0, perimeter: 0 })
    
    // Reset states based on current page
    if (currentPage === 0) {
      // Page 1 - no specific interactive elements to reset beyond box
    } else if (currentPage === 1) {
      // Page 2 - reset fade states
      setBox1Fading(false)
      setBox2Fading(false)
      setBox3Fading(false)
    } else if (currentPage === 2) {
      // Page 3 - reset button states and green boxes
      setPage3ButtonClicked(false)
      setPage3SecondButtonClicked(false)
      setSelectedGreenBoxes(new Set())
      setReturningToPage3AfterSecondButton(false)
    } else if (currentPage === 3) {
      // Page 4 - reset all button and checkbox states
      setPage4Button1Clicked(false)
      setPage4Button2Clicked(false)
      setPage4Button3Clicked(false)
      setPage4Button4Clicked(false)
      setPage4Button5Clicked(false)
      setPage4SpeechBubbleClicked(false)
      setPage4Checkbox1(false)
      setPage4Checkbox2(false)
      setPage4Checkbox3(false)
      setPage4Box1Fading(false)
      setPage4Box2Fading(false)
      setPage4Box3Fading(false)
      setPage4FirstVisit(false)
      setSafetyGlassesPop(false)
    } else if (currentPage === 4) {
      // Page 5 - reset button and dot states
      setPage5Button1Clicked(false)
      setPage5Button2Clicked(false)
      setPage5BlueDotSelected(false)
      setPage5GreenDotSelected(false)
    } else if (currentPage === 5) {
      // Page 6 - reset button and checkbox states
      setPage6Button1Clicked(false)
      setPage6Button2Clicked(false)
      setPage6GreenCheckboxSelected(false)
    } else if (currentPage === 6) {
      // Page 7 - reset box states
      setPage7Box1Selected(false)
      setPage7Box2Selected(false)
      setPage7Box3Selected(false)
      setPage7Box4Selected(false)
      setPage7Box4Hovered(false)
      setPage7Box4EverSelected(false)
    } else if (currentPage === 7) {
      // Page 8 - reset box states
      setPage8Box1Selected(false)
      setPage8Box2Selected(false)
      setPage8Box3Selected(false)
      setPage8Box4Selected(false)
      setPage8WhiteBoxHidden(false)
      setPage8Box3WhiteBoxHidden(false)
      // Clear timeout if active
      if (page8WhiteBoxTimeoutRef.current) {
        clearTimeout(page8WhiteBoxTimeoutRef.current)
        page8WhiteBoxTimeoutRef.current = null
      }
    } else if (currentPage === 8) {
      // Page 9 - reset box states
      setPage9Box1Selected(false)
      setPage9Box2Selected(false)
      setPage9Box2bSelected(false)
      setPage9Box3Selected(false)
      setPage9WhiteBoxesHidden(false)
      setPage9RightWhiteBoxHidden(false)
      // Clear timeout if active
      if (page9RightWhiteBoxTimeoutRef.current) {
        clearTimeout(page9RightWhiteBoxTimeoutRef.current)
        page9RightWhiteBoxTimeoutRef.current = null
      }
    } else if (currentPage === 9) {
      // Page 10 - reset box state
      setPage10BoxSelected(false)
      setPage10BoxesVisible(false)
      setPage10Box1Selected(false)
      setPage10Box2Selected(false)
      setPage10Box3Selected(false)
      setPage10Box4Selected(false)
      setPage10WhiteBoxesHidden(false)
      setPage10WhiteBox1Hidden(false)
      setPage10NeedHelpWhiteBoxVisible(false)
      setPage10WhiteBox3Hidden(false)
      setPage10NewWhiteBoxHidden(false)
    } else if (currentPage === 10) {
      // Page 11 - reset box state
      setPage11BoxSelected(false)
      setPage11Box2Selected(false)
      setPage11Box3Selected(false)
      setPage11Box4Selected(false)
    } else if (currentPage === 11) {
      // Page 12 - reset box state
      setPage12Box1Selected(false)
      setPage12Box2Selected(false)
      setPage12Box3Selected(false)
      setPage12Box4Selected(false)
      setPage12_1BoxSelected(false)
    } else if (currentPage === 12) {
      // Page 13 - reset box states
      setPage13Box1Selected(false)
      setPage13Box2Selected(false)
      setPage13Box3Selected(false)
      setPage13Box4Selected(false)
    } else if (currentPage === 13) {
      // Page 14 - reset box states
      setPage14Box1Selected(false)
      setPage14Box2Selected(false)
      setPage14Box3Selected(false)
      setPage14Box4Selected(false)
      setPage14Box4bSelected(false)
      setPage14Box5Selected(false)
    } else if (currentPage === 14) {
      // Page 15 - reset box state
      setPage15BoxSelected(false)
      setPage15BoxesVisible(false)
      setPage15ShowHelpText(true)
      setPage15Box1Selected(false)
      setPage15Box2Selected(false)
      setPage15Box3Selected(false)
    } else if (currentPage === 15) {
      // Page 16 - reset box states
      setPage16Box1Selected(false)
      setPage16Box2Selected(false)
      setPage16Box3Selected(false)
      setPage5ShowHelpImage(false)
      // Clear timeout if active
      if (page5HelpImageTimeoutRef.current) {
        clearTimeout(page5HelpImageTimeoutRef.current)
        page5HelpImageTimeoutRef.current = null
      }
    } else if (currentPage === 16) {
      // Page 17 - reset box states
      setPage17Box1Selected(false)
      setPage17Box2Selected(false)
      setPage17Box3Selected(false)
      setPage17Box4bSelected(false)
      setPage17Box4Selected(false)
    } else if (currentPage === 17) {
      // Page 18 - reset box states
      setPage18Box1Selected(false)
      setPage18Box2Selected(false)
      setPage18Box3Selected(false)
      setPage18Box4Selected(false)
      setPage18BoxesVisible(false)
      setPage18ShowHelpText(true)
      setPage18HelpImageState(0)
    } else if (currentPage === 18) {
      // Page 19 - reset box states
      setPage19Box1Selected(false)
      setPage19Box2Selected(false)
      setPage19Box3Selected(false)
    } else if (currentPage === 19) {
      // Page 20 - reset box states
      setPage20Box1Selected(false)
      setPage20Box2Selected(false)
      setPage20Box3Selected(false)
      setPage20Box4Selected(false)
      setPage20Box5Selected(false)
      setPage20Box6Selected(false)
      setPage21ShowHelpImage(false)
    } else if (currentPage === 20) {
      // Page 21.1 - reset box states
      setPage21Box1Selected(false)
      setPage21Box2Selected(false)
      setPage21ShowHelpImage(false)
      setPage21ShowHelpText(true)
      setPage21BoxesVisible(false)
      setPage21Show21_2Image(false)
    } else if (currentPage === 21) {
      // Page 22 - reset box states
      setPage22Box1Selected(false)
      setPage22Box2Selected(false)
      setPage22Box3Selected(false)
      setPage22Box4Selected(false)
      setPage22Box5Selected(false)
      setPage22Box6Selected(false)
    } else if (currentPage === 22) {
      // Page 23 - reset box states
      setPage23Box1Selected(false)
      setPage23Box2Selected(false)
      setPage23Box3Selected(false)
    } else if (currentPage === 23) {
      // Page 24 - reset box states
      setPage24Box1Selected(false)
      setPage24ShowMainImage(false)
      setPage24ShowHelpText(true)
    }
    
    // Clear dimensions capture
    if (onDimensionsCapture) {
      onDimensionsCapture(null)
    }
  }, [currentPage, onDimensionsCapture])

  // Development function to jump to a specific page
  const handlePageSelect = useCallback((pageIndex, isPage7_1 = false, isPage8_1 = false, isPage10_1 = false, isPage10 = false, isPage12_1 = false, isPage5_1 = false, isPage18_1 = false, isPage21_1 = false, isPage21 = false) => {
    if (isPage5_1) {
      // Special case: 5.1.png - set page to 4 and show 5.1.png
      setCurrentPage(4)
      setPage5ShowHelpImage(true)
      // Reset box position for the new page
      setBoxPosition(getDefaultBoxPosition(4))
      // Reset dot positions
      setDot1Position(10)
      setDot2Position(60)
      setDot3Position({ x: 50, y: 50 })
    } else if (isPage7_1) {
      // Special case: 7.1.png - set page to 6 and enable box 4 selection
      setCurrentPage(6)
      setPage7Box4Selected(true)
      setPage7Box4EverSelected(true)
    } else if (isPage8_1) {
      // Special case: 8.1.png - set page to 7 and enable box 2 selection
      setCurrentPage(7)
      setPage8Box2Selected(true)
      setPage8Box3Selected(true)
      setPage8Box3WhiteBoxHidden(true)
      setPage8Box4Selected(true)
    } else if (isPage12_1) {
      // Special case: 12.1.png - set page to 11 and enable box 3 selection
      setCurrentPage(11)
      setPage12Box3Selected(true)
    } else if (isPage10_1) {
      // Special case: 10.1.png - set page to 9 and show 10.1.png
      setCurrentPage(9)
      setPage10BoxSelected(false)
      setPage10BoxesVisible(false)
      setPage10Box1Selected(false)
      setPage10Box2Selected(false)
      setPage10Box3Selected(false)
      setPage10Box4Selected(false)
      setPage10WhiteBoxesHidden(false)
      setPage10WhiteBox1Hidden(false)
      setPage10NeedHelpWhiteBoxVisible(false)
      setPage10WhiteBox3Hidden(false)
      // Reset box position for the new page
      setBoxPosition(getDefaultBoxPosition(9))
      // Reset dot positions
      setDot1Position(10)
      setDot2Position(60)
      setDot3Position({ x: 50, y: 50 })
    } else if (isPage18_1) {
      // Special case: 18.1.png - set page to 17 and show 18.1.png
      setCurrentPage(17)
      // Reset box position for the new page
      setBoxPosition(getDefaultBoxPosition(17))
      // Reset dot positions
      setDot1Position(10)
      setDot2Position(60)
      setDot3Position({ x: 50, y: 50 })
    } else if (isPage21_1) {
      // Special case: 21.1.png - set page to 20 and show 21.1.png (default)
      setCurrentPage(20)
      setPage21ShowHelpImage(false)
      // Reset box position for the new page
      setBoxPosition(getDefaultBoxPosition(20))
      // Reset dot positions
      setDot1Position(10)
      setDot2Position(60)
      setDot3Position({ x: 50, y: 50 })
    } else if (isPage10) {
      // Special case: 10.png - set page to 9 and show 10.png
      setCurrentPage(9)
      setPage10BoxSelected(true)
      setPage10BoxesVisible(false)
      setPage10Box1Selected(false)
      setPage10Box2Selected(false)
      setPage10Box3Selected(false)
      setPage10Box4Selected(false)
      setPage10WhiteBoxesHidden(false)
      setPage10WhiteBox3Hidden(false)
      setPage10NewWhiteBoxHidden(false)
      // Reset box position for the new page
      setBoxPosition(getDefaultBoxPosition(9))
      // Reset dot positions
      setDot1Position(10)
      setDot2Position(60)
      setDot3Position({ x: 50, y: 50 })
    } else {
      // Regular page selection
      setCurrentPage(pageIndex)
      // Reset box position for the new page
      setBoxPosition(getDefaultBoxPosition(pageIndex))
      // Reset dot positions
      setDot1Position(10)
      setDot2Position(60)
      setDot3Position({ x: 50, y: 50 })
    }
    setZoom(100)
  }, [])

  // Expose refresh function to parent
  useEffect(() => {
    if (onRefresh) {
      onRefresh(handleRefresh)
    }
  }, [onRefresh, handleRefresh])

  // Expose page select function to parent
  useEffect(() => {
    if (onPageSelect) {
      onPageSelect(handlePageSelect)
    }
  }, [onPageSelect, handlePageSelect])

  // Handler for page 1 button
  const handlePage1Button = () => {
    // Button is disabled once clicked, so this should only execute on first click
    // Reset returning state when button is clicked
    setReturningFromPage3(false)
    // Mark page 1 as visited
    setVisitedPages(prev => new Set(prev).add(1))
    // Move to next page
    if (currentPage < pages.length - 1) {
      setCurrentPage(prev => prev + 1)
      setZoom(100)
    }
  }

  // Handler for page 4 buttons
  const handlePage4Button1 = () => {
    setPage4Button1Clicked(true)
    setVisitedPages(prev => new Set(prev).add(3))
  }

  const handlePage4Button2 = () => {
    setPage4Button2Clicked(true)
  }

  const handlePage4Button3 = () => {
    setPage4Button3Clicked(true)
  }

  const handlePage4Button4 = () => {
    setPage4Button4Clicked(true)
  }

  const handlePage4Button5 = () => {
    setPage4Button5Clicked(true)
  }

  // Handler for page 4 speech bubble button
  const handlePage4SpeechBubble = () => {
    setPage4SpeechBubbleClicked(true)
  }

  // Handler for page 5 buttons
  const handlePage5Button1 = () => {
    setPage5Button1Clicked(true)
  }

  const handlePage5Button2 = () => {
    setPage5Button2Clicked(true)
  }

  // Handler for page 5 blue edge dot
  const handlePage5BlueDot = () => {
    setPage5BlueDotSelected(true)
  }

  const handlePage5GreenDot = () => {
    setPage5GreenDotSelected(true)
  }

  // Handler for page 5 "Show/Hide Connections" button
  const handlePage5NeedHelp = () => {
    // If already showing 5.1.png, immediately hide it and cancel timer
    if (page5ShowHelpImage) {
      if (page5HelpImageTimeoutRef.current) {
        clearTimeout(page5HelpImageTimeoutRef.current)
        page5HelpImageTimeoutRef.current = null
      }
      setPage5ShowHelpImage(false)
      return
    }
    
    // Clear any existing timeout
    if (page5HelpImageTimeoutRef.current) {
      clearTimeout(page5HelpImageTimeoutRef.current)
    }
    
    // Show 5.1.png
    setPage5ShowHelpImage(true)
    
    // After 5 seconds, revert back to 5.png
    page5HelpImageTimeoutRef.current = setTimeout(() => {
      setPage5ShowHelpImage(false)
      page5HelpImageTimeoutRef.current = null
    }, 5000)
  }

  // Handler for page 7 "Show/Hide Connections" button
  const handlePage7ShowConnections = () => {
    // Toggle between 7.png and 7.1.png - no auto reset
    if (page7Box4Selected) {
      // Currently showing 7.1.png, switch back to 7.png
      setPage7Box4Selected(false)
    } else {
      // Currently showing 7.png, switch to 7.1.png
      setPage7Box4Selected(true)
      setPage7Box4EverSelected(true)
    }
  }

  // Handler for page 6 buttons
  const handlePage6Button1 = () => {
    setPage6Button1Clicked(true)
  }

  const handlePage6Button2 = () => {
    setPage6Button2Clicked(true)
  }


  // Handler for page 7 boxes
  const handlePage7Box1 = () => {
    setPage7Box1Selected(prev => !prev)
  }

  const handlePage7Box2 = () => {
    setPage7Box2Selected(prev => !prev)
  }

  const handlePage7Box3 = () => {
    setPage7Box3Selected(prev => !prev)
  }

  const handlePage7Box4 = () => {
    setPage7Box4Selected(prev => {
      const newValue = !prev
      // Track if box 4 has ever been selected
      if (newValue) {
        setPage7Box4EverSelected(true)
      }
      return newValue
    })
  }

  // Handler for page 8 button box
  const handlePage8Box1 = () => {
    setPage8Box1Selected(true)
    // Clear any existing timeout
    if (page8WhiteBoxTimeoutRef.current) {
      clearTimeout(page8WhiteBoxTimeoutRef.current)
    }
    // Hide white box after 1 second delay
    page8WhiteBoxTimeoutRef.current = setTimeout(() => {
      setPage8WhiteBoxHidden(true)
      page8WhiteBoxTimeoutRef.current = null
    }, 1000)
  }

  const handlePage8Box2 = () => {
    setPage8Box2Selected(true)
    // Automatically select box 3 and box 4 when box 2 is selected
    setPage8Box3Selected(true)
    setPage8Box3WhiteBoxHidden(true)
    setPage8Box4Selected(true)
  }

  const handlePage8Box3 = () => {
    setPage8Box3Selected(true)
    setPage8Box3WhiteBoxHidden(true)
  }

  const handlePage8Box4 = () => {
    setPage8Box4Selected(true)
  }

  const handlePage9Box1 = () => {
    setPage9Box1Selected(true)
    setPage9WhiteBoxesHidden(true)
  }

  const handlePage9Box2 = () => {
    setPage9Box2Selected(true)
  }

  const handlePage9Box2b = () => {
    setPage9Box2bSelected(true)
    // Hide right white box immediately
    setPage9RightWhiteBoxHidden(true)
    if (page9RightWhiteBoxTimeoutRef.current) {
      clearTimeout(page9RightWhiteBoxTimeoutRef.current)
      page9RightWhiteBoxTimeoutRef.current = null
    }
  }

  const handlePage9Box3 = () => {
    setPage9Box3Selected(true)
    // Clear timeout if active (white box should already be hidden by box 2b)
    if (page9RightWhiteBoxTimeoutRef.current) {
      clearTimeout(page9RightWhiteBoxTimeoutRef.current)
      page9RightWhiteBoxTimeoutRef.current = null
    }
  }

  // Handler for page 10 "Show/Hide Wiring Diagram" button
  const handlePage10ShowConnections = () => {
    // If already showing 10.png, immediately hide it and cancel timer
    if (page10BoxSelected) {
      if (page10HelpImageTimeoutRef.current) {
        clearTimeout(page10HelpImageTimeoutRef.current)
        page10HelpImageTimeoutRef.current = null
      }
      setPage10BoxSelected(false)
      setPage10BoxesVisible(true)
      return
    }
    
    // Clear any existing timeout
    if (page10HelpImageTimeoutRef.current) {
      clearTimeout(page10HelpImageTimeoutRef.current)
    }
    
    // Show 10.png
    setPage10BoxSelected(true)
    setPage10BoxesVisible(false)
    
    // After 5 seconds, revert back to 10.1.png
    page10HelpImageTimeoutRef.current = setTimeout(() => {
      setPage10BoxSelected(false)
      setPage10BoxesVisible(true)
      page10HelpImageTimeoutRef.current = null
    }, 5000)
  }

  const handlePage10Box1 = () => {
    setPage10Box1Selected(true)
    // Hide white box over "Need Help?" box when box 1 is selected (same time as white box 3)
    setPage10NeedHelpWhiteBoxVisible(false)
    // Hide white box 3 when box 1 is selected
    setPage10WhiteBox3Hidden(true)
    // Hide white boxes if both box 1 and box 2 are now selected
    if (page10Box2Selected) {
      setPage10WhiteBoxesHidden(true)
    }
  }

  const handlePage10Box2 = () => {
    setPage10Box2Selected(true)
    // Hide white box 1 when box 2 is selected
    setPage10WhiteBox1Hidden(true)
    // Hide new white box when box 2 is selected
    setPage10NewWhiteBoxHidden(true)
    // Hide white box over "Need Help?" box when box 2 is selected
    setPage10NeedHelpWhiteBoxVisible(false)
    // Hide white boxes if both box 1 and box 2 are now selected
    if (page10Box1Selected) {
      setPage10WhiteBoxesHidden(true)
    }
  }

  const handlePage10Box3 = () => {
    setPage10Box3Selected(true)
  }

  const handlePage10Box4 = () => {
    setPage10Box4Selected(true)
  }

  const handlePage15Box = () => {
    if (page15BoxSelected) {
      // On 15.png: switch back to 15.1.png and show boxes
      setPage15BoxSelected(false)
      setPage15BoxesVisible(true)
      setPage15ShowHelpText(false)
    } else {
      // On 15.1.png
      if (!page15BoxesVisible) {
        // First click: show boxes on 15.1.png, hide "Need Help?" text
        setPage15BoxesVisible(true)
        setPage15ShowHelpText(false)
      } else {
        // Second click: switch to 15.png, keep boxes hidden
        setPage15BoxSelected(true)
        setPage15BoxesVisible(false)
        setPage15ShowHelpText(false)
      }
    }
  }

  const handlePage15Box1 = () => {
    setPage15Box1Selected(true)
  }

  const handlePage15Box2 = () => {
    setPage15Box2Selected(true)
  }

  const handlePage15Box3 = () => {
    setPage15Box3Selected(true)
  }

  const handlePage11Box = () => {
    setPage11BoxSelected(true)
  }

  const handlePage11Box2 = () => {
    setPage11Box2Selected(true)
  }

  const handlePage11Box3 = () => {
    setPage11Box3Selected(true)
  }

  const handlePage11Box4 = () => {
    setPage11Box4Selected(true)
  }

  const handlePage12Box1 = () => {
    setPage12Box1Selected(true)
  }

  const handlePage12Box2 = () => {
    setPage12Box2Selected(true)
  }

  const handlePage12Box3 = () => {
    setPage12Box3Selected(true)
    // When box 3 is selected, we transition to 12.1.png
    setPage12_1BoxSelected(true)
  }

  const handlePage12Box4 = () => {
    setPage12Box4Selected(true)
  }

  const handlePage13Box1 = () => {
    setPage13Box1Selected(true)
  }

  const handlePage13Box2 = () => {
    setPage13Box2Selected(true)
  }

  const handlePage13Box3 = () => {
    setPage13Box3Selected(true)
  }

  const handlePage13Box4 = () => {
    setPage13Box4Selected(true)
  }

  const handlePage14Box1 = () => {
    setPage14Box1Selected(true)
  }

  const handlePage14Box2 = () => {
    setPage14Box2Selected(true)
  }

  const handlePage14Box3 = () => {
    setPage14Box3Selected(true)
  }

  const handlePage14Box4 = () => {
    setPage14Box4Selected(true)
  }

  const handlePage14Box4b = () => {
    setPage14Box4bSelected(true)
  }

  const handlePage14Box5 = () => {
    setPage14Box5Selected(true)
  }

  const handlePage16Box1 = () => {
    setPage16Box1Selected(true)
  }

  const handlePage16Box2 = () => {
    setPage16Box2Selected(true)
  }


  const handlePage16Box3 = () => {
    setPage16Box3Selected(true)
  }

  const handlePage17Box1 = () => {
    setPage17Box1Selected(true)
  }

  const handlePage17Box2 = () => {
    setPage17Box2Selected(true)
  }

  const handlePage17Box3 = () => {
    setPage17Box3Selected(true)
  }

  const handlePage17Box4 = () => {
    setPage17Box4Selected(true)
  }

  const handlePage17Box4b = () => {
    setPage17Box4bSelected(true)
  }

  const handlePage18Box1 = () => {
    setPage18Box1Selected(true)
  }

  const handlePage18Box2 = () => {
    setPage18Box2Selected(true)
  }

  const handlePage18Box3 = () => {
    setPage18Box3Selected(true)
  }

  const handlePage18Box4 = () => {
    setPage18Box4Selected(true)
  }

  const handlePage19Box1 = () => {
    setPage19Box1Selected(true)
  }

  const handlePage19Box2 = () => {
    setPage19Box2Selected(true)
  }

  const handlePage19Box3 = () => {
    setPage19Box3Selected(true)
  }

  const handlePage20Box1 = () => {
    setPage20Box1Selected(true)
  }

  const handlePage20Box2 = () => {
    setPage20Box2Selected(true)
  }

  const handlePage20Box3 = () => {
    setPage20Box3Selected(true)
  }

  const handlePage20Box4 = () => {
    setPage20Box4Selected(true)
  }

  const handlePage20Box5 = () => {
    setPage20Box5Selected(true)
  }

  const handlePage20Box6 = () => {
    setPage20Box6Selected(true)
  }

  const handlePage21Box1 = () => {
    setPage21Box1Selected(true)
  }

  const handlePage21Box2 = () => {
    setPage21Box2Selected(true)
  }

  const handlePage21NeedHelp = () => {
    if (page21ShowHelpImage) {
      // On 21.png or 21.2.png: switch back to 21.1.png, keep boxes visible, reset 21.2.png state
      setPage21ShowHelpImage(false)
      setPage21BoxesVisible(true)
      setPage21ShowHelpText(false)
      setPage21Show21_2Image(false)
    } else {
      // On 21.1.png
      if (page21ShowHelpText) {
        // First click: hide white box, hide "Need Help?" text
        setPage21ShowHelpText(false)
      } else {
        // Second click: switch to 21.png, show boxes
        setPage21ShowHelpImage(true)
        setPage21BoxesVisible(true)
        setPage21Show21_2Image(false)
      }
    }
  }

  const handlePage21DuplicateButton = () => {
    // Toggle between 21.png and 21.2.png
    setPage21Show21_2Image(!page21Show21_2Image)
  }

  const handlePage22Box1 = () => {
    setPage22Box1Selected(true)
  }

  const handlePage22Box2 = () => {
    setPage22Box2Selected(true)
  }

  const handlePage22Box3 = () => {
    setPage22Box3Selected(true)
  }

  const handlePage22Box4 = () => {
    setPage22Box4Selected(true)
  }

  const handlePage22Box5 = () => {
    setPage22Box5Selected(true)
  }

  const handlePage22Box6 = () => {
    setPage22Box6Selected(true)
  }

  const handlePage23Box1 = () => {
    setPage23Box1Selected(true)
  }

  const handlePage23Box2 = () => {
    setPage23Box2Selected(true)
  }

  const handlePage23Box3 = () => {
    setPage23Box3Selected(true)
  }

  const handlePage24Box1 = () => {
    setPage24Box1Selected(true)
  }

  const handlePage24NeedHelp = () => {
    if (page24ShowHelpText) {
      // First click: hide "Need Help?" text
      setPage24ShowHelpText(false)
    } else {
      // Second click: switch to 24.png
      setPage24ShowMainImage(true)
    }
  }

  const handlePage18NeedHelp = () => {
    if (!page18BoxesVisible) {
      // First click: show text boxes on 18.1.png, hide "Need Help?" text
      setPage18BoxesVisible(true)
      setPage18ShowHelpText(false)
      setPage18HelpImageState(0) // Show 18.1.png
    } else {
      // Subsequent clicks: cycle through images
      // Second click: show 18.png
      // Third click: show 18.1.png again
      if (page18HelpImageState === 0) {
        setPage18HelpImageState(1) // Show 18.png
      } else if (page18HelpImageState === 1) {
        setPage18HelpImageState(2) // Show 18.1.png again
      } else {
        setPage18HelpImageState(0) // Reset to 18.1.png (cycle back)
      }
      // Keep page18BoxesVisible true and page18ShowHelpText false
    }
  }

  // Handler for page 3 speech bubble button
  const handlePage3Button = () => {
    setPage3ButtonClicked(true)
    // Don't navigate immediately - wait for second box to be clicked
  }

  const handlePage3SecondButton = () => {
    // Enable Next button when second box is clicked (don't navigate automatically)
    setPage3SecondButtonClicked(true)
  }

  // Handler for green box clicks on page 3
  const handleGreenBoxClick = (index) => {
    setSelectedGreenBoxes(prev => {
      const newSet = new Set(prev)
      if (newSet.has(index)) {
        newSet.delete(index) // Toggle off if already selected
      } else {
        newSet.add(index) // Toggle on if not selected
      }
      return newSet
    })
  }

  const handleZoomIn = () => {
    setZoom(prev => Math.min(prev + 25, 300))
  }

  const handleZoomOut = () => {
    setZoom(prev => Math.max(prev - 25, 50))
  }

  const handleReset = () => {
    setZoom(100)
  }

  // Track container size changes to ensure buttons scale correctly with panel resizing
  const [containerSize, setContainerSize] = useState({ width: 0, height: 0 })
  const [imageAspect, setImageAspect] = useState(DEFAULT_PAGE_ASPECT)
  const [imageNaturalSize, setImageNaturalSize] = useState({ width: 0, height: 0 })
  const [safetyGlassesSize, setSafetyGlassesSize] = useState({ width: 0, height: 0 })
  
  useEffect(() => {
    const updateContainerSize = () => {
      if (stageFrameRef.current) {
        const rect = stageFrameRef.current.getBoundingClientRect()
        setContainerSize({ width: rect.width, height: rect.height })
      }
    }
    
    updateContainerSize()
    
    const resizeObserver = new ResizeObserver(() => {
      updateContainerSize()
    })
    
    if (stageFrameRef.current) {
      resizeObserver.observe(stageFrameRef.current)
    }
    
    window.addEventListener('resize', updateContainerSize)
    
    return () => {
      resizeObserver.disconnect()
      window.removeEventListener('resize', updateContainerSize)
    }
  }, [currentPage])

  // Handle white box visibility on page 8
  useEffect(() => {
    if (currentPage === 7 && page8Box1Selected && !page8WhiteBoxHidden) {
      // If box 1 is already selected when arriving at page 8, hide white box immediately
      setPage8WhiteBoxHidden(true)
    } else if (currentPage !== 7) {
      // Reset white box state when not on page 8
      setPage8WhiteBoxHidden(false)
      if (page8WhiteBoxTimeoutRef.current) {
        clearTimeout(page8WhiteBoxTimeoutRef.current)
        page8WhiteBoxTimeoutRef.current = null
      }
    }
  }, [currentPage, page8Box1Selected, page8WhiteBoxHidden])

  // Initialize box when editor mode is enabled or page changes
  useEffect(() => {
    // Reset box position when page changes
    const defaultPosition = getDefaultBoxPosition(currentPage)
    setBoxPosition(defaultPosition)
    // Reset dot positions to default when page changes
    setDot1Position(10)
    setDot2Position(60)
    setDot3Position({ x: 50, y: 50 })
    // Reset page 3 button states when leaving page 3 (but keep page3SecondButtonClicked and selectedGreenBoxes to track state)
    if (currentPage !== 2) {
      setPage3ButtonClicked(false)
      // Don't reset page3SecondButtonClicked - we need to know if it was clicked when returning
      // Don't reset selectedGreenBoxes - we need to preserve selected state when returning
    }
    // When arriving at page 3, if second button was previously clicked, set returning state
    // This means the user has completed the page 3 flow and is returning
    if (currentPage === 2 && page3SecondButtonClicked) {
      setReturningToPage3AfterSecondButton(true)
      // Also set page3ButtonClicked to true so first button shows as disabled
      setPage3ButtonClicked(true)
    }
    // Reset returningFromPage3 when not on page 2
    if (currentPage !== 1) {
      setReturningFromPage3(false)
    }
    // Reset returningFromPage2 when not on page 1
    if (currentPage !== 0) {
      setReturningFromPage2(false)
    }
    // Reset returningToPage3AfterSecondButton when not on page 3
    if (currentPage !== 2) {
      setReturningToPage3AfterSecondButton(false)
    }
  }, [currentPage])

  // Trigger white boxes fade on page 2 when Start button was clicked
  useEffect(() => {
    if (currentPage === 1 && visitedPages.has(0) && !editorMode) {
      // Box 1: fade after 2 seconds
      const timer1 = setTimeout(() => {
        setBox1Fading(true)
      }, 2000)

      // Box 2: fade after 4 seconds
      const timer2 = setTimeout(() => {
        setBox2Fading(true)
      }, 4000)

      // Box 3: fade after 6 seconds
      const timer3 = setTimeout(() => {
        setBox3Fading(true)
      }, 6000)

      return () => {
        clearTimeout(timer1)
        clearTimeout(timer2)
        clearTimeout(timer3)
      }
    } else {
      // Reset fade states when leaving page 2
      setBox1Fading(false)
      setBox2Fading(false)
      setBox3Fading(false)
    }
  }, [currentPage, visitedPages, editorMode])

  // Trigger white boxes fade on page 4 when buttons are clicked
  useEffect(() => {
    if (currentPage === 3 && !editorMode) {
      // Check if all items have been selected (for returning to page 4)
      const checkedCount = (page4Checkbox1 ? 1 : 0) + (page4Checkbox2 ? 1 : 0) + (page4Checkbox3 ? 1 : 0)
      const allItemsSelected = page4SpeechBubbleClicked && 
                               checkedCount >= 2 && 
                               page4Button2Clicked && 
                               page4Button3Clicked && 
                               page4Button4Clicked && 
                               page4Button5Clicked
      
      // If all items are selected, immediately hide all boxes (no fade animation)
      if (allItemsSelected) {
        setPage4Box1Fading(true)
        setPage4Box2Fading(true)
        setPage4Box3Fading(true)
      } else {
        // Box 1: fade when speech bubble is clicked
        if (page4SpeechBubbleClicked) {
          setPage4Box1Fading(true)
        }
        
        // Box 2: fade when at least two checkboxes are selected
        if (checkedCount >= 2) {
          setPage4Box2Fading(true)
        }
        
        // Box 3: fade when all three small buttons (2, 3, 4) are clicked
        if (page4Button2Clicked && page4Button3Clicked && page4Button4Clicked) {
          setPage4Box3Fading(true)
        }
      }
    } else {
      // Reset fade states when leaving page 4 (only if not all items are selected)
      // If all items are selected, keep fade states so boxes remain hidden when returning
      const checkedCount = (page4Checkbox1 ? 1 : 0) + (page4Checkbox2 ? 1 : 0) + (page4Checkbox3 ? 1 : 0)
      const allItemsSelected = page4SpeechBubbleClicked && 
                               checkedCount >= 2 && 
                               page4Button2Clicked && 
                               page4Button3Clicked && 
                               page4Button4Clicked && 
                               page4Button5Clicked
      
      if (!allItemsSelected) {
        setPage4Box1Fading(false)
        setPage4Box2Fading(false)
        setPage4Box3Fading(false)
      }
      // Don't reset checkbox states - they should persist across page navigation
    }
  }, [currentPage, editorMode, page4SpeechBubbleClicked, page4Button1Clicked, page4Button2Clicked, page4Button3Clicked, page4Button4Clicked, page4Button5Clicked, page4Checkbox1, page4Checkbox2, page4Checkbox3])

  // Trigger safety glasses pop animation when landing on page 4 for the first time
  useEffect(() => {
    if (currentPage === 3 && !editorMode && !page4FirstVisit) {
      // Mark page 4 as visited
      setPage4FirstVisit(true)
      // Trigger the pop animation
      setSafetyGlassesPop(true)
      // Reset the animation state after animation completes (1000ms)
      const timer = setTimeout(() => {
        setSafetyGlassesPop(false)
      }, 1000)
      return () => clearTimeout(timer)
    }
  }, [currentPage, editorMode, page4FirstVisit])

  // Update dimensions when editor mode is enabled or page changes
  useEffect(() => {
    if (editorMode && boxPosition) {
      const dot1Coords = perimeterToCoordinates(dot1Position)
      const dot2Coords = perimeterToCoordinates(dot2Position)
      const dimensions = {
        page: currentPage + 1,
        left: boxPosition.left.toFixed(2),
        top: boxPosition.top.toFixed(2),
        width: boxPosition.width.toFixed(2),
        height: boxPosition.height.toFixed(2),
        right: (boxPosition.left + boxPosition.width).toFixed(2),
        bottom: (boxPosition.top + boxPosition.height).toFixed(2),
        dot1: {
          x: dot1Coords.x.toFixed(2),
          y: dot1Coords.y.toFixed(2),
          perimeter: dot1Position.toFixed(2)
        },
        dot2: {
          x: dot2Coords.x.toFixed(2),
          y: dot2Coords.y.toFixed(2),
          perimeter: dot2Position.toFixed(2)
        },
        dot3: {
          x: dot3Position.x.toFixed(2),
          y: dot3Position.y.toFixed(2)
        }
      }
      onDimensionsCapture(dimensions)
    }
  }, [editorMode, currentPage, boxPosition, dot1Position, dot2Position, dot3Position]) // Update when mode, page, position, or dot positions change

  // Get coordinates relative to image as percentage (always at 100% zoom level)
  const getRelativeCoordinates = (clientX, clientY) => {
    if (!stageRef.current || !imgRef.current) return null
    
    const wrapperRect = stageRef.current.getBoundingClientRect()
    const imgRect = imgRef.current.getBoundingClientRect()
    
    // Calculate the scale factor
    const scale = zoom / 100
    
    // Get the image's current display dimensions (already includes CSS transform scale)
    const imgScaledWidth = imgRect.width
    const imgScaledHeight = imgRect.height
    
    // Calculate the image dimensions at 100% zoom (divide by scale)
    const imgNaturalWidth = imgScaledWidth / scale
    const imgNaturalHeight = imgScaledHeight / scale
    
    // Get the center point of the image (center of wrapper since image is centered)
    const wrapperCenterX = wrapperRect.left + wrapperRect.width / 2
    const wrapperCenterY = wrapperRect.top + wrapperRect.height / 2
    
    // Calculate mouse position relative to wrapper center
    const mouseXFromCenter = clientX - wrapperCenterX
    const mouseYFromCenter = clientY - wrapperCenterY
    
    // Convert to image coordinates at 100% zoom
    // Since image scales from center, divide by scale to get 100% zoom coordinates
    const imgXAt100Zoom = mouseXFromCenter / scale
    const imgYAt100Zoom = mouseYFromCenter / scale
    
    // Convert to percentage relative to image size at 100% zoom
    // 0% = left/top edge of image, 50% = center, 100% = right/bottom edge
    const percentX = (imgXAt100Zoom / imgNaturalWidth) * 100 + 50
    const percentY = (imgYAt100Zoom / imgNaturalHeight) * 100 + 50
    
    return { 
      x: Math.max(0, Math.min(100, percentX)), 
      y: Math.max(0, Math.min(100, percentY)) 
    }
  }

  // Convert perimeter percentage (0-100) to x,y coordinates on the box edge
  // Perimeter: 0% = top-left, 25% = top-right, 50% = bottom-right, 75% = bottom-left, 100% = top-left
  const perimeterToCoordinates = (perimeterPercent) => {
    const { left, top, width, height } = boxPosition
    const perimeter = perimeterPercent % 100
    
    if (perimeter <= 25) {
      // Top edge: left to right
      const t = perimeter / 25
      return {
        x: left + width * t,
        y: top
      }
    } else if (perimeter <= 50) {
      // Right edge: top to bottom
      const t = (perimeter - 25) / 25
      return {
        x: left + width,
        y: top + height * t
      }
    } else if (perimeter <= 75) {
      // Bottom edge: right to left
      const t = (perimeter - 50) / 25
      return {
        x: left + width * (1 - t),
        y: top + height
      }
    } else {
      // Left edge: bottom to top
      const t = (perimeter - 75) / 25
      return {
        x: left,
        y: top + height * (1 - t)
      }
    }
  }

  // Convert x,y coordinates to perimeter percentage
  // Finds the closest point on the box perimeter to the given coordinates
  const coordinatesToPerimeter = (x, y) => {
    const { left, top, width, height } = boxPosition
    const right = left + width
    const bottom = top + height
    
    // Project point onto each edge and calculate distance
    // Top edge: from (left, top) to (right, top)
    const topT = Math.max(0, Math.min(1, (x - left) / width))
    const topProjX = left + width * topT
    const topProjY = top
    const distToTop = Math.sqrt(Math.pow(x - topProjX, 2) + Math.pow(y - topProjY, 2))
    
    // Right edge: from (right, top) to (right, bottom)
    const rightT = Math.max(0, Math.min(1, (y - top) / height))
    const rightProjX = right
    const rightProjY = top + height * rightT
    const distToRight = Math.sqrt(Math.pow(x - rightProjX, 2) + Math.pow(y - rightProjY, 2))
    
    // Bottom edge: from (right, bottom) to (left, bottom)
    const bottomT = Math.max(0, Math.min(1, (right - x) / width))
    const bottomProjX = right - width * bottomT
    const bottomProjY = bottom
    const distToBottom = Math.sqrt(Math.pow(x - bottomProjX, 2) + Math.pow(y - bottomProjY, 2))
    
    // Left edge: from (left, bottom) to (left, top)
    const leftT = Math.max(0, Math.min(1, (bottom - y) / height))
    const leftProjX = left
    const leftProjY = bottom - height * leftT
    const distToLeft = Math.sqrt(Math.pow(x - leftProjX, 2) + Math.pow(y - leftProjY, 2))
    
    // Find the closest edge
    const minDist = Math.min(distToTop, distToRight, distToBottom, distToLeft)
    
    let perimeter = 0
    
    if (minDist === distToTop) {
      // On top edge
      perimeter = topT * 25
    } else if (minDist === distToRight) {
      // On right edge
      perimeter = 25 + rightT * 25
    } else if (minDist === distToBottom) {
      // On bottom edge
      perimeter = 50 + bottomT * 25
    } else {
      // On left edge
      perimeter = 75 + leftT * 25
    }
    
    return perimeter
  }


  // Handle mouse down on box, resize handle, or dot
  const handleBoxMouseDown = (e) => {
    if (!editorMode) return
    
    const handle = e.target.dataset.handle
    const dotId = e.target.dataset.dot
    
    if (dotId === 'dot1' || dotId === 'dot2' || dotId === 'dot3') {
      // Starting dot drag
      e.preventDefault()
      e.stopPropagation()
      setIsDraggingDot(dotId)
      const coords = getRelativeCoordinates(e.clientX, e.clientY)
      if (coords) {
        if (dotId === 'dot3') {
          // For dot3, store the current position
          setDotDragStart({ x: coords.x, y: coords.y, startX: dot3Position.x, startY: dot3Position.y })
        } else {
          // For edge dots, store perimeter
          const currentPerimeter = dotId === 'dot1' ? dot1Position : dot2Position
          setDotDragStart({ x: coords.x, y: coords.y, perimeter: currentPerimeter })
        }
      }
    } else if (handle && ['n', 's', 'e', 'w'].includes(handle)) {
      // Starting resize on edge
      e.preventDefault()
      e.stopPropagation()
      setIsResizing(true)
      setResizeHandle(handle)
      const coords = getRelativeCoordinates(e.clientX, e.clientY)
      if (coords) {
        setDragStart(coords)
        setBoxStart(boxPosition)
      }
    } else if (e.target.classList.contains('resizable-box-content') || e.target.classList.contains('resizable-box')) {
      // Starting drag
      e.preventDefault()
      e.stopPropagation()
      setIsDragging(true)
      const coords = getRelativeCoordinates(e.clientX, e.clientY)
      if (coords) {
        setDragStart(coords)
        setBoxStart(boxPosition)
      }
    }
  }

  // Handle mouse move for dragging, resizing, or dot dragging
  const handleMouseMove = useCallback((e) => {
    if (!editorMode) return
    
    const coords = getRelativeCoordinates(e.clientX, e.clientY)
    if (!coords) return

    if (isDraggingDot) {
      if (isDraggingDot === 'dot3') {
        // Dot3 can move anywhere on the page
        const deltaX = coords.x - dotDragStart.x
        const deltaY = coords.y - dotDragStart.y
        let newX = dotDragStart.startX + deltaX
        let newY = dotDragStart.startY + deltaY
        // Keep within image bounds (0-100%)
        newX = Math.max(0, Math.min(100, newX))
        newY = Math.max(0, Math.min(100, newY))
        setDot3Position({ x: newX, y: newY })
      } else {
        // Calculate new dot position along perimeter for edge dots
        const newPerimeter = coordinatesToPerimeter(coords.x, coords.y)
        if (isDraggingDot === 'dot1') {
          setDot1Position(newPerimeter)
        } else if (isDraggingDot === 'dot2') {
          setDot2Position(newPerimeter)
        }
      }
    } else if (isDragging) {
      // Calculate new position
      const deltaX = coords.x - dragStart.x
      const deltaY = coords.y - dragStart.y
      
      let newLeft = boxStart.left + deltaX
      let newTop = boxStart.top + deltaY
      
      // Keep box within image bounds
      newLeft = Math.max(0, Math.min(100 - boxStart.width, newLeft))
      newTop = Math.max(0, Math.min(100 - boxStart.height, newTop))
      
      setBoxPosition(prev => ({
        ...prev,
        left: newLeft,
        top: newTop
      }))
    } else if (isResizing && resizeHandle) {
      // Calculate new size and position based on edge handle
      const deltaX = coords.x - dragStart.x
      const deltaY = coords.y - dragStart.y
      
      let newLeft = boxStart.left
      let newTop = boxStart.top
      let newWidth = boxStart.width
      let newHeight = boxStart.height
      
      // Handle different resize directions (only edges, not corners)
      if (resizeHandle === 'w') {
        // Resize from left edge
        newLeft = Math.max(0, boxStart.left + deltaX)
        newWidth = Math.max(2, boxStart.width - deltaX)
        if (newLeft + newWidth > 100) {
          newWidth = 100 - newLeft
        }
      } else if (resizeHandle === 'e') {
        // Resize from right edge
        newWidth = Math.max(2, boxStart.width + deltaX)
        if (newLeft + newWidth > 100) {
          newWidth = 100 - newLeft
        }
      } else if (resizeHandle === 'n') {
        // Resize from top edge
        newTop = Math.max(0, boxStart.top + deltaY)
        newHeight = Math.max(2, boxStart.height - deltaY)
        if (newTop + newHeight > 100) {
          newHeight = 100 - newTop
        }
      } else if (resizeHandle === 's') {
        // Resize from bottom edge
        newHeight = Math.max(2, boxStart.height + deltaY)
        if (newTop + newHeight > 100) {
          newHeight = 100 - newTop
        }
      }
      
      setBoxPosition(prev => ({
        ...prev,
        left: newLeft,
        top: newTop,
        width: newWidth,
        height: newHeight
      }))
    }
  }, [editorMode, isDragging, isResizing, isDraggingDot, resizeHandle, dragStart, boxStart, dotDragStart, dot3Position, zoom, boxPosition])

  // Handle mouse up
  const handleMouseUp = useCallback(() => {
    if (isDragging || isResizing || isDraggingDot) {
      setIsDragging(false)
      setIsResizing(false)
      setIsDraggingDot(null)
      setResizeHandle(null)
      // Dimensions will be updated by the useEffect watching boxPosition and dot positions
    }
  }, [isDragging, isResizing, isDraggingDot])

  // Set up global mouse event listeners
  useEffect(() => {
    if (editorMode && (isDragging || isResizing || isDraggingDot)) {
      document.addEventListener('mousemove', handleMouseMove)
      document.addEventListener('mouseup', handleMouseUp)
      return () => {
        document.removeEventListener('mousemove', handleMouseMove)
        document.removeEventListener('mouseup', handleMouseUp)
      }
    }
  }, [editorMode, isDragging, isResizing, isDraggingDot, handleMouseMove, handleMouseUp])

  // Update dimensions whenever box position or dot positions change (debounced after drag/resize)
  useEffect(() => {
    if (editorMode && !isDragging && !isResizing && !isDraggingDot) {
      const timeoutId = setTimeout(() => {
        const dot1Coords = perimeterToCoordinates(dot1Position)
        const dot2Coords = perimeterToCoordinates(dot2Position)
        const dimensions = {
          page: currentPage + 1,
          left: boxPosition.left.toFixed(2),
          top: boxPosition.top.toFixed(2),
          width: boxPosition.width.toFixed(2),
          height: boxPosition.height.toFixed(2),
          right: (boxPosition.left + boxPosition.width).toFixed(2),
          bottom: (boxPosition.top + boxPosition.height).toFixed(2),
          dot1: {
            x: dot1Coords.x.toFixed(2),
            y: dot1Coords.y.toFixed(2),
            perimeter: dot1Position.toFixed(2)
          },
          dot2: {
            x: dot2Coords.x.toFixed(2),
            y: dot2Coords.y.toFixed(2),
            perimeter: dot2Position.toFixed(2)
          },
          dot3: {
            x: dot3Position.x.toFixed(2),
            y: dot3Position.y.toFixed(2)
          }
        }
        onDimensionsCapture(dimensions)
      }, 100) // Small delay to batch updates
      
      return () => clearTimeout(timeoutId)
    }
  }, [boxPosition, dot1Position, dot2Position, dot3Position, editorMode, isDragging, isResizing, isDraggingDot, currentPage, onDimensionsCapture])

  // Calculate box style - scales with zoom (same as image)
  const getBoxStyle = () => {
    const scale = zoom / 100
    
    // To make the box scale from wrapper center (50%, 50%) like the image does,
    // we need to calculate where the wrapper center point is relative to the box itself
    // Wrapper center is at 50% 50% of wrapper
    // Box is positioned at boxPosition.left% boxPosition.top% of wrapper
    
    // The wrapper center point relative to the box:
    // X: How far into the box is the wrapper center horizontally
    const wrapperCenterRelativeToBoxLeft = (50 - boxPosition.left) / boxPosition.width * 100
    // Y: How far into the box is the wrapper center vertically  
    const wrapperCenterRelativeToBoxTop = (50 - boxPosition.top) / boxPosition.height * 100
    
    return {
      position: 'absolute',
      left: `${boxPosition.left}%`,
      top: `${boxPosition.top}%`,
      width: `${boxPosition.width}%`,
      height: `${boxPosition.height}%`,
      transform: `scale(${scale})`,
      transformOrigin: `${wrapperCenterRelativeToBoxLeft}% ${wrapperCenterRelativeToBoxTop}%`,
      border: '2px solid #0d6efd',
      backgroundColor: 'rgba(13, 110, 253, 0.1)',
      cursor: isDragging ? 'move' : 'default',
      zIndex: 20,
      boxSizing: 'border-box'
    }
  }

  // Calculate dot style - positions dot on the edge of the box
  const getDotStyle = (perimeterPercent) => {
    const coords = perimeterToCoordinates(perimeterPercent)
    const { left, top, width, height } = boxPosition
    
    // Calculate position relative to box (0-100% within box)
    const relativeX = ((coords.x - left) / width) * 100
    const relativeY = ((coords.y - top) / height) * 100
    
    return {
      position: 'absolute',
      left: `${relativeX}%`,
      top: `${relativeY}%`,
      width: '8px',
      height: '8px',
      transform: 'translate(-50%, -50%)',
      borderRadius: '50%',
      backgroundColor: '#ff6b6b',
      border: '2px solid white',
      boxShadow: '0 2px 4px rgba(0, 0, 0, 0.3)',
      cursor: 'pointer',
      zIndex: 25,
      pointerEvents: 'auto'
    }
  }

  // Calculate dot3 style - positions dot anywhere on the page
  const getDot3Style = () => {
    const scale = zoom / 100
    
    return {
      position: 'absolute',
      left: `${dot3Position.x}%`,
      top: `${dot3Position.y}%`,
      width: '8px',
      height: '8px',
      transform: 'translate(-50%, -50%)',
      borderRadius: '50%',
      backgroundColor: '#4ecdc4',
      border: '2px solid white',
      boxShadow: '0 2px 4px rgba(0, 0, 0, 0.3)',
      cursor: 'pointer',
      zIndex: 25,
      pointerEvents: 'auto'
    }
  }


  // Calculate button style - scales with zoom exactly like the image (from wrapper center)
  const getButtonStyle = (buttonLeft, buttonTop, buttonWidth, buttonHeight) => {
    const scale = zoom / 100
    
    // Calculate transform origin so button scales from wrapper center (50%, 50%) like the image does
    // The wrapper center point relative to the button:
    // X: How far into the button is the wrapper center horizontally
    const wrapperCenterRelativeToButtonLeft = (50 - buttonLeft) / buttonWidth * 100
    // Y: How far into the button is the wrapper center vertically  
    const wrapperCenterRelativeToButtonTop = (50 - buttonTop) / buttonHeight * 100
    
    return {
      position: 'absolute',
      left: `${buttonLeft}%`,
      top: `${buttonTop}%`,
      width: `${buttonWidth}%`,
      height: `${buttonHeight}%`,
      transform: `scale(${scale})`,
      transformOrigin: `${wrapperCenterRelativeToButtonLeft}% ${wrapperCenterRelativeToButtonTop}%`
    }
  }

  // Calculate page number style - scales with zoom exactly like the image (from wrapper center)
  // Page numbers are positioned at a point, so we treat them as a small box for scaling purposes
  const getPageNumberStyle = (pageNumberLeft, pageNumberTop) => {
    const scale = zoom / 100
    // Use a small box size for the page number (treating it like a button/box)
    // This ensures it scales correctly from the wrapper center
    const pageNumberWidth = 5 // percentage (small box size for the page number)
    const pageNumberHeight = 5 // percentage (small box size for the page number)
    
    // Adjust position: move left 20px and up 20px
    // Use imageNaturalSize for pixel-to-percentage conversion since page numbers are relative to the image
    const leftOffsetPx = -20 // negative because we're moving left
    const topOffsetPx = -20 // negative because we're moving up
    const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
    const topOffsetPercent = imageNaturalSize.height > 0 ? (topOffsetPx / imageNaturalSize.height) * 100 : 0
    
    const adjustedLeft = pageNumberLeft + leftOffsetPercent
    const adjustedTop = pageNumberTop + topOffsetPercent
    
    // Calculate transform origin so page number scales from wrapper center (50%, 50%) like the image does
    // The wrapper center point relative to the page number:
    // X: How far into the page number is the wrapper center horizontally
    const wrapperCenterRelativeToPageNumberLeft = (50 - adjustedLeft) / pageNumberWidth * 100
    // Y: How far into the page number is the wrapper center vertically  
    const wrapperCenterRelativeToPageNumberTop = (50 - adjustedTop) / pageNumberHeight * 100
    
    return {
      position: 'absolute',
      left: `${adjustedLeft}%`,
      top: `${adjustedTop}%`,
      width: `${pageNumberWidth}%`,
      height: `${pageNumberHeight}%`,
      transform: `scale(${scale})`,
      transformOrigin: `${wrapperCenterRelativeToPageNumberLeft}% ${wrapperCenterRelativeToPageNumberTop}%`
    }
  }

  const handleImageLoad = useCallback((event) => {
    if (!event?.target) return
    const { naturalWidth, naturalHeight } = event.target
    if (!naturalWidth || !naturalHeight) return
    const aspect = naturalWidth / naturalHeight
    setImageAspect(prev => {
      const previousAspect = prev ?? DEFAULT_PAGE_ASPECT
      if (Math.abs(previousAspect - aspect) < 0.0001) {
        return previousAspect
      }
      return aspect
    })
    setImageNaturalSize({ width: naturalWidth, height: naturalHeight })
  }, [])

  let stageWidthPx = 0
  let stageHeightPx = 0

  const stageStyle = (() => {
    const baseStyle = { cursor: editorMode ? 'default' : 'default' }
    if (!containerSize.width || !containerSize.height) {
      return baseStyle
    }
    const availableWidth = Math.max(containerSize.width - STAGE_FRAME_PADDING, 0)
    const availableHeight = Math.max(containerSize.height - STAGE_FRAME_PADDING, 0)
    if (!availableWidth || !availableHeight) {
      return baseStyle
    }
    const aspect = imageAspect || DEFAULT_PAGE_ASPECT
    let stageWidth = availableWidth
    let stageHeight = stageWidth / aspect
    
    if (stageHeight > availableHeight) {
      stageHeight = availableHeight
      stageWidth = stageHeight * aspect
    }
    
    stageWidthPx = stageWidth
    stageHeightPx = stageHeight
    
    return {
      ...baseStyle,
      width: `${stageWidth}px`,
      height: `${stageHeight}px`
    }
  })()
  
  // Calculate padding for wrapper when zoomed to create scrollable space
  const wrapperPadding = (() => {
    if (zoom === 100 || !stageHeightPx || !stageWidthPx) {
      return {}
    }
    const scale = zoom / 100
    // When image scales from center, it extends (scale - 1) / 2 on each side
    const paddingMultiplier = (scale - 1) / 2
    const paddingTop = stageHeightPx * paddingMultiplier
    const paddingBottom = stageHeightPx * paddingMultiplier
    const paddingLeft = stageWidthPx * paddingMultiplier
    const paddingRight = stageWidthPx * paddingMultiplier
    
    return {
      paddingTop: `${paddingTop}px`,
      paddingBottom: `${paddingBottom}px`,
      paddingLeft: `${paddingLeft}px`,
      paddingRight: `${paddingRight}px`
    }
  })()

  const stageRelativeScale = imageNaturalSize.height > 0 && stageHeightPx > 0
    ? stageHeightPx / imageNaturalSize.height
    : 1
  const buttonBorderWidth = Math.max(1, Math.min(2, 2 * stageRelativeScale))

  return (
    <div className={`instructions-panel ${zoom === 100 ? 'no-scrollbars' : ''} ${editorMode ? 'editor-mode' : ''}`}>
      <div className="instructions-background">
        <div className="instructions-content">
          <div className={`page-container ${zoom === 100 ? 'no-scrollbars' : ''}`}>
            <div className="page-wrapper" style={wrapperPadding}>
              <div className="page-stage-frame" ref={stageFrameRef}>
                <div 
                  className="page-stage"
                  ref={stageRef}
                  style={stageStyle}
                >
                  <img 
                    ref={imgRef}
                    src={(() => {
                      try {
                        if (currentPage === 4 && page5ShowHelpImage) return page5_1
                        if (currentPage === 6 && page7Box4Selected) return page7_1
                        if (currentPage === 7 && page8Box2Selected) return page8_1
                        if (currentPage === 9 && !page10BoxSelected) return page10_1
                        if (currentPage === 9) return page10
                        if (currentPage === 10) return page11
                        if (currentPage === 14 && page15BoxSelected) return page15
                        if (currentPage === 14) return page15_1
                        if (currentPage === 20 && page21ShowHelpImage && page21Show21_2Image) return page21_2
                        if (currentPage === 20 && page21ShowHelpImage) return page21
                        if (currentPage === 20) return page21_1
                        if (currentPage === 11 && page12Box3Selected) {
                          console.log('Switching to 12.1.png', { page12_1, page12Box3Selected, currentPage })
                          if (!page12_1) {
                            console.error('page12_1 is undefined!', { page12_1, page12Box3Selected, currentPage })
                            return page12 || page1
                          }
                          console.log('Returning page12_1:', page12_1)
                          return page12_1
                        }
                        if (currentPage === 11) {
                          if (!page12) {
                            console.error('page12 is undefined!')
                            return page1
                          }
                          return page12
                        }
                        if (currentPage === 17) {
                          // Show 18.png only when Need Help button has been clicked and page18HelpImageState === 1 (second click)
                          if (page18BoxesVisible && page18HelpImageState === 1) {
                            // Second click: show 18.png
                            if (!page18) {
                              console.error('page18 is undefined!')
                              return page1
                            }
                            return page18
                          } else {
                            // Show 18.1.png in all other cases (including when all 4 boxes are selected)
                            if (!page18_1) {
                              console.error('page18_1 is undefined!')
                              return page1
                            }
                            return page18_1
                          }
                        }
                        if (currentPage === 22 && page23Box1Selected) return page23_1
                        if (currentPage === 23 && page24ShowMainImage) return page24
                        if (currentPage === 23) return page24_1
                        if (pages[currentPage]) return pages[currentPage]
                        console.warn(`No image found for page ${currentPage}, using page1`)
                        return page1
                      } catch (error) {
                        console.error('Error determining image src:', error, { currentPage, pagesLength: pages.length })
                        return page1
                      }
                    })()} 
                    alt={`Instruction page ${currentPage + 1}`}
                    className="instruction-page"
                    onLoad={handleImageLoad}
                    onError={(e) => {
                      console.error('Image failed to load:', e.target.src, { currentPage, page12Box3Selected, page12_1 })
                      // Fallback to page12 if page12_1 fails to load
                      if (currentPage === 11 && page12Box3Selected && page12) {
                        console.log('Falling back to page12')
                        e.target.src = page12
                      }
                    }}
                    style={{ 
                      transform: `scale(${zoom / 100})`, 
                      transformOrigin: 'center center',
                      pointerEvents: editorMode ? 'none' : 'auto'
                    }}
                  />
                  {editorMode && (() => {
                    const dot1Coords = perimeterToCoordinates(dot1Position)
                    const dot2Coords = perimeterToCoordinates(dot2Position)
                    
                    return (
                      <>
                        {/* SVG for precise line rendering - using viewBox for percentage coordinates */}
                        <svg
                          style={{
                            position: 'absolute',
                            top: 0,
                            left: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            zIndex: 23
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          {/* Connecting line from dot1 to dot3 */}
                          <line
                            x1={dot1Coords.x}
                            y1={dot1Coords.y}
                            x2={dot3Position.x}
                            y2={dot3Position.y}
                            stroke="#4ecdc4"
                            strokeWidth="0.3"
                          />
                          {/* Connecting line from dot2 to dot3 */}
                          <line
                            x1={dot2Coords.x}
                            y1={dot2Coords.y}
                            x2={dot3Position.x}
                            y2={dot3Position.y}
                            stroke="#4ecdc4"
                            strokeWidth="0.3"
                          />
                        </svg>
                        {/* Resizable box with edge dots */}
                    <div 
                      ref={boxRef}
                      className="resizable-box"
                      style={getBoxStyle()}
                      onMouseDown={handleBoxMouseDown}
                    >
                      <div className="resizable-box-content" />
                      <div className="resize-handle resize-handle-n" data-handle="n" />
                      <div className="resize-handle resize-handle-s" data-handle="s" />
                      <div className="resize-handle resize-handle-e" data-handle="e" />
                      <div className="resize-handle resize-handle-w" data-handle="w" />
                          <div 
                            className="edge-dot"
                            data-dot="dot1"
                            style={getDotStyle(dot1Position)}
                            onMouseDown={handleBoxMouseDown}
                          />
                          <div 
                            className="edge-dot"
                            data-dot="dot2"
                            style={getDotStyle(dot2Position)}
                            onMouseDown={handleBoxMouseDown}
                          />
                    </div>
                        {/* Dot3 - positioned at the end of the connection lines */}
                        <div 
                          className="edge-dot dot3"
                          data-dot="dot3"
                          style={getDot3Style()}
                          onMouseDown={handleBoxMouseDown}
                        />
                      </>
                    )
                  })()}
                  {currentPage === 0 && !editorMode && (() => {
                    const buttonLeft = 44.36
                    const buttonTop = 59.30
                    const buttonWidth = 10.96
                    const buttonHeight = 3.86
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const isDisabled = visitedPages.has(0)
                    const startFontSize = Math.min(24, Math.max(8, 24 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    const adjustedLeft = Math.max(0, buttonLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, buttonTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, buttonWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, buttonHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    const buttonWidthPx = stageWidthPx > 0 ? (expandedWidth / 100) * stageWidthPx : 0
                    const displayWidthPx = buttonWidthPx * (zoom / 100)
                    const isStartButtonSmall = displayWidthPx > 0 && displayWidthPx <= START_BUTTON_SMALL_THRESHOLD
                    const startButtonBorderWidth = isStartButtonSmall ? 2 : 3
                    const expandedButtonStyle = {
                      ...buttonStyle,
                      left: `${adjustedLeft}%`,
                      top: `${adjustedTop}%`,
                      width: `${Math.max(0, expandedWidth)}%`,
                      height: `${Math.max(0, expandedHeight)}%`
                    }
                    
                    return (
                      <button 
                        onClick={handleStart}
                        disabled={isDisabled}
                        className={`page-start-button ${isDisabled ? 'disabled' : ''} ${isDisabled ? 'selected' : ''} ${returningFromPage2 ? 'returning-from-page2' : ''}`}
                        style={{
                          ...expandedButtonStyle,
                          backgroundColor: 'white',
                          color: returningFromPage2 ? '#f05f40' : '#0d6efd',
                          cursor: isDisabled ? 'default' : 'pointer',
                          fontSize: `${startFontSize}px`,
                          fontFamily: 'Roboto, sans-serif',
                          border: returningFromPage2 ? '2px solid #f05f40' : undefined
                        }}
                        aria-label="Start"
                      >
                        Start
                      </button>
                    )
                  })()}
                  {currentPage === 1 && !editorMode && (() => {
                    const buttonLeft = 29.77
                    const buttonTop = 83.75
                    const buttonWidth = 40.45
                    const buttonHeight = 4.22
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    // Once button has been clicked, it should always be disabled when returning to page 2
                    const isDisabled = visitedPages.has(1)
                    // Show orange edge if button has been clicked (regardless of where returning from)
                    const showOrangeEdge = visitedPages.has(1)
                    const readyFontSize = Math.min(18, Math.max(6, 18 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    // Calculate 43px downward offset as percentage of image natural height (fixed, doesn't change with panel resize)
                    const downwardOffset43pxPercent = imageNaturalSize.height > 0 ? (43 / imageNaturalSize.height) * 100 : 0
                    const adjustedLeft = Math.max(0, buttonLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, buttonTop - topOffsetAdjust + downwardOffset43pxPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, buttonWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, buttonHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    const buttonWidthPx = stageWidthPx > 0 ? (expandedWidth / 100) * stageWidthPx : 0
                    const displayWidthPx = buttonWidthPx * (zoom / 100)
                    const isReadyButtonSmall = displayWidthPx > 0 && displayWidthPx <= START_BUTTON_SMALL_THRESHOLD
                    const readyButtonBorderWidth = isReadyButtonSmall ? 2 : 3
                    const expandedButtonStyle = {
                      ...buttonStyle,
                      left: `${adjustedLeft}%`,
                      top: `${adjustedTop}%`,
                      width: `${Math.max(0, expandedWidth)}%`,
                      height: `${Math.max(0, expandedHeight)}%`
                    }
                    
                    return (
                      <button 
                        onClick={handlePage1Button}
                        disabled={isDisabled}
                        className={`page-start-button ${isDisabled ? 'disabled' : ''} ${isDisabled ? 'selected' : ''} ${showOrangeEdge ? 'returning-from-page3' : ''}`}
                        style={{
                          ...expandedButtonStyle,
                          backgroundColor: 'white',
                          color: '#000',
                          cursor: isDisabled ? 'default' : 'pointer',
                          fontSize: `${readyFontSize}px`,
                          fontFamily: 'Roboto, sans-serif',
                          fontWeight: 700,
                          border: showOrangeEdge ? '2px solid #f05f40' : undefined
                        }}
                        aria-label="I'm ready to build a drone controller"
                      >
                        I'm ready to build a drone controller
                      </button>
                    )
                  })()}
                  {/* Number "2" at Dot 3 position on page 2 */}
                  {currentPage === 1 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        2
                      </span>
                    </div>
                  )}
                  {/* Number "3" at Dot 3 position on page 3 */}
                  {currentPage === 2 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        3
                      </span>
                    </div>
                  )}
                  {/* Number "4" at Dot 3 position on page 4 */}
                  {currentPage === 3 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        4
                      </span>
                    </div>
                  )}
                  {/* Number "5" at Dot 3 position on page 5 */}
                  {currentPage === 4 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        5
                      </span>
                    </div>
                  )}
                  {/* Number "6" at Dot 3 position on page 6 */}
                  {currentPage === 5 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        6
                      </span>
                    </div>
                  )}
                  {/* Number "7" at Dot 3 position on page 7 (also shows on 7.1.png) */}
                  {currentPage === 6 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        7
                      </span>
                    </div>
                  )}
                  {/* Number "8" at Dot 3 position on page 8 */}
                  {currentPage === 7 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: 0,
                          top: 0,
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        8
                      </span>
                    </div>
                  )}
                  {/* White box on page 8 - displayed until button box 1 is selected (with 1 second delay) */}
                  {currentPage === 7 && !editorMode && !page8WhiteBoxHidden && (
                    <div
                      style={{
                        ...getButtonStyle(1.70, 42.44, 95.93, 47.73),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* Button box on page 8 */}
                  {currentPage === 7 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 26.48
                      const boxTop = 19.11
                      const boxWidth = 23.60
                      const boxHeight = 10.47
                      const dot1X = 45.51
                      const dot1Y = 29.58
                      const dot2X = 40.64
                      const dot2Y = 29.58
                      const dot3X = 54.73
                      const dot3Y = 33.81
                      const isSelected = page8Box1Selected
                      
                      // Move dot 1 to the right by 2px
                      const dot1RightPx = 2
                      const dot1RightPercent = stageWidthPx > 0 ? (dot1RightPx / stageWidthPx) * 100 : 0
                      const adjustedDot1X = dot1X + dot1RightPercent
                      
                      // Lower top edge down by 2px (reduce height)
                      const topEdgeDownPx = 2
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      const heightReducePx = 2
                      const heightReducePercent = stageHeightPx > 0 ? (heightReducePx / stageHeightPx) * 100 : 0
                      // Bring bottom edge up by 1px (moved down 1px from previous 2px up)
                      const bottomEdgeUpPx = 1
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - heightReducePercent - bottomEdgeUpPercent
                      
                      // Bring right edge to the left 3px (reduce width)
                      const rightEdgeLeftPx = 3
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxWidth = boxWidth - rightEdgeLeftPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot2 and dot1) to dot3
                      // Dot3 is BELOW the box (33.81% > 29.58%), so triangle points downward
                      const triangleBaseLeft = dot2X  // Left point on bottom edge (40.64%)
                      const triangleBaseRight = adjustedDot1X  // Right point on bottom edge (45.51% - moved left 1px)
                      const triangleBaseY = adjustedTop + expandedHeight  // Bottom edge Y position
                      const triangleTipX = dot3X  // Triangle tip X (54.73%)
                      const triangleTipY = dot3Y  // Triangle tip Y (33.81% - below the box)
                      
                      // Uniform corner radius for all four corners of the box (reduced for box 1 on page 8)
                      const borderRadiusPx = Math.min(20, Math.max(8, 20 * stageRelativeScale))
                      const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                      const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                      // Same corner radius applied to all four corners (top-left, top-right, bottom-left, bottom-right)
                      const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                      const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                      
                      const topLeft = 0
                      const topRight = 100
                      const topY = 0
                      const bottomY = 100
                      
                      const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                      const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                      const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                      const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                      
                      const speechBubblePath = `
                        M ${topLeft + borderRadiusWrapperX},${topY}
                        Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                        L ${topLeft},${bottomY - borderRadiusWrapperY}
                        Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                        L ${triangleBaseRightWrapper},${bottomY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                        Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                        L ${topRight},${topY + borderRadiusWrapperY}
                        Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        Z
                      `
                      
                      const leftBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${topY}
                        Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                        L ${topLeft},${bottomY - borderRadiusWrapperY}
                        Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      `
                      
                      const triangleLeftLegPath = `
                        M ${triangleBaseLeftWrapper},${bottomY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      const triangleRightLegPath = `
                        M ${triangleBaseRightWrapper},${bottomY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      
                      const rightBorderPath = `
                        M ${triangleBaseRightWrapper},${bottomY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                        Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                        L ${topRight},${topY + borderRadiusWrapperY}
                        Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      `
                      
                      const topBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${topY}
                        L ${topRight - borderRadiusWrapperX},${topY}
                      `
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage8Box1 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box'
                            }}
                          >
                          </div>
                          <svg
                            className="speech-bubble-svg"
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: 'none',
                              overflow: 'visible',
                              zIndex: 10
                            }}
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                          >
                            <defs>
                            </defs>
                            <path
                              d={speechBubblePath}
                              fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                              style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                            />
                            <g className="speech-bubble-border-group">
                              <path
                                d={leftBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleLeftLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleRightLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={rightBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={topBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                            </g>
                            <path
                              d={`M ${triangleBaseLeftWrapper},${bottomY} L ${triangleBaseRightWrapper},${bottomY}`}
                              fill="none"
                              stroke="transparent"
                              strokeWidth="0.3"
                              vectorEffect="non-scaling-stroke"
                            />
                          </svg>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Button box 2 on page 8 */}
                  {currentPage === 7 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 30.99
                      const boxTop = 54.10
                      const boxWidth = 24.06
                      const boxHeight = 6.30
                      const dot1BaseX = 33.57
                      const dot1Y = 54.10
                      const dot2X = 41.00
                      const dot2Y = 54.10
                      const dot3X = 27.92
                      const dot3Y = 52.26
                      const isSelected = page8Box2Selected
                      
                      // Lower top edge down by 2px (reduce height)
                      const topEdgeDownPx = 2
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      const heightReducePx = 2
                      const heightReducePercent = stageHeightPx > 0 ? (heightReducePx / stageHeightPx) * 100 : 0
                      // Bring bottom edge up by 2px (reduce height further)
                      const bottomEdgeUpPx = 2
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - heightReducePercent - bottomEdgeUpPercent
                      
                      // Bring left edge to the right 1px (moved left 2px from previous 3px right, keeping right edge in place)
                      const leftEdgeRightPx = 1
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Bring right edge to the left 3px (reduce width)
                      const rightEdgeLeftPx = 3
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      // Move dot 1 to the right by 6px (total)
                      const dot1RightOffsetPx = 6
                      const dot1RightOffsetPercent = stageWidthPx > 0 ? (dot1RightOffsetPx / stageWidthPx) * 100 : 0
                      const dot1X = dot1BaseX + dot1RightOffsetPercent
                      
                      // Move dot 3 to the left by 3px (moved left 1px from previous 2px left)
                      const dot3LeftPx = 3
                      const dot3LeftPercent = stageWidthPx > 0 ? (dot3LeftPx / stageWidthPx) * 100 : 0
                      const adjustedDot3X = dot3X - dot3LeftPercent
                      
                      // Move dot 3 up by 1px
                      const dot3UpPx = 1
                      const dot3UpPercent = stageHeightPx > 0 ? (dot3UpPx / stageHeightPx) * 100 : 0
                      const adjustedDot3Y = dot3Y - dot3UpPercent
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                      // Dot3 is ABOVE the box (52.26% < 54.10%), so triangle points upward
                      // Triangle base breaks the top edge at exact dot1 and dot2 X positions
                      // Use exact dot positions - dots are at the top edge where triangle should connect
                      const triangleBaseLeft = dot1X  // Left break point - exact dot1 X position (moved right 4px)
                      const triangleBaseRight = dot2X  // Right break point - exact dot2 X position (41.00%)
                      const triangleTipX = adjustedDot3X  // Triangle tip X (27.92% - moved left 3px)
                      const triangleTipY = adjustedDot3Y  // Triangle tip Y (52.26% - moved up 1px)
                      
                      // Reduced corner radius for box 2
                      const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                      const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                      const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                      // Same corner radius applied to all four corners (top-left, top-right, bottom-left, bottom-right)
                      const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                      const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                      
                      const topLeft = 0
                      const topRight = 100
                      const topY = 0
                      const bottomY = 100
                      
                      // Convert triangle base points to wrapper-relative coordinates
                      // Triangle base should break the top edge at the exact X positions of dot1 and dot2
                      // These coordinates must match where the dots are visually positioned
                      const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                      const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                      const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                      // Triangle tip is above the box, so calculate relative to wrapper (will be negative)
                      const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                      
                      const speechBubblePath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                        L ${triangleBaseRightWrapper},${topY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                        L ${topRight},${bottomY - borderRadiusWrapperY}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                        Z
                      `
                      
                      // Border paths - separate segments to exclude top edge between the two points
                      // Left border: from bottom-left corner up to first point on top edge (dot1 position)
                      const leftBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      `
                      
                      // Triangle border: two legs only (not the base between the points)
                      // Left leg: from dot1 to tip
                      const triangleLeftLegPath = `
                        M ${triangleBaseLeftWrapper},${topY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      // Right leg: from dot2 to tip
                      const triangleRightLegPath = `
                        M ${triangleBaseRightWrapper},${topY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      
                      // Right border: from second point on top edge (dot2 position) down to bottom-right corner
                      const rightBorderPath = `
                        M ${triangleBaseRightWrapper},${topY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                        L ${topRight},${bottomY - borderRadiusWrapperY}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      // Bottom border: complete bottom edge
                      const bottomBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        L ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage8Box2 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box'
                            }}
                          >
                          </div>
                          <svg
                            className="speech-bubble-svg"
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: 'none',
                              overflow: 'visible',
                              zIndex: 10
                            }}
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                          >
                            <defs>
                            </defs>
                            <path
                              d={speechBubblePath}
                              fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                              style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                            />
                            <g className="speech-bubble-border-group">
                              <path
                                d={leftBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleLeftLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleRightLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={rightBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={bottomBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                            </g>
                            <path
                              d={`M ${triangleBaseLeftWrapper},${topY} L ${triangleBaseRightWrapper},${topY}`}
                              fill="none"
                              stroke="transparent"
                              strokeWidth="0.3"
                              vectorEffect="non-scaling-stroke"
                            />
                          </svg>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* White box on page 8.1.png - displayed until button box 3 is selected, covering box 4 */}
                  {currentPage === 7 && !editorMode && page8Box2Selected && !page8Box3WhiteBoxHidden && (
                    <div
                      style={{
                        ...getButtonStyle(41.13, 77.60, 16.62, 7.51),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* Button box 3 on page 8.1.png - only shown when 8.1.png is displayed */}
                  {currentPage === 7 && !editorMode && page8Box2Selected && (
                    <>
                      {(() => {
                      const boxLeft = 32.34
                      const boxTop = 70.29
                      const boxWidth = 14.14
                      const boxHeight = 4.38
                      const dot1X = 46.48
                      const dot1Y = 70.96
                      const dot2X = 46.48
                      const dot2Y = 72.01
                      const dot3X = 51.13
                      const dot3Y = 69.67
                      const isSelected = page8Box3Selected
                      
                      // Move dot 1 down by 2px
                      const dot1DownPx = 2
                      const dot1DownPercent = stageHeightPx > 0 ? (dot1DownPx / stageHeightPx) * 100 : 0
                      const adjustedDot1Y = dot1Y + dot1DownPercent
                      
                      // Move dot 2 down by 1px
                      const dot2DownPx = 1
                      const dot2DownPercent = stageHeightPx > 0 ? (dot2DownPx / stageHeightPx) * 100 : 0
                      const adjustedDot2Y = dot2Y + dot2DownPercent
                      
                      // Move dot 3 to the right 1px and down 1px (moved left 1px from previous 2px right)
                      const dot3RightPx = 1
                      const dot3RightPercent = stageWidthPx > 0 ? (dot3RightPx / stageWidthPx) * 100 : 0
                      const dot3DownPx = 1
                      const dot3DownPercent = stageHeightPx > 0 ? (dot3DownPx / stageHeightPx) * 100 : 0
                      const adjustedDot3X = dot3X + dot3RightPercent
                      const adjustedDot3Y = dot3Y + dot3DownPercent
                      
                      // Lower top edge down by 2px (reduce height)
                      const topEdgeDownPx = 2
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      const heightReducePx = 2
                      const heightReducePercent = stageHeightPx > 0 ? (heightReducePx / stageHeightPx) * 100 : 0
                      // Bring bottom edge up by 2px (reduce height further)
                      const bottomEdgeUpPx = 2
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - heightReducePercent - bottomEdgeUpPercent
                      
                      // Bring left edge to the right 1px (moved left 1px from previous 2px right)
                      const leftEdgeRightPx = 1
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Bring right edge to the left 3px (reduce width)
                      const rightEdgeLeftPx = 3
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      // Calculate triangle - it extends from the RIGHT edge (between dot1 and dot2) to dot3
                      // Dot1 and Dot2 are both on the right edge (46.48%) at different Y positions
                      // Dot3 is above and to the right (51.13%, 69.67%), so triangle extends upward and rightward
                      const triangleBaseTop = adjustedDot1Y  // Top break point on right edge (70.96% - moved down 2px)
                      const triangleBaseBottom = adjustedDot2Y  // Bottom break point on right edge (72.01% - moved down 1px)
                      const triangleTipX = adjustedDot3X  // Triangle tip X (51.13% - moved left 2px)
                      const triangleTipY = adjustedDot3Y  // Triangle tip Y (69.67% - moved up 1px)
                      
                      // Reduced corner radius for box 3
                      const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                      const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                      const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                      const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                      const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                      
                      const topLeft = 0
                      const topRight = 100
                      const topY = 0
                      const bottomY = 100
                      
                      // Convert triangle base points to wrapper-relative coordinates
                      // Triangle base is on the right edge (at topRight = 100)
                      const triangleBaseTopWrapper = ((triangleBaseTop - adjustedTop) / expandedHeight) * 100
                      const triangleBaseBottomWrapper = ((triangleBaseBottom - adjustedTop) / expandedHeight) * 100
                      const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                      const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                      
                      const speechBubblePath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        L ${topRight - borderRadiusWrapperX},${topY}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                        ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topRight},${triangleBaseTopWrapper}` : ''}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                        L ${topRight},${triangleBaseBottomWrapper}
                        ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topRight},${bottomY - borderRadiusWrapperY}` : ''}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                        Z
                      `
                      
                      // Border paths - separate segments to exclude right edge between the two points
                      const leftBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        L ${topRight - borderRadiusWrapperX},${topY}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      `
                      
                      const topBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${topY}
                        L ${topRight - borderRadiusWrapperX},${topY}
                      `
                      
                      const triangleTopLegPath = `
                        M ${topRight},${triangleBaseTopWrapper}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      const triangleBottomLegPath = `
                        M ${topRight},${triangleBaseBottomWrapper}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      
                      const rightBorderTopPath = `
                        M ${topRight},${topY + borderRadiusWrapperY}
                        ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topRight},${triangleBaseTopWrapper}` : ''}
                      `
                      
                      const rightBorderBottomPath = `
                        M ${topRight},${triangleBaseBottomWrapper}
                        ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topRight},${bottomY - borderRadiusWrapperY}` : ''}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      const bottomBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        L ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage8Box3 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box'
                            }}
                          >
                          </div>
                          <svg
                            className="speech-bubble-svg"
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: 'none',
                              overflow: 'visible',
                              zIndex: 10
                            }}
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                          >
                            <defs>
                            </defs>
                            <path
                              d={speechBubblePath}
                              fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                              style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                            />
                            <g className="speech-bubble-border-group">
                              <path
                                d={leftBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={topBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleTopLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleBottomLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={rightBorderTopPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={rightBorderBottomPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={bottomBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                            </g>
                            <path
                              d={`M ${topRight},${triangleBaseTopWrapper} L ${topRight},${triangleBaseBottomWrapper}`}
                              fill="none"
                              stroke="transparent"
                              strokeWidth="0.3"
                              vectorEffect="non-scaling-stroke"
                            />
                          </svg>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Button box 4 on page 8.1.png - only shown when 8.1.png is displayed */}
                  {currentPage === 7 && !editorMode && page8Box2Selected && (
                    <>
                      {(() => {
                      const boxLeft = 41.80
                      const boxTop = 79.87
                      const boxWidth = 13.24
                      const boxHeight = 4.21
                      const dot1X = 49.31
                      const dot1Y = 79.87
                      const dot2X = 52.95
                      const dot2Y = 79.87
                      const dot3X = 56.08
                      const dot3Y = 77.86
                      const isSelected = page8Box4Selected
                      
                      // Move dot 1 down by 4px (2px + 2px additional)
                      const dot1DownPx = 4
                      const dot1DownPercent = stageHeightPx > 0 ? (dot1DownPx / stageHeightPx) * 100 : 0
                      const adjustedDot1Y = dot1Y + dot1DownPercent
                      
                      // Move dot 3 to the left 1px and down by 1px (moved left 1px from previous 1px right)
                      const dot3LeftPx = 1
                      const dot3LeftPercent = stageWidthPx > 0 ? (dot3LeftPx / stageWidthPx) * 100 : 0
                      const dot3DownPx = 1
                      const dot3DownPercent = stageHeightPx > 0 ? (dot3DownPx / stageHeightPx) * 100 : 0
                      const adjustedDot3X = dot3X - dot3LeftPercent
                      const adjustedDot3Y = dot3Y + dot3DownPercent
                      
                      // Lower top edge down by 2px (reduce height)
                      const topEdgeDownPx = 2
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      const heightReducePx = 2
                      const heightReducePercent = stageHeightPx > 0 ? (heightReducePx / stageHeightPx) * 100 : 0
                      // Bring bottom edge up by 2px (reduce height further)
                      const bottomEdgeUpPx = 2
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - heightReducePercent - bottomEdgeUpPercent
                      
                      // Bring left edge to the right 2px (moved left 1px from previous 3px right)
                      const leftEdgeRightPx = 2
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left 2px (reduce width)
                      const rightEdgeLeftPx = 2
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                      // Dot3 is ABOVE the box (77.86% < 79.87%), so triangle points upward
                      const triangleBaseLeft = dot1X  // Left break point - exact dot1 X position (49.31%)
                      const triangleBaseRight = dot2X  // Right break point - exact dot2 X position (52.95%)
                      const triangleTipX = adjustedDot3X  // Triangle tip X (56.08% - moved left 1px)
                      const triangleTipY = adjustedDot3Y  // Triangle tip Y (77.86% - moved down 1px)
                      
                      // Reduced corner radius for box 4
                      const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                      const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                      const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                      const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                      const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                      
                      const topLeft = 0
                      const topRight = 100
                      const topY = 0
                      const bottomY = 100
                      
                      // Convert triangle base points to wrapper-relative coordinates
                      const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                      const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                      const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                      const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                      
                      const speechBubblePath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                        L ${triangleBaseRightWrapper},${topY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                        L ${topRight},${bottomY - borderRadiusWrapperY}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                        Z
                      `
                      
                      // Border paths - separate segments to exclude top edge between the two points
                      const leftBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      `
                      
                      const triangleLeftLegPath = `
                        M ${triangleBaseLeftWrapper},${topY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      const triangleRightLegPath = `
                        M ${triangleBaseRightWrapper},${topY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      
                      const rightBorderPath = `
                        M ${triangleBaseRightWrapper},${topY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                        L ${topRight},${bottomY - borderRadiusWrapperY}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      const bottomBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        L ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected && page8Box3Selected ? handlePage8Box4 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected || !page8Box3Selected ? 'none' : 'auto',
                              cursor: isSelected || !page8Box3Selected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box'
                            }}
                          >
                          </div>
                          <svg
                            className="speech-bubble-svg"
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: 'none',
                              overflow: 'visible',
                              zIndex: 10
                            }}
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                          >
                            <defs>
                            </defs>
                            <path
                              d={speechBubblePath}
                              fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                              style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                            />
                            <g className="speech-bubble-border-group">
                              <path
                                d={leftBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleLeftLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleRightLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={rightBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={bottomBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                            </g>
                            <path
                              d={`M ${triangleBaseLeftWrapper},${topY} L ${triangleBaseRightWrapper},${topY}`}
                              fill="none"
                              stroke="transparent"
                              strokeWidth="0.3"
                              vectorEffect="non-scaling-stroke"
                            />
                          </svg>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Number "9" at Dot 3 position on page 9 */}
                  {currentPage === 8 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        9
                      </span>
                    </div>
                  )}
                  {/* White boxes on page 9 - displayed until button box 1 is selected */}
                  {currentPage === 8 && !editorMode && !page9WhiteBoxesHidden && (
                    <div
                      style={{
                        position: 'absolute',
                        left: '12.72%',
                        top: '42.70%',
                        width: '48.45%',
                        height: '33.92%',
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* Right white box on page 9 - displayed until box 2b is selected (with 0.75s delay), hides to reveal box 3 */}
                  {currentPage === 8 && !editorMode && !page9RightWhiteBoxHidden && (
                    <div
                      style={{
                        position: 'absolute',
                        left: '67.28%',
                        top: '25.41%',
                        width: '24.43%',
                        height: '33.92%',
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* Button box 1 on page 9 */}
                  {currentPage === 8 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 23.10
                      const boxTop = 27.99
                      const boxWidth = 36.45
                      const boxHeight = 5.77
                      const dot1X = 29.06
                      const dot1Y = 27.99
                      const dot2X = 38.08
                      const dot2Y = 27.99
                      const dot3X = 26.57
                      const dot3Y = 23.54
                      const isSelected = page9Box1Selected
                      
                      // Move left edge to the right 2px (reduce width)
                      const leftEdgeRightPx = 2
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left 2px (reduce width)
                      const rightEdgeLeftPx = 2
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                      
                      // Move top edge down 2px (reduce height)
                      const topEdgeDownPx = 2
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up 2px (reduce height further)
                      const bottomEdgeUpPx = 2
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                      // Dot3 is ABOVE the box (23.54% < 27.99%), so triangle points upward
                      const triangleBaseLeft = dot1X
                      const triangleBaseRight = dot2X
                      const triangleTipX = dot3X
                      const triangleTipY = dot3Y
                      
                      const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                      const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                      const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                      const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                      const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                      
                      const topLeft = 0
                      const topRight = 100
                      const topY = 0
                      const bottomY = 100
                      
                      const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                      const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                      const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                      const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                      
                      const speechBubblePath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                        L ${triangleBaseRightWrapper},${topY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                        L ${topRight},${bottomY - borderRadiusWrapperY}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                        Z
                      `
                      
                      const leftBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      `
                      
                      const triangleLeftLegPath = `
                        M ${triangleBaseLeftWrapper},${topY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      const triangleRightLegPath = `
                        M ${triangleBaseRightWrapper},${topY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      
                      const rightBorderPath = `
                        M ${triangleBaseRightWrapper},${topY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                        L ${topRight},${bottomY - borderRadiusWrapperY}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      const bottomBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        L ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage9Box1 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box'
                            }}
                          >
                          </div>
                          <svg
                            className="speech-bubble-svg"
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: 'none',
                              overflow: 'visible',
                              zIndex: 10
                            }}
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                          >
                            <defs>
                            </defs>
                            <path
                              d={speechBubblePath}
                              fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                              style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                            />
                            <g className="speech-bubble-border-group">
                              <path
                                d={leftBorderPath}
                                fill="none"
                                stroke={isSelected ? "#f05f40" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleLeftLegPath}
                                fill="none"
                                stroke={isSelected ? "#f05f40" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleRightLegPath}
                                fill="none"
                                stroke={isSelected ? "#f05f40" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={rightBorderPath}
                                fill="none"
                                stroke={isSelected ? "#f05f40" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={bottomBorderPath}
                                fill="none"
                                stroke={isSelected ? "#f05f40" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                            </g>
                            <path
                              d={`M ${triangleBaseLeftWrapper},${topY} L ${triangleBaseRightWrapper},${topY}`}
                              fill="none"
                              stroke="transparent"
                              strokeWidth="0.3"
                              vectorEffect="non-scaling-stroke"
                            />
                          </svg>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Button box 3 on page 9 (right side pointer box) - only active after box 2b is selected */}
                  {currentPage === 8 && !editorMode && page9RightWhiteBoxHidden && (
                    <>
                      {(() => {
                      const boxLeft = 69.06
                      const boxTop = 46.27
                      const boxWidth = 21.13
                      const boxHeight = 7.69
                      const dot1X = 72.77
                      const dot1Y = 46.27
                      const dot2X = 77.74
                      const dot2Y = 46.27
                      const dot3X = 71.40
                      const dot3Y = 42.86
                      const isSelected = page9Box2Selected
                      
                      // Move dot 2 to the right by 2px
                      const dot2RightOffsetPx = 2
                      const dot2RightOffsetPercent = imageNaturalSize.width > 0 ? (dot2RightOffsetPx / imageNaturalSize.width) * 100 : 0
                      const adjustedDot2X = dot2X + dot2RightOffsetPercent
                      
                      // Move left edge to the right 2px (reduce width)
                      const leftEdgeRightPx = 2
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left 2px (reduce width)
                      const rightEdgeLeftPx = 2
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                      
                      // Move top edge down 2px (reduce height)
                      const topEdgeDownPx = 2
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up 3px (reduce height further)
                      const bottomEdgeUpPx = 3
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                      // Dot3 is ABOVE the box (42.86% < 46.27%), so triangle points upward
                      const triangleBaseLeft = dot1X
                      const triangleBaseRight = adjustedDot2X
                      const triangleTipX = dot3X
                      const triangleTipY = dot3Y
                      
                      const borderRadiusPx = Math.min(15, Math.max(6, 15 * stageRelativeScale))
                      const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                      const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                      const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                      const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                      
                      const topLeft = 0
                      const topRight = 100
                      const topY = 0
                      const bottomY = 100
                      
                      const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                      const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                      const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                      const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                      
                      const speechBubblePath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                        L ${triangleBaseRightWrapper},${topY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                        L ${topRight},${bottomY - borderRadiusWrapperY}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                        Z
                      `
                      
                      const leftBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      `
                      
                      const triangleLeftLegPath = `
                        M ${triangleBaseLeftWrapper},${topY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      const triangleRightLegPath = `
                        M ${triangleBaseRightWrapper},${topY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      
                      const rightBorderPath = `
                        M ${triangleBaseRightWrapper},${topY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                        L ${topRight},${bottomY - borderRadiusWrapperY}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      const bottomBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        L ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={{...buttonStyle, zIndex: 101}}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage9Box2 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box'
                            }}
                          >
                          </div>
                          <svg
                            className="speech-bubble-svg"
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: 'none',
                              overflow: 'visible',
                              zIndex: 10
                            }}
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                          >
                            <defs>
                            </defs>
                            <path
                              d={speechBubblePath}
                              fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                              style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                            />
                            <g className="speech-bubble-border-group">
                              <path
                                d={leftBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleLeftLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleRightLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={rightBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={bottomBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                            </g>
                            <path
                              d={`M ${triangleBaseLeftWrapper},${topY} L ${triangleBaseRightWrapper},${topY}`}
                              fill="none"
                              stroke="transparent"
                              strokeWidth="0.3"
                              vectorEffect="non-scaling-stroke"
                            />
                          </svg>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Button box 2b on page 9 (between box 2 and box 3) - hidden until box 2 (large box) is selected */}
                  {currentPage === 8 && !editorMode && page9Box3Selected && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 34.37
                    const boxTop = 68.20
                    const boxWidth = 4.68
                    const boxHeight = 3.51
                    const isSelected = page9Box2bSelected
                    
                    // Move top edge down by 2px and left edge to the right by 2px (keep bottom and right edges in place)
                    const topEdgeDownPx = 2
                    const leftEdgeRightPx = 2
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    
                    // Move right edge to the left by 2px (reduce width, keep left edge in place)
                    const rightEdgeLeftPx = 2
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - leftEdgeRightPercent - rightEdgeLeftPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - topEdgeDownPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const strokeColor = isSelected ? "#3bbf6b" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    const fillColor = isSelected ? "#3bbf6b" : "rgba(255, 255, 255, 0.95)"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected && page9Box3Selected ? handlePage9Box2b : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected || !page9Box3Selected ? 'none' : 'auto',
                            cursor: isSelected || !page9Box3Selected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={fillColor}
                            style={{ fill: fillColor }}
                          />
                          <path
                            d={roundedRectPath}
                            fill="none"
                            stroke={strokeColor}
                            strokeWidth={strokeWidth}
                            style={{ stroke: strokeColor, strokeWidth: strokeWidth }}
                            className="speech-bubble-border"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Button box 2 on page 9 (large no pointer box) - visible after box 1 is selected */}
                  {currentPage === 8 && !editorMode && page9Box1Selected && (
                    <>
                      {(() => {
                      const boxLeft = 14.82
                      const boxTop = 46.49
                      const boxWidth = 43.78
                      const boxHeight = 27.25
                      const isSelected = page9Box3Selected
                      
                      // Move left edge to the right 2px (reduce width)
                      const leftEdgeRightPx = 2
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left 2px (reduce width)
                      const rightEdgeLeftPx = 2
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                      
                      // Move top edge down 2px (reduce height)
                      const topEdgeDownPx = 2
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up 3px (reduce height further)
                      const bottomEdgeUpPx = 3
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      const borderRadiusPx = Math.min(50, Math.max(20, 50 * stageRelativeScale))
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage9Box3 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box',
                              borderRadius: `${borderRadiusPx}px`,
                              backgroundColor: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)',
                              border: `${isSelected ? '2px' : '1px'} solid ${isSelected ? '#f05f40' : '#0d6efd'}`
                            }}
                          >
                          </div>
                        </div>
                      )
                      })()}
                    </>
                  )}
                  {/* Box 4 on page 10 (10.png and 10.1.png) - same style as box 2b on page 9 */}
                  {currentPage === 9 && !editorMode && page10Box3Selected && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 48.56
                    const boxTop = 88.40
                    const boxWidth = 3.13
                    const boxHeight = 2.52
                    const isSelected = page10Box4Selected
                    
                    // Reduce height: move top edge down 3px, bottom edge up 2px
                    const topEdgeDownPx = 3
                    const bottomEdgeUpPx = 2
                    const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                    const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                    const adjustedBoxTop = boxTop + topEdgeDownPercent
                    const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                    
                    // Reduce width: move left edge to the right 1px, right edge to the left 2px
                    const leftEdgeRightPx = 1
                    const rightEdgeLeftPx = 2
                    const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                    const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                    const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                    const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(6, Math.max(2, 6 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const strokeColor = isSelected ? "#3bbf6b" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    const fillColor = isSelected ? "#3bbf6b" : "transparent"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage10Box4 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={fillColor}
                            style={{ fill: fillColor }}
                          />
                          <path
                            d={roundedRectPath}
                            fill="none"
                            stroke={strokeColor}
                            strokeWidth={strokeWidth}
                            style={{ stroke: strokeColor, strokeWidth: strokeWidth }}
                            className="speech-bubble-border"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Number "10" at Dot 3 position on page 10 (also shows on 10.1.png) */}
                  {currentPage === 9 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        10
                      </span>
                    </div>
                  )}
                  {/* White box on page 11.png - hidden when box 1 is selected */}
                  {currentPage === 10 && !editorMode && !page11BoxSelected && (
                    <div
                      style={{
                        ...getButtonStyle(0.00, 47.49, 6.71, 3.51),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* White box 2 on page 11.png - hidden when box 1 is selected */}
                  {currentPage === 10 && !editorMode && !page11BoxSelected && (
                    <div
                      style={{
                        ...getButtonStyle(19.72, 56.89, 42.30, 13.61),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* White box 3 on page 11.png - hidden when box 2 is selected */}
                  {currentPage === 10 && !editorMode && !page11Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(20.40, 70.47, 34.64, 19.70),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* Box 4 on page 11 (11.png) - similar style to box 4 on page 10 */}
                  {currentPage === 10 && !editorMode && page11Box3Selected && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 36.43
                    const boxTop = 85.98
                    const boxWidth = 3.18
                    const boxHeight = 2.39
                    const isSelected = page11Box4Selected
                    
                    // Reduce width: move left edge to the right 2px, right edge to the left 2px
                    const leftEdgeRightPx = 2
                    const rightEdgeLeftPx = 2
                    const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                    const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                    const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                    const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                    
                    // Reduce height: move top edge down 2px, bottom edge up 1px
                    const topEdgeDownPx = 2
                    const bottomEdgeUpPx = 1
                    const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                    const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                    const adjustedBoxTop = boxTop + topEdgeDownPercent
                    const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(6, Math.max(2, 6 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const strokeColor = isSelected ? "#3bbf6b" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    const fillColor = isSelected ? "#3bbf6b" : "transparent"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage11Box4 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={fillColor}
                            style={{ fill: fillColor }}
                          />
                          <path
                            d={roundedRectPath}
                            fill="none"
                            stroke={strokeColor}
                            strokeWidth={strokeWidth}
                            style={{ stroke: strokeColor, strokeWidth: strokeWidth }}
                            className="speech-bubble-border"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Number "11" at Dot 3 position on page 11 */}
                  {currentPage === 10 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        11
                      </span>
                    </div>
                  )}
                  {/* Box 1 on page 12.png - with pointer (also shows on 12.1.png) */}
                  {currentPage === 11 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 48.48
                    const boxTop = 35.35
                    const boxWidth = 13.53
                    const boxHeight = 4.14
                    const dot1X = 56.65
                    const dot1Y = 39.49
                    const dot2X = 59.33
                    const dot2Y = 39.49
                    const dot3X = 61.15
                    const dot3Y = 41.56
                    const isSelected = page12Box1Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move top edge down by 4px and bottom edge up by 3px (reduce height)
                    const topEdgeDownPx = 4
                    const bottomEdgeUpPx = 3
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    // Move left edge to the right by 1px and keep right edge in place (reduce width)
                    const leftEdgeRightPx = 3
                    const rightEdgeLeftPx = 3
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop + expandedHeight
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage12Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 2 on page 12.png - with pointer (also shows on 12.1.png) */}
                  {currentPage === 11 && !editorMode && (() => {
                    const boxLeft = 12.96
                    const boxTop = 40.35
                    const boxWidth = 37.35
                    const boxHeight = 10.82
                    const dot1X = 19.60
                    const dot1Y = 51.17
                    const dot2X = 28.16
                    const dot2Y = 51.17
                    const dot3X = 22.29
                    const dot3Y = 53.66
                    const isSelected = page12Box2Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move top edge down by 4px and bottom edge up by 3px (reduce height)
                    const topEdgeDownPx = 4
                    const bottomEdgeUpPx = 3
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    // Move left edge to the right by 1px and right edge to the left by 2px (reduce width)
                    const leftEdgeRightPx = 1
                    const rightEdgeLeftPx = 2
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop + (expandedHeight / 100) * 100
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(22, Math.max(9, 22 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage12Box2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 13,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 3 on page 12.png - with pointer (also shows on 12.1.png) */}
                  {currentPage === 11 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 6.43
                    const boxTop = 76.04
                    const boxWidth = 42.76
                    const boxHeight = 8.04
                    const dot1X = 31.09
                    const dot1Y = 84.07
                    const dot2X = 41.68
                    const dot2Y = 84.07
                    const dot3X = 42.34
                    const dot3Y = 87.08
                    const isSelected = page12Box3Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move top edge down by 2px and bottom edge up by 3px (reduce height)
                    const topEdgeDownPx = 2
                    const bottomEdgeUpPx = 3
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    // Move left edge to the right by 1px and right edge to the left by 3px from current location (reduce width)
                    const leftEdgeRightPx = 2
                    const rightEdgeLeftPx = 5
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop + (expandedHeight / 100) * 100
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(15, Math.max(6, 15 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage12Box3 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 13,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 4 on page 12.png and 12.1.png - visible when box 3 is selected (bottom z-index) */}
                  {/* Show box 4 when box 3 is selected, on both 12.png and 12.1.png */}
                  {currentPage === 11 && page12Box3Selected && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 65.68
                    const boxTop = 76.91
                    const boxWidth = 29.91
                    const boxHeight = 3.16
                    const isSelected = page12Box4Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move top edge down by 2px and bottom edge up by 4px (reduce height)
                    const topEdgeDownPx = 2
                    const bottomEdgeUpPx = 4
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    // Move left edge to the right by 1px and right edge to the left by 4px (reduce width)
                    const leftEdgeRightPx = 1
                    const rightEdgeLeftPx = 4
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{ ...buttonStyle, zIndex: 1 }}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage12Box4 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 1,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 0
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* White box 1 on page 12.png - hidden when box 1 is selected (also shows on 12.1.png) */}
                  {currentPage === 11 && !editorMode && !page12Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(66.81, 45.40, 6.93, 4.03),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* White box 2 on page 12.png - hidden when box 1 is selected */}
                  {currentPage === 11 && !page12Box3Selected && !editorMode && !page12Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(66.81, 46.96, 15.94, 12.56),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* White box 3 on page 12.png - hidden when box 1 is selected (also shows on 12.1.png) */}
                  {currentPage === 11 && !editorMode && !page12Box1Selected && (() => {
                    const boxLeft = 10.04
                    const boxTop = 39.83
                    const boxWidth = 50.19
                    const boxHeight = 31.36
                    
                    // Reduce width by bringing right edge to the left 30px (20px + 10px more)
                    const rightEdgeLeftPx = 30
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const adjustedBoxWidth = Math.max(0, boxWidth - rightEdgeLeftPercent)
                    
                    return (
                      <div
                        style={{
                          ...getButtonStyle(boxLeft, boxTop, adjustedBoxWidth, boxHeight),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    )
                  })()}
                  {/* White box 4 on page 12.png - hidden when box 1 is selected */}
                  {currentPage === 11 && !editorMode && !page12Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(52.17, 49.92, 15.27, 17.44),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* White box 5 on page 12.png - hidden when box 2 is selected (also shows on 12.1.png) */}
                  {currentPage === 11 && !editorMode && !page12Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(0.00, 70.99, 100.00, 24.05),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* White box 6 on page 12.png - hidden when box 2 is selected (also shows on 12.1.png) */}
                  {currentPage === 11 && !editorMode && !page12Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(74.35, 61.76, 25.65, 33.28),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* White box on page 12.png - hidden when box 1 is selected - REMOVED */}
                  {false && currentPage === 11 && !editorMode && !page12Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(0.97, 11.39, 99.03, 20.28),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* Number "12" at Dot 3 position on page 12 (also shows on 12.1.png) */}
                  {currentPage === 11 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        12
                      </span>
                    </div>
                  )}
                  {/* Box 2 on page 13.png - with pointer - REMOVED */}
                  {false && currentPage === 12 && !editorMode && (() => {
                    const boxLeft = 12.51
                    const boxTop = 40.70
                    const boxWidth = 37.35
                    const boxHeight = 10.30
                    const dot1X = 18.70
                    const dot1Y = 51.00
                    const dot2X = 27.94
                    const dot2Y = 51.00
                    const dot3X = 22.29
                    const dot3Y = 53.66
                    const isSelected = page13Box2Selected
                    
                    // Adjust box height: top edge down 2px, bottom edge up 4px
                    const topDownPx = 2
                    const bottomUpPx = 4
                    const topDownPercent = imageNaturalSize.height > 0 ? (topDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomUpPercent = imageNaturalSize.height > 0 ? (bottomUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topDownPercent + bottomUpPercent
                    
                    // Adjust box width: left edge right 2px, right edge left 3px
                    const leftRightPx = 2
                    const rightLeftPx = 3
                    const leftRightPercent = imageNaturalSize.width > 0 ? (leftRightPx / imageNaturalSize.width) * 100 : 0
                    const rightLeftPercent = imageNaturalSize.width > 0 ? (rightLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftRightPercent + rightLeftPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop + expandedHeight
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(42, Math.max(14, 42 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      L ${topLeft + borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected && page13Box1Selected ? handlePage13Box2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected || !page13Box1Selected ? 'none' : 'auto',
                            cursor: isSelected || !page13Box1Selected ? 'default' : 'pointer',
                            zIndex: 13,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 3 on page 13.png - no pointer - REMOVED */}
                  {false && currentPage === 12 && !editorMode && (() => {
                    const boxLeft = 26.03
                    const boxTop = 73.95
                    const boxWidth = 47.71
                    const boxHeight = 17.61
                    const isSelected = page13Box3Selected
                    
                    // Adjust box height: top edge down 3px, bottom edge up 4px
                    const topDownPx = 3
                    const bottomUpPx = 4
                    const topDownPercent = imageNaturalSize.height > 0 ? (topDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomUpPercent = imageNaturalSize.height > 0 ? (bottomUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topDownPercent + bottomUpPercent
                    
                    // Adjust box width: left edge right 3px, right edge left 2px
                    const leftRightPx = 3
                    const rightLeftPx = 2
                    const leftRightPercent = imageNaturalSize.width > 0 ? (leftRightPx / imageNaturalSize.width) * 100 : 0
                    const rightLeftPercent = imageNaturalSize.width > 0 ? (rightLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftRightPercent + rightLeftPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(35, Math.max(14, 35 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 12}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected && page13Box2Selected ? handlePage13Box3 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected || !page13Box2Selected ? 'none' : 'auto',
                            cursor: isSelected || !page13Box2Selected ? 'default' : 'pointer',
                            zIndex: 13,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* White box 1 on page 13.png - hidden when box 1 (with pointer) is selected - REMOVED */}
                  {false && currentPage === 12 && !editorMode && !page13Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(72.06, 45.22, 6.19, 3.34),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 2 on page 13.png - hidden when box 1 (with pointer) is selected - REMOVED */}
                  {false && currentPage === 12 && !editorMode && !page13Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(73.41, 46.09, 14.75, 11.69),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 3 on page 13.png - hidden when box 1 (with pointer) is selected - REMOVED */}
                  {false && currentPage === 12 && !editorMode && !page13Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(9.65, 38.96, 41.79, 12.56),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 4 on page 13.png - hidden when box 1 (with pointer) is selected - REMOVED */}
                  {false && currentPage === 12 && !editorMode && !page13Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(14.83, 49.75, 10.47, 4.79),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 5 on page 13.png - hidden when box 1 (with pointer) is selected - REMOVED */}
                  {false && currentPage === 12 && !editorMode && !page13Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(23.39, 49.75, 5.85, 2.44),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 5b on page 13.png - hidden when box 1 (with pointer) is selected - REMOVED */}
                  {false && currentPage === 12 && !editorMode && !page13Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(24.10, 50.64, 2.96, 2.00),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 6 on page 13.png - hidden when box 2 (with pointer) is selected - REMOVED */}
                  {false && currentPage === 12 && !editorMode && !page13Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(23.39, 72.15, 53.58, 21.57),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 1 on page 13.png - hidden when box 1 is selected - bottom z-index */}
                  {currentPage === 12 && !editorMode && !page13Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(40.45, 81.36, 18.69, 7.64),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 2 on page 13.png - hidden when box 1 is selected - bottom z-index */}
                  {currentPage === 12 && !editorMode && !page13Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(48.60, 84.12, 13.21, 5.57),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* Box 1 on page 13.png - with pointer */}
                  {currentPage === 12 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 50.26
                    const boxTop = 63.96
                    const boxWidth = 27.58
                    const boxHeight = 19.14
                    const dot1X = 54.20
                    const dot1Y = 63.96
                    const dot2X = 60.00
                    const dot2Y = 63.96
                    const dot3X = 49.11
                    const dot3Y = 62.41
                    const isSelected = page13Box1Selected
                    
                    // Move dot 1 to the right 3px
                    const dot1RightPx = 3
                    const dot1RightPercent = imageNaturalSize.width > 0 ? (dot1RightPx / imageNaturalSize.width) * 100 : 0
                    const adjustedDot1X = dot1X + dot1RightPercent
                    
                    // Reduce width: move left edge to the right 4px, right edge to the left 4px
                    const leftEdgeRightPx = 4
                    const rightEdgeLeftPx = 4
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                    const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                    
                    // Reduce height: move top edge down 4px, bottom edge up 5px
                    const topEdgeDownPx = 4
                    const bottomEdgeUpPx = 5
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const adjustedBoxTop = boxTop + topEdgeDownPercent
                    const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                    // Dot3 is ABOVE the box (62.41% < 63.96%), so triangle points upward
                    const triangleBaseLeft = adjustedDot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(40, Math.max(16, 40 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      L ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      M ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 12}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage13Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 12,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Number "13" at Dot 3 position on page 13 */}
                  {currentPage === 12 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        13
                      </span>
                    </div>
                  )}
                  {/* Box 1 on page 14.png - with pointer (downward) */}
                  {currentPage === 13 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 26.71
                    const boxTop = 27.64
                    const boxWidth = 11.66
                    const boxHeight = 4.21
                    const dot1X = 34.02
                    const dot1Y = 31.85
                    const dot2X = 36.95
                    const dot2Y = 31.85
                    const dot3X = 38.51
                    const dot3Y = 33.98
                    const isSelected = page14Box1Selected
                    
                    // Move dot 2 to the left by 3px
                    const dot2LeftOffsetPx = 3
                    const dot2LeftOffsetPercent = imageNaturalSize.width > 0 ? (dot2LeftOffsetPx / imageNaturalSize.width) * 100 : 0
                    const adjustedDot2X = dot2X - dot2LeftOffsetPercent
                    
                    // Move top edge down by 5px, keep bottom edge up by 5px (reduce height)
                    const topEdgeDownPx = 5
                    const bottomEdgeUpPx = 5
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    // Move left edge to the right by 3px and right edge to the left by 3px (reduce width)
                    const leftEdgeRightPx = 3
                    const rightEdgeLeftPx = 3
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = adjustedDot2X
                    const triangleBaseY = adjustedTop + expandedHeight
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage14Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 2 on page 14.png - with pointer (upward) */}
                  {currentPage === 13 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 60.95
                    const boxTop = 41.39
                    const boxWidth = 15.27
                    const boxHeight = 5.08
                    const dot1X = 63.08
                    const dot1Y = 41.39
                    const dot2X = 66.69
                    const dot2Y = 41.39
                    const dot3X = 62.39
                    const dot3Y = 40.25
                    const isSelected = page14Box2Selected
                    
                    // Move dot 1 to the right by 5px
                    const dot1RightOffsetPx = 5
                    const dot1RightOffsetPercent = imageNaturalSize.width > 0 ? (dot1RightOffsetPx / imageNaturalSize.width) * 100 : 0
                    const adjustedDot1X = dot1X + dot1RightOffsetPercent
                    
                    // Adjust height: move top edge down 4px, bottom edge down 1px
                    const topEdgeDownPx = 4
                    const bottomEdgeDownPx = 1
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeDownPercent = imageNaturalSize.height > 0 ? (bottomEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    
                    // Move left edge to the right by 5px and right edge to the left by 1px (reduce width)
                    const leftEdgeRightPx = 5
                    const rightEdgeLeftPx = 1
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust + bottomEdgeDownPercent - topEdgeDownPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = adjustedDot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      L ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      M ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected && page14Box1Selected ? handlePage14Box2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected || !page14Box1Selected ? 'none' : 'auto',
                            cursor: isSelected || !page14Box1Selected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 3 on page 14.png - no pointer */}
                  {currentPage === 13 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 9.13
                    const boxTop = 35.82
                    const boxWidth = 24.51
                    const boxHeight = 12.74
                    const isSelected = page14Box3Selected
                    
                    // Adjust box height: top edge down 4px, bottom edge up 4px
                    const topDownPx = 4
                    const bottomUpPx = 4
                    const topDownPercent = imageNaturalSize.height > 0 ? (topDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomUpPercent = imageNaturalSize.height > 0 ? (bottomUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topDownPercent + bottomUpPercent
                    
                    // Reduce box width: move left edge to the right 4px, move right edge to the left 1px
                    const leftRightPx = 4
                    const rightLeftPx = 1
                    const leftRightPercent = imageNaturalSize.width > 0 ? (leftRightPx / imageNaturalSize.width) * 100 : 0
                    const rightLeftPercent = imageNaturalSize.width > 0 ? (rightLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftRightPercent + rightLeftPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(26, Math.max(11, 26 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected && page14Box2Selected ? handlePage14Box3 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected || !page14Box2Selected ? 'none' : 'auto',
                            cursor: isSelected || !page14Box2Selected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 4 on page 14.png - no pointer */}
                  {currentPage === 13 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 60.73
                    const boxTop = 53.41
                    const boxWidth = 27.66
                    const boxHeight = 11.52
                    const isSelected = page14Box4Selected
                    
                    // Increase box height: top edge up 36px, bottom edge down 25px
                    const topUpPx = 36
                    const bottomDownPx = 25
                    const topUpPercent = imageNaturalSize.height > 0 ? (topUpPx / imageNaturalSize.height) * 100 : 0
                    const bottomDownPercent = imageNaturalSize.height > 0 ? (bottomDownPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightIncreasePercent = topUpPercent + bottomDownPercent
                    
                    // Adjust box width: move left edge to the right 4px, keep right edge in current location (25px right)
                    const leftRightPx = 4
                    const rightRightPx = 25
                    const leftRightPercent = imageNaturalSize.width > 0 ? (leftRightPx / imageNaturalSize.width) * 100 : 0
                    const rightRightPercent = imageNaturalSize.width > 0 ? (rightRightPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthIncreasePercent = rightRightPercent - leftRightPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust - topUpPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust + totalWidthIncreasePercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust + totalHeightIncreasePercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(30, Math.max(8, 30 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected && page14Box3Selected ? handlePage14Box4 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected || !page14Box3Selected ? 'none' : 'auto',
                            cursor: isSelected || !page14Box3Selected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Button box 4b on page 14 - same style as box 2b on page 9 - hidden until box 4 is selected */}
                  {currentPage === 13 && !editorMode && page14Box4Selected && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 74.70
                    const boxTop = 64.55
                    const boxWidth = 3.55
                    const boxHeight = 2.47
                    const isSelected = page14Box4bSelected
                    
                    // Reduce width: move left edge to the right 5px, right edge to the left 4px
                    const leftRightPx = 5
                    const rightLeftPx = 4
                    const leftRightPercent = imageNaturalSize.width > 0 ? (leftRightPx / imageNaturalSize.width) * 100 : 0
                    const rightLeftPercent = imageNaturalSize.width > 0 ? (rightLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftRightPercent + rightLeftPercent
                    
                    // Reduce height: move top edge down 3px, bottom edge up 3px
                    const topDownPx = 3
                    const bottomUpPx = 3
                    const topDownPercent = imageNaturalSize.height > 0 ? (topDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomUpPercent = imageNaturalSize.height > 0 ? (bottomUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topDownPercent + bottomUpPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(6, Math.max(2, 6 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const strokeColor = isSelected ? "#3bbf6b" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    const fillColor = isSelected ? "#3bbf6b" : "transparent"
                    
                    return (
                      <div 
                        className="speech-bubble-wrapper"
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage14Box4b : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={fillColor}
                            style={{ fill: fillColor }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={roundedRectPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              style={{ stroke: strokeColor, strokeWidth: strokeWidth }}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 5 on page 14.png - with pointer (leftward) - active when box 4b is selected */}
                  {currentPage === 13 && !editorMode && page14Box4bSelected && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 49.24
                    const boxTop = 80.56
                    const boxWidth = 19.10
                    const boxHeight = 5.08
                    const dot1XBase = 52.04
                    const dot1Y = 85.64
                    const dot2X = 57.00
                    const dot2Y = 85.64
                    const dot3XBase = 43.69
                    const dot3YBase = 88.13
                    const isSelected = page14Box5Selected
                    
                    // Move dot 1 to the right by 2px
                    const dot1RightPx = 2
                    const dot1RightPercent = imageNaturalSize.width > 0 ? (dot1RightPx / imageNaturalSize.width) * 100 : 0
                    const dot1X = dot1XBase + dot1RightPercent
                    
                    // Move dot 3 to the left by 2px and down by 1px
                    const dot3LeftPx = 2
                    const dot3DownPx = 1
                    const dot3LeftPercent = imageNaturalSize.width > 0 ? (dot3LeftPx / imageNaturalSize.width) * 100 : 0
                    const dot3DownPercent = imageNaturalSize.height > 0 ? (dot3DownPx / imageNaturalSize.height) * 100 : 0
                    const dot3X = dot3XBase - dot3LeftPercent
                    const dot3Y = dot3YBase + dot3DownPercent
                    
                    // Reduce height: move top edge down 4px, bottom edge up 2px
                    const topEdgeDownPx = 4
                    const bottomEdgeUpPx = 2
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    // Reduce width: move left edge to the right 3px, right edge to the left 3px, then additional 1px left on right edge
                    const leftEdgeRightPx = 3
                    const rightEdgeLeftPx = 3
                    const rightEdgeLeftAdditionalPx = 1  // Additional 1px left movement for right edge
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftAdditionalPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftAdditionalPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent + rightEdgeLeftAdditionalPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends LEFTWARD from the bottom edge (at dot1 and dot2 X positions) to dot3
                    // Dot1 and dot2 are on the bottom edge at X positions 52.04% and 57.00%
                    // The triangle breaks the bottom edge and extends leftward to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop + expandedHeight  // Bottom edge Y position
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    // Convert triangle base points to wrapper-relative coordinates
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      L ${topLeft + borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    // Bottom border: from left corner to first triangle point, then from second triangle point to right corner
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage14Box5 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* White box on page 14.png - hidden when box 4b is selected */}
                  {currentPage === 13 && !editorMode && !page14Box4bSelected && (
                    <div
                      style={{
                        ...getButtonStyle(0.00, 69.60, 100.00, 25.10),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 14.png - hidden when box 1 is selected */}
                  {currentPage === 13 && !editorMode && !page14Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(55.55, 41.57, 21.80, 5.95),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 1b on page 14.png - hidden when box 1 is selected */}
                  {currentPage === 13 && !editorMode && !page14Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(55.32, 41.57, 22.70, 5.77),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 1c on page 14.png - hidden when box 1 is selected */}
                  {currentPage === 13 && !editorMode && !page14Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(60.28, 39.83, 17.52, 8.56),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 2 on page 14.png - hidden when box 3 is selected */}
                  {currentPage === 13 && !editorMode && !page14Box3Selected && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 56.90
                    const boxTop = 52.36
                    const boxWidth = 33.97
                    const boxHeight = 14.30
                    
                    // Increase height: move top edge up 30px (from current position), keep bottom edge at current position (20px down)
                    const topEdgeUpPx = 30
                    const bottomEdgeDownPx = 20
                    const topEdgeUpPercent = imageNaturalSize.height > 0 ? (topEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeDownPercent = imageNaturalSize.height > 0 ? (bottomEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    
                    // Increase width: move right edge to the right 10px, keep left edge in place
                    const rightEdgeRightPx = 10
                    const rightEdgeRightPercent = imageNaturalSize.width > 0 ? (rightEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust - topEdgeUpPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust + rightEdgeRightPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust + topEdgeUpPercent + bottomEdgeDownPercent)
                    
                    return (
                      <div
                        style={{
                          ...getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 1000,
                          position: 'absolute'
                        }}
                      />
                    )
                  })()}
                  {/* White box 3 on page 14.png - hidden when box 2 is selected */}
                  {currentPage === 13 && !editorMode && !page14Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(7.56, 34.95, 27.21, 14.30),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 3a on page 14.png - hidden when box 3 is selected */}
                  {currentPage === 13 && !editorMode && !page14Box3Selected && (
                    <div
                      style={{
                        ...getButtonStyle(45.41, 40.00, 4.55, 4.55),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 3b on page 14.png - hidden when box 3 is selected */}
                  {currentPage === 13 && !editorMode && !page14Box3Selected && (
                    <div
                      style={{
                        ...getButtonStyle(47.08, 40.20, 4.55, 4.55),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 3c on page 14.png - hidden when box 3 is selected */}
                  {currentPage === 13 && !editorMode && !page14Box3Selected && (
                    <div
                      style={{
                        ...getButtonStyle(34.01, 45.60, 21.67, 23.88),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 3d on page 14.png - hidden when box 3 is selected */}
                  {currentPage === 13 && !editorMode && !page14Box3Selected && (
                    <div
                      style={{
                        ...getButtonStyle(9.46, 49.95, 36.77, 19.35),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 3e on page 14.png - hidden when box 3 is selected */}
                  {currentPage === 13 && !editorMode && !page14Box3Selected && (
                    <div
                      style={{
                        ...getButtonStyle(53.60, 25.25, 7.30, 6.77),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 3f on page 14.png - hidden when box 3 is selected */}
                  {currentPage === 13 && !editorMode && !page14Box3Selected && (
                    <div
                      style={{
                        ...getButtonStyle(54.99, 26.14, 7.30, 6.77),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 3g on page 14.png - hidden when box 3 is selected */}
                  {currentPage === 13 && !editorMode && !page14Box3Selected && (
                    <div
                      style={{
                        ...getButtonStyle(57.04, 26.39, 3.94, 6.77),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* Number "14" at Dot 3 position on page 14 */}
                  {currentPage === 13 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        14
                      </span>
                    </div>
                  )}
                  {/* Number "15" at Dot 3 position on page 15.1 */}
                  {currentPage === 14 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        15
                      </span>
                    </div>
                  )}
                  {/* Box 1 on page 16.png - with pointer (leftward) */}
                  {currentPage === 15 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 67.94
                    const boxTop = 19.98
                    const boxWidth = 26.08
                    const boxHeight = 6.99
                    const dot1X = 67.94
                    const dot1Y = 23.96
                    const dot2X = 67.94
                    const dot2Y = 25.52
                    const dot3X = 61.72
                    const dot3Y = 26.85
                    const isSelected = page16Box1Selected
                    
                    // Move top edge down by 5px and bottom edge up by 4px (reduce height)
                    const topEdgeDownPx = 5
                    const bottomEdgeUpPx = 4
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    // Move left edge to the right by 2px and right edge to the left by 3px (reduce width)
                    const leftEdgeRightPx = 2
                    const rightEdgeLeftPx = 3
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends LEFTWARD from the left edge (between dot1 and dot2) to dot3
                    const triangleBaseTop = dot1Y
                    const triangleBaseBottom = dot2Y
                    const triangleBaseX = adjustedLeft
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseTopWrapper = ((triangleBaseTop - adjustedTop) / expandedHeight) * 100
                    const triangleBaseBottomWrapper = ((triangleBaseBottom - adjustedTop) / expandedHeight) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${triangleBaseBottomWrapper}` : ''}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      L ${topLeft + borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                      M ${topLeft},${triangleBaseBottomWrapper}
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${bottomY - borderRadiusWrapperY}` : ''}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleTopLegPath = `
                      M ${topLeft},${triangleBaseTopWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleBottomLegPath = `
                      M ${topLeft},${triangleBaseBottomWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage16Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleTopLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleBottomLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 2 on page 16.png - with pointer (leftward) */}
                  {currentPage === 15 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 63.66
                    const boxTop = 49.58
                    const boxWidth = 32.39
                    const boxHeight = 17.44
                    const dot1X = 63.66
                    const dot1Y = 59.64
                    const dot2X = 63.66
                    const dot2Y = 63.82
                    const dot3X = 55.41
                    const dot3Y = 59.23
                    const isSelected = page16Box2Selected
                    
                    // Move top edge down by 4px and bottom edge up by 2px (reduce height)
                    const topEdgeDownPx = 4
                    const bottomEdgeUpPx = 2
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    // Move left edge to the right by 3px and right edge to the left by 3px (reduce width)
                    const leftEdgeRightPx = 3
                    const rightEdgeLeftPx = 3
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends LEFTWARD from the left edge (between dot1 and dot2) to dot3
                    const triangleBaseTop = dot1Y
                    const triangleBaseBottom = dot2Y
                    const triangleBaseX = adjustedLeft
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(35, Math.max(14, 35 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseTopWrapper = ((triangleBaseTop - adjustedTop) / expandedHeight) * 100
                    const triangleBaseBottomWrapper = ((triangleBaseBottom - adjustedTop) / expandedHeight) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${triangleBaseBottomWrapper}` : ''}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      L ${topLeft + borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                      M ${topLeft},${triangleBaseBottomWrapper}
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${bottomY - borderRadiusWrapperY}` : ''}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleTopLegPath = `
                      M ${topLeft},${triangleBaseTopWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleBottomLegPath = `
                      M ${topLeft},${triangleBaseBottomWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage16Box2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleTopLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleBottomLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 3 on page 16.png - with pointer (leftward) */}
                  {currentPage === 15 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 50.14
                    const boxTop = 77.08
                    const boxWidth = 15.49
                    const boxHeight = 4.73
                    const dot1X = 50.14
                    const dot1Y = 79.67
                    const dot2X = 50.14
                    const dot2Y = 80.95
                    const dot3X = 45.72
                    const dot3Y = 81.69
                    const isSelected = page16Box3Selected
                    
                    // Move top edge down by 3px and bottom edge up by 2px (reduce height)
                    const topEdgeDownPx = 3
                    const bottomEdgeUpPx = 2
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    // Move left edge to the right by 2px and right edge to the left by 2px (reduce width)
                    const leftEdgeRightPx = 2
                    const rightEdgeLeftPx = 2
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends LEFTWARD from the left edge (between dot1 and dot2) to dot3
                    const triangleBaseTop = dot1Y
                    const triangleBaseBottom = dot2Y
                    const triangleBaseX = adjustedLeft
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseTopWrapper = ((triangleBaseTop - adjustedTop) / expandedHeight) * 100
                    const triangleBaseBottomWrapper = ((triangleBaseBottom - adjustedTop) / expandedHeight) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${triangleBaseBottomWrapper}` : ''}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      L ${topLeft + borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                      M ${topLeft},${triangleBaseBottomWrapper}
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${bottomY - borderRadiusWrapperY}` : ''}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleTopLegPath = `
                      M ${topLeft},${triangleBaseTopWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleBottomLegPath = `
                      M ${topLeft},${triangleBaseBottomWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage16Box3 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleTopLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleBottomLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* White box on page 16 - hidden when box 1 is selected */}
                  {currentPage === 15 && !editorMode && !page16Box1Selected && (
                    <div
                      style={{
                        position: 'absolute',
                        left: '0.00%',
                        top: '34.78%',
                        width: '98.63%',
                        height: '40.94%',
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* White box on page 16 - hidden when box 2 is selected */}
                  {currentPage === 15 && !editorMode && !page16Box2Selected && (
                    <div
                      style={{
                        position: 'absolute',
                        left: '24.11%',
                        top: '74.82%',
                        width: '73.85%',
                        height: '19.18%',
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* Number "16" at Dot 3 position on page 16 */}
                  {currentPage === 15 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        16
                      </span>
                    </div>
                  )}
                  {/* Box 1 on page 17.png - with pointer (downward) */}
                  {currentPage === 16 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 38.20
                    const boxTop = 30.77
                    const boxWidth = 11.89
                    const boxHeight = 4.21
                    const dot1XBase = 46.41
                    const dot1Y = 34.98
                    const dot2XBase = 48.44
                    const dot2Y = 34.98
                    const dot3X = 52.70
                    const dot3Y = 35.90
                    const isSelected = page17Box1Selected
                    
                    // Move dot 1 and dot 2 to the left by 2px
                    const dotLeftOffsetPx = 2
                    const dotLeftOffsetPercent = imageNaturalSize.width > 0 ? (dotLeftOffsetPx / imageNaturalSize.width) * 100 : 0
                    const dot1X = dot1XBase - dotLeftOffsetPercent
                    const dot2X = dot2XBase - dotLeftOffsetPercent
                    
                    // Reduce width: move left edge to the right 3px, right edge to the left 4px
                    const leftEdgeRightPx = 3
                    const rightEdgeLeftPx = 4
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Reduce height: move top edge down 3px, bottom edge up 4px, then additional 1px down on top edge and 1px up on bottom edge
                    const topEdgeDownPx = 3
                    const topEdgeDownAdditionalPx = 1  // Additional 1px down movement for top edge
                    const bottomEdgeUpPx = 4
                    const bottomEdgeUpAdditionalPx = 1  // Additional 1px up movement for bottom edge
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const topEdgeDownAdditionalPercent = imageNaturalSize.height > 0 ? (topEdgeDownAdditionalPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpAdditionalPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpAdditionalPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + topEdgeDownAdditionalPercent + bottomEdgeUpPercent + bottomEdgeUpAdditionalPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent + topEdgeDownAdditionalPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop + expandedHeight
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleTopLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleBottomLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage17Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleTopLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleBottomLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 2 on page 17.png - with pointer (rightward) */}
                  {currentPage === 16 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 33.92
                    const boxTop = 37.21
                    const boxWidth = 15.49
                    const boxHeight = 4.73
                    const dot1X = 49.41
                    const dot1YBase = 40.32
                    const dot2X = 49.41
                    const dot2Y = 41.36
                    const dot3XBase = 52.03
                    const dot3YBase = 40.60
                    const isSelected = page17Box2Selected
                    
                    // Move dot 1 up by 2px, then additional 2px up
                    const dot1UpPx = 2
                    const dot1UpAdditionalPx = 2  // Additional 2px up movement for dot 1
                    const dot1UpPercent = imageNaturalSize.height > 0 ? (dot1UpPx / imageNaturalSize.height) * 100 : 0
                    const dot1UpAdditionalPercent = imageNaturalSize.height > 0 ? (dot1UpAdditionalPx / imageNaturalSize.height) * 100 : 0
                    const dot1Y = dot1YBase - dot1UpPercent - dot1UpAdditionalPercent
                    
                    // Move dot 3 to the left by 3px and up by 1px, then additional 3px left, then additional 3px left
                    const dot3LeftPx = 3
                    const dot3LeftAdditionalPx = 3  // Additional 3px left movement for dot 3
                    const dot3LeftAdditional2Px = 3  // Additional 3px left movement for dot 3 from current location
                    const dot3UpPx = 1
                    const dot3LeftPercent = imageNaturalSize.width > 0 ? (dot3LeftPx / imageNaturalSize.width) * 100 : 0
                    const dot3LeftAdditionalPercent = imageNaturalSize.width > 0 ? (dot3LeftAdditionalPx / imageNaturalSize.width) * 100 : 0
                    const dot3LeftAdditional2Percent = imageNaturalSize.width > 0 ? (dot3LeftAdditional2Px / imageNaturalSize.width) * 100 : 0
                    const dot3UpPercent = imageNaturalSize.height > 0 ? (dot3UpPx / imageNaturalSize.height) * 100 : 0
                    const dot3X = dot3XBase - dot3LeftPercent - dot3LeftAdditionalPercent - dot3LeftAdditional2Percent
                    const dot3Y = dot3YBase - dot3UpPercent
                    
                    // Move left edge to the left 10px and right edge to the left 10px, then additional 5px left on both edges, then right edge to the right 1px
                    const leftEdgeLeftPx = 10
                    const leftEdgeLeftAdditionalPx = 5  // Additional 5px left movement for left edge
                    const rightEdgeLeftPx = 10
                    const rightEdgeLeftAdditionalPx = 5  // Additional 5px left movement for right edge
                    const rightEdgeRightPx = 1  // Move right edge to the right 1px
                    const rightEdgeRightAdditionalPx = 1  // Additional 1px right movement for right edge
                    const leftEdgeLeftPercent = imageNaturalSize.width > 0 ? (leftEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const leftEdgeLeftAdditionalPercent = imageNaturalSize.width > 0 ? (leftEdgeLeftAdditionalPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftAdditionalPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftAdditionalPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeRightPercent = imageNaturalSize.width > 0 ? (rightEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeRightAdditionalPercent = imageNaturalSize.width > 0 ? (rightEdgeRightAdditionalPx / imageNaturalSize.width) * 100 : 0
                    
                    // Move top edge up 2px (keep bottom edge in place)
                    const topEdgeUpPx = 2
                    const topEdgeUpPercent = imageNaturalSize.height > 0 ? (topEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust - leftEdgeLeftPercent - leftEdgeLeftAdditionalPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust - topEdgeUpPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - rightEdgeLeftPercent - rightEdgeLeftAdditionalPercent + rightEdgeRightPercent + rightEdgeRightAdditionalPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust + topEdgeUpPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends RIGHTWARD from the right edge (between dot1 and dot2) to dot3
                    const triangleBaseTop = dot1Y
                    const triangleBaseBottom = dot2Y
                    const triangleBaseX = adjustedLeft + expandedWidth
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseTopWrapper = ((triangleBaseTop - adjustedTop) / expandedHeight) * 100
                    const triangleBaseBottomWrapper = ((triangleBaseBottom - adjustedTop) / expandedHeight) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topRight},${triangleBaseBottomWrapper}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topRight},${triangleBaseTopWrapper}` : ''}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      L ${topLeft + borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleTopLegPath = `
                      M ${topRight},${triangleBaseTopWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleBottomLegPath = `
                      M ${topRight},${triangleBaseBottomWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topRight},${triangleBaseBottomWrapper}` : ''}
                      M ${topRight},${triangleBaseTopWrapper}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topRight},${topY + borderRadiusWrapperY}` : ''}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected && page17Box1Selected ? handlePage17Box2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected || !page17Box1Selected ? 'none' : 'auto',
                            cursor: isSelected || !page17Box1Selected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleTopLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleBottomLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 3 on page 17.png - simple box (no pointer) */}
                  {currentPage === 16 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 21.53
                    const boxTop = 73.60
                    const boxWidth = 27.89
                    const boxHeight = 10.30
                    const isSelected = page17Box3Selected
                    
                    // Reduce width: move left edge to the right 3px, right edge to the left 3px, then additional 1px right on left edge
                    const leftEdgeRightPx = 3
                    const leftEdgeRightAdditionalPx = 1  // Additional 1px right movement for left edge
                    const rightEdgeLeftPx = 3
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const leftEdgeRightAdditionalPercent = imageNaturalSize.width > 0 ? (leftEdgeRightAdditionalPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + leftEdgeRightAdditionalPercent + rightEdgeLeftPercent
                    
                    // Reduce height: move top edge down 4px, bottom edge up 3px
                    const topEdgeDownPx = 4
                    const bottomEdgeUpPx = 3
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent + leftEdgeRightAdditionalPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(20, Math.max(4, 20 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected && page17Box2Selected ? handlePage17Box3 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected || !page17Box2Selected ? 'none' : 'auto',
                            cursor: isSelected || !page17Box2Selected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <path
                            d={roundedRectPath}
                            fill="none"
                            stroke={strokeColor}
                            strokeWidth={strokeWidth}
                            className="speech-bubble-border"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 4 on page 17.png - simple box (no pointer) */}
                  {currentPage === 16 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 53.07
                    const boxTop = 73.25
                    const boxWidth = 27.89
                    const boxHeight = 18.48
                    const isSelected = page17Box4Selected
                    
                    // Reduce width: move left edge to the right 2px, right edge to the left 4px
                    const leftEdgeRightPx = 2
                    const rightEdgeLeftPx = 4
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Reduce height: move top edge down 4px, bottom edge up 5px, then additional 1px up on bottom edge
                    const topEdgeDownPx = 4
                    const bottomEdgeUpPx = 5
                    const bottomEdgeUpAdditionalPx = 1  // Additional 1px up movement for bottom edge
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpAdditionalPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpAdditionalPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent + bottomEdgeUpAdditionalPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(26, Math.max(4, 26 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected && page17Box3Selected ? handlePage17Box4 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected || !page17Box3Selected ? 'none' : 'auto',
                            cursor: isSelected || !page17Box3Selected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <path
                            d={roundedRectPath}
                            fill="none"
                            stroke={strokeColor}
                            strokeWidth={strokeWidth}
                            className="speech-bubble-border"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Button box 4b on page 17 - same style as box 2b on page 9 - hidden until box 4 is selected */}
                  {currentPage === 16 && !editorMode && page17Box4Selected && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 65.01
                    const boxTop = 87.79
                    const boxWidth = 3.55
                    const boxHeight = 2.50
                    const isSelected = page17Box4bSelected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Reduce width: move left edge to the right 5px, right edge to the left 4px
                    const leftEdgeRightPx = 5
                    const rightEdgeLeftPx = 4
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Reduce height: move top edge down 4px, bottom edge up 2px
                    const topEdgeDownPx = 4
                    const bottomEdgeUpPx = 2
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(6, Math.max(2, 6 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const strokeColor = isSelected ? "#3bbf6b" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    const fillColor = isSelected ? "#3bbf6b" : "transparent"
                    
                    return (
                      <div 
                        className="speech-bubble-wrapper"
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage17Box4b : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={fillColor}
                            style={{ fill: fillColor }}
                          />
                          <path
                            d={roundedRectPath}
                            fill="none"
                            stroke={strokeColor}
                            strokeWidth={strokeWidth}
                            style={{ stroke: strokeColor, strokeWidth: strokeWidth }}
                            className="speech-bubble-border"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* White boxes on page 17 - hidden when box 1 is selected */}
                  {currentPage === 16 && !editorMode && !page17Box1Selected && (
                    <>
                      {/* White box 1 on page 17 */}
                      <div
                        style={{
                          ...getButtonStyle(29.41, 36.34, 20.00, 6.99),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 2 on page 17 */}
                      <div
                        style={{
                          ...getButtonStyle(32.79, 40.17, 20.00, 2.81),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 3 on page 17 */}
                      <div
                        style={{
                          ...getButtonStyle(46.98, 39.83, 3.78, 2.81),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    </>
                  )}
                  {/* White boxes on page 17 - hidden when box 2 is selected */}
                  {currentPage === 16 && !editorMode && !page17Box2Selected && (
                    <>
                      {/* White box 1 on page 17 (hidden when box 2 selected) */}
                      <div
                        style={{
                          ...getButtonStyle(55.32, 41.48, 4.90, 4.12),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 2 on page 17 (hidden when box 2 selected) */}
                      <div
                        style={{
                          ...getButtonStyle(58.25, 41.65, 3.55, 4.12),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 3 on page 17 (hidden when box 2 selected) */}
                      <div
                        style={{
                          ...getButtonStyle(9.81, 42.87, 60.33, 28.67),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 4 on page 17 (hidden when box 2 selected) */}
                      <div
                        style={{
                          ...getButtonStyle(18.93, 71.33, 32.39, 23.62),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    </>
                  )}
                  {/* White boxes on page 17 - hidden when box 3 is selected */}
                  {currentPage === 16 && !editorMode && !page17Box3Selected && (
                    <>
                      {/* White box 3 on page 17 (hidden when box 3 selected) */}
                      <div
                        style={{
                          ...getButtonStyle(60.30, 30.76, 5.87, 4.80),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 4 on page 17 (hidden when box 3 selected) */}
                      <div
                        style={{
                          ...getButtonStyle(62.75, 31.11, 3.56, 4.80),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 5 on page 17 (hidden when box 3 selected) */}
                      <div
                        style={{
                          ...getButtonStyle(58.55, 26.07, 7.76, 3.68),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 6 on page 17 (hidden when box 3 selected) */}
                      <div
                        style={{
                          ...getButtonStyle(58.02, 30.89, 7.76, 4.26),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 7 on page 17 (hidden when box 3 selected) */}
                      <div
                        style={{
                          ...getButtonStyle(49.91, 19.11, 23.15, 11.17),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 8 on page 17 (hidden when box 3 selected) */}
                      <div
                        style={{
                          ...getButtonStyle(50.59, 71.51, 32.39, 23.53),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    </>
                  )}
                  {/* White boxes on page 17 - hidden when box 4 is selected */}
                  {currentPage === 16 && !editorMode && !page17Box4Selected && (
                    <>
                      {/* White box 1 on page 17 (hidden when box 4 selected) */}
                      <div
                        style={{
                          ...getButtonStyle(58.96, 25.25, 5.19, 4.45),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 2 on page 17 (hidden when box 4 selected) */}
                      {(() => {
                        const widthReductionPx = 15
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (widthReductionPx / imageNaturalSize.width) * 100 : 0
                        const adjustedWidth = 2.00 - widthReductionPercent
                        const rightOffsetPx = 7
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const adjustedLeft = 62.82 + rightOffsetPercent
                        return (
                          <div
                            style={{
                              ...getButtonStyle(adjustedLeft, 24.90, adjustedWidth, 4.80),
                              backgroundColor: 'white',
                              border: 'none',
                              pointerEvents: 'none',
                              zIndex: 100
                            }}
                          />
                        )
                      })()}
                      {/* White box on page 17 (hidden when box 4 selected) */}
                      <div
                        style={{
                          ...getButtonStyle(19.05, 84.30, 31.72, 6.99),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                      {/* White box 3 on page 17 (hidden when box 4 selected) */}
                      <div
                        style={{
                          ...getButtonStyle(58.47, 26.07, 8.55, 3.72),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    </>
                  )}
                  {/* Number "17" at Dot 3 position on page 17 */}
                  {currentPage === 16 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        17
                      </span>
                    </div>
                  )}
                  {/* Number "18" at Dot 3 position on page 18 */}
                  {currentPage === 17 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        18
                      </span>
                    </div>
                  )}
                  {/* Box 1 on page 18.1.png - with pointer (downward) */}
                  {currentPage === 17 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 37.52
                    const boxTop = 40.70
                    const boxWidth = 25.18
                    const boxHeight = 4.73
                    const dot1X = 41.68
                    const dot1Y = 45.42
                    const dot2X = 48.21
                    const dot2Y = 45.42
                    const dot3X = 49.77
                    const dot3Y = 50.87
                    const isSelected = page18Box1Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Reduce width: move left edge to the right 2px, right edge to the left 4px
                    const leftEdgeRightPx = 2
                    const rightEdgeLeftPx = 4
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Reduce height: move top edge down 1px, bottom edge up 4px
                    const topEdgeDownPx = 1
                    const bottomEdgeUpPx = 4
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop + expandedHeight
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleTopLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleBottomLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage18Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleTopLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleBottomLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 2 on page 18.1.png - with pointer (downward) */}
                  {currentPage === 17 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 66.36
                    const boxTop = 43.66
                    const boxWidth = 25.18
                    const boxHeight = 5.25
                    const dot1X = 80.66
                    const dot1Y = 48.91
                    const dot2X = 86.51
                    const dot2Y = 48.91
                    const dot3X = 81.54
                    const dot3Y = 50.52
                    const isSelected = page18Box2Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Reduce width: move left edge to the right 2px, right edge to the left 5px
                    const leftEdgeRightPx = 2
                    const rightEdgeLeftPx = 5
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Reduce height: move top edge down 4px, bottom edge up 4px
                    const topEdgeDownPx = 4
                    const bottomEdgeUpPx = 4
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop + expandedHeight
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleTopLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleBottomLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage18Box2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleTopLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleBottomLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 3 on page 18.1.png - with pointer (upward) */}
                  {currentPage === 17 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 45.41
                    const boxTop = 81.43
                    const boxWidth = 23.60
                    const boxHeight = 5.08
                    const dot1X = 58.58
                    const dot1Y = 81.43
                    const dot2XBase = 65.34
                    const dot2Y = 81.43
                    const dot3X = 73.21
                    const dot3Y = 76.46
                    const isSelected = page18Box3Selected
                    
                    // Move dot 2 to the left by 5px (3px + 2px)
                    const dot2LeftOffsetPx = 5
                    const dot2LeftOffsetPercent = imageNaturalSize.width > 0 ? (dot2LeftOffsetPx / imageNaturalSize.width) * 100 : 0
                    const dot2X = dot2XBase - dot2LeftOffsetPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Reduce width: move left edge to the right 1px, right edge to the left 6px
                    const leftEdgeRightPx = 1
                    const rightEdgeLeftPx = 6
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Reduce height: move top edge down 2px, bottom edge up 6px
                    const topEdgeDownPx = 2
                    const bottomEdgeUpPx = 6
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                    `
                    
                    const triangleTopLegPath = `
                      M ${triangleBaseLeftWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleBottomLegPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${topY}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      M ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage18Box3 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleTopLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleBottomLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 4 on page 18.1.png - with pointer (upward) */}
                  {currentPage === 17 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 72.89
                    const boxTop = 78.82
                    const boxWidth = 20.23
                    const boxHeight = 5.25
                    const dot1X = 84.49
                    const dot1Y = 78.82
                    const dot2X = 88.99
                    const dot2Y = 78.82
                    const dot3X = 84.70
                    const dot3Y = 76.11
                    const isSelected = page18Box4Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Reduce width: move left edge to the right 2px, right edge to the left 4px
                    const leftEdgeRightPx = 2
                    const rightEdgeLeftPx = 4
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Reduce height: move top edge down 2px, bottom edge up 2px
                    const topEdgeDownPx = 2
                    const bottomEdgeUpPx = 2
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                    `
                    
                    const triangleTopLegPath = `
                      M ${triangleBaseLeftWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleBottomLegPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${topY}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      M ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 14}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage18Box4 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 14,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleTopLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleBottomLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* White box on page 18.1 - hidden when all 4 boxes are selected */}
                  {currentPage === 17 && !editorMode && !(page18Box1Selected && page18Box2Selected && page18Box3Selected && page18Box4Selected) && (
                    <div
                      style={{
                        ...getButtonStyle(54.42, 86.92, 41.85, 7.34),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* "Need Help?" button on 18.1.png - always visible when on page 18 */}
                  {currentPage === 17 && !editorMode && (() => {
                        const boxLeft = 8.23
                        const boxTop = 38.78
                        const boxWidth = 15.49
                        const boxHeight = 4.21
                        const isSelected = false // Button is never "selected", it's always clickable
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Move box down by 30px
                        const downOffsetPx = 30
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        
                        // Move box top edge down by 6px and bottom edge up by 3px (reduce height)
                        const topDownOffsetPx = 6
                        const topDownOffsetPercent = imageNaturalSize.height > 0 ? (topDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const heightReductionPx = 9
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (heightReductionPx / imageNaturalSize.height) * 100 : 0
                        
                        // Move box left edge to the right by 6px and right edge to the left by 6px (reduce width)
                        const leftEdgeRightPx = 6
                        const rightEdgeLeftPx = 6
                        const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                        const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                        const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topDownOffsetPercent + downOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        const borderRadiusPx = Math.min(8, Math.max(3, 8 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Determine stroke color and width for box
                        const strokeColor = "#0d6efd"
                        const strokeWidth = "1"
                        // Show "Need Help?" text only if page18ShowHelpText is true
                        const showHelpText = page18ShowHelpText
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={{...buttonStyle, zIndex: 12}}
                          >
                            <div
                              className="speech-bubble-box"
                              onClick={handlePage18NeedHelp}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'auto',
                                cursor: 'pointer',
                                zIndex: 13,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: showHelpText ? '#000' : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontStyle: showHelpText ? 'italic' : 'normal',
                                fontWeight: showHelpText ? '300' : 'normal',
                                textAlign: 'center',
                                padding: '4px 8px',
                                boxSizing: 'border-box',
                                userSelect: 'auto',
                                WebkitUserSelect: 'auto',
                                opacity: 1
                              }}
                            >
                              {showHelpText && 'Need Help?'}
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill={showHelpText ? "#ffffff" : "transparent"}
                                style={{ fill: showHelpText ? '#ffffff' : 'transparent' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                  {/* Button, LED, and Ground boxes - show on 18.1.png when page18BoxesVisible is true, or on 24.1.png */}
                  {/* Only show on 18.1.png (not 18.png) - hide when page18HelpImageState === 1 (18.png) */}
                  {(((currentPage === 17 && page18BoxesVisible && page18HelpImageState !== 1) || (currentPage === 23 && !page24ShowMainImage)) && !editorMode) && (
                    <>
                      {/* Button box */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce button box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 10
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move button box: right 10px, then left 4px, then right 3px (net: right 9px), and down 40px (15px + 25px)
                        // Additional movement: down 40px and right 10px
                        // Additional movement for buttons/leds: down 20px and right 5px
                        // Additional movement: down 8px
                        // Additional movement: down 5px
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const downOffsetPx = 40
                        const additionalDownOffsetPx = 40
                        const additionalRightOffsetPx2 = 10
                        const additionalDownOffsetPx3 = 20
                        const additionalRightOffsetPx3 = 5
                        const additionalDownOffsetPx4 = 8
                        const additionalDownOffsetPx5 = 5
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent2 = imageNaturalSize.width > 0 ? (additionalRightOffsetPx2 / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent3 = imageNaturalSize.width > 0 ? (additionalRightOffsetPx3 / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent = imageNaturalSize.height > 0 ? (additionalDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent3 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx3 / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent4 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx4 / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent5 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx5 / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent + additionalRightOffsetPercent2 + additionalRightOffsetPercent3
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent + additionalDownOffsetPercent + additionalDownOffsetPercent3 + additionalDownOffsetPercent4 + additionalDownOffsetPercent5)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const buttonFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'white',
                                fontSize: `${buttonFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              Button
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#099b4d"
                                style={{ fill: '#099b4d' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* LED text box on 18.1.png */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce LED box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 10
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move LED box: right 10px, then left 4px, then right 3px (net: right 9px), then right 43px more, and down 40px (15px + 25px)
                        // Additional movement: down 40px and right 10px
                        // Additional movement for buttons/leds: down 20px and right 5px
                        // Additional movement: down 8px
                        // Additional movement: down 5px
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const downOffsetPx = 40
                        const ledRightOffsetPx = 43
                        const additionalDownOffsetPx = 40
                        const additionalRightOffsetPx2 = 10
                        const additionalDownOffsetPx3 = 20
                        const additionalRightOffsetPx3 = 5
                        const additionalDownOffsetPx4 = 8
                        const additionalDownOffsetPx5 = 5
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent2 = imageNaturalSize.width > 0 ? (additionalRightOffsetPx2 / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent3 = imageNaturalSize.width > 0 ? (additionalRightOffsetPx3 / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent = imageNaturalSize.height > 0 ? (additionalDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent3 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx3 / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent4 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx4 / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent5 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx5 / imageNaturalSize.height) * 100 : 0
                        const ledRightOffsetPercent = imageNaturalSize.width > 0 ? (ledRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent + ledRightOffsetPercent + additionalRightOffsetPercent2 + additionalRightOffsetPercent3
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent + additionalDownOffsetPercent + additionalDownOffsetPercent3 + additionalDownOffsetPercent4 + additionalDownOffsetPercent5)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for LED box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const ledFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'white',
                                fontSize: `${ledFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              LED
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#099b4d"
                                style={{ fill: '#099b4d' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* Ground text box on 18.1.png */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce button box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 5
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move button box: right 10px, then left 4px, then right 3px (net: right 9px), and down 35px (10px + 25px)
                        // Then for duplicate: left 25px (15px + 10px) and down 111px (86px + 25px)
                        // Additional movement: down 40px and right 10px
                        // Additional movement for Ground box only: down 10px and right 10px
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const downOffsetPx = 35
                        const duplicateLeftOffsetPx = 25
                        const duplicateDownOffsetPx = 111
                        const additionalDownOffsetPx = 40
                        const additionalRightOffsetPx2 = 10
                        const groundRightOffsetPx = 10
                        const groundDownOffsetPx = 10
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent2 = imageNaturalSize.width > 0 ? (additionalRightOffsetPx2 / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const duplicateLeftOffsetPercent = imageNaturalSize.width > 0 ? (duplicateLeftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const duplicateDownOffsetPercent = imageNaturalSize.height > 0 ? (duplicateDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent = imageNaturalSize.height > 0 ? (additionalDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const groundRightOffsetPercent = imageNaturalSize.width > 0 ? (groundRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const groundDownOffsetPercent = imageNaturalSize.height > 0 ? (groundDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent - duplicateLeftOffsetPercent + additionalRightOffsetPercent2 + groundRightOffsetPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent + duplicateDownOffsetPercent + additionalDownOffsetPercent + groundDownOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const groundFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: '#595959',
                                fontSize: `${groundFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              Ground
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#ffffff"
                                style={{ fill: '#ffffff' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* Duplicate Button box - 100px to the right */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce button box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 10
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move button box: right 10px, then left 4px, then right 3px (net: right 9px), and down 40px (15px + 25px)
                        // Add 90px to the right for duplicate (100px - 10px left)
                        // Additional movement: down 40px and right 10px
                        // Additional movement for buttons/leds: down 20px and right 5px
                        // Additional movement: down 8px
                        // Additional movement: down 5px
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const downOffsetPx = 40
                        const duplicateRightOffsetPx = 90
                        const additionalDownOffsetPx = 40
                        const additionalRightOffsetPx2 = 10
                        const additionalDownOffsetPx3 = 20
                        const additionalRightOffsetPx3 = 5
                        const additionalDownOffsetPx4 = 8
                        const additionalDownOffsetPx5 = 5
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent2 = imageNaturalSize.width > 0 ? (additionalRightOffsetPx2 / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent3 = imageNaturalSize.width > 0 ? (additionalRightOffsetPx3 / imageNaturalSize.width) * 100 : 0
                        const duplicateRightOffsetPercent = imageNaturalSize.width > 0 ? (duplicateRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent = imageNaturalSize.height > 0 ? (additionalDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent3 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx3 / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent4 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx4 / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent5 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx5 / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent + duplicateRightOffsetPercent + additionalRightOffsetPercent2 + additionalRightOffsetPercent3
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent + additionalDownOffsetPercent + additionalDownOffsetPercent3 + additionalDownOffsetPercent4 + additionalDownOffsetPercent5)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const buttonFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'white',
                                fontSize: `${buttonFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              Button
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#f1c232"
                                style={{ fill: '#f1c232' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* Duplicate LED text box - 100px to the right */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce LED box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 10
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move LED box: right 10px, then left 4px, then right 3px (net: right 9px), then right 43px more, and down 40px (15px + 25px)
                        // Add 90px to the right for duplicate (100px - 10px left)
                        // Additional movement: down 40px and right 10px
                        // Additional movement for buttons/leds: down 20px and right 5px
                        // Additional movement: down 8px
                        // Additional movement: down 5px
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const ledRightOffsetPx = 43
                        const duplicateRightOffsetPx = 90
                        const downOffsetPx = 40
                        const additionalDownOffsetPx = 40
                        const additionalRightOffsetPx2 = 10
                        const additionalDownOffsetPx3 = 20
                        const additionalRightOffsetPx3 = 5
                        const additionalDownOffsetPx4 = 8
                        const additionalDownOffsetPx5 = 5
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent2 = imageNaturalSize.width > 0 ? (additionalRightOffsetPx2 / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent3 = imageNaturalSize.width > 0 ? (additionalRightOffsetPx3 / imageNaturalSize.width) * 100 : 0
                        const ledRightOffsetPercent = imageNaturalSize.width > 0 ? (ledRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const duplicateRightOffsetPercent = imageNaturalSize.width > 0 ? (duplicateRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent = imageNaturalSize.height > 0 ? (additionalDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent3 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx3 / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent4 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx4 / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent5 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx5 / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent + ledRightOffsetPercent + duplicateRightOffsetPercent + additionalRightOffsetPercent2 + additionalRightOffsetPercent3
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent + additionalDownOffsetPercent + additionalDownOffsetPercent3 + additionalDownOffsetPercent4 + additionalDownOffsetPercent5)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const ledFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'black',
                                fontSize: `${ledFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              LED
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#ffffff"
                                style={{ fill: '#ffffff' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* Duplicate LED infill white box - 50px to the right of the white infill LED box */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce LED box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 10
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move LED box: right 10px, then left 4px, then right 3px (net: right 9px), then right 43px more, and down 40px (15px + 25px)
                        // Add 90px to the right for first duplicate (100px - 10px left)
                        // Add 50px more to the right for second duplicate (50px to the right of white infill LED box)
                        // Additional movement: down 40px and right 10px
                        // Additional movement for buttons/leds: down 20px and right 5px
                        // Additional movement: down 8px
                        // Additional movement: down 5px
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const ledRightOffsetPx = 43
                        const duplicateRightOffsetPx = 90
                        const duplicate2RightOffsetPx = 88
                        const downOffsetPx = 40
                        const additionalDownOffsetPx = 40
                        const additionalRightOffsetPx2 = 10
                        const additionalDownOffsetPx3 = 20
                        const additionalRightOffsetPx3 = 5
                        const additionalDownOffsetPx4 = 8
                        const additionalDownOffsetPx5 = 5
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent2 = imageNaturalSize.width > 0 ? (additionalRightOffsetPx2 / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent3 = imageNaturalSize.width > 0 ? (additionalRightOffsetPx3 / imageNaturalSize.width) * 100 : 0
                        const ledRightOffsetPercent = imageNaturalSize.width > 0 ? (ledRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const duplicateRightOffsetPercent = imageNaturalSize.width > 0 ? (duplicateRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const duplicate2RightOffsetPercent = imageNaturalSize.width > 0 ? (duplicate2RightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent = imageNaturalSize.height > 0 ? (additionalDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent3 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx3 / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent4 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx4 / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent5 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx5 / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent + ledRightOffsetPercent + duplicateRightOffsetPercent + duplicate2RightOffsetPercent + additionalRightOffsetPercent2 + additionalRightOffsetPercent3
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent + additionalDownOffsetPercent + additionalDownOffsetPercent3 + additionalDownOffsetPercent4 + additionalDownOffsetPercent5)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const ledFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'white',
                                fontSize: `${ledFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              LED
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#0000ffff"
                                style={{ fill: '#0000ffff' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* Duplicate blue infill box - Slider text box - 75px to the right of blue infill LED box */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce LED box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 10
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move LED box: right 10px, then left 4px, then right 3px (net: right 9px), then right 43px more, and down 40px (15px + 25px)
                        // Add 90px to the right for first duplicate (100px - 10px left)
                        // Add 88px more to the right for second duplicate (blue infill LED box)
                        // Add 75px more to the right for third duplicate (Slider box)
                        // Additional movement: down 40px and right 10px
                        // Additional movement for buttons/leds: down 20px and right 5px
                        // Additional movement: down 8px
                        // Additional movement: down 5px
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const ledRightOffsetPx = 43
                        const duplicateRightOffsetPx = 90
                        const duplicate2RightOffsetPx = 88
                        const duplicate3RightOffsetPx = 108
                        const downOffsetPx = 40
                        const additionalDownOffsetPx = 40
                        const additionalRightOffsetPx2 = 10
                        const additionalDownOffsetPx3 = 20
                        const additionalRightOffsetPx3 = 5
                        const additionalDownOffsetPx4 = 8
                        const additionalDownOffsetPx5 = 5
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent2 = imageNaturalSize.width > 0 ? (additionalRightOffsetPx2 / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent3 = imageNaturalSize.width > 0 ? (additionalRightOffsetPx3 / imageNaturalSize.width) * 100 : 0
                        const ledRightOffsetPercent = imageNaturalSize.width > 0 ? (ledRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const duplicateRightOffsetPercent = imageNaturalSize.width > 0 ? (duplicateRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const duplicate2RightOffsetPercent = imageNaturalSize.width > 0 ? (duplicate2RightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const duplicate3RightOffsetPercent = imageNaturalSize.width > 0 ? (duplicate3RightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent = imageNaturalSize.height > 0 ? (additionalDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent3 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx3 / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent4 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx4 / imageNaturalSize.height) * 100 : 0
                        const additionalDownOffsetPercent5 = imageNaturalSize.height > 0 ? (additionalDownOffsetPx5 / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent + ledRightOffsetPercent + duplicateRightOffsetPercent + duplicate2RightOffsetPercent + duplicate3RightOffsetPercent + additionalRightOffsetPercent2 + additionalRightOffsetPercent3
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent + additionalDownOffsetPercent + additionalDownOffsetPercent3 + additionalDownOffsetPercent4 + additionalDownOffsetPercent5)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const sliderFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'white',
                                fontSize: `${sliderFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              Slider
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#595959"
                                style={{ fill: '#595959' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                    </>
                  )}
                  {/* Number "19" at Dot 3 position on page 19 */}
                  {currentPage === 18 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        19
                      </span>
                    </div>
                  )}
                  {/* Box 1 on page 19 */}
                  {currentPage === 18 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 68.61
                      const boxTop = 24.68
                      const boxWidth = 24.96
                      const boxHeight = 6.64
                      const dot1X = 68.61
                      const dot1Y = 28.31
                      const dot2X = 68.61
                      const dot2Y = 30.22
                      const dot3X = 52.70
                      const dot3Y = 31.02
                      const isSelected = page19Box1Selected
                      
                      // Move left edge to the right by 3px (reduce width)
                      const leftEdgeRightPx = 3
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left by 3px (reduce width)
                      const rightEdgeLeftPx = 3
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                      
                      // Move top edge down by 2px (reduce height) - keep in place
                      const topEdgeDownPx = 2
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 3px (reduced from 4px to increase height by 1px)
                      const bottomEdgeUpPx = 3
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      // Dots are on the left edge, so they move with the box (top edge moved down 2px)
                      // Move dot 1 up by 1px (additional adjustment from current location)
                      const dot1UpPx = 1
                      const dot1UpPercent = stageHeightPx > 0 ? (dot1UpPx / stageHeightPx) * 100 : 0
                      const adjustedDot1Y = dot1Y + topEdgeDownPercent - dot1UpPercent
                      // Move dot 2 up by 3px (additional adjustment from current location)
                      const dot2UpPx = 3
                      const dot2UpPercent = stageHeightPx > 0 ? (dot2UpPx / stageHeightPx) * 100 : 0
                      const adjustedDot2Y = dot2Y + topEdgeDownPercent - dot2UpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      // Calculate triangle - it extends LEFTWARD from the left edge (between dot1 and dot2) to dot3
                      // Dot1 and Dot2 are both on the left edge (moved right 3px, moved down 2px) at different Y positions
                      // Dot3 is to the left (52.70%, 31.02%), so triangle extends leftward
                      const triangleBaseTop = adjustedDot1Y  // Top break point on left edge (moved down 2px)
                      const triangleBaseBottom = adjustedDot2Y  // Bottom break point on left edge (moved down 2px)
                      const triangleTipX = dot3X  // Triangle tip X (52.70%)
                      const triangleTipY = dot3Y  // Triangle tip Y (31.02%)
                      
                      // Reduced corner radius for box
                      const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                      const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                      const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                      const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                      const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                      
                      const topLeft = 0
                      const topRight = 100
                      const topY = 0
                      const bottomY = 100
                      
                      // Convert triangle base points to wrapper-relative coordinates
                      // Triangle base is on the left edge (at topLeft = 0)
                      const triangleBaseTopWrapper = ((triangleBaseTop - adjustedTop) / expandedHeight) * 100
                      const triangleBaseBottomWrapper = ((triangleBaseBottom - adjustedTop) / expandedHeight) * 100
                      const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                      const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                      
                      const speechBubblePath = `
                        M ${topRight - borderRadiusWrapperX},${bottomY}
                        Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                        L ${topRight},${topY + borderRadiusWrapperY}
                        Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        L ${topLeft + borderRadiusWrapperX},${topY}
                        Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                        ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                        L ${topLeft},${triangleBaseBottomWrapper}
                        ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${bottomY - borderRadiusWrapperY}` : ''}
                        Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        Z
                      `
                      
                      // Border paths - separate segments to exclude left edge between the two points
                      const rightBorderPath = `
                        M ${topRight - borderRadiusWrapperX},${bottomY}
                        Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                        L ${topRight},${topY + borderRadiusWrapperY}
                        Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        L ${topLeft + borderRadiusWrapperX},${topY}
                        Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      `
                      
                      const topBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${topY}
                        L ${topRight - borderRadiusWrapperX},${topY}
                      `
                      
                      const triangleTopLegPath = `
                        M ${topLeft},${triangleBaseTopWrapper}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      const triangleBottomLegPath = `
                        M ${topLeft},${triangleBaseBottomWrapper}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      
                      const leftBorderTopPath = `
                        M ${topLeft},${topY + borderRadiusWrapperY}
                        ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                      `
                      
                      const leftBorderBottomPath = `
                        M ${topLeft},${triangleBaseBottomWrapper}
                        ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${bottomY - borderRadiusWrapperY}` : ''}
                        Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      `
                      
                      const bottomBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        L ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage19Box1 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box'
                            }}
                          >
                          </div>
                          <svg
                            className="speech-bubble-svg"
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: 'none',
                              overflow: 'visible',
                              zIndex: 10
                            }}
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                          >
                            <defs>
                            </defs>
                            <path
                              d={speechBubblePath}
                              fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.7)"}
                              style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.7)' }}
                            />
                            <g className="speech-bubble-border-group">
                              <path
                                d={rightBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={topBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={leftBorderTopPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleTopLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleBottomLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={leftBorderBottomPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={bottomBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                            </g>
                            <path
                              d={`M ${topLeft},${triangleBaseTopWrapper} L ${topLeft},${triangleBaseBottomWrapper}`}
                              fill="none"
                              stroke="transparent"
                              strokeWidth="0.3"
                              vectorEffect="non-scaling-stroke"
                            />
                          </svg>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Box 2 on page 19 */}
                  {currentPage === 18 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 65.01
                      const boxTop = 37.91
                      const boxWidth = 15.49
                      const boxHeight = 4.55
                      const dot1X = 73.90
                      const dot1Y = 37.91
                      const dot2X = 77.95
                      const dot2Y = 37.91
                      const dot3X = 79.51
                      const dot3Y = 34.85
                      const isSelected = page19Box2Selected
                      
                      // Move left edge to the right by 3px (reduce width)
                      const leftEdgeRightPx = 3
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left by 2px (reduce width)
                      const rightEdgeLeftPx = 2
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                      
                      // Move top edge down by 3px (reduce height)
                      const topEdgeDownPx = 3
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 1px (reduce height)
                      const bottomEdgeUpPx = 1
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      // Dots are on the top edge, so their X positions need to be adjusted relative to the new box position
                      // Dot1 and Dot2 X positions are relative to the box, so they move with the left edge
                      // Dot1 and Dot2 Y positions are on the top edge, so they move with the top edge (moved down 3px)
                      let adjustedDot1X = dot1X + leftEdgeRightPercent
                      let adjustedDot2X = dot2X + leftEdgeRightPercent
                      const adjustedDot1Y = dot1Y + topEdgeDownPercent
                      const adjustedDot2Y = dot2Y + topEdgeDownPercent
                      
                      // Move dot 1 to the left by 2px
                      const dot1LeftPx = 2
                      const dot1LeftPercent = stageWidthPx > 0 ? (dot1LeftPx / stageWidthPx) * 100 : 0
                      adjustedDot1X = adjustedDot1X - dot1LeftPercent
                      
                      // Move dot 2 to the left by 4px
                      const dot2LeftPx = 4
                      const dot2LeftPercent = stageWidthPx > 0 ? (dot2LeftPx / stageWidthPx) * 100 : 0
                      adjustedDot2X = adjustedDot2X - dot2LeftPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                      // Dot3 is ABOVE the box (34.85% < 37.91%), so triangle points upward
                      // Triangle base breaks the top edge at exact dot1 and dot2 X positions (adjusted for box movement and dot adjustments)
                      const triangleBaseLeft = adjustedDot1X  // Left break point - exact dot1 X position (moved right 3px, then left 2px)
                      const triangleBaseRight = adjustedDot2X  // Right break point - exact dot2 X position (moved right 3px, then left 4px)
                      const triangleTipX = dot3X  // Triangle tip X (79.51%)
                      const triangleTipY = dot3Y  // Triangle tip Y (34.85% - above the box)
                      
                      // Reduced corner radius for box
                      const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                      const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                      const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                      const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                      const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                      
                      const topLeft = 0
                      const topRight = 100
                      const topY = 0
                      const bottomY = 100
                      
                      // Convert triangle base points to wrapper-relative coordinates
                      // Triangle base should break the top edge at the exact X positions of dot1 and dot2
                      const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                      const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                      const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                      // Triangle tip is above the box, so calculate relative to wrapper (will be negative)
                      const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                      
                      const speechBubblePath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                        L ${triangleBaseRightWrapper},${topY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                        L ${topRight},${bottomY - borderRadiusWrapperY}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                        Z
                      `
                      
                      // Border paths - separate segments to exclude top edge between the two points
                      // Left border: from bottom-left corner up to first point on top edge (dot1 position)
                      const leftBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      `
                      
                      // Triangle border: two legs only (not the base between the points)
                      // Left leg: from dot1 to tip
                      const triangleLeftLegPath = `
                        M ${triangleBaseLeftWrapper},${topY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      // Right leg: from dot2 to tip
                      const triangleRightLegPath = `
                        M ${triangleBaseRightWrapper},${topY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      
                      // Right border: from second point on top edge (dot2 position) down to bottom-right corner
                      const rightBorderPath = `
                        M ${triangleBaseRightWrapper},${topY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                        L ${topRight},${bottomY - borderRadiusWrapperY}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      // Bottom border: complete bottom edge
                      const bottomBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        L ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage19Box2 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box'
                            }}
                          >
                          </div>
                          <svg
                            className="speech-bubble-svg"
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: 'none',
                              overflow: 'visible',
                              zIndex: 10
                            }}
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                          >
                            <defs>
                            </defs>
                            <path
                              d={speechBubblePath}
                              fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.7)"}
                              style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.7)' }}
                            />
                            <g className="speech-bubble-border-group">
                              <path
                                d={leftBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleLeftLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleRightLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={rightBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={bottomBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                            </g>
                            <path
                              d={`M ${triangleBaseLeftWrapper},${topY} L ${triangleBaseRightWrapper},${topY}`}
                              fill="none"
                              stroke="transparent"
                              strokeWidth="0.3"
                              vectorEffect="non-scaling-stroke"
                            />
                          </svg>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Box 3 on page 19 */}
                  {currentPage === 18 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 47.66
                      const boxTop = 72.38
                      const boxWidth = 22.93
                      const boxHeight = 4.90
                      const dot1X = 47.66
                      const dot1Y = 73.22
                      const dot2X = 47.66
                      const dot2Y = 74.62
                      const dot3X = 34.23
                      const dot3Y = 73.85
                      const isSelected = page19Box3Selected
                      
                      // Move left edge to the right by 3px (reduce width)
                      const leftEdgeRightPx = 3
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left by 3px (reduced from 4px to increase width by 1px)
                      const rightEdgeLeftPx = 3
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                      
                      // Move top edge down by 2px (reduce height) - keep in place
                      const topEdgeDownPx = 2
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 3px (reduced from 4px to increase height by 1px)
                      const bottomEdgeUpPx = 3
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      // Dots are on the left edge, so they move with the box (left edge moved right 3px, top edge moved down 2px)
                      const adjustedDot1X = dot1X + leftEdgeRightPercent
                      const adjustedDot2X = dot2X + leftEdgeRightPercent
                      // Move dot 1 up by 1px (additional adjustment from current location)
                      const dot1UpPx = 1
                      const dot1UpPercent = stageHeightPx > 0 ? (dot1UpPx / stageHeightPx) * 100 : 0
                      const adjustedDot1Y = dot1Y + topEdgeDownPercent - dot1UpPercent
                      // Move dot 2 up by 3px (additional adjustment from current location)
                      const dot2UpPx = 3
                      const dot2UpPercent = stageHeightPx > 0 ? (dot2UpPx / stageHeightPx) * 100 : 0
                      const adjustedDot2Y = dot2Y + topEdgeDownPercent - dot2UpPercent
                      
                      // Move dot 3 up by 1px (additional adjustment from current location)
                      const dot3UpPx = 1
                      const dot3UpPercent = stageHeightPx > 0 ? (dot3UpPx / stageHeightPx) * 100 : 0
                      const adjustedDot3Y = dot3Y - dot3UpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      // Calculate triangle - it extends LEFTWARD from the left edge (between dot1 and dot2) to dot3
                      // Dot1 and Dot2 are both on the left edge (moved right 3px, moved down 2px) at different Y positions
                      // Dot3 is to the left (34.23%, 73.85%), so triangle extends leftward
                      const triangleBaseTop = adjustedDot1Y  // Top break point on left edge (moved down 2px)
                      const triangleBaseBottom = adjustedDot2Y  // Bottom break point on left edge (moved down 2px)
                      const triangleTipX = dot3X  // Triangle tip X (34.23%)
                      const triangleTipY = adjustedDot3Y  // Triangle tip Y (73.85%, moved up 1px)
                      
                      // Reduced corner radius for box
                      const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                      const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                      const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                      const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                      const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                      
                      const topLeft = 0
                      const topRight = 100
                      const topY = 0
                      const bottomY = 100
                      
                      // Convert triangle base points to wrapper-relative coordinates
                      // Triangle base is on the left edge (at topLeft = 0)
                      const triangleBaseTopWrapper = ((triangleBaseTop - adjustedTop) / expandedHeight) * 100
                      const triangleBaseBottomWrapper = ((triangleBaseBottom - adjustedTop) / expandedHeight) * 100
                      const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                      const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                      
                      const speechBubblePath = `
                        M ${topRight - borderRadiusWrapperX},${bottomY}
                        Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                        L ${topRight},${topY + borderRadiusWrapperY}
                        Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        L ${topLeft + borderRadiusWrapperX},${topY}
                        Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                        ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                        L ${topLeft},${triangleBaseBottomWrapper}
                        ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${bottomY - borderRadiusWrapperY}` : ''}
                        Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        Z
                      `
                      
                      // Border paths - separate segments to exclude left edge between the two points
                      const rightBorderPath = `
                        M ${topRight - borderRadiusWrapperX},${bottomY}
                        Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                        L ${topRight},${topY + borderRadiusWrapperY}
                        Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        L ${topLeft + borderRadiusWrapperX},${topY}
                        Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      `
                      
                      const topBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${topY}
                        L ${topRight - borderRadiusWrapperX},${topY}
                      `
                      
                      const triangleTopLegPath = `
                        M ${topLeft},${triangleBaseTopWrapper}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      const triangleBottomLegPath = `
                        M ${topLeft},${triangleBaseBottomWrapper}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      
                      const leftBorderTopPath = `
                        M ${topLeft},${topY + borderRadiusWrapperY}
                        ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                      `
                      
                      const leftBorderBottomPath = `
                        M ${topLeft},${triangleBaseBottomWrapper}
                        ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${bottomY - borderRadiusWrapperY}` : ''}
                        Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      `
                      
                      const bottomBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        L ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage19Box3 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box'
                            }}
                          >
                          </div>
                          <svg
                            className="speech-bubble-svg"
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: 'none',
                              overflow: 'visible',
                              zIndex: 10
                            }}
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                          >
                            <defs>
                            </defs>
                            <path
                              d={speechBubblePath}
                              fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.7)"}
                              style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.7)' }}
                            />
                            <g className="speech-bubble-border-group">
                              <path
                                d={rightBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={topBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={leftBorderTopPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleTopLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleBottomLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={leftBorderBottomPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={bottomBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                            </g>
                            <path
                              d={`M ${topLeft},${triangleBaseTopWrapper} L ${topLeft},${triangleBaseBottomWrapper}`}
                              fill="none"
                              stroke="transparent"
                              strokeWidth="0.3"
                              vectorEffect="non-scaling-stroke"
                            />
                          </svg>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* White boxes on page 19 - hidden when box 1 is selected */}
                  {currentPage === 18 && !editorMode && !page19Box1Selected && (
                    <>
                      {/* White box 1 */}
                      <div
                        style={{
                          ...getButtonStyle(67.49, 31.82, 29.01, 15.00),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 2 */}
                      <div
                        style={{
                          ...getButtonStyle(56.22, 33.91, 29.01, 15.00),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    </>
                  )}
                  {/* White box on page 19 - hidden when box 2 is selected */}
                  {currentPage === 18 && !editorMode && !page19Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(0.00, 62.63, 100.00, 31.36),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* Number "20" at Dot 3 position on page 20 */}
                  {currentPage === 19 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        20
                      </span>
                    </div>
                  )}
                  {/* Number "21" at Dot 3 position on page 21.1 (default) */}
                  {currentPage === 20 && !editorMode && !page21ShowHelpImage && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        21
                      </span>
                    </div>
                  )}
                  {/* Box 1 on page 21.1.png */}
                  {currentPage === 20 && !editorMode && !page21ShowHelpImage && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 32.57
                    const boxTop = 45.75
                    const boxWidth = 25.63
                    const boxHeight = 6.82
                    const dot1X = 36.72
                    const dot1Y = 52.56
                    const dot2X = 43.71
                    const dot2Y = 52.56
                    const dot3X = 32.43
                    const dot3Y = 55.75
                    const isSelected = page21Box1Selected
                    
                    // Move left edge to the right by 2px (reduce width)
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                    // Move right edge to the left by 2px (reduce width)
                    const rightEdgeLeftPx = 2
                    const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                    const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                    const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                    
                    // Move top edge down by 3px (reduce height)
                    const topEdgeDownPx = 3
                    const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                    // Move bottom edge up by 2px (reduce height)
                    const bottomEdgeUpPx = 2
                    const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                    const adjustedBoxTop = boxTop + topEdgeDownPercent
                    const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage21Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          <path
                            d={`M ${triangleBaseLeftWrapper},${bottomY} L ${triangleBaseRightWrapper},${bottomY}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 2 on page 21.1.png */}
                  {currentPage === 20 && !editorMode && !page21ShowHelpImage && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 63.66
                    const boxTop = 47.83
                    const boxWidth = 27.43
                    const boxHeight = 23.18
                    const dot1X = 63.66
                    const dot1Y = 61.39
                    const dot2X = 63.66
                    const dot2Y = 67.31
                    const dot3X = 54.06
                    const dot3Y = 71.07
                    const isSelected = page21Box2Selected
                    
                    // Move left edge to the right by 2px (reduce width)
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                    // Move right edge to the left by 2px (reduce width)
                    const rightEdgeLeftPx = 2
                    const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                    const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                    const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                    
                    // Move top edge down by 3px (reduce height)
                    const topEdgeDownPx = 3
                    const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                    // Move bottom edge up by 1px (reduce height)
                    const bottomEdgeUpPx = 1
                    const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                    const adjustedBoxTop = boxTop + topEdgeDownPercent
                    const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Move dot 2 up by 2px (net: 3px up - 1px down = 2px up from original)
                    const dot2UpPx = 2
                    const dot2UpPercent = stageHeightPx > 0 ? (dot2UpPx / stageHeightPx) * 100 : 0
                    const adjustedDot2Y = dot2Y - dot2UpPercent
                    
                    const triangleBaseTop = dot1Y
                    const triangleBaseBottom = adjustedDot2Y
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(42, Math.max(14, 42 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseTopWrapper = ((triangleBaseTop - adjustedTop) / expandedHeight) * 100
                    const triangleBaseBottomWrapper = ((triangleBaseBottom - adjustedTop) / expandedHeight) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${triangleBaseBottomWrapper}` : ''}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const triangleTopLegPath = `
                      M ${topLeft},${triangleBaseTopWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleBottomLegPath = `
                      M ${topLeft},${triangleBaseBottomWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const leftBorderTopPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                    `
                    
                    const leftBorderBottomPath = `
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `M ${topLeft},${triangleBaseBottomWrapper}` : ''}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage21Box2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleTopLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleBottomLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={leftBorderTopPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={leftBorderBottomPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          <path
                            d={`M ${topLeft},${triangleBaseTopWrapper} L ${topLeft},${triangleBaseBottomWrapper}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* White box 1 on page 21.1.png - hidden when box 1 is selected */}
                  {currentPage === 20 && !editorMode && !page21ShowHelpImage && !page21Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(3.05, 56.19, 50.42, 41.11),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 2 on page 21.1.png - hidden when box 1 is selected */}
                  {currentPage === 20 && !editorMode && !page21ShowHelpImage && !page21Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(19.27, 72.47, 74.75, 22.49),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 3 on page 21.1.png - hidden when box 1 is selected */}
                  {currentPage === 20 && !editorMode && !page21ShowHelpImage && !page21Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(50.14, 52.79, 43.88, 42.16),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 4 on page 21.1.png - hidden when box 1 is selected */}
                  {currentPage === 20 && !editorMode && !page21ShowHelpImage && !page21Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(60.73, 46.18, 33.29, 25.79),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 21.1.png - hidden when "Need Help?" button is selected */}
                  {currentPage === 20 && !editorMode && !page21ShowHelpImage && page21ShowHelpText && (
                    <div
                      style={{
                        ...getButtonStyle(9.13, 81.09, 20.00, 15.00),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* "Need Help?" button on 21.1.png and 21.png - always visible when on page 21 */}
                  {currentPage === 20 && !editorMode && (() => {
                        const boxLeft = 8.23
                        const boxTop = 38.78
                        const boxWidth = 15.49
                        const boxHeight = 4.21
                        const isSelected = false // Button is never "selected", it's always clickable
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Move box down by 56px (30px + 15px + 8px + 3px additional)
                        const downOffsetPx = 56
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        
                        // Move box top edge down by 6px and bottom edge up by 3px (reduce height)
                        const topDownOffsetPx = 6
                        const topDownOffsetPercent = imageNaturalSize.height > 0 ? (topDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const heightReductionPx = 9
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (heightReductionPx / imageNaturalSize.height) * 100 : 0
                        
                        // Move box left edge to the right by 6px and right edge to the left by 6px (reduce width)
                        const leftEdgeRightPx = 6
                        const rightEdgeLeftPx = 6
                        const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                        const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                        const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topDownOffsetPercent + downOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        const borderRadiusPx = Math.min(8, Math.max(3, 8 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Determine stroke color and width for box
                        const strokeColor = "#0d6efd"
                        const strokeWidth = "1"
                        // Show "Need Help?" text only if page21ShowHelpText is true
                        const showHelpText = page21ShowHelpText
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={{...buttonStyle, zIndex: 12}}
                          >
                            <div
                              className="speech-bubble-box"
                              onClick={handlePage21NeedHelp}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'auto',
                                cursor: 'pointer',
                                zIndex: 13,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: showHelpText ? '#000' : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontStyle: showHelpText ? 'italic' : 'normal',
                                fontWeight: showHelpText ? '300' : 'normal',
                                textAlign: 'center',
                                padding: '4px 8px',
                                boxSizing: 'border-box',
                                userSelect: 'auto',
                                WebkitUserSelect: 'auto',
                                opacity: showHelpText ? 1 : 0
                              }}
                            >
                              {showHelpText && 'Need Help?'}
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill={showHelpText ? "#ffffff" : "transparent"}
                                style={{ fill: showHelpText ? '#ffffff' : 'transparent' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                  })()}
                  {/* Duplicate "Need Help?" button on 21.png and 21.2.png - bottom left, no text */}
                  {currentPage === 20 && !editorMode && page21ShowHelpImage && (() => {
                        const boxLeft = 6.66
                        const boxTop = 92.31
                        const boxWidth = 8.28
                        const boxHeight = 6.12
                        const isSelected = false // Button is never "selected", it's always clickable
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Move left edge to the right by 2px (increase left position)
                        const leftEdgeRightPx = 2
                        const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                        // Move right edge to the left by 4px (decrease width)
                        const rightEdgeLeftPx = 4
                        const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                        const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                        
                        // Move top edge down by 4px (3px + 1px) (increase top position)
                        const topEdgeDownPx = 4
                        const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                        // Move bottom edge up by 5px (4px + 1px) (decrease height)
                        const bottomEdgeUpPx = 5
                        const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                        const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        const borderRadiusPx = Math.min(20, Math.max(8, 20 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Determine stroke color and width for box
                        const strokeColor = "#0d6efd"
                        const strokeWidth = "1"
                        // No text for this duplicate button
                        const showHelpText = false
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={{...buttonStyle, zIndex: 12}}
                          >
                            <div
                              className="speech-bubble-box"
                              onClick={handlePage21DuplicateButton}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'auto',
                                cursor: 'pointer',
                                zIndex: 13,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontStyle: 'normal',
                                fontWeight: 'normal',
                                textAlign: 'center',
                                padding: '4px 8px',
                                boxSizing: 'border-box',
                                userSelect: 'auto',
                                WebkitUserSelect: 'auto',
                                opacity: 0
                              }}
                            >
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="transparent"
                                style={{ fill: 'transparent' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                  })()}
                  {/* Number "21" at Dot 3 position on page 21 */}
                  {currentPage === 20 && !editorMode && page21ShowHelpImage && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        21
                      </span>
                    </div>
                  )}
                  {/* Box 1 on page 21.png - shown when Need Help button clicked second time, hidden on 21.2.png */}
                  {currentPage === 20 && !editorMode && page21ShowHelpImage && page21BoxesVisible && !page21Show21_2Image && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 32.57
                    const boxTop = 45.75
                    const boxWidth = 25.63
                    const boxHeight = 6.82
                    const dot1X = 36.72
                    const dot1Y = 52.56
                    const dot2X = 43.71
                    const dot2Y = 52.56
                    const dot3X = 32.43
                    const dot3Y = 55.75
                    const isSelected = page21Box1Selected
                    
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                    const rightEdgeLeftPx = 2
                    const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                    const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                    const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                    
                    const topEdgeDownPx = 3
                    const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                    const bottomEdgeUpPx = 2
                    const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                    const adjustedBoxTop = boxTop + topEdgeDownPercent
                    const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage21Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          <path
                            d={`M ${triangleBaseLeftWrapper},${bottomY} L ${triangleBaseRightWrapper},${bottomY}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 2 on page 21.png - shown when Need Help button clicked second time, hidden on 21.2.png */}
                  {currentPage === 20 && !editorMode && page21ShowHelpImage && page21BoxesVisible && !page21Show21_2Image && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 63.66
                    const boxTop = 47.83
                    const boxWidth = 27.43
                    const boxHeight = 23.18
                    const dot1X = 63.66
                    const dot1Y = 61.39
                    const dot2X = 63.66
                    const dot2Y = 67.31
                    const dot3X = 54.06
                    const dot3Y = 71.07
                    const isSelected = page21Box2Selected
                    
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                    const rightEdgeLeftPx = 2
                    const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                    const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                    const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                    
                    const topEdgeDownPx = 3
                    const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                    const bottomEdgeUpPx = 1
                    const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                    const adjustedBoxTop = boxTop + topEdgeDownPercent
                    const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const dot2UpPx = 2
                    const dot2UpPercent = stageHeightPx > 0 ? (dot2UpPx / stageHeightPx) * 100 : 0
                    const adjustedDot2Y = dot2Y - dot2UpPercent
                    
                    const triangleBaseTop = dot1Y
                    const triangleBaseBottom = adjustedDot2Y
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(42, Math.max(14, 42 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseTopWrapper = ((triangleBaseTop - adjustedTop) / expandedHeight) * 100
                    const triangleBaseBottomWrapper = ((triangleBaseBottom - adjustedTop) / expandedHeight) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${triangleBaseBottomWrapper}` : ''}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const triangleTopLegPath = `
                      M ${topLeft},${triangleBaseTopWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleBottomLegPath = `
                      M ${topLeft},${triangleBaseBottomWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const leftBorderTopPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                    `
                    
                    const leftBorderBottomPath = `
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `M ${topLeft},${triangleBaseBottomWrapper}` : ''}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage21Box2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleTopLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleBottomLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={leftBorderTopPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={leftBorderBottomPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          <path
                            d={`M ${topLeft},${triangleBaseTopWrapper} L ${topLeft},${triangleBaseBottomWrapper}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 1 on page 22 */}
                  {currentPage === 21 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 12.96
                    const boxTop = 15.10
                    const boxWidth = 24.73
                    const boxHeight = 6.12
                    const dot1X = 29.06
                    const dot1Y = 21.23
                    const dot2X = 34.25
                    const dot2Y = 21.23
                    const dot3X = 38.28
                    const dot3Y = 23.36
                    const isSelected = page22Box1Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move left edge to the right by 1px (increase left position)
                    const leftEdgeRightPx = 1
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    // Move right edge to the left by 2px (decrease width)
                    const rightEdgeLeftPx = 2
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Move top edge down by 3px (increase top position)
                    const topEdgeDownPx = 3
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    // Move bottom edge up by 3px (decrease height)
                    const bottomEdgeUpPx = 3
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Move dot 2 to the left by 2px
                    const dot2LeftPx = 2
                    const dot2LeftPercent = imageNaturalSize.width > 0 ? (dot2LeftPx / imageNaturalSize.width) * 100 : 0
                    const adjustedDot2X = dot2X - dot2LeftPercent
                    
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = adjustedDot2X
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage22Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          <path
                            d={`M ${triangleBaseLeftWrapper},${bottomY} L ${triangleBaseRightWrapper},${bottomY}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 2 on page 22 */}
                  {currentPage === 21 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 34.37
                    const boxTop = 28.86
                    const boxWidth = 33.07
                    const boxHeight = 7.17
                    const isSelected = page22Box2Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move left edge to the right by 2px (increase left position)
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    // Move right edge to the left by 3px (decrease width)
                    const rightEdgeLeftPx = 3
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Move top edge down by 2px (increase top position)
                    const topEdgeDownPx = 2
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    // Move bottom edge up by 3px (decrease height)
                    const bottomEdgeUpPx = 3
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage22Box2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 3 on page 22 */}
                  {currentPage === 21 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 34.82
                    const boxTop = 37.39
                    const boxWidth = 33.07
                    const boxHeight = 7.51
                    const isSelected = page22Box3Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move left edge to the right by 2px (increase left position)
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    // Move right edge to the left by 3px (decrease width)
                    const rightEdgeLeftPx = 3
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Move top edge down by 2px (increase top position)
                    const topEdgeDownPx = 2
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    // Move bottom edge up by 4px (decrease height)
                    const bottomEdgeUpPx = 4
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage22Box3 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 4 on page 22 */}
                  {currentPage === 21 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 34.59
                    const boxTop = 46.44
                    const boxWidth = 33.07
                    const boxHeight = 7.51
                    const isSelected = page22Box4Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move left edge to the right by 3px (increase left position)
                    const leftEdgeRightPx = 3
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    // Move right edge to the left by 3px (decrease width)
                    const rightEdgeLeftPx = 3
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Move top edge down by 4px (increase top position)
                    const topEdgeDownPx = 4
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    // Move bottom edge up by 5px (decrease height)
                    const bottomEdgeUpPx = 5
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage22Box4 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 5 on page 22 */}
                  {currentPage === 21 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 40.23
                    const boxTop = 58.45
                    const boxWidth = 21.13
                    const boxHeight = 8.91
                    const isSelected = page22Box5Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move left edge to the right by 2px (increase left position)
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    // Move right edge to the left by 3px (decrease width)
                    const rightEdgeLeftPx = 3
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Move top edge down by 2px (increase top position)
                    const topEdgeDownPx = 2
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    // Move bottom edge up by 4px (decrease height)
                    const bottomEdgeUpPx = 4
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage22Box5 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 6 on page 22 - visible only after box 5 is selected */}
                  {currentPage === 21 && !editorMode && page22Box5Selected && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 14.77
                    const boxTop = 70.64
                    const boxWidth = 70.69
                    const boxHeight = 3.34
                    const isSelected = page22Box6Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move left edge to the right by 1px (increase left position)
                    const leftEdgeRightPx = 1
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    // Move right edge to the left by 3px (decrease width)
                    const rightEdgeLeftPx = 3
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Move top edge down by 3px (increase top position)
                    const topEdgeDownPx = 3
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    // Move bottom edge up by 4px (decrease height)
                    const bottomEdgeUpPx = 4
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(8, Math.max(3, 8 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage22Box6 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* White box on page 22 - hidden when box 1 is selected */}
                  {currentPage === 21 && !editorMode && !page22Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(11.39, 27.81, 57.40, 8.91),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 2 is selected */}
                  {currentPage === 21 && !editorMode && !page22Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(32.79, 36.87, 57.40, 8.91),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 2 is selected (left side) */}
                  {currentPage === 21 && !editorMode && !page22Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(11.16, 28.68, 22.70, 7.86),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 3 is selected */}
                  {currentPage === 21 && !editorMode && !page22Box3Selected && (
                    <div
                      style={{
                        ...getButtonStyle(10.71, 45.57, 58.08, 8.91),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 3 is selected (right side) */}
                  {currentPage === 21 && !editorMode && !page22Box3Selected && (
                    <div
                      style={{
                        ...getButtonStyle(68.16, 37.04, 23.83, 7.86),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 4 is selected */}
                  {currentPage === 21 && !editorMode && !page22Box4Selected && (
                    <div
                      style={{
                        ...getButtonStyle(34.82, 54.10, 31.72, 14.13),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 4 is selected (left side) */}
                  {currentPage === 21 && !editorMode && !page22Box4Selected && (
                    <div
                      style={{
                        ...getButtonStyle(10.49, 46.44, 23.83, 7.86),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 5 is selected */}
                  {currentPage === 21 && !editorMode && !page22Box5Selected && (
                    <div
                      style={{
                        ...getButtonStyle(9.13, 69.42, 81.51, 24.40),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 5 is selected (top) */}
                  {currentPage === 21 && !editorMode && !page22Box5Selected && (
                    <div
                      style={{
                        ...getButtonStyle(37.97, 54.28, 26.08, 3.86),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 6 is selected (below box 6) */}
                  {currentPage === 21 && !editorMode && !page22Box6Selected && (
                    <div
                      style={{
                        ...getButtonStyle(13.19, 69.60, 74.97, 24.40),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 5,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* Number "22" at Dot 3 position on page 22 */}
                  {currentPage === 21 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        22
                      </span>
                    </div>
                  )}
                  {/* Box 1 on page 23 */}
                  {currentPage === 22 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 35.49
                    const boxTop = 39.65
                    const boxWidth = 11.44
                    const boxHeight = 3.51
                    const dot1X = 41.68
                    const dot1Y = 43.16
                    const dot2X = 45.06
                    const dot2Y = 43.16
                    const dot3X = 47.75
                    const dot3Y = 44.95
                    const isSelected = page23Box1Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move left edge to the right by 2px (increase left position)
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    // Move right edge to the left by 2px (decrease width)
                    const rightEdgeLeftPx = 2
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Move top edge down by 1px (increase top position)
                    const topEdgeDownPx = 1
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    // Move bottom edge up by 2px (decrease height)
                    const bottomEdgeUpPx = 2
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop + expandedHeight
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage23Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 2 on page 23 - visible only after box 1 is selected */}
                  {currentPage === 22 && !editorMode && page23Box1Selected && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 30.09
                    const boxTop = 52.88
                    const boxWidth = 16.40
                    const boxHeight = 5.77
                    const dot1X = 40.33
                    const dot1Y = 52.88
                    const dot2X = 43.48
                    const dot2Y = 52.88
                    const dot3X = 46.17
                    const dot3Y = 51.74
                    const isSelected = page23Box2Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move left edge to the right by 2px (increase left position)
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    // Move right edge to the left by 3px (decrease width)
                    const rightEdgeLeftPx = 3
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Move top edge down by 3px (increase top position)
                    const topEdgeDownPx = 3
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    // Move bottom edge up by 4px (decrease height)
                    const bottomEdgeUpPx = 4
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    // Speech bubble with triangle pointing UP from top edge
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      L ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${topY}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    // Top border segments (left of triangle and right of triangle)
                    const topBorderLeftPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                    `
                    const topBorderRightPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage23Box2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderLeftPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderRightPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 3 on page 23 - visible only after box 2 is selected */}
                  {currentPage === 22 && !editorMode && page23Box2Selected && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 34.42
                    const boxTop = 76.24
                    const boxWidth = 27.79
                    const boxHeight = 9.77
                    const dot1X = 33.92
                    const dot1Y = 82.10
                    const dot2X = 33.92
                    const dot2Y = 84.69
                    const dot3X = 29.05
                    const dot3Y = 87.08
                    const isSelected = page23Box3Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(20, Math.max(8, 20 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    // Triangle points LEFT from left edge (between dot1 and dot2) to dot3
                    const triangleBaseTopWrapper = ((dot1Y - adjustedTop) / expandedHeight) * 100
                    const triangleBaseBottomWrapper = ((dot2Y - adjustedTop) / expandedHeight) * 100
                    const triangleTipXWrapper = ((dot3X - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((dot3Y - adjustedTop) / expandedHeight) * 100
                    
                    // Speech bubble with triangle pointing LEFT from left edge
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      L ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${triangleBaseBottomWrapper}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${topLeft},${triangleBaseTopWrapper}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${topY + borderRadiusWrapperY}` : ''}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${topY}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      L ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const leftBorderBottomPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${triangleBaseBottomWrapper}` : ''}
                    `
                    
                    const triangleTopLegPath = `
                      M ${topLeft},${triangleBaseTopWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleBottomLegPath = `
                      M ${topLeft},${triangleBaseBottomWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const leftBorderTopPath = `
                      M ${topLeft},${triangleBaseTopWrapper}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${topY + borderRadiusWrapperY}` : ''}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage23Box3 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={leftBorderBottomPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleBottomLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleTopLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={leftBorderTopPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* White box 2 on page 23 - hidden when box 2 is selected */}
                  {currentPage === 22 && !editorMode && !page23Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(8.56, 30.95, 16.62, 8.38),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 3 on page 23 - hidden when box 2 is selected */}
                  {currentPage === 22 && !editorMode && !page23Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(49.46, 20.85, 24.73, 19.35),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 4 on page 23 - hidden when box 2 is selected */}
                  {currentPage === 22 && !editorMode && !page23Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(40.45, 23.11, 24.73, 15.87),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 5 on page 23 - hidden when box 2 is selected */}
                  {currentPage === 22 && !editorMode && !page23Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(35.72, 25.20, 24.73, 9.25),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 6 on page 23 - hidden when box 2 is selected */}
                  {currentPage === 22 && !editorMode && !page23Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(53.79, 39.93, 7.61, 4.94),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 7 on page 23 - hidden when box 2 is selected */}
                  {currentPage === 22 && !editorMode && !page23Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(56.22, 40.28, 5.36, 4.94),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 8 on page 23 - hidden when box 2 is selected */}
                  {currentPage === 22 && !editorMode && !page23Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(0.00, 58.80, 58.98, 15.00),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 9 on page 23 - hidden when box 2 is selected */}
                  {currentPage === 22 && !editorMode && !page23Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(0.00, 61.41, 100.00, 31.54),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* Number "23" at Dot 3 position on page 23 */}
                  {currentPage === 22 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        23
                      </span>
                    </div>
                  )}
                  {/* "Need Help?" button on 24.1.png - visible when showing initial page */}
                  {currentPage === 23 && !editorMode && !page24ShowMainImage && (() => {
                        const boxWidth = 15.49
                        const boxHeight = 4.21
                        
                        // Center horizontally
                        const boxLeft = (100 - boxWidth) / 2
                        
                        // Position 70px from bottom of image
                        const bottomOffsetPx = 70
                        const bottomOffsetPercent = imageNaturalSize.height > 0 ? (bottomOffsetPx / imageNaturalSize.height) * 100 : 3
                        const boxHeightPercent = imageNaturalSize.height > 0 ? (boxHeight / 100) * 100 : boxHeight
                        const boxTop = 100 - bottomOffsetPercent - boxHeight
                        
                        const adjustedLeft = boxLeft
                        const adjustedTop = boxTop
                        const expandedWidth = boxWidth
                        const expandedHeight = boxHeight
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        const borderRadiusPx = Math.min(8, Math.max(3, 8 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        const strokeColor = "#0d6efd"
                        const strokeWidth = "1"
                        const showHelpText = page24ShowHelpText
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={{...buttonStyle, zIndex: 12}}
                          >
                            <div
                              className="speech-bubble-box"
                              onClick={handlePage24NeedHelp}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'auto',
                                cursor: 'pointer',
                                zIndex: 13,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: showHelpText ? '#000' : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${Math.min(24, Math.max(10, 24 * stageRelativeScale))}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontStyle: showHelpText ? 'italic' : 'normal',
                                fontWeight: showHelpText ? '300' : 'normal',
                                textAlign: 'center',
                                padding: '4px 8px',
                                boxSizing: 'border-box',
                                userSelect: 'auto',
                                WebkitUserSelect: 'auto',
                                opacity: showHelpText ? 1 : 0
                              }}
                            >
                              {showHelpText && 'Hint'}
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill={showHelpText ? "#ffffff" : "transparent"}
                                style={{ fill: showHelpText ? '#ffffff' : 'transparent' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                  })()}
                  {/* Box 1 on page 24 */}
                  {currentPage === 23 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 36.40
                    const boxTop = 34.78
                    const boxWidth = 24.28
                    const boxHeight = 5.60
                    const dot1X = 41.23
                    const dot1Y = 40.38
                    const dot2X = 46.64
                    const dot2Y = 40.38
                    const dot3X = 47.07
                    const dot3Y = 41.99
                    const isSelected = page24Box1Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop + expandedHeight
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage24Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Number "24" at Dot 3 position on page 24 */}
                  {currentPage === 23 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        24
                      </span>
                    </div>
                  )}
                  {/* Number "25" at Dot 3 position on page 25 */}
                  {currentPage === 24 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        25
                      </span>
                    </div>
                  )}
                  {/* Number "26" at Dot 3 position on page 26 */}
                  {currentPage === 25 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        26
                      </span>
                    </div>
                  )}
                  {/* Number "27" at Dot 3 position on page 27 */}
                  {currentPage === 26 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        27
                      </span>
                    </div>
                  )}
                  {/* Number "28" at Dot 3 position on page 28 */}
                  {currentPage === 27 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        28
                      </span>
                    </div>
                  )}
                  {/* Number "29" at Dot 3 position on page 29 */}
                  {currentPage === 28 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        29
                      </span>
                    </div>
                  )}
                  {/* Number "30" at Dot 3 position on page 30 */}
                  {currentPage === 29 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        30
                      </span>
                    </div>
                  )}
                  {/* Number "31" at Dot 3 position on page 31 */}
                  {currentPage === 30 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        31
                      </span>
                    </div>
                  )}
                  {/* Number "32" at Dot 3 position on page 32 */}
                  {currentPage === 31 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        32
                      </span>
                    </div>
                  )}
                  {/* Box 1 on page 20 */}
                  {currentPage === 19 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 43.35
                      const boxTop = 36.21
                      const boxWidth = 11.30
                      const boxHeight = 3.80
                      const dot1X = 50.18
                      const dot1Y = 40.01
                      const dot2X = 52.64
                      const dot2Y = 40.01
                      const dot3X = 55.13
                      const dot3Y = 41.73
                      const isSelected = page20Box1Selected

                      // Move left edge to the right by 1px (reduce width)
                      const leftEdgeRightPx = 1
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left by 2px (reduce width)
                      const rightEdgeLeftPx = 2
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent

                      // Move top edge down by 3px (reduce height)
                      const topEdgeDownPx = 3
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 1px (reduce height)
                      const bottomEdgeUpPx = 1
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                      // Dot3 is BELOW the box (41.73% > 40.01%), so triangle points downward
                      // Dots are on the bottom edge, so they move with the box (left edge moved right 1px)
                      const adjustedDot1X = dot1X + leftEdgeRightPercent
                      const adjustedDot2X = dot2X + leftEdgeRightPercent
                      // Dots Y positions are on the bottom edge, so they move up 1px when the bottom edge moves up
                      const adjustedDot1Y = dot1Y - bottomEdgeUpPercent
                      const adjustedDot2Y = dot2Y - bottomEdgeUpPercent
                      const triangleBaseLeft = adjustedDot1X  // Left point on bottom edge (50.18%)
                      const triangleBaseRight = adjustedDot2X  // Right point on bottom edge (52.64%)
                      const triangleBaseY = adjustedTop + expandedHeight  // Bottom edge Y position
                      const triangleTipX = dot3X  // Triangle tip X (55.13%)
                      const triangleTipY = dot3Y  // Triangle tip Y (41.73% - below the box)
                      
                      // Reduced corner radius for box
                      const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                      const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                      const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                      const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                      const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                      
                      const topLeft = 0
                      const topRight = 100
                      const topY = 0
                      const bottomY = 100
                      
                      const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                      const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                      const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                      const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                      
                      const speechBubblePath = `
                        M ${topLeft + borderRadiusWrapperX},${topY}
                        Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                        L ${topLeft},${bottomY - borderRadiusWrapperY}
                        Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                        L ${triangleBaseRightWrapper},${bottomY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                        Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                        L ${topRight},${topY + borderRadiusWrapperY}
                        Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        Z
                      `
                      
                      const leftBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${topY}
                        Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                        L ${topLeft},${bottomY - borderRadiusWrapperY}
                        Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      `
                      
                      const triangleLeftLegPath = `
                        M ${triangleBaseLeftWrapper},${bottomY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      const triangleRightLegPath = `
                        M ${triangleBaseRightWrapper},${bottomY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      
                      const rightBorderPath = `
                        M ${triangleBaseRightWrapper},${bottomY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                        Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                        L ${topRight},${topY + borderRadiusWrapperY}
                        Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      `
                      
                      const topBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${topY}
                        L ${topRight - borderRadiusWrapperX},${topY}
                      `
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage20Box1 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box'
                            }}
                          >
                          </div>
                          <svg
                            className="speech-bubble-svg"
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: 'none',
                              overflow: 'visible',
                              zIndex: 10
                            }}
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                          >
                            <defs>
                            </defs>
                            <path
                              d={speechBubblePath}
                              fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.7)"}
                              style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.7)' }}
                            />
                            <g className="speech-bubble-border-group">
                              <path
                                d={leftBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleLeftLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleRightLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={rightBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={topBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                            </g>
                            <path
                              d={`M ${triangleBaseLeftWrapper},${bottomY} L ${triangleBaseRightWrapper},${bottomY}`}
                              fill="none"
                              stroke="transparent"
                              strokeWidth="0.3"
                              vectorEffect="non-scaling-stroke"
                            />
                          </svg>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Box 2 on page 20 */}
                  {currentPage === 19 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 37.10
                      const boxTop = 42.41
                      const boxWidth = 14.87
                      const boxHeight = 6.04
                      const dot1X = 51.97
                      const dot1Y = 45.76
                      const dot2X = 51.97
                      const dot2Y = 47.31
                      const dot3X = 54.91
                      const dot3Y = 46.73
                      const isSelected = page20Box2Selected

                      // Move left edge to the right by 1px (reduce width)
                      const leftEdgeRightPx = 1
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left by 2px (reduce width)
                      const rightEdgeLeftPx = 2
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent

                      // Move top edge down by 4px (reduce height)
                      const topEdgeDownPx = 4
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 2px (reduce height)
                      const bottomEdgeUpPx = 2
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      // Calculate triangle - it extends RIGHTWARD from the right edge (between dot1 and dot2) to dot3
                      // Dot1 and Dot2 are both on the right edge (51.97%) at different Y positions
                      // Dot3 is to the right (54.91%, 46.73%), so triangle extends rightward
                      // Dots are on the right edge, so their Y positions move with the top edge (moved down 4px)
                      let adjustedDot1Y = dot1Y + topEdgeDownPercent
                      let adjustedDot2Y = dot2Y + topEdgeDownPercent
                      // Move dot 1 up by 2px (additional adjustment from current location)
                      const dot1UpPx = 2
                      const dot1UpPercent = stageHeightPx > 0 ? (dot1UpPx / stageHeightPx) * 100 : 0
                      adjustedDot1Y = adjustedDot1Y - dot1UpPercent
                      // Move dot 2 up by 4px (additional adjustment from current location)
                      const dot2UpPx = 4
                      const dot2UpPercent = stageHeightPx > 0 ? (dot2UpPx / stageHeightPx) * 100 : 0
                      adjustedDot2Y = adjustedDot2Y - dot2UpPercent
                      const triangleBaseTop = adjustedDot1Y  // Top break point on right edge (45.76%)
                      const triangleBaseBottom = adjustedDot2Y  // Bottom break point on right edge (47.31%)
                      const triangleTipX = dot3X  // Triangle tip X (54.91%)
                      const triangleTipY = dot3Y  // Triangle tip Y (46.73%)
                      
                      // Reduced corner radius for box
                      const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                      const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                      const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                      const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                      const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                      
                      const topLeft = 0
                      const topRight = 100
                      const topY = 0
                      const bottomY = 100
                      
                      // Convert triangle base points to wrapper-relative coordinates
                      // Triangle base is on the right edge (at topRight = 100)
                      const triangleBaseTopWrapper = ((triangleBaseTop - adjustedTop) / expandedHeight) * 100
                      const triangleBaseBottomWrapper = ((triangleBaseBottom - adjustedTop) / expandedHeight) * 100
                      const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                      const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                      
                      const speechBubblePath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        L ${topRight - borderRadiusWrapperX},${topY}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                        ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topRight},${triangleBaseTopWrapper}` : ''}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                        L ${topRight},${triangleBaseBottomWrapper}
                        ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topRight},${bottomY - borderRadiusWrapperY}` : ''}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                        Z
                      `
                      
                      // Border paths - separate segments to exclude right edge between the two points
                      const leftBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        L ${topRight - borderRadiusWrapperX},${topY}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      `
                      
                      const topBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${topY}
                        L ${topRight - borderRadiusWrapperX},${topY}
                      `
                      
                      const triangleTopLegPath = `
                        M ${topRight},${triangleBaseTopWrapper}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      const triangleBottomLegPath = `
                        M ${topRight},${triangleBaseBottomWrapper}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      
                      const rightBorderTopPath = `
                        M ${topRight},${topY + borderRadiusWrapperY}
                        ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topRight},${triangleBaseTopWrapper}` : ''}
                      `
                      
                      const rightBorderBottomPath = `
                        M ${topRight},${triangleBaseBottomWrapper}
                        ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topRight},${bottomY - borderRadiusWrapperY}` : ''}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      const bottomBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        L ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage20Box2 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box'
                            }}
                          >
                          </div>
                          <svg
                            className="speech-bubble-svg"
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: 'none',
                              overflow: 'visible',
                              zIndex: 10
                            }}
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                          >
                            <defs>
                            </defs>
                            <path
                              d={speechBubblePath}
                              fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.7)"}
                              style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.7)' }}
                            />
                            <g className="speech-bubble-border-group">
                              <path
                                d={leftBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={topBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={rightBorderTopPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleTopLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleBottomLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={rightBorderBottomPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={bottomBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                            </g>
                            <path
                              d={`M ${topRight},${triangleBaseTopWrapper} L ${topRight},${triangleBaseBottomWrapper}`}
                              fill="none"
                              stroke="transparent"
                              strokeWidth="0.3"
                              vectorEffect="non-scaling-stroke"
                            />
                          </svg>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Box 3 on page 20 - no pointer */}
                  {currentPage === 19 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 15.47
                      const boxTop = 77.23
                      const boxWidth = 21.12
                      const boxHeight = 8.62
                      const isSelected = page20Box3Selected

                      // Move left edge to the right by 2px (reduce width, keep right edge in place)
                      const leftEdgeRightPx = 2
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent

                      // Move top edge down by 1px (reduce height)
                      const topEdgeDownPx = 1
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 2px (reduce height)
                      const bottomEdgeUpPx = 2
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage20Box3 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box',
                              borderRadius: `${borderRadiusPx}px`,
                              backgroundColor: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.7)',
                              border: `${isSelected ? '2px' : '1px'} solid ${isSelected ? '#f05f40' : '#0d6efd'}`
                            }}
                          >
                          </div>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Box 4 on page 20 - no pointer */}
                  {currentPage === 19 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 39.33
                      const boxTop = 77.23
                      const boxWidth = 21.12
                      const boxHeight = 8.62
                      const isSelected = page20Box4Selected

                      // Move left edge to the right by 1px (reduce width)
                      const leftEdgeRightPx = 1
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left by 1px (reduce width)
                      const rightEdgeLeftPx = 1
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent

                      // Move top edge down by 1px (reduce height)
                      const topEdgeDownPx = 1
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 2px (reduce height)
                      const bottomEdgeUpPx = 2
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage20Box4 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box',
                              borderRadius: `${borderRadiusPx}px`,
                              backgroundColor: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.7)',
                              border: `${isSelected ? '2px' : '1px'} solid ${isSelected ? '#f05f40' : '#0d6efd'}`
                            }}
                          >
                          </div>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Box 5 on page 20 - no pointer */}
                  {currentPage === 19 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 63.20
                      const boxTop = 77.23
                      const boxWidth = 21.12
                      const boxHeight = 16.72
                      const isSelected = page20Box5Selected

                      // Move left edge to the right by 1px (reduce width)
                      const leftEdgeRightPx = 1
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left by 1px (reduce width)
                      const rightEdgeLeftPx = 1
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent

                      // Move top edge down by 1px (reduce height)
                      const topEdgeDownPx = 1
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 1px (reduce height)
                      const bottomEdgeUpPx = 1
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage20Box5 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box',
                              borderRadius: `${borderRadiusPx}px`,
                              backgroundColor: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.7)',
                              border: `${isSelected ? '2px' : '1px'} solid ${isSelected ? '#f05f40' : '#0d6efd'}`
                            }}
                          >
                          </div>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Box 6 on page 20 - only active after box 5 is selected */}
                  {currentPage === 19 && !editorMode && page20Box5Selected && (
                    <>
                      {(() => {
                      const boxLeft = 72.22
                      const boxTop = 90.75
                      const boxWidth = 3.55
                      const boxHeight = 2.33
                      const isSelected = page20Box6Selected

                      // Keep left edge in place, move right edge to the left by 6px (reduce width by 6px total)
                      const rightEdgeLeftPx = 6
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft
                      const adjustedBoxWidth = boxWidth - rightEdgeLeftPercent

                      // Move top edge down by 1px (reduce height)
                      const topEdgeDownPx = 1
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 1px (reduce height)
                      const bottomEdgeUpPx = 1
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent

                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage20Box6 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box',
                              borderRadius: `${borderRadiusPx}px`,
                              backgroundColor: isSelected ? '#3bbf6b' : 'rgba(255, 255, 255, 0.95)',
                              border: '1px solid',
                              borderColor: isSelected ? '#3bbf6b' : '#0d6efd',
                              outline: isSelected ? '1px solid #3bbf6b' : 'none',
                              outlineOffset: '0px'
                            }}
                          >
                          </div>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* White boxes on page 20 - hidden when box 1 is selected */}
                  {currentPage === 19 && !editorMode && !page20Box1Selected && (
                    <>
                      {/* White box 1 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(32.34, 42.09, 20.00, 7.34),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 2 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(47.56, 45.57, 8.48, 3.63),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    </>
                  )}
                  {/* White boxes on page 20 - hidden when box 2 is selected */}
                  {currentPage === 19 && !editorMode && !page20Box2Selected && (
                    <>
                      {/* White box 1 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(12.19, 50.10, 75.40, 26.43),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 2 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(58.74, 46.86, 4.43, 3.56),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 3 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(14.35, 76.11, 24.03, 10.70),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    </>
                  )}
                  {/* White boxes on page 20 - hidden when box 3 is selected */}
                  {currentPage === 19 && !editorMode && !page20Box3Selected && (
                    <>
                      {/* White box 1 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(38.20, 76.04, 23.83, 12.56),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 2 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(63.36, 36.40, 5.81, 4.55),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 3 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(65.83, 36.87, 5.81, 4.55),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 4 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(60.05, 36.00, 9.19, 4.90),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    </>
                  )}
                  {/* White boxes on page 20 - hidden when box 4 is selected */}
                  {currentPage === 19 && !editorMode && !page20Box4Selected && (
                    <>
                      {/* White box 1 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(58.02, 18.59, 14.82, 7.17),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 2 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(61.85, 75.69, 25.41, 19.87),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    </>
                  )}
                  {/* White boxes on page 20 - hidden when box 5 is selected */}
                  {currentPage === 19 && !editorMode && !page20Box5Selected && (
                    <>
                      {/* White box 1 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(53.74, 25.55, 23.38, 10.65),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 2 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(14.32, 86.66, 23.38, 6.99),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    </>
                  )}
                  {/* White box on page 15.1.png - hidden when "Need Help?" button is selected the first time */}
                  {currentPage === 14 && !editorMode && !page15BoxSelected && !page15BoxesVisible && (() => {
                    const boxLeft = 64.56
                    const boxTop = 52.01
                    const boxWidth = 26.08
                    const boxHeight = 11.87
                    // Increase width by 20px (move right edge 20px to the right)
                    const widthIncreasePx = 20
                    const widthIncreasePercent = imageNaturalSize.width > 0 ? (widthIncreasePx / imageNaturalSize.width) * 100 : 0
                    const adjustedWidth = boxWidth + widthIncreasePercent
                    
                    return (
                      <div
                        style={{
                          ...getButtonStyle(boxLeft, boxTop, adjustedWidth, boxHeight),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    )
                  })()}
                  {/* White box on page 15.1.png and 15.png - hidden when both box 1 and box 2 are selected */}
                  {currentPage === 14 && !editorMode && !(page15Box1Selected && page15Box2Selected) && (
                    <div
                      style={{
                        ...getButtonStyle(17.47, 76.91, 65.96, 15.87),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* Button, LED boxes - only show on 15.1.png when page15BoxesVisible is true */}
                  {currentPage === 14 && !editorMode && !page15BoxSelected && page15BoxesVisible && (
                    <>
                      {/* Button box */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce button box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 10
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move button box: right 10px, then left 4px, then right 3px (net: right 9px), and down 15px
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const downOffsetPx = 15
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const buttonFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: '#ffeb3b', // Yellow text
                                fontSize: `${buttonFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              Button
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#ffffff"
                                style={{ fill: '#ffffff' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* Duplicate Button box - 100px to the right */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce button box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 10
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move button box: right 10px, then left 4px, then right 3px (net: right 9px), and down 15px
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const downOffsetPx = 15
                        // Add 90px to the right for duplicate (100px - 10px left)
                        const duplicateRightOffsetPx = 90
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const duplicateRightOffsetPercent = imageNaturalSize.width > 0 ? (duplicateRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent + duplicateRightOffsetPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const buttonFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'white',
                                fontSize: `${buttonFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              Button
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#ffeb3b"
                                style={{ fill: '#ffeb3b' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* Duplicate LED text box - 100px to the right */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce LED box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 10
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move LED box: right 10px, then left 4px, then right 3px (net: right 9px), then right 43px more, and down 15px
                        // Add 90px to the right for duplicate (100px - 10px left)
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const ledRightOffsetPx = 43
                        const duplicateRightOffsetPx = 90
                        const downOffsetPx = 15
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const ledRightOffsetPercent = imageNaturalSize.width > 0 ? (ledRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const duplicateRightOffsetPercent = imageNaturalSize.width > 0 ? (duplicateRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent + ledRightOffsetPercent + duplicateRightOffsetPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const ledFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'black',
                                fontSize: `${ledFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              LED
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#ffffff"
                                style={{ fill: '#ffffff' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* Ground text box on 15.1.png */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce button box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 5
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move button box: right 10px, then left 4px, then right 3px (net: right 9px), and down 15px
                        // Then for duplicate: left 25px (15px + 10px) and down 86px (50px + 40px - 4px)
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const downOffsetPx = 15
                        const duplicateLeftOffsetPx = 25
                        const duplicateDownOffsetPx = 86
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const duplicateLeftOffsetPercent = imageNaturalSize.width > 0 ? (duplicateLeftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const duplicateDownOffsetPercent = imageNaturalSize.height > 0 ? (duplicateDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent - duplicateLeftOffsetPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent + duplicateDownOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const groundFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: '#595959',
                                fontSize: `${groundFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              Ground
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#ffffff"
                                style={{ fill: '#ffffff' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                    </>
                  )}
                  {/* Number "19" at Dot 3 position on page 19 */}
                  {currentPage === 18 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        19
                      </span>
                    </div>
                  )}
                  {/* Box 1 on page 19 */}
                  {currentPage === 18 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 68.61
                      const boxTop = 24.68
                      const boxWidth = 24.96
                      const boxHeight = 6.64
                      const dot1X = 68.61
                      const dot1Y = 28.31
                      const dot2X = 68.61
                      const dot2Y = 30.22
                      const dot3X = 52.70
                      const dot3Y = 31.02
                      const isSelected = page19Box1Selected
                      
                      // Move left edge to the right by 3px (reduce width)
                      const leftEdgeRightPx = 3
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left by 3px (reduce width)
                      const rightEdgeLeftPx = 3
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                      
                      // Move top edge down by 2px (reduce height) - keep in place
                      const topEdgeDownPx = 2
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 3px (reduced from 4px to increase height by 1px)
                      const bottomEdgeUpPx = 3
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      // Dots are on the left edge, so they move with the box (top edge moved down 2px)
                      // Move dot 1 up by 1px (additional adjustment from current location)
                      const dot1UpPx = 1
                      const dot1UpPercent = stageHeightPx > 0 ? (dot1UpPx / stageHeightPx) * 100 : 0
                      const adjustedDot1Y = dot1Y + topEdgeDownPercent - dot1UpPercent
                      // Move dot 2 up by 3px (additional adjustment from current location)
                      const dot2UpPx = 3
                      const dot2UpPercent = stageHeightPx > 0 ? (dot2UpPx / stageHeightPx) * 100 : 0
                      const adjustedDot2Y = dot2Y + topEdgeDownPercent - dot2UpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      // Calculate triangle - it extends LEFTWARD from the left edge (between dot1 and dot2) to dot3
                      // Dot1 and Dot2 are both on the left edge (moved right 3px, moved down 2px) at different Y positions
                      // Dot3 is to the left (52.70%, 31.02%), so triangle extends leftward
                      const triangleBaseTop = adjustedDot1Y  // Top break point on left edge (moved down 2px)
                      const triangleBaseBottom = adjustedDot2Y  // Bottom break point on left edge (moved down 2px)
                      const triangleTipX = dot3X  // Triangle tip X (52.70%)
                      const triangleTipY = dot3Y  // Triangle tip Y (31.02%)
                      
                      // Reduced corner radius for box
                      const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                      const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                      const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                      const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                      const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                      
                      const topLeft = 0
                      const topRight = 100
                      const topY = 0
                      const bottomY = 100
                      
                      // Convert triangle base points to wrapper-relative coordinates
                      // Triangle base is on the left edge (at topLeft = 0)
                      const triangleBaseTopWrapper = ((triangleBaseTop - adjustedTop) / expandedHeight) * 100
                      const triangleBaseBottomWrapper = ((triangleBaseBottom - adjustedTop) / expandedHeight) * 100
                      const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                      const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                      
                      const speechBubblePath = `
                        M ${topRight - borderRadiusWrapperX},${bottomY}
                        Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                        L ${topRight},${topY + borderRadiusWrapperY}
                        Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        L ${topLeft + borderRadiusWrapperX},${topY}
                        Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                        ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                        L ${topLeft},${triangleBaseBottomWrapper}
                        ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${bottomY - borderRadiusWrapperY}` : ''}
                        Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        Z
                      `
                      
                      // Border paths - separate segments to exclude left edge between the two points
                      const rightBorderPath = `
                        M ${topRight - borderRadiusWrapperX},${bottomY}
                        Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                        L ${topRight},${topY + borderRadiusWrapperY}
                        Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        L ${topLeft + borderRadiusWrapperX},${topY}
                        Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      `
                      
                      const topBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${topY}
                        L ${topRight - borderRadiusWrapperX},${topY}
                      `
                      
                      const triangleTopLegPath = `
                        M ${topLeft},${triangleBaseTopWrapper}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      const triangleBottomLegPath = `
                        M ${topLeft},${triangleBaseBottomWrapper}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      
                      const leftBorderTopPath = `
                        M ${topLeft},${topY + borderRadiusWrapperY}
                        ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                      `
                      
                      const leftBorderBottomPath = `
                        M ${topLeft},${triangleBaseBottomWrapper}
                        ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${bottomY - borderRadiusWrapperY}` : ''}
                        Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      `
                      
                      const bottomBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        L ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage19Box1 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box'
                            }}
                          >
                          </div>
                          <svg
                            className="speech-bubble-svg"
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: 'none',
                              overflow: 'visible',
                              zIndex: 10
                            }}
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                          >
                            <defs>
                            </defs>
                            <path
                              d={speechBubblePath}
                              fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.7)"}
                              style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.7)' }}
                            />
                            <g className="speech-bubble-border-group">
                              <path
                                d={rightBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={topBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={leftBorderTopPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleTopLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleBottomLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={leftBorderBottomPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={bottomBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                            </g>
                            <path
                              d={`M ${topLeft},${triangleBaseTopWrapper} L ${topLeft},${triangleBaseBottomWrapper}`}
                              fill="none"
                              stroke="transparent"
                              strokeWidth="0.3"
                              vectorEffect="non-scaling-stroke"
                            />
                          </svg>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Box 2 on page 19 */}
                  {currentPage === 18 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 65.01
                      const boxTop = 37.91
                      const boxWidth = 15.49
                      const boxHeight = 4.55
                      const dot1X = 73.90
                      const dot1Y = 37.91
                      const dot2X = 77.95
                      const dot2Y = 37.91
                      const dot3X = 79.51
                      const dot3Y = 34.85
                      const isSelected = page19Box2Selected
                      
                      // Move left edge to the right by 3px (reduce width)
                      const leftEdgeRightPx = 3
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left by 2px (reduce width)
                      const rightEdgeLeftPx = 2
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                      
                      // Move top edge down by 3px (reduce height)
                      const topEdgeDownPx = 3
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 1px (reduce height)
                      const bottomEdgeUpPx = 1
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      // Dots are on the top edge, so their X positions need to be adjusted relative to the new box position
                      // Dot1 and Dot2 X positions are relative to the box, so they move with the left edge
                      // Dot1 and Dot2 Y positions are on the top edge, so they move with the top edge (moved down 3px)
                      let adjustedDot1X = dot1X + leftEdgeRightPercent
                      let adjustedDot2X = dot2X + leftEdgeRightPercent
                      const adjustedDot1Y = dot1Y + topEdgeDownPercent
                      const adjustedDot2Y = dot2Y + topEdgeDownPercent
                      
                      // Move dot 1 to the left by 2px
                      const dot1LeftPx = 2
                      const dot1LeftPercent = stageWidthPx > 0 ? (dot1LeftPx / stageWidthPx) * 100 : 0
                      adjustedDot1X = adjustedDot1X - dot1LeftPercent
                      
                      // Move dot 2 to the left by 4px
                      const dot2LeftPx = 4
                      const dot2LeftPercent = stageWidthPx > 0 ? (dot2LeftPx / stageWidthPx) * 100 : 0
                      adjustedDot2X = adjustedDot2X - dot2LeftPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                      // Dot3 is ABOVE the box (34.85% < 37.91%), so triangle points upward
                      // Triangle base breaks the top edge at exact dot1 and dot2 X positions (adjusted for box movement and dot adjustments)
                      const triangleBaseLeft = adjustedDot1X  // Left break point - exact dot1 X position (moved right 3px, then left 2px)
                      const triangleBaseRight = adjustedDot2X  // Right break point - exact dot2 X position (moved right 3px, then left 4px)
                      const triangleTipX = dot3X  // Triangle tip X (79.51%)
                      const triangleTipY = dot3Y  // Triangle tip Y (34.85% - above the box)
                      
                      // Reduced corner radius for box
                      const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                      const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                      const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                      const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                      const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                      
                      const topLeft = 0
                      const topRight = 100
                      const topY = 0
                      const bottomY = 100
                      
                      // Convert triangle base points to wrapper-relative coordinates
                      // Triangle base should break the top edge at the exact X positions of dot1 and dot2
                      const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                      const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                      const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                      // Triangle tip is above the box, so calculate relative to wrapper (will be negative)
                      const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                      
                      const speechBubblePath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                        L ${triangleBaseRightWrapper},${topY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                        L ${topRight},${bottomY - borderRadiusWrapperY}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                        Z
                      `
                      
                      // Border paths - separate segments to exclude top edge between the two points
                      // Left border: from bottom-left corner up to first point on top edge (dot1 position)
                      const leftBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      `
                      
                      // Triangle border: two legs only (not the base between the points)
                      // Left leg: from dot1 to tip
                      const triangleLeftLegPath = `
                        M ${triangleBaseLeftWrapper},${topY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      // Right leg: from dot2 to tip
                      const triangleRightLegPath = `
                        M ${triangleBaseRightWrapper},${topY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      
                      // Right border: from second point on top edge (dot2 position) down to bottom-right corner
                      const rightBorderPath = `
                        M ${triangleBaseRightWrapper},${topY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                        L ${topRight},${bottomY - borderRadiusWrapperY}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      // Bottom border: complete bottom edge
                      const bottomBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        L ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage19Box2 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box'
                            }}
                          >
                          </div>
                          <svg
                            className="speech-bubble-svg"
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: 'none',
                              overflow: 'visible',
                              zIndex: 10
                            }}
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                          >
                            <defs>
                            </defs>
                            <path
                              d={speechBubblePath}
                              fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.7)"}
                              style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.7)' }}
                            />
                            <g className="speech-bubble-border-group">
                              <path
                                d={leftBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleLeftLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleRightLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={rightBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={bottomBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                            </g>
                            <path
                              d={`M ${triangleBaseLeftWrapper},${topY} L ${triangleBaseRightWrapper},${topY}`}
                              fill="none"
                              stroke="transparent"
                              strokeWidth="0.3"
                              vectorEffect="non-scaling-stroke"
                            />
                          </svg>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Box 3 on page 19 */}
                  {currentPage === 18 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 47.66
                      const boxTop = 72.38
                      const boxWidth = 22.93
                      const boxHeight = 4.90
                      const dot1X = 47.66
                      const dot1Y = 73.22
                      const dot2X = 47.66
                      const dot2Y = 74.62
                      const dot3X = 34.23
                      const dot3Y = 73.85
                      const isSelected = page19Box3Selected
                      
                      // Move left edge to the right by 3px (reduce width)
                      const leftEdgeRightPx = 3
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left by 3px (reduced from 4px to increase width by 1px)
                      const rightEdgeLeftPx = 3
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                      
                      // Move top edge down by 2px (reduce height) - keep in place
                      const topEdgeDownPx = 2
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 3px (reduced from 4px to increase height by 1px)
                      const bottomEdgeUpPx = 3
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      // Dots are on the left edge, so they move with the box (left edge moved right 3px, top edge moved down 2px)
                      const adjustedDot1X = dot1X + leftEdgeRightPercent
                      const adjustedDot2X = dot2X + leftEdgeRightPercent
                      // Move dot 1 up by 1px (additional adjustment from current location)
                      const dot1UpPx = 1
                      const dot1UpPercent = stageHeightPx > 0 ? (dot1UpPx / stageHeightPx) * 100 : 0
                      const adjustedDot1Y = dot1Y + topEdgeDownPercent - dot1UpPercent
                      // Move dot 2 up by 3px (additional adjustment from current location)
                      const dot2UpPx = 3
                      const dot2UpPercent = stageHeightPx > 0 ? (dot2UpPx / stageHeightPx) * 100 : 0
                      const adjustedDot2Y = dot2Y + topEdgeDownPercent - dot2UpPercent
                      
                      // Move dot 3 up by 1px (additional adjustment from current location)
                      const dot3UpPx = 1
                      const dot3UpPercent = stageHeightPx > 0 ? (dot3UpPx / stageHeightPx) * 100 : 0
                      const adjustedDot3Y = dot3Y - dot3UpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      // Calculate triangle - it extends LEFTWARD from the left edge (between dot1 and dot2) to dot3
                      // Dot1 and Dot2 are both on the left edge (moved right 3px, moved down 2px) at different Y positions
                      // Dot3 is to the left (34.23%, 73.85%), so triangle extends leftward
                      const triangleBaseTop = adjustedDot1Y  // Top break point on left edge (moved down 2px)
                      const triangleBaseBottom = adjustedDot2Y  // Bottom break point on left edge (moved down 2px)
                      const triangleTipX = dot3X  // Triangle tip X (34.23%)
                      const triangleTipY = adjustedDot3Y  // Triangle tip Y (73.85%, moved up 1px)
                      
                      // Reduced corner radius for box
                      const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                      const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                      const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                      const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                      const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                      
                      const topLeft = 0
                      const topRight = 100
                      const topY = 0
                      const bottomY = 100
                      
                      // Convert triangle base points to wrapper-relative coordinates
                      // Triangle base is on the left edge (at topLeft = 0)
                      const triangleBaseTopWrapper = ((triangleBaseTop - adjustedTop) / expandedHeight) * 100
                      const triangleBaseBottomWrapper = ((triangleBaseBottom - adjustedTop) / expandedHeight) * 100
                      const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                      const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                      
                      const speechBubblePath = `
                        M ${topRight - borderRadiusWrapperX},${bottomY}
                        Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                        L ${topRight},${topY + borderRadiusWrapperY}
                        Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        L ${topLeft + borderRadiusWrapperX},${topY}
                        Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                        ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                        L ${topLeft},${triangleBaseBottomWrapper}
                        ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${bottomY - borderRadiusWrapperY}` : ''}
                        Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        Z
                      `
                      
                      // Border paths - separate segments to exclude left edge between the two points
                      const rightBorderPath = `
                        M ${topRight - borderRadiusWrapperX},${bottomY}
                        Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                        L ${topRight},${topY + borderRadiusWrapperY}
                        Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        L ${topLeft + borderRadiusWrapperX},${topY}
                        Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      `
                      
                      const topBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${topY}
                        L ${topRight - borderRadiusWrapperX},${topY}
                      `
                      
                      const triangleTopLegPath = `
                        M ${topLeft},${triangleBaseTopWrapper}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      const triangleBottomLegPath = `
                        M ${topLeft},${triangleBaseBottomWrapper}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      
                      const leftBorderTopPath = `
                        M ${topLeft},${topY + borderRadiusWrapperY}
                        ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                      `
                      
                      const leftBorderBottomPath = `
                        M ${topLeft},${triangleBaseBottomWrapper}
                        ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${bottomY - borderRadiusWrapperY}` : ''}
                        Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      `
                      
                      const bottomBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        L ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage19Box3 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box'
                            }}
                          >
                          </div>
                          <svg
                            className="speech-bubble-svg"
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: 'none',
                              overflow: 'visible',
                              zIndex: 10
                            }}
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                          >
                            <defs>
                            </defs>
                            <path
                              d={speechBubblePath}
                              fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.7)"}
                              style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.7)' }}
                            />
                            <g className="speech-bubble-border-group">
                              <path
                                d={rightBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={topBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={leftBorderTopPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleTopLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleBottomLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={leftBorderBottomPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={bottomBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                            </g>
                            <path
                              d={`M ${topLeft},${triangleBaseTopWrapper} L ${topLeft},${triangleBaseBottomWrapper}`}
                              fill="none"
                              stroke="transparent"
                              strokeWidth="0.3"
                              vectorEffect="non-scaling-stroke"
                            />
                          </svg>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* White boxes on page 19 - hidden when box 1 is selected */}
                  {currentPage === 18 && !editorMode && !page19Box1Selected && (
                    <>
                      {/* White box 1 */}
                      <div
                        style={{
                          ...getButtonStyle(67.49, 31.82, 29.01, 15.00),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 2 */}
                      <div
                        style={{
                          ...getButtonStyle(56.22, 33.91, 29.01, 15.00),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    </>
                  )}
                  {/* White box on page 19 - hidden when box 2 is selected */}
                  {currentPage === 18 && !editorMode && !page19Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(0.00, 62.63, 100.00, 31.36),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* Number "20" at Dot 3 position on page 20 */}
                  {currentPage === 19 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        20
                      </span>
                    </div>
                  )}
                  {/* Number "21" at Dot 3 position on page 21.1 (default) */}
                  {currentPage === 20 && !editorMode && !page21ShowHelpImage && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        21
                      </span>
                    </div>
                  )}
                  {/* Box 1 on page 21.1.png */}
                  {currentPage === 20 && !editorMode && !page21ShowHelpImage && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 32.57
                    const boxTop = 45.75
                    const boxWidth = 25.63
                    const boxHeight = 6.82
                    const dot1X = 36.72
                    const dot1Y = 52.56
                    const dot2X = 43.71
                    const dot2Y = 52.56
                    const dot3X = 32.43
                    const dot3Y = 55.75
                    const isSelected = page21Box1Selected
                    
                    // Move left edge to the right by 2px (reduce width)
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                    // Move right edge to the left by 2px (reduce width)
                    const rightEdgeLeftPx = 2
                    const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                    const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                    const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                    
                    // Move top edge down by 3px (reduce height)
                    const topEdgeDownPx = 3
                    const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                    // Move bottom edge up by 2px (reduce height)
                    const bottomEdgeUpPx = 2
                    const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                    const adjustedBoxTop = boxTop + topEdgeDownPercent
                    const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage21Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          <path
                            d={`M ${triangleBaseLeftWrapper},${bottomY} L ${triangleBaseRightWrapper},${bottomY}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 2 on page 21.1.png */}
                  {currentPage === 20 && !editorMode && !page21ShowHelpImage && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 63.66
                    const boxTop = 47.83
                    const boxWidth = 27.43
                    const boxHeight = 23.18
                    const dot1X = 63.66
                    const dot1Y = 61.39
                    const dot2X = 63.66
                    const dot2Y = 67.31
                    const dot3X = 54.06
                    const dot3Y = 71.07
                    const isSelected = page21Box2Selected
                    
                    // Move left edge to the right by 2px (reduce width)
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                    // Move right edge to the left by 2px (reduce width)
                    const rightEdgeLeftPx = 2
                    const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                    const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                    const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                    
                    // Move top edge down by 3px (reduce height)
                    const topEdgeDownPx = 3
                    const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                    // Move bottom edge up by 1px (reduce height)
                    const bottomEdgeUpPx = 1
                    const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                    const adjustedBoxTop = boxTop + topEdgeDownPercent
                    const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Move dot 2 up by 2px (net: 3px up - 1px down = 2px up from original)
                    const dot2UpPx = 2
                    const dot2UpPercent = stageHeightPx > 0 ? (dot2UpPx / stageHeightPx) * 100 : 0
                    const adjustedDot2Y = dot2Y - dot2UpPercent
                    
                    const triangleBaseTop = dot1Y
                    const triangleBaseBottom = adjustedDot2Y
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(42, Math.max(14, 42 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseTopWrapper = ((triangleBaseTop - adjustedTop) / expandedHeight) * 100
                    const triangleBaseBottomWrapper = ((triangleBaseBottom - adjustedTop) / expandedHeight) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${triangleBaseBottomWrapper}` : ''}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const triangleTopLegPath = `
                      M ${topLeft},${triangleBaseTopWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleBottomLegPath = `
                      M ${topLeft},${triangleBaseBottomWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const leftBorderTopPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                    `
                    
                    const leftBorderBottomPath = `
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `M ${topLeft},${triangleBaseBottomWrapper}` : ''}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage21Box2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleTopLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleBottomLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={leftBorderTopPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={leftBorderBottomPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          <path
                            d={`M ${topLeft},${triangleBaseTopWrapper} L ${topLeft},${triangleBaseBottomWrapper}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* White box 1 on page 21.1.png - hidden when box 1 is selected */}
                  {currentPage === 20 && !editorMode && !page21ShowHelpImage && !page21Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(3.05, 56.19, 50.42, 41.11),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 2 on page 21.1.png - hidden when box 1 is selected */}
                  {currentPage === 20 && !editorMode && !page21ShowHelpImage && !page21Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(19.27, 72.47, 74.75, 22.49),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 3 on page 21.1.png - hidden when box 1 is selected */}
                  {currentPage === 20 && !editorMode && !page21ShowHelpImage && !page21Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(50.14, 52.79, 43.88, 42.16),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 4 on page 21.1.png - hidden when box 1 is selected */}
                  {currentPage === 20 && !editorMode && !page21ShowHelpImage && !page21Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(60.73, 46.18, 33.29, 25.79),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 21.1.png - hidden when "Need Help?" button is selected */}
                  {currentPage === 20 && !editorMode && !page21ShowHelpImage && page21ShowHelpText && (
                    <div
                      style={{
                        ...getButtonStyle(9.13, 81.09, 20.00, 15.00),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* "Need Help?" button on 21.1.png and 21.png - always visible when on page 21 */}
                  {currentPage === 20 && !editorMode && (() => {
                        const boxLeft = 8.23
                        const boxTop = 38.78
                        const boxWidth = 15.49
                        const boxHeight = 4.21
                        const isSelected = false // Button is never "selected", it's always clickable
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Move box down by 56px (30px + 15px + 8px + 3px additional)
                        const downOffsetPx = 56
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        
                        // Move box top edge down by 6px and bottom edge up by 3px (reduce height)
                        const topDownOffsetPx = 6
                        const topDownOffsetPercent = imageNaturalSize.height > 0 ? (topDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const heightReductionPx = 9
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (heightReductionPx / imageNaturalSize.height) * 100 : 0
                        
                        // Move box left edge to the right by 6px and right edge to the left by 6px (reduce width)
                        const leftEdgeRightPx = 6
                        const rightEdgeLeftPx = 6
                        const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                        const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                        const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topDownOffsetPercent + downOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        const borderRadiusPx = Math.min(8, Math.max(3, 8 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Determine stroke color and width for box
                        const strokeColor = "#0d6efd"
                        const strokeWidth = "1"
                        // Show "Need Help?" text only if page21ShowHelpText is true
                        const showHelpText = page21ShowHelpText
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={{...buttonStyle, zIndex: 12}}
                          >
                            <div
                              className="speech-bubble-box"
                              onClick={handlePage21NeedHelp}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'auto',
                                cursor: 'pointer',
                                zIndex: 13,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: showHelpText ? '#000' : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontStyle: showHelpText ? 'italic' : 'normal',
                                fontWeight: showHelpText ? '300' : 'normal',
                                textAlign: 'center',
                                padding: '4px 8px',
                                boxSizing: 'border-box',
                                userSelect: 'auto',
                                WebkitUserSelect: 'auto',
                                opacity: showHelpText ? 1 : 0
                              }}
                            >
                              {showHelpText && 'Need Help?'}
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill={showHelpText ? "#ffffff" : "transparent"}
                                style={{ fill: showHelpText ? '#ffffff' : 'transparent' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                  })()}
                  {/* Duplicate "Need Help?" button on 21.png and 21.2.png - bottom left, no text */}
                  {currentPage === 20 && !editorMode && page21ShowHelpImage && (() => {
                        const boxLeft = 6.66
                        const boxTop = 92.31
                        const boxWidth = 8.28
                        const boxHeight = 6.12
                        const isSelected = false // Button is never "selected", it's always clickable
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Move left edge to the right by 2px (increase left position)
                        const leftEdgeRightPx = 2
                        const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                        // Move right edge to the left by 4px (decrease width)
                        const rightEdgeLeftPx = 4
                        const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                        const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                        
                        // Move top edge down by 4px (3px + 1px) (increase top position)
                        const topEdgeDownPx = 4
                        const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                        // Move bottom edge up by 5px (4px + 1px) (decrease height)
                        const bottomEdgeUpPx = 5
                        const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                        const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        const borderRadiusPx = Math.min(20, Math.max(8, 20 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Determine stroke color and width for box
                        const strokeColor = "#0d6efd"
                        const strokeWidth = "1"
                        // No text for this duplicate button
                        const showHelpText = false
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={{...buttonStyle, zIndex: 12}}
                          >
                            <div
                              className="speech-bubble-box"
                              onClick={handlePage21DuplicateButton}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'auto',
                                cursor: 'pointer',
                                zIndex: 13,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontStyle: 'normal',
                                fontWeight: 'normal',
                                textAlign: 'center',
                                padding: '4px 8px',
                                boxSizing: 'border-box',
                                userSelect: 'auto',
                                WebkitUserSelect: 'auto',
                                opacity: 0
                              }}
                            >
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="transparent"
                                style={{ fill: 'transparent' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                  })()}
                  {/* Number "21" at Dot 3 position on page 21 */}
                  {currentPage === 20 && !editorMode && page21ShowHelpImage && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        21
                      </span>
                    </div>
                  )}
                  {/* Box 1 on page 21.png - shown when Need Help button clicked second time, hidden on 21.2.png */}
                  {currentPage === 20 && !editorMode && page21ShowHelpImage && page21BoxesVisible && !page21Show21_2Image && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 32.57
                    const boxTop = 45.75
                    const boxWidth = 25.63
                    const boxHeight = 6.82
                    const dot1X = 36.72
                    const dot1Y = 52.56
                    const dot2X = 43.71
                    const dot2Y = 52.56
                    const dot3X = 32.43
                    const dot3Y = 55.75
                    const isSelected = page21Box1Selected
                    
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                    const rightEdgeLeftPx = 2
                    const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                    const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                    const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                    
                    const topEdgeDownPx = 3
                    const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                    const bottomEdgeUpPx = 2
                    const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                    const adjustedBoxTop = boxTop + topEdgeDownPercent
                    const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage21Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          <path
                            d={`M ${triangleBaseLeftWrapper},${bottomY} L ${triangleBaseRightWrapper},${bottomY}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 2 on page 21.png - shown when Need Help button clicked second time, hidden on 21.2.png */}
                  {currentPage === 20 && !editorMode && page21ShowHelpImage && page21BoxesVisible && !page21Show21_2Image && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 63.66
                    const boxTop = 47.83
                    const boxWidth = 27.43
                    const boxHeight = 23.18
                    const dot1X = 63.66
                    const dot1Y = 61.39
                    const dot2X = 63.66
                    const dot2Y = 67.31
                    const dot3X = 54.06
                    const dot3Y = 71.07
                    const isSelected = page21Box2Selected
                    
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                    const rightEdgeLeftPx = 2
                    const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                    const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                    const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent
                    
                    const topEdgeDownPx = 3
                    const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                    const bottomEdgeUpPx = 1
                    const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                    const adjustedBoxTop = boxTop + topEdgeDownPercent
                    const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const dot2UpPx = 2
                    const dot2UpPercent = stageHeightPx > 0 ? (dot2UpPx / stageHeightPx) * 100 : 0
                    const adjustedDot2Y = dot2Y - dot2UpPercent
                    
                    const triangleBaseTop = dot1Y
                    const triangleBaseBottom = adjustedDot2Y
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(42, Math.max(14, 42 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseTopWrapper = ((triangleBaseTop - adjustedTop) / expandedHeight) * 100
                    const triangleBaseBottomWrapper = ((triangleBaseBottom - adjustedTop) / expandedHeight) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${triangleBaseBottomWrapper}` : ''}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const triangleTopLegPath = `
                      M ${topLeft},${triangleBaseTopWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleBottomLegPath = `
                      M ${topLeft},${triangleBaseBottomWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const leftBorderTopPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${triangleBaseTopWrapper}` : ''}
                    `
                    
                    const leftBorderBottomPath = `
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `M ${topLeft},${triangleBaseBottomWrapper}` : ''}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage21Box2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleTopLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleBottomLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={leftBorderTopPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={leftBorderBottomPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          <path
                            d={`M ${topLeft},${triangleBaseTopWrapper} L ${topLeft},${triangleBaseBottomWrapper}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 1 on page 22 */}
                  {currentPage === 21 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 12.96
                    const boxTop = 15.10
                    const boxWidth = 24.73
                    const boxHeight = 6.12
                    const dot1X = 29.06
                    const dot1Y = 21.23
                    const dot2X = 34.25
                    const dot2Y = 21.23
                    const dot3X = 38.28
                    const dot3Y = 23.36
                    const isSelected = page22Box1Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move left edge to the right by 1px (increase left position)
                    const leftEdgeRightPx = 1
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    // Move right edge to the left by 2px (decrease width)
                    const rightEdgeLeftPx = 2
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Move top edge down by 3px (increase top position)
                    const topEdgeDownPx = 3
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    // Move bottom edge up by 3px (decrease height)
                    const bottomEdgeUpPx = 3
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Move dot 2 to the left by 2px
                    const dot2LeftPx = 2
                    const dot2LeftPercent = imageNaturalSize.width > 0 ? (dot2LeftPx / imageNaturalSize.width) * 100 : 0
                    const adjustedDot2X = dot2X - dot2LeftPercent
                    
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = adjustedDot2X
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage22Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          <path
                            d={`M ${triangleBaseLeftWrapper},${bottomY} L ${triangleBaseRightWrapper},${bottomY}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 2 on page 22 */}
                  {currentPage === 21 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 34.37
                    const boxTop = 28.86
                    const boxWidth = 33.07
                    const boxHeight = 7.17
                    const isSelected = page22Box2Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move left edge to the right by 2px (increase left position)
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    // Move right edge to the left by 3px (decrease width)
                    const rightEdgeLeftPx = 3
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Move top edge down by 2px (increase top position)
                    const topEdgeDownPx = 2
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    // Move bottom edge up by 3px (decrease height)
                    const bottomEdgeUpPx = 3
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage22Box2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 3 on page 22 */}
                  {currentPage === 21 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 34.82
                    const boxTop = 37.39
                    const boxWidth = 33.07
                    const boxHeight = 7.51
                    const isSelected = page22Box3Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move left edge to the right by 2px (increase left position)
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    // Move right edge to the left by 3px (decrease width)
                    const rightEdgeLeftPx = 3
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Move top edge down by 2px (increase top position)
                    const topEdgeDownPx = 2
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    // Move bottom edge up by 4px (decrease height)
                    const bottomEdgeUpPx = 4
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage22Box3 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 4 on page 22 */}
                  {currentPage === 21 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 34.59
                    const boxTop = 46.44
                    const boxWidth = 33.07
                    const boxHeight = 7.51
                    const isSelected = page22Box4Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move left edge to the right by 3px (increase left position)
                    const leftEdgeRightPx = 3
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    // Move right edge to the left by 3px (decrease width)
                    const rightEdgeLeftPx = 3
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Move top edge down by 4px (increase top position)
                    const topEdgeDownPx = 4
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    // Move bottom edge up by 5px (decrease height)
                    const bottomEdgeUpPx = 5
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage22Box4 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 5 on page 22 */}
                  {currentPage === 21 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 40.23
                    const boxTop = 58.45
                    const boxWidth = 21.13
                    const boxHeight = 8.91
                    const isSelected = page22Box5Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move left edge to the right by 2px (increase left position)
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    // Move right edge to the left by 3px (decrease width)
                    const rightEdgeLeftPx = 3
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Move top edge down by 2px (increase top position)
                    const topEdgeDownPx = 2
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    // Move bottom edge up by 4px (decrease height)
                    const bottomEdgeUpPx = 4
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage22Box5 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 6 on page 22 - visible only after box 5 is selected */}
                  {currentPage === 21 && !editorMode && page22Box5Selected && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 14.77
                    const boxTop = 70.64
                    const boxWidth = 70.69
                    const boxHeight = 3.34
                    const isSelected = page22Box6Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move left edge to the right by 1px (increase left position)
                    const leftEdgeRightPx = 1
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    // Move right edge to the left by 3px (decrease width)
                    const rightEdgeLeftPx = 3
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Move top edge down by 3px (increase top position)
                    const topEdgeDownPx = 3
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    // Move bottom edge up by 4px (decrease height)
                    const bottomEdgeUpPx = 4
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(8, Math.max(3, 8 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage22Box6 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* White box on page 22 - hidden when box 1 is selected */}
                  {currentPage === 21 && !editorMode && !page22Box1Selected && (
                    <div
                      style={{
                        ...getButtonStyle(11.39, 27.81, 57.40, 8.91),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 2 is selected */}
                  {currentPage === 21 && !editorMode && !page22Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(32.79, 36.87, 57.40, 8.91),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 2 is selected (left side) */}
                  {currentPage === 21 && !editorMode && !page22Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(11.16, 28.68, 22.70, 7.86),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 3 is selected */}
                  {currentPage === 21 && !editorMode && !page22Box3Selected && (
                    <div
                      style={{
                        ...getButtonStyle(10.71, 45.57, 58.08, 8.91),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 3 is selected (right side) */}
                  {currentPage === 21 && !editorMode && !page22Box3Selected && (
                    <div
                      style={{
                        ...getButtonStyle(68.16, 37.04, 23.83, 7.86),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 4 is selected */}
                  {currentPage === 21 && !editorMode && !page22Box4Selected && (
                    <div
                      style={{
                        ...getButtonStyle(34.82, 54.10, 31.72, 14.13),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 4 is selected (left side) */}
                  {currentPage === 21 && !editorMode && !page22Box4Selected && (
                    <div
                      style={{
                        ...getButtonStyle(10.49, 46.44, 23.83, 7.86),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 5 is selected */}
                  {currentPage === 21 && !editorMode && !page22Box5Selected && (
                    <div
                      style={{
                        ...getButtonStyle(9.13, 69.42, 81.51, 24.40),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 5 is selected (top) */}
                  {currentPage === 21 && !editorMode && !page22Box5Selected && (
                    <div
                      style={{
                        ...getButtonStyle(37.97, 54.28, 26.08, 3.86),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box on page 22 - hidden when box 6 is selected (below box 6) */}
                  {currentPage === 21 && !editorMode && !page22Box6Selected && (
                    <div
                      style={{
                        ...getButtonStyle(13.19, 69.60, 74.97, 24.40),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 5,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* Number "22" at Dot 3 position on page 22 */}
                  {currentPage === 21 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        22
                      </span>
                    </div>
                  )}
                  {/* Box 1 on page 23 */}
                  {currentPage === 22 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 35.49
                    const boxTop = 39.65
                    const boxWidth = 11.44
                    const boxHeight = 3.51
                    const dot1X = 41.68
                    const dot1Y = 43.16
                    const dot2X = 45.06
                    const dot2Y = 43.16
                    const dot3X = 47.75
                    const dot3Y = 44.95
                    const isSelected = page23Box1Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move left edge to the right by 2px (increase left position)
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    // Move right edge to the left by 2px (decrease width)
                    const rightEdgeLeftPx = 2
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Move top edge down by 1px (increase top position)
                    const topEdgeDownPx = 1
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    // Move bottom edge up by 2px (decrease height)
                    const bottomEdgeUpPx = 2
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop + expandedHeight
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage23Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 2 on page 23 - visible only after box 1 is selected */}
                  {currentPage === 22 && !editorMode && page23Box1Selected && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 30.09
                    const boxTop = 52.88
                    const boxWidth = 16.40
                    const boxHeight = 5.77
                    const dot1X = 40.33
                    const dot1Y = 52.88
                    const dot2X = 43.48
                    const dot2Y = 52.88
                    const dot3X = 46.17
                    const dot3Y = 51.74
                    const isSelected = page23Box2Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Move left edge to the right by 2px (increase left position)
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    // Move right edge to the left by 3px (decrease width)
                    const rightEdgeLeftPx = 3
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Move top edge down by 3px (increase top position)
                    const topEdgeDownPx = 3
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    // Move bottom edge up by 4px (decrease height)
                    const bottomEdgeUpPx = 4
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    // Speech bubble with triangle pointing UP from top edge
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      L ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${topY}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    // Top border segments (left of triangle and right of triangle)
                    const topBorderLeftPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                    `
                    const topBorderRightPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage23Box2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderLeftPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderRightPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 3 on page 23 - visible only after box 2 is selected */}
                  {currentPage === 22 && !editorMode && page23Box2Selected && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 34.42
                    const boxTop = 76.24
                    const boxWidth = 27.79
                    const boxHeight = 9.77
                    const dot1X = 33.92
                    const dot1Y = 82.10
                    const dot2X = 33.92
                    const dot2Y = 84.69
                    const dot3X = 29.05
                    const dot3Y = 87.08
                    const isSelected = page23Box3Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(20, Math.max(8, 20 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    // Triangle points LEFT from left edge (between dot1 and dot2) to dot3
                    const triangleBaseTopWrapper = ((dot1Y - adjustedTop) / expandedHeight) * 100
                    const triangleBaseBottomWrapper = ((dot2Y - adjustedTop) / expandedHeight) * 100
                    const triangleTipXWrapper = ((dot3X - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((dot3Y - adjustedTop) / expandedHeight) * 100
                    
                    // Speech bubble with triangle pointing LEFT from left edge
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      L ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${triangleBaseBottomWrapper}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${topLeft},${triangleBaseTopWrapper}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${topY + borderRadiusWrapperY}` : ''}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${topY}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      L ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const leftBorderBottomPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topLeft},${triangleBaseBottomWrapper}` : ''}
                    `
                    
                    const triangleTopLegPath = `
                      M ${topLeft},${triangleBaseTopWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleBottomLegPath = `
                      M ${topLeft},${triangleBaseBottomWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const leftBorderTopPath = `
                      M ${topLeft},${triangleBaseTopWrapper}
                      ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topLeft},${topY + borderRadiusWrapperY}` : ''}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage23Box3 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={leftBorderBottomPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleBottomLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleTopLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={leftBorderTopPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* White box 2 on page 23 - hidden when box 2 is selected */}
                  {currentPage === 22 && !editorMode && !page23Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(8.56, 30.95, 16.62, 8.38),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 3 on page 23 - hidden when box 2 is selected */}
                  {currentPage === 22 && !editorMode && !page23Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(49.46, 20.85, 24.73, 19.35),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 4 on page 23 - hidden when box 2 is selected */}
                  {currentPage === 22 && !editorMode && !page23Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(40.45, 23.11, 24.73, 15.87),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 5 on page 23 - hidden when box 2 is selected */}
                  {currentPage === 22 && !editorMode && !page23Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(35.72, 25.20, 24.73, 9.25),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 6 on page 23 - hidden when box 2 is selected */}
                  {currentPage === 22 && !editorMode && !page23Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(53.79, 39.93, 7.61, 4.94),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 7 on page 23 - hidden when box 2 is selected */}
                  {currentPage === 22 && !editorMode && !page23Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(56.22, 40.28, 5.36, 4.94),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 8 on page 23 - hidden when box 2 is selected */}
                  {currentPage === 22 && !editorMode && !page23Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(0.00, 58.80, 58.98, 15.00),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* White box 9 on page 23 - hidden when box 2 is selected */}
                  {currentPage === 22 && !editorMode && !page23Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(0.00, 61.41, 100.00, 31.54),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 1000,
                        position: 'absolute'
                      }}
                    />
                  )}
                  {/* Number "23" at Dot 3 position on page 23 */}
                  {currentPage === 22 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        23
                      </span>
                    </div>
                  )}
                  {/* "Need Help?" button on 24.1.png - visible when showing initial page */}
                  {currentPage === 23 && !editorMode && !page24ShowMainImage && (() => {
                        const boxWidth = 15.49
                        const boxHeight = 4.21
                        
                        // Center horizontally
                        const boxLeft = (100 - boxWidth) / 2
                        
                        // Position 70px from bottom of image
                        const bottomOffsetPx = 70
                        const bottomOffsetPercent = imageNaturalSize.height > 0 ? (bottomOffsetPx / imageNaturalSize.height) * 100 : 3
                        const boxHeightPercent = imageNaturalSize.height > 0 ? (boxHeight / 100) * 100 : boxHeight
                        const boxTop = 100 - bottomOffsetPercent - boxHeight
                        
                        const adjustedLeft = boxLeft
                        const adjustedTop = boxTop
                        const expandedWidth = boxWidth
                        const expandedHeight = boxHeight
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        const borderRadiusPx = Math.min(8, Math.max(3, 8 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        const strokeColor = "#0d6efd"
                        const strokeWidth = "1"
                        const showHelpText = page24ShowHelpText
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={{...buttonStyle, zIndex: 12}}
                          >
                            <div
                              className="speech-bubble-box"
                              onClick={handlePage24NeedHelp}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'auto',
                                cursor: 'pointer',
                                zIndex: 13,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: showHelpText ? '#000' : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${Math.min(24, Math.max(10, 24 * stageRelativeScale))}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontStyle: showHelpText ? 'italic' : 'normal',
                                fontWeight: showHelpText ? '300' : 'normal',
                                textAlign: 'center',
                                padding: '4px 8px',
                                boxSizing: 'border-box',
                                userSelect: 'auto',
                                WebkitUserSelect: 'auto',
                                opacity: showHelpText ? 1 : 0
                              }}
                            >
                              {showHelpText && 'Hint'}
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill={showHelpText ? "#ffffff" : "transparent"}
                                style={{ fill: showHelpText ? '#ffffff' : 'transparent' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                  })()}
                  {/* Box 1 on page 24 */}
                  {currentPage === 23 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 36.40
                    const boxTop = 34.78
                    const boxWidth = 24.28
                    const boxHeight = 5.60
                    const dot1X = 41.23
                    const dot1Y = 40.38
                    const dot2X = 46.64
                    const dot2Y = 40.38
                    const dot3X = 47.07
                    const dot3Y = 41.99
                    const isSelected = page24Box1Selected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop + expandedHeight
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage24Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isSelected ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Number "24" at Dot 3 position on page 24 */}
                  {currentPage === 23 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        24
                      </span>
                    </div>
                  )}
                  {/* Number "25" at Dot 3 position on page 25 */}
                  {currentPage === 24 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        25
                      </span>
                    </div>
                  )}
                  {/* Number "26" at Dot 3 position on page 26 */}
                  {currentPage === 25 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        26
                      </span>
                    </div>
                  )}
                  {/* Number "27" at Dot 3 position on page 27 */}
                  {currentPage === 26 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        27
                      </span>
                    </div>
                  )}
                  {/* Number "28" at Dot 3 position on page 28 */}
                  {currentPage === 27 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        28
                      </span>
                    </div>
                  )}
                  {/* Number "29" at Dot 3 position on page 29 */}
                  {currentPage === 28 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        29
                      </span>
                    </div>
                  )}
                  {/* Number "30" at Dot 3 position on page 30 */}
                  {currentPage === 29 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        30
                      </span>
                    </div>
                  )}
                  {/* Number "31" at Dot 3 position on page 31 */}
                  {currentPage === 30 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        31
                      </span>
                    </div>
                  )}
                  {/* Number "32" at Dot 3 position on page 32 */}
                  {currentPage === 31 && !editorMode && (
                    <div style={getPageNumberStyle(94.83, 95.96)}>
                      <span
                        style={{
                          position: 'absolute',
                          left: '50%',
                          top: '50%',
                          transform: 'translate(-50%, -50%)',
                          fontFamily: 'Roboto, sans-serif',
                          color: '#595959',
                          fontSize: `${12 * stageRelativeScale}px`,
                          fontWeight: 'bold',
                          pointerEvents: 'none',
                          zIndex: 10
                        }}
                      >
                        32
                      </span>
                    </div>
                  )}
                  {/* Box 1 on page 20 */}
                  {currentPage === 19 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 43.35
                      const boxTop = 36.21
                      const boxWidth = 11.30
                      const boxHeight = 3.80
                      const dot1X = 50.18
                      const dot1Y = 40.01
                      const dot2X = 52.64
                      const dot2Y = 40.01
                      const dot3X = 55.13
                      const dot3Y = 41.73
                      const isSelected = page20Box1Selected

                      // Move left edge to the right by 1px (reduce width)
                      const leftEdgeRightPx = 1
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left by 2px (reduce width)
                      const rightEdgeLeftPx = 2
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent

                      // Move top edge down by 3px (reduce height)
                      const topEdgeDownPx = 3
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 1px (reduce height)
                      const bottomEdgeUpPx = 1
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                      // Dot3 is BELOW the box (41.73% > 40.01%), so triangle points downward
                      // Dots are on the bottom edge, so they move with the box (left edge moved right 1px)
                      const adjustedDot1X = dot1X + leftEdgeRightPercent
                      const adjustedDot2X = dot2X + leftEdgeRightPercent
                      // Dots Y positions are on the bottom edge, so they move up 1px when the bottom edge moves up
                      const adjustedDot1Y = dot1Y - bottomEdgeUpPercent
                      const adjustedDot2Y = dot2Y - bottomEdgeUpPercent
                      const triangleBaseLeft = adjustedDot1X  // Left point on bottom edge (50.18%)
                      const triangleBaseRight = adjustedDot2X  // Right point on bottom edge (52.64%)
                      const triangleBaseY = adjustedTop + expandedHeight  // Bottom edge Y position
                      const triangleTipX = dot3X  // Triangle tip X (55.13%)
                      const triangleTipY = dot3Y  // Triangle tip Y (41.73% - below the box)
                      
                      // Reduced corner radius for box
                      const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                      const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                      const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                      const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                      const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                      
                      const topLeft = 0
                      const topRight = 100
                      const topY = 0
                      const bottomY = 100
                      
                      const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                      const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                      const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                      const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                      
                      const speechBubblePath = `
                        M ${topLeft + borderRadiusWrapperX},${topY}
                        Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                        L ${topLeft},${bottomY - borderRadiusWrapperY}
                        Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                        L ${triangleBaseRightWrapper},${bottomY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                        Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                        L ${topRight},${topY + borderRadiusWrapperY}
                        Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        Z
                      `
                      
                      const leftBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${topY}
                        Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                        L ${topLeft},${bottomY - borderRadiusWrapperY}
                        Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      `
                      
                      const triangleLeftLegPath = `
                        M ${triangleBaseLeftWrapper},${bottomY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      const triangleRightLegPath = `
                        M ${triangleBaseRightWrapper},${bottomY}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      
                      const rightBorderPath = `
                        M ${triangleBaseRightWrapper},${bottomY}
                        ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                        Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                        L ${topRight},${topY + borderRadiusWrapperY}
                        Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      `
                      
                      const topBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${topY}
                        L ${topRight - borderRadiusWrapperX},${topY}
                      `
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage20Box1 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box'
                            }}
                          >
                          </div>
                          <svg
                            className="speech-bubble-svg"
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: 'none',
                              overflow: 'visible',
                              zIndex: 10
                            }}
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                          >
                            <defs>
                            </defs>
                            <path
                              d={speechBubblePath}
                              fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.7)"}
                              style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.7)' }}
                            />
                            <g className="speech-bubble-border-group">
                              <path
                                d={leftBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleLeftLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleRightLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={rightBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={topBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                            </g>
                            <path
                              d={`M ${triangleBaseLeftWrapper},${bottomY} L ${triangleBaseRightWrapper},${bottomY}`}
                              fill="none"
                              stroke="transparent"
                              strokeWidth="0.3"
                              vectorEffect="non-scaling-stroke"
                            />
                          </svg>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Box 2 on page 20 */}
                  {currentPage === 19 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 37.10
                      const boxTop = 42.41
                      const boxWidth = 14.87
                      const boxHeight = 6.04
                      const dot1X = 51.97
                      const dot1Y = 45.76
                      const dot2X = 51.97
                      const dot2Y = 47.31
                      const dot3X = 54.91
                      const dot3Y = 46.73
                      const isSelected = page20Box2Selected

                      // Move left edge to the right by 1px (reduce width)
                      const leftEdgeRightPx = 1
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left by 2px (reduce width)
                      const rightEdgeLeftPx = 2
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent

                      // Move top edge down by 4px (reduce height)
                      const topEdgeDownPx = 4
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 2px (reduce height)
                      const bottomEdgeUpPx = 2
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      // Calculate triangle - it extends RIGHTWARD from the right edge (between dot1 and dot2) to dot3
                      // Dot1 and Dot2 are both on the right edge (51.97%) at different Y positions
                      // Dot3 is to the right (54.91%, 46.73%), so triangle extends rightward
                      // Dots are on the right edge, so their Y positions move with the top edge (moved down 4px)
                      let adjustedDot1Y = dot1Y + topEdgeDownPercent
                      let adjustedDot2Y = dot2Y + topEdgeDownPercent
                      // Move dot 1 up by 2px (additional adjustment from current location)
                      const dot1UpPx = 2
                      const dot1UpPercent = stageHeightPx > 0 ? (dot1UpPx / stageHeightPx) * 100 : 0
                      adjustedDot1Y = adjustedDot1Y - dot1UpPercent
                      // Move dot 2 up by 4px (additional adjustment from current location)
                      const dot2UpPx = 4
                      const dot2UpPercent = stageHeightPx > 0 ? (dot2UpPx / stageHeightPx) * 100 : 0
                      adjustedDot2Y = adjustedDot2Y - dot2UpPercent
                      const triangleBaseTop = adjustedDot1Y  // Top break point on right edge (45.76%)
                      const triangleBaseBottom = adjustedDot2Y  // Bottom break point on right edge (47.31%)
                      const triangleTipX = dot3X  // Triangle tip X (54.91%)
                      const triangleTipY = dot3Y  // Triangle tip Y (46.73%)
                      
                      // Reduced corner radius for box
                      const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                      const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                      const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                      const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                      const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                      
                      const topLeft = 0
                      const topRight = 100
                      const topY = 0
                      const bottomY = 100
                      
                      // Convert triangle base points to wrapper-relative coordinates
                      // Triangle base is on the right edge (at topRight = 100)
                      const triangleBaseTopWrapper = ((triangleBaseTop - adjustedTop) / expandedHeight) * 100
                      const triangleBaseBottomWrapper = ((triangleBaseBottom - adjustedTop) / expandedHeight) * 100
                      const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                      const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                      
                      const speechBubblePath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        L ${topRight - borderRadiusWrapperX},${topY}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                        ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topRight},${triangleBaseTopWrapper}` : ''}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                        L ${topRight},${triangleBaseBottomWrapper}
                        ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topRight},${bottomY - borderRadiusWrapperY}` : ''}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                        Z
                      `
                      
                      // Border paths - separate segments to exclude right edge between the two points
                      const leftBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                        L ${topLeft},${topY + borderRadiusWrapperY}
                        Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                        L ${topRight - borderRadiusWrapperX},${topY}
                        Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      `
                      
                      const topBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${topY}
                        L ${topRight - borderRadiusWrapperX},${topY}
                      `
                      
                      const triangleTopLegPath = `
                        M ${topRight},${triangleBaseTopWrapper}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      const triangleBottomLegPath = `
                        M ${topRight},${triangleBaseBottomWrapper}
                        L ${triangleTipXWrapper},${triangleTipYWrapper}
                      `
                      
                      const rightBorderTopPath = `
                        M ${topRight},${topY + borderRadiusWrapperY}
                        ${triangleBaseTopWrapper > topY + borderRadiusWrapperY ? `L ${topRight},${triangleBaseTopWrapper}` : ''}
                      `
                      
                      const rightBorderBottomPath = `
                        M ${topRight},${triangleBaseBottomWrapper}
                        ${triangleBaseBottomWrapper < bottomY - borderRadiusWrapperY ? `L ${topRight},${bottomY - borderRadiusWrapperY}` : ''}
                        Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      const bottomBorderPath = `
                        M ${topLeft + borderRadiusWrapperX},${bottomY}
                        L ${topRight - borderRadiusWrapperX},${bottomY}
                      `
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage20Box2 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box'
                            }}
                          >
                          </div>
                          <svg
                            className="speech-bubble-svg"
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: 'none',
                              overflow: 'visible',
                              zIndex: 10
                            }}
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                          >
                            <defs>
                            </defs>
                            <path
                              d={speechBubblePath}
                              fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.7)"}
                              style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.7)' }}
                            />
                            <g className="speech-bubble-border-group">
                              <path
                                d={leftBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={topBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={rightBorderTopPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleTopLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={triangleBottomLegPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={rightBorderBottomPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                              <path
                                d={bottomBorderPath}
                                fill="none"
                                stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                strokeWidth={isSelected ? "2" : "1"}
                                className="speech-bubble-border"
                                vectorEffect="non-scaling-stroke"
                              />
                            </g>
                            <path
                              d={`M ${topRight},${triangleBaseTopWrapper} L ${topRight},${triangleBaseBottomWrapper}`}
                              fill="none"
                              stroke="transparent"
                              strokeWidth="0.3"
                              vectorEffect="non-scaling-stroke"
                            />
                          </svg>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Box 3 on page 20 - no pointer */}
                  {currentPage === 19 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 15.47
                      const boxTop = 77.23
                      const boxWidth = 21.12
                      const boxHeight = 8.62
                      const isSelected = page20Box3Selected

                      // Move left edge to the right by 2px (reduce width, keep right edge in place)
                      const leftEdgeRightPx = 2
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent

                      // Move top edge down by 1px (reduce height)
                      const topEdgeDownPx = 1
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 2px (reduce height)
                      const bottomEdgeUpPx = 2
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage20Box3 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box',
                              borderRadius: `${borderRadiusPx}px`,
                              backgroundColor: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.7)',
                              border: `${isSelected ? '2px' : '1px'} solid ${isSelected ? '#f05f40' : '#0d6efd'}`
                            }}
                          >
                          </div>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Box 4 on page 20 - no pointer */}
                  {currentPage === 19 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 39.33
                      const boxTop = 77.23
                      const boxWidth = 21.12
                      const boxHeight = 8.62
                      const isSelected = page20Box4Selected

                      // Move left edge to the right by 1px (reduce width)
                      const leftEdgeRightPx = 1
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left by 1px (reduce width)
                      const rightEdgeLeftPx = 1
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent

                      // Move top edge down by 1px (reduce height)
                      const topEdgeDownPx = 1
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 2px (reduce height)
                      const bottomEdgeUpPx = 2
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage20Box4 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box',
                              borderRadius: `${borderRadiusPx}px`,
                              backgroundColor: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.7)',
                              border: `${isSelected ? '2px' : '1px'} solid ${isSelected ? '#f05f40' : '#0d6efd'}`
                            }}
                          >
                          </div>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Box 5 on page 20 - no pointer */}
                  {currentPage === 19 && !editorMode && (
                    <>
                      {(() => {
                      const boxLeft = 63.20
                      const boxTop = 77.23
                      const boxWidth = 21.12
                      const boxHeight = 16.72
                      const isSelected = page20Box5Selected

                      // Move left edge to the right by 1px (reduce width)
                      const leftEdgeRightPx = 1
                      const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                      // Move right edge to the left by 1px (reduce width)
                      const rightEdgeLeftPx = 1
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft + leftEdgeRightPercent
                      const adjustedBoxWidth = boxWidth - leftEdgeRightPercent - rightEdgeLeftPercent

                      // Move top edge down by 1px (reduce height)
                      const topEdgeDownPx = 1
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 1px (reduce height)
                      const bottomEdgeUpPx = 1
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent
                      
                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage20Box5 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box',
                              borderRadius: `${borderRadiusPx}px`,
                              backgroundColor: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.7)',
                              border: `${isSelected ? '2px' : '1px'} solid ${isSelected ? '#f05f40' : '#0d6efd'}`
                            }}
                          >
                          </div>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* Box 6 on page 20 - only active after box 5 is selected */}
                  {currentPage === 19 && !editorMode && page20Box5Selected && (
                    <>
                      {(() => {
                      const boxLeft = 72.22
                      const boxTop = 90.75
                      const boxWidth = 3.55
                      const boxHeight = 2.33
                      const isSelected = page20Box6Selected

                      // Keep left edge in place, move right edge to the left by 6px (reduce width by 6px total)
                      const rightEdgeLeftPx = 6
                      const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                      const adjustedBoxLeft = boxLeft
                      const adjustedBoxWidth = boxWidth - rightEdgeLeftPercent

                      // Move top edge down by 1px (reduce height)
                      const topEdgeDownPx = 1
                      const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                      // Move bottom edge up by 1px (reduce height)
                      const bottomEdgeUpPx = 1
                      const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                      const adjustedBoxTop = boxTop + topEdgeDownPercent
                      const adjustedBoxHeight = boxHeight - topEdgeDownPercent - bottomEdgeUpPercent

                      const pixelIncrease = 3
                      const halfPixelIncrease = pixelIncrease / 2
                      const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                      const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                      const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                      const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                      const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                      
                      const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                      const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                      const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                      const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                      
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                      
                      return (
                        <div 
                          className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                          style={buttonStyle}
                        >
                          <div
                            className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                            onClick={!isSelected ? handlePage20Box6 : undefined}
                            style={{
                              position: 'absolute',
                              left: 0,
                              top: 0,
                              width: '100%',
                              height: '100%',
                              pointerEvents: isSelected ? 'none' : 'auto',
                              cursor: isSelected ? 'default' : 'pointer',
                              zIndex: 11,
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                              fontSize: `${bubbleFontSize}px`,
                              fontFamily: 'Roboto, sans-serif',
                              textAlign: 'center',
                              padding: '4px 8px',
                              boxSizing: 'border-box',
                              borderRadius: `${borderRadiusPx}px`,
                              backgroundColor: isSelected ? '#3bbf6b' : 'rgba(255, 255, 255, 0.95)',
                              border: '1px solid',
                              borderColor: isSelected ? '#3bbf6b' : '#0d6efd',
                              outline: isSelected ? '1px solid #3bbf6b' : 'none',
                              outlineOffset: '0px'
                            }}
                          >
                          </div>
                        </div>
                      )
                    })()}
                    </>
                  )}
                  {/* White boxes on page 20 - hidden when box 1 is selected */}
                  {currentPage === 19 && !editorMode && !page20Box1Selected && (
                    <>
                      {/* White box 1 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(32.34, 42.09, 20.00, 7.34),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 2 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(47.56, 45.57, 8.48, 3.63),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    </>
                  )}
                  {/* White boxes on page 20 - hidden when box 2 is selected */}
                  {currentPage === 19 && !editorMode && !page20Box2Selected && (
                    <>
                      {/* White box 1 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(12.19, 50.10, 75.40, 26.43),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 2 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(58.74, 46.86, 4.43, 3.56),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 3 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(14.35, 76.11, 24.03, 10.70),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    </>
                  )}
                  {/* White boxes on page 20 - hidden when box 3 is selected */}
                  {currentPage === 19 && !editorMode && !page20Box3Selected && (
                    <>
                      {/* White box 1 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(38.20, 76.04, 23.83, 12.56),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 2 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(63.36, 36.40, 5.81, 4.55),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 3 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(65.83, 36.87, 5.81, 4.55),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 4 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(60.05, 36.00, 9.19, 4.90),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    </>
                  )}
                  {/* White boxes on page 20 - hidden when box 4 is selected */}
                  {currentPage === 19 && !editorMode && !page20Box4Selected && (
                    <>
                      {/* White box 1 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(58.02, 18.59, 14.82, 7.17),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 2 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(61.85, 75.69, 25.41, 19.87),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    </>
                  )}
                  {/* White boxes on page 20 - hidden when box 5 is selected */}
                  {currentPage === 19 && !editorMode && !page20Box5Selected && (
                    <>
                      {/* White box 1 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(53.74, 25.55, 23.38, 10.65),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                      {/* White box 2 on page 20 */}
                      <div
                        style={{
                          ...getButtonStyle(14.32, 86.66, 23.38, 6.99),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    </>
                  )}
                  {/* White box on page 15.1.png - hidden when "Need Help?" button is selected the first time */}
                  {currentPage === 14 && !editorMode && !page15BoxSelected && !page15BoxesVisible && (() => {
                    const boxLeft = 64.56
                    const boxTop = 52.01
                    const boxWidth = 26.08
                    const boxHeight = 11.87
                    // Increase width by 20px (move right edge 20px to the right)
                    const widthIncreasePx = 20
                    const widthIncreasePercent = imageNaturalSize.width > 0 ? (widthIncreasePx / imageNaturalSize.width) * 100 : 0
                    const adjustedWidth = boxWidth + widthIncreasePercent
                    
                    return (
                      <div
                        style={{
                          ...getButtonStyle(boxLeft, boxTop, adjustedWidth, boxHeight),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    )
                  })()}
                  {/* White box on page 15.1.png and 15.png - hidden when both box 1 and box 2 are selected */}
                  {currentPage === 14 && !editorMode && !(page15Box1Selected && page15Box2Selected) && (
                    <div
                      style={{
                        ...getButtonStyle(17.47, 76.91, 65.96, 15.87),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* Button, LED boxes - only show on 15.1.png when page15BoxesVisible is true */}
                  {currentPage === 14 && !editorMode && !page15BoxSelected && page15BoxesVisible && (
                    <>
                      {/* Button box */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce button box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 10
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move button box: right 10px, then left 4px, then right 3px (net: right 9px), and down 15px
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const downOffsetPx = 15
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const buttonFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'white',
                                fontSize: `${buttonFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              Button
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#099b4d"
                                style={{ fill: '#099b4d' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* LED text box on 15.1.png */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce LED box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 10
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move LED box: right 10px, then left 4px, then right 3px (net: right 9px), then right 43px more, and down 15px
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const ledRightOffsetPx = 43
                        const downOffsetPx = 15
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const ledRightOffsetPercent = imageNaturalSize.width > 0 ? (ledRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent + ledRightOffsetPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const buttonFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'white',
                                fontSize: `${buttonFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              LED
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#099b4d"
                                style={{ fill: '#099b4d' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* Duplicate Button box - 100px to the right */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce button box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 10
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move button box: right 10px, then left 4px, then right 3px (net: right 9px), and down 15px
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const downOffsetPx = 15
                        // Add 90px to the right for duplicate (100px - 10px left)
                        const duplicateRightOffsetPx = 90
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const duplicateRightOffsetPercent = imageNaturalSize.width > 0 ? (duplicateRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent + duplicateRightOffsetPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const buttonFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'white',
                                fontSize: `${buttonFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              Button
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#f1c232"
                                style={{ fill: '#f1c232' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                    </>
                  )}
                  {/* Box 1 on page 15.1.png and 15.png - with pointer */}
                  {currentPage === 14 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 42.25
                    const boxTop = 34.78
                    const boxWidth = 32.39
                    const boxHeight = 6.12
                    const dot1X = 61.06
                    const dot1Y = 40.90
                    const dot2X = 68.27
                    const dot2Y = 40.90
                    const dot3X = 59.91
                    const dot3Y = 42.86
                    const isSelected = page15Box1Selected
                    
                    // Move top edge down by 3px and bottom edge up by 3px (reduce height)
                    const topEdgeDownPx = 3
                    const bottomEdgeUpPx = 3
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    // Move left edge to the right by 2px and right edge to the left by 3px (reduce width)
                    const leftEdgeRightPx = 2
                    const rightEdgeLeftPx = 3
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop + (expandedHeight / 100) * 100
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseYWrapper = ((triangleBaseY - adjustedTop) / expandedHeight) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${triangleBaseRightWrapper},${bottomY}` : ''}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${topY}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      M ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `${triangleBaseRightWrapper},${bottomY}` : ''}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage15Box1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 13,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 2 on page 15.1.png and 15.png - with pointer */}
                  {currentPage === 14 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 40.90
                    const boxTop = 69.94
                    const boxWidth = 31.26
                    const boxHeight = 5.42
                    const dot1X = 58.80
                    const dot1Y = 69.94
                    const dot2X = 66.69
                    const dot2Y = 69.94
                    const dot3X = 63.07
                    const dot3Y = 68.63
                    const isSelected = page15Box2Selected
                    
                    // Move top edge down by 3px, keep bottom edge up by 4px (reduce height)
                    const topEdgeDownPx = 3
                    const bottomEdgeUpPx = 4
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    // Move left edge to the right by 2px and right edge to the left by 3px (reduce width)
                    const leftEdgeRightPx = 2
                    const rightEdgeLeftPx = 3
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseYWrapper = ((triangleBaseY - adjustedTop) / expandedHeight) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${triangleBaseRightWrapper},${topY}` : ''}
                      L ${topRight - borderRadiusWrapperX},${topY}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      L ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${topY}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      M ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `${triangleBaseRightWrapper},${topY}` : ''}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage15Box2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 13,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 3 on page 15.1.png and 15.png - only active after both box 1 and box 2 are selected */}
                  {currentPage === 14 && !editorMode && stageWidthPx > 0 && stageHeightPx > 0 && (() => {
                    const boxLeft = 19.50
                    const boxTop = 78.13
                    const boxWidth = 62.13
                    const boxHeight = 13.43
                    const isSelected = page15Box3Selected
                    const isActive = page15Box1Selected && page15Box2Selected
                    
                    // Move top edge down by 2px and bottom edge up by 1px (reduce height)
                    const topEdgeDownPx = 2
                    const bottomEdgeUpPx = 1
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    // Move left edge to the right by 5px and right edge to the left by 3px (reduce width)
                    const leftEdgeRightPx = 5
                    const rightEdgeLeftPx = 3
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(28, Math.max(13, 28 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected && isActive ? handlePage15Box3 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: (isSelected || !isActive) ? 'none' : 'auto',
                            cursor: (isSelected || !isActive) ? 'default' : 'pointer',
                            zIndex: 13,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* "Need Help?" button on 15.1.png and 15.png - always visible when on page 15 */}
                  {currentPage === 14 && !editorMode && (() => {
                        const boxLeft = 8.23
                        const boxTop = 38.78
                        const boxWidth = 15.49
                        const boxHeight = 4.21
                        const isSelected = false // Button is never "selected", it's always clickable
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Move box down by 30px
                        const downOffsetPx = 30
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        
                        // Move box top edge down by 6px and bottom edge up by 3px (reduce height)
                        const topDownOffsetPx = 6
                        const topDownOffsetPercent = imageNaturalSize.height > 0 ? (topDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const heightReductionPx = 9
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (heightReductionPx / imageNaturalSize.height) * 100 : 0
                        
                        // Move box left edge to the right by 6px and right edge to the left by 6px (reduce width)
                        const leftEdgeRightPx = 6
                        const rightEdgeLeftPx = 6
                        const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                        const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                        const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topDownOffsetPercent + downOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        const borderRadiusPx = Math.min(8, Math.max(3, 8 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Determine stroke color and width for box
                        const strokeColor = "#0d6efd"
                        const strokeWidth = "1"
                        // Show "Need Help?" text only if page15ShowHelpText is true
                        const showHelpText = page15ShowHelpText
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={{...buttonStyle, zIndex: 12}}
                          >
                            <div
                              className="speech-bubble-box"
                              onClick={handlePage15Box}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'auto',
                                cursor: 'pointer',
                                zIndex: 13,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: showHelpText ? '#000' : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontStyle: showHelpText ? 'italic' : 'normal',
                                fontWeight: showHelpText ? '300' : 'normal',
                                textAlign: 'center',
                                padding: '4px 8px',
                                boxSizing: 'border-box',
                                userSelect: 'auto',
                                WebkitUserSelect: 'auto',
                                opacity: showHelpText ? 1 : 0
                              }}
                            >
                              {showHelpText && 'Need Help?'}
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill={showHelpText ? "#ffffff" : "transparent"}
                                style={{ fill: showHelpText ? '#ffffff' : 'transparent' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                  {/* White box 1 on page 10.1.png - displayed until box 2 is selected */}
                  {currentPage === 9 && !editorMode && !page10BoxSelected && !page10WhiteBox1Hidden && (
                    <div
                      style={{
                        ...getButtonStyle(6.43, 41.04, 20.00, 6.99),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* New white box on page 10.1.png - displayed until box 2 is selected */}
                  {currentPage === 9 && !editorMode && !page10BoxSelected && !page10NewWhiteBoxHidden && (() => {
                    // Move white box down by 40px
                    const downOffsetPx = 40
                    const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                    const adjustedTop = 40.87 + downOffsetPercent
                    return (
                      <div
                        style={{
                          ...getButtonStyle(6.88, adjustedTop, 20.00, 7.34),
                          backgroundColor: 'white',
                          border: 'none',
                          pointerEvents: 'none',
                          zIndex: 100
                        }}
                      />
                    )
                  })()}
                  {/* White box over "Need Help?" box on page 10.1.png - displayed after box 2 is selected, hidden when box 1 is selected */}
                  {currentPage === 9 && !editorMode && !page10BoxSelected && page10NeedHelpWhiteBoxVisible && !page10Box2Selected && (
                    <div
                      style={{
                        ...getButtonStyle(8.23, 38.78, 15.49, 4.21),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* White box 2 on page 10.1.png - displayed until both box 1 and box 2 are selected */}
                  {currentPage === 9 && !editorMode && !page10BoxSelected && !page10WhiteBoxesHidden && (
                    <div
                      style={{
                        ...getButtonStyle(32.34, 72.03, 35.77, 21.44),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* White box 3 on page 10.1.png - displayed until box 1 is selected */}
                  {currentPage === 9 && !editorMode && !page10BoxSelected && !page10WhiteBox3Hidden && (
                    <div
                      style={{
                        ...getButtonStyle(57.35, 58.11, 27.21, 13.26),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 100
                      }}
                    />
                  )}
                  {/* Button boxes on 10.1.png and 10.png */}
                  {currentPage === 9 && !editorMode && (
                    <>
                      {/* Button, LED, and Ground boxes - only show on 10.1.png when page10BoxesVisible is true */}
                      {!page10BoxSelected && page10BoxesVisible && (
                        <>
                      {/* Button box */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce button box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5  // Increased from 3px to 5px
                        const additionalWidthReductionPx = 10  // Increased from 5px to 10px to reduce width
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move button box: right 10px, then left 4px, then right 3px (net: right 9px), and down 15px (moved down 5px from previous 10px)
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const downOffsetPx = 15
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const buttonFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'white',
                                fontSize: `${buttonFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              Button
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#099b4d"
                                style={{ fill: '#099b4d' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* LED text box on 10.1.png */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce LED box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 20  // Increased from 15px to 20px to reduce width more
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move LED box: right 10px, then left 4px, then right 3px (net: right 9px), then right 43px more (moved right 5px from previous 38px), and down 15px
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const ledRightOffsetPx = 43  // Additional 43px to the right (moved right 5px from previous 38px)
                        const downOffsetPx = 15
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const ledRightOffsetPercent = imageNaturalSize.width > 0 ? (ledRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent + ledRightOffsetPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const buttonFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'white',
                                fontSize: `${buttonFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              LED
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#099b4d"
                                style={{ fill: '#099b4d' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* Ground text box on 10.1.png */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce button box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 5
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move button box: right 10px, then left 4px, then right 3px (net: right 9px), and down 10px
                        // Then for duplicate: left 25px (15px + 10px) and down 86px (50px + 40px - 4px)
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const downOffsetPx = 10
                        const duplicateLeftOffsetPx = 25
                        const duplicateDownOffsetPx = 86
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const duplicateLeftOffsetPercent = imageNaturalSize.width > 0 ? (duplicateLeftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const duplicateDownOffsetPercent = imageNaturalSize.height > 0 ? (duplicateDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent - duplicateLeftOffsetPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent + duplicateDownOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const buttonFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: '#595959',
                                fontSize: `${buttonFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              Ground
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#ffffff"
                                style={{ fill: '#ffffff' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                        </>
                      )}
                      {/* "Show Wiring Diagram" button on 10.1.png - bottom centered */}
                      {currentPage === 9 && !editorMode && !page10BoxSelected && (() => {
                        const boxWidth = 18
                        const boxHeight = 3
                        
                        const pixelIncrease = 3
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Add 27px on each side (54px total width increase)
                        const widthExpansionPx = 54
                        const widthExpansionPercent = imageNaturalSize.width > 0 ? (widthExpansionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Reduce height by lowering top edge 7px
                        const heightReductionPx = 7
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (heightReductionPx / imageNaturalSize.height) * 100 : 0
                        
                        // Position button centered horizontally at bottom, 24px up from bottom
                        const bottomOffsetPx = 24
                        const bottomOffsetPercent = imageNaturalSize.height > 0 ? (bottomOffsetPx / imageNaturalSize.height) * 100 : 0
                        
                        // Center horizontally
                        const expandedWidth = boxWidth + widthPercentAdjust + widthExpansionPercent
                        const adjustedLeft = (100 - expandedWidth) / 2
                        
                        // Position from bottom: 100% - boxHeight - bottomOffset
                        const expandedHeight = boxHeight + heightPercentAdjust - heightReductionPercent
                        const adjustedTop = 100 - expandedHeight - bottomOffsetPercent
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        const borderRadiusPx = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        // Rounded corners on top, sharp corners on bottom
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY}
                          L ${topRight},${bottomY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight},${bottomY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft},${bottomY}
                          L ${topRight},${bottomY}
                        `
                        
                        const strokeColor = "#0d6efd"
                        const strokeWidth = "1"
                        const showHelpText = true
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={{
                              ...buttonStyle, 
                              zIndex: 9999,
                              boxShadow: '0 2px 6px rgba(0, 0, 0, 0.08), 0 0 4px rgba(13, 110, 253, 0.3)',
                              borderRadius: `${borderRadiusPx}px ${borderRadiusPx}px 0 0`
                            }}
                          >
                            <div
                              className="speech-bubble-box"
                              onClick={handlePage10ShowConnections}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'auto',
                                cursor: 'pointer',
                                zIndex: 10000,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: showHelpText ? '#000' : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontStyle: showHelpText ? 'italic' : 'normal',
                                fontWeight: showHelpText ? '300' : 'normal',
                                textAlign: 'center',
                                padding: '2px 4px',
                                boxSizing: 'border-box',
                                userSelect: 'auto',
                                WebkitUserSelect: 'auto',
                                opacity: showHelpText ? 1 : 0
                              }}
                            >
                              {showHelpText && 'Show Wiring Diagram'}
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 9998
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill={showHelpText ? "#ffffff" : "transparent"}
                                style={{ fill: showHelpText ? '#ffffff' : 'transparent' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* "Hide Wiring Diagram" button on 10.png - bottom centered */}
                      {currentPage === 9 && !editorMode && page10BoxSelected && (() => {
                        const boxWidth = 18
                        const boxHeight = 3
                        
                        const pixelIncrease = 3
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Add 27px on each side (54px total width increase)
                        const widthExpansionPx = 54
                        const widthExpansionPercent = imageNaturalSize.width > 0 ? (widthExpansionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Reduce height by lowering top edge 7px
                        const heightReductionPx = 7
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (heightReductionPx / imageNaturalSize.height) * 100 : 0
                        
                        // Position button centered horizontally at bottom, 24px up from bottom
                        const bottomOffsetPx = 24
                        const bottomOffsetPercent = imageNaturalSize.height > 0 ? (bottomOffsetPx / imageNaturalSize.height) * 100 : 0
                        
                        // Center horizontally
                        const expandedWidth = boxWidth + widthPercentAdjust + widthExpansionPercent
                        const adjustedLeft = (100 - expandedWidth) / 2
                        
                        // Position from bottom: 100% - boxHeight - bottomOffset
                        const expandedHeight = boxHeight + heightPercentAdjust - heightReductionPercent
                        const adjustedTop = 100 - expandedHeight - bottomOffsetPercent
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        const borderRadiusPx = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        // Rounded corners on top, sharp corners on bottom
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY}
                          L ${topRight},${bottomY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight},${bottomY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft},${bottomY}
                          L ${topRight},${bottomY}
                        `
                        
                        const strokeColor = "#0d6efd"
                        const strokeWidth = "1"
                        const showHelpText = true
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={{
                              ...buttonStyle, 
                              zIndex: 9999,
                              boxShadow: '0 2px 6px rgba(0, 0, 0, 0.08), 0 0 4px rgba(13, 110, 253, 0.3)',
                              borderRadius: `${borderRadiusPx}px ${borderRadiusPx}px 0 0`
                            }}
                          >
                            <div
                              className="speech-bubble-box"
                              onClick={handlePage10ShowConnections}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'auto',
                                cursor: 'pointer',
                                zIndex: 10000,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: showHelpText ? '#000' : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontStyle: showHelpText ? 'italic' : 'normal',
                                fontWeight: showHelpText ? '300' : 'normal',
                                textAlign: 'center',
                                padding: '2px 4px',
                                boxSizing: 'border-box',
                                userSelect: 'auto',
                                WebkitUserSelect: 'auto',
                                opacity: showHelpText ? 1 : 0
                              }}
                            >
                              {showHelpText && 'Hide Wiring Diagram'}
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 9998
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill={showHelpText ? "#ffffff" : "transparent"}
                                style={{ fill: showHelpText ? '#ffffff' : 'transparent' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* Box 1 on 10.1.png and 10.png - with pointer */}
                      {(() => {
                        const boxLeft = 59.15
                        const boxTop = 46.09
                        const boxWidth = 29.24
                        const boxHeight = 5.95
                        const dot1X = 63.53
                        const dot1Y = 52.04
                        const dot2X = 70.29
                        const dot2Y = 52.04
                        const dot3X = 54.73
                        const dot3Y = 57.31
                        const isSelected = page10Box1Selected
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Keep top edge in place (down 2px) and move bottom edge up 2px more (total 5px up)
                        const topDownOffsetPx = 2
                        const bottomUpOffsetPx = 5
                        const topDownOffsetPercent = imageNaturalSize.height > 0 ? (topDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const bottomUpOffsetPercent = imageNaturalSize.height > 0 ? (bottomUpOffsetPx / imageNaturalSize.height) * 100 : 0
                        const totalHeightReductionPercent = topDownOffsetPercent + bottomUpOffsetPercent
                        
                        // Move left edge to the right by 3px and right edge to the left by 3px (reduce width)
                        const leftEdgeRightPx = 3
                        const rightEdgeLeftPx = 3
                        const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                        const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                        const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                        
                        // Move dot 1 to the right by 2px
                        const dot1RightPx = 2
                        const dot1RightPercent = imageNaturalSize.width > 0 ? (dot1RightPx / imageNaturalSize.width) * 100 : 0
                        const adjustedDot1X = dot1X + dot1RightPercent
                        
                        // Move dot 2 to the right by 4px (2px + 2px more = 4px)
                        const dot2RightPx = 4
                        const dot2RightPercent = imageNaturalSize.width > 0 ? (dot2RightPx / imageNaturalSize.width) * 100 : 0
                        const adjustedDot2X = dot2X + dot2RightPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topDownOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                        const triangleBaseLeft = adjustedDot1X
                        const triangleBaseRight = adjustedDot2X
                        const triangleBaseY = adjustedTop + expandedHeight
                        const triangleTipX = dot3X
                        const triangleTipY = dot3Y
                        
                        const borderRadiusPx = Math.min(15, Math.max(6, 15 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                        const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                        const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                        const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                        
                        const speechBubblePath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                          L ${triangleTipXWrapper},${triangleTipYWrapper}
                          L ${triangleBaseRightWrapper},${bottomY}
                          ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                        `
                        
                        const triangleLeftLegPath = `
                          M ${triangleBaseLeftWrapper},${bottomY}
                          L ${triangleTipXWrapper},${triangleTipYWrapper}
                        `
                        const triangleRightLegPath = `
                          M ${triangleBaseRightWrapper},${bottomY}
                          L ${triangleTipXWrapper},${triangleTipYWrapper}
                        `
                        
                        const rightBorderPath = `
                          M ${triangleBaseRightWrapper},${bottomY}
                          ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        return (
                          <div 
                            className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                            style={buttonStyle}
                          >
                            <div
                              className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                              onClick={!isSelected ? handlePage10Box1 : undefined}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: isSelected ? 'none' : 'auto',
                                cursor: isSelected ? 'default' : 'pointer',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${bubbleFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                textAlign: 'center',
                                padding: '4px 8px',
                                boxSizing: 'border-box',
                                userSelect: isSelected ? 'none' : 'auto',
                                WebkitUserSelect: isSelected ? 'none' : 'auto'
                              }}
                            >
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={speechBubblePath}
                                fill={isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)'}
                                style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={triangleLeftLegPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={triangleRightLegPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* Box 2 on 10.1.png and 10.png - no pointer */}
                      {(() => {
                        const boxLeft = 58.70
                        const boxTop = 59.85
                        const boxWidth = 24.51
                        const boxHeight = 10.13
                        const isSelected = page10Box2Selected
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Move bottom edge up by 3px (reduce height)
                        const bottomUpPx = 3
                        const bottomUpPercent = imageNaturalSize.height > 0 ? (bottomUpPx / imageNaturalSize.height) * 100 : 0
                        
                        // Move left edge to the right by 3px and right edge to the left by 2px (reduce width)
                        const leftEdgeRightPx = 3
                        const rightEdgeLeftPx = 2
                        const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                        const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                        const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - bottomUpPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        const borderRadiusPx = Math.min(25, Math.max(10, 25 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                        const strokeWidth = isSelected ? "2" : "1"
                        
                        return (
                          <div 
                            className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                            style={{...buttonStyle, zIndex: 12}}
                          >
                            <div
                              className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                              onClick={!isSelected ? handlePage10Box2 : undefined}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: isSelected ? 'none' : 'auto',
                                cursor: isSelected ? 'default' : 'pointer',
                                zIndex: 13,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                                fontFamily: 'Roboto, sans-serif',
                                textAlign: 'center',
                                padding: '4px 8px',
                                boxSizing: 'border-box',
                                userSelect: isSelected ? 'none' : 'auto',
                                WebkitUserSelect: isSelected ? 'none' : 'auto'
                              }}
                            >
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                                style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* Box 3 on 10.1.png and 10.png - no pointer */}
                      {(() => {
                        const boxLeft = 34.59
                        const boxTop = 73.43
                        const boxWidth = 31.04
                        const boxHeight = 18.31
                        const isSelected = page10Box3Selected
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Move top edge down by 3px and bottom edge up by 3px (reduce height by 6px total)
                        const topDownPx = 3
                        const bottomUpPx = 3
                        const topDownPercent = imageNaturalSize.height > 0 ? (topDownPx / imageNaturalSize.height) * 100 : 0
                        const bottomUpPercent = imageNaturalSize.height > 0 ? (bottomUpPx / imageNaturalSize.height) * 100 : 0
                        const totalHeightReductionPercent = topDownPercent + bottomUpPercent
                        
                        // Move left edge to the right by 2px and right edge to the left by 3px (reduce width)
                        const leftEdgeRightPx = 2
                        const rightEdgeLeftPx = 3
                        const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                        const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                        const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topDownPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        const borderRadiusPx = Math.min(35, Math.max(12, 35 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                        const strokeWidth = isSelected ? "2" : "1"
                        
                        return (
                          <div 
                            className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                            style={{...buttonStyle, zIndex: 12}}
                          >
                            <div
                              className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                              onClick={!isSelected ? handlePage10Box3 : undefined}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: isSelected ? 'none' : 'auto',
                                cursor: isSelected ? 'default' : 'pointer',
                                zIndex: 13,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                                fontFamily: 'Roboto, sans-serif',
                                textAlign: 'center',
                                padding: '4px 8px',
                                boxSizing: 'border-box',
                                userSelect: isSelected ? 'none' : 'auto',
                                WebkitUserSelect: isSelected ? 'none' : 'auto'
                              }}
                            >
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                                style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                    </>
                  )}
                  {/* Box on page 11.png - with pointer */}
                  {currentPage === 10 && !editorMode && (() => {
                    const boxLeft = 33.02
                    const boxTop = 50.97
                    const boxWidth = 34.64
                    const boxHeight = 6.12
                    const dot1X = 33.02
                    const dot1Y = 53.55
                    const dot2X = 33.02
                    // Move dot 2 down by 2px
                    const dot2YMoveDownPx = 2
                    const dot2YMoveDownPercent = imageNaturalSize.height > 0 ? (dot2YMoveDownPx / imageNaturalSize.height) * 100 : 0
                    const dot2Y = 51.98 + dot2YMoveDownPercent
                    const dot3X = 28.82
                    const dot3Y = 50.87
                    const isSelected = page11BoxSelected
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Reduce width: move left edge right by 3px and right edge left by 4px
                    const leftEdgeRightPx = 3
                    const rightEdgeLeftPx = 4
                    const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                    
                    // Reduce height: move top edge down by 3px and bottom edge up by 4px (additional reduction from current)
                    const topEdgeDownPx = 3 + 3  // Additional 3px down from current
                    const bottomEdgeUpPx = 4 + 4  // Additional 4px up from current
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    const totalHeightReductionPercent = topEdgeDownPercent + bottomEdgeUpPercent
                    
                    const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - totalHeightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends UPWARD from the left edge to dot3
                    // Dot1 and Dot2 are both at X: 33.02% (left edge), so triangle points from left edge
                    // Dot1 Y: 53.55% (lower), Dot2 Y: 51.98% (higher), so dot2 is above dot1
                    const triangleBaseX = dot1X  // Both dots at same X position
                    const triangleBaseTopY = dot2Y  // Use dot2 Y for top of base (higher Y = lower on screen, but we want the upper one)
                    const triangleBaseBottomY = dot1Y  // Use dot1 Y for bottom of base
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseXWrapper = ((triangleBaseX - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseTopYWrapper = ((triangleBaseTopY - adjustedTop) / expandedHeight) * 100
                    const triangleBaseBottomYWrapper = ((triangleBaseBottomY - adjustedTop) / expandedHeight) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${triangleBaseTopYWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${topLeft},${triangleBaseBottomYWrapper}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${triangleBaseTopYWrapper}
                      M ${topLeft},${triangleBaseBottomYWrapper}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${topLeft},${triangleBaseTopYWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${topLeft},${triangleBaseBottomYWrapper}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected ? handlePage11Box : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected ? 'none' : 'auto',
                            cursor: isSelected ? 'default' : 'pointer',
                            zIndex: 13,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 2 on page 11.png - with pointer, active only after box 1 is selected */}
                  {currentPage === 10 && !editorMode && (() => {
                    const boxLeft = 28.96
                    const boxTop = 64.03
                    const boxWidth = 30.14
                    const boxHeight = 5.60
                    const dot1X = 34.47
                    const dot1Y = 64.03
                    const dot2X = 42.13
                    const dot2Y = 64.03
                    const dot3X = 29.50
                    const dot3Y = 62.01
                    const isSelected = page11Box2Selected
                    
                    // Adjust box 2: move left edge right 3px, move right edge left 1px
                    const leftEdgeMoveRightPx = 3
                    const rightEdgeMoveLeftPx = 1
                    const leftEdgeAdjustPercent = stageWidthPx > 0 ? (leftEdgeMoveRightPx / stageWidthPx) * 100 : 0
                    const rightEdgeAdjustPercent = stageWidthPx > 0 ? (rightEdgeMoveLeftPx / stageWidthPx) * 100 : 0
                    const adjustedBoxLeft = boxLeft + leftEdgeAdjustPercent
                    const adjustedBoxWidth = boxWidth - leftEdgeAdjustPercent - rightEdgeAdjustPercent
                    
                    // Adjust box 2: move top edge down 1px, move bottom edge up 3px
                    const topEdgeMoveDownPx = 1
                    const bottomEdgeMoveUpPx = 3
                    const topEdgeAdjustPercent = stageHeightPx > 0 ? (topEdgeMoveDownPx / stageHeightPx) * 100 : 0
                    const bottomEdgeAdjustPercent = stageHeightPx > 0 ? (bottomEdgeMoveUpPx / stageHeightPx) * 100 : 0
                    const adjustedBoxTop = boxTop + topEdgeAdjustPercent
                    const adjustedBoxHeight = boxHeight - topEdgeAdjustPercent - bottomEdgeAdjustPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      L ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      M ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected && page11BoxSelected ? handlePage11Box2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected || !page11BoxSelected ? 'none' : 'auto',
                            cursor: isSelected || !page11BoxSelected ? 'default' : 'pointer',
                            zIndex: 13,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Box 3 on page 11.png - no pointer, active only after box 2 is selected */}
                  {currentPage === 10 && !editorMode && (() => {
                    const boxLeft = 22.43
                    const boxTop = 70.99
                    const boxWidth = 31.26
                    const boxHeight = 18.48
                    const isSelected = page11Box3Selected
                    
                    // Adjust box 3: move top edge down 3px, move bottom edge up 4px
                    const topEdgeMoveDownPx = 3
                    const bottomEdgeMoveUpPx = 4
                    const topEdgeAdjustPercent = stageHeightPx > 0 ? (topEdgeMoveDownPx / stageHeightPx) * 100 : 0
                    const bottomEdgeAdjustPercent = stageHeightPx > 0 ? (bottomEdgeMoveUpPx / stageHeightPx) * 100 : 0
                    const adjustedBoxTop = boxTop + topEdgeAdjustPercent
                    const adjustedBoxHeight = boxHeight - topEdgeAdjustPercent - bottomEdgeAdjustPercent
                    
                    // Adjust box 3: move left edge right 2px, move right edge left 2px
                    const leftEdgeMoveRightPx = 2
                    const rightEdgeMoveLeftPx = 2
                    const leftEdgeAdjustPercent = stageWidthPx > 0 ? (leftEdgeMoveRightPx / stageWidthPx) * 100 : 0
                    const rightEdgeAdjustPercent = stageWidthPx > 0 ? (rightEdgeMoveLeftPx / stageWidthPx) * 100 : 0
                    const adjustedBoxLeft = boxLeft + leftEdgeAdjustPercent
                    const adjustedBoxWidth = boxWidth - leftEdgeAdjustPercent - rightEdgeAdjustPercent
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, adjustedBoxLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, adjustedBoxTop - topOffsetAdjust)
                    const expandedWidth = Math.min(100 - adjustedLeft, adjustedBoxWidth + widthPercentAdjust)
                    const expandedHeight = Math.min(100 - adjustedTop, adjustedBoxHeight + heightPercentAdjust)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    const borderRadiusPx = Math.min(35, Math.max(10, 35 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const roundedRectPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                    `
                    
                    const rightBorderPath = `
                      M ${topRight - borderRadiusWrapperX},${bottomY}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const strokeColor = isSelected ? "#ff8c00" : "#0d6efd"
                    const strokeWidth = isSelected ? "2" : "1"
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                        style={{...buttonStyle, zIndex: 12}}
                      >
                        <div
                          className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                          onClick={!isSelected && page11Box2Selected ? handlePage11Box3 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isSelected || !page11Box2Selected ? 'none' : 'auto',
                            cursor: isSelected || !page11Box2Selected ? 'default' : 'pointer',
                            zIndex: 13,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box',
                            userSelect: isSelected ? 'none' : 'auto',
                            WebkitUserSelect: isSelected ? 'none' : 'auto'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={roundedRectPath}
                            fill={isSelected ? "transparent" : "rgba(255, 255, 255, 0.95)"}
                            style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={strokeColor}
                              strokeWidth={strokeWidth}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Speech bubble button on page 3 (3.png) */}
                  {currentPage === 2 && !editorMode && (() => {
                    // Speech bubble dimensions from provided data
                    const bubbleLeft = 9.81
                    const bubbleTop = 30.42
                    const bubbleWidth = 18.42
                    const bubbleHeight = 4.38
                    const dot1X = 13.07
                    const dot1Y = 30.42
                    const dot2X = 17.80
                    const dot2Y = 30.42
                    const dot3X = 19.13
                    const dot3Y = 27.72
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    // If returning after second button was clicked, show as disabled with orange edge
                    const isDisabled = page3ButtonClicked || returningToPage3AfterSecondButton
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Reduce height by 3px (was 5px, now increased by 2px = 3px reduction)
                    const heightReductionPx = 3
                    const heightReductionPercent = stageHeightPx > 0 ? (heightReductionPx / stageHeightPx) * 100 : 0
                    
                    // Move the box down by 3px
                    const moveDownByPx = 3
                    const moveDownByPercent = stageHeightPx > 0 ? (moveDownByPx / stageHeightPx) * 100 : 0
                    
                    // Additional adjustments: left edge inwards 4px, right edge inwards 8px, bottom edge up 5px
                    const leftEdgeInwardPx = 4
                    const leftEdgeInwardPercent = stageWidthPx > 0 ? (leftEdgeInwardPx / stageWidthPx) * 100 : 0
                    const rightEdgeInwardPx = 8
                    const rightEdgeInwardPercent = stageWidthPx > 0 ? (rightEdgeInwardPx / stageWidthPx) * 100 : 0
                    const bottomEdgeUpPx = 5
                    const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                    
                    // Adjust dot3: move left 2px and down 3px
                    const dot3LeftOffsetPx = 2
                    const dot3DownOffsetPx = 3
                    const dot3LeftOffsetPercent = stageWidthPx > 0 ? (dot3LeftOffsetPx / stageWidthPx) * 100 : 0
                    const dot3DownOffsetPercent = stageHeightPx > 0 ? (dot3DownOffsetPx / stageHeightPx) * 100 : 0
                    const adjustedDot3X = dot3X - dot3LeftOffsetPercent
                    const adjustedDot3Y = dot3Y + dot3DownOffsetPercent
                    
                    const adjustedLeft = Math.max(0, bubbleLeft - leftOffsetAdjust + leftEdgeInwardPercent)
                    const adjustedTop = Math.max(0, bubbleTop - topOffsetAdjust + moveDownByPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, bubbleWidth + widthPercentAdjust - rightEdgeInwardPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, bubbleHeight + heightPercentAdjust - heightReductionPercent - bottomEdgeUpPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Font size scales exactly with image using stageRelativeScale - no min/max to maintain exact scale
                    // This ensures text maintains same visual appearance at 100% zoom regardless of panel width
                    const bubbleFontSize = 16 * stageRelativeScale
                    // Padding scales proportionally with button size
                    const buttonHeightPx = (expandedHeight / 100) * stageHeightPx
                    const buttonWidthPx = (expandedWidth / 100) * stageWidthPx
                    const paddingTopBottom = buttonHeightPx * 0.05
                    const paddingLeftRight = buttonWidthPx * 0.02
                    
                    // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                    // Dot3 is ABOVE the box (27.72% < 30.42%), so triangle points upward
                    const triangleBaseLeft = dot1X  // Left point on top edge
                    const triangleBaseRight = dot2X  // Right point on top edge
                    const triangleBaseY = bubbleTop  // Top edge Y position (30.42%)
                    const triangleTipX = adjustedDot3X  // Triangle tip X (adjusted)
                    const triangleTipY = adjustedDot3Y  // Triangle tip Y (adjusted)
                    
                    // Calculate rounded rectangle corner radius (reduced for speech bubbles)
                    const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                    // Convert to wrapper-relative SVG coordinates (0-100)
                    // The wrapper dimensions in pixels
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    // CSS border-radius applies the same pixel value to all corners
                    // Convert to SVG coordinates: use separate X and Y radius values
                    // Horizontal curves (left/right edges) use radius as % of width
                    // Vertical curves (top/bottom edges) use radius as % of height
                    // CSS caps each at 50% of its respective dimension
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    // Convert coordinates from page coordinates to wrapper-relative (0-100)
                    // Wrapper is at adjustedLeft, adjustedTop with size expandedWidth, expandedHeight
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    // Convert triangle points to wrapper-relative coordinates
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    // Build path: rounded rectangle with triangle protrusion on top edge (using wrapper-relative coordinates)
                    // Use borderRadiusWrapperX for horizontal curves (left/right), borderRadiusWrapperY for vertical curves (top/bottom)
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      Z
                    `
                    
                    // Border paths - separate segments to exclude top edge between the two points
                    // Left border: from bottom-left corner up to first point on top edge
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                    `
                    
                    // Triangle border: two legs only (not the base between the points)
                    // Left leg: from dot1 to tip
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    // Right leg: from dot2 to tip
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    // Right border: from second point on top edge down to bottom-right corner
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    // Bottom border: complete bottom edge
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isDisabled ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        {/* Clickable box area - only the rounded rectangle part, not the triangle */}
                        <div
                          className={`speech-bubble-box ${isDisabled ? 'disabled selected' : ''}`}
                          onClick={!isDisabled ? handlePage3Button : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isDisabled ? 'none' : 'auto',
                            cursor: isDisabled ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isDisabled ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            fontWeight: 700,
                            textAlign: 'center',
                            padding: `${paddingTopBottom}px ${paddingLeftRight}px`,
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        {/* SVG for speech bubble shape - single unified shape */}
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          {/* Main filled shape */}
                          <path
                            d={speechBubblePath}
                            fill={isDisabled ? 'transparent' : 'rgba(255, 255, 255, 0.95)'}
                            style={{ fill: isDisabled ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          {/* Border paths with pulse animation - excluding the top edge between the two points */}
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            {/* Triangle left leg */}
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            {/* Triangle right leg */}
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          {/* Top edge between the two points - no glow, no border */}
                          <path
                            d={`M ${triangleBaseLeftWrapper},${topY} L ${triangleBaseRightWrapper},${topY}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Second speech bubble button on page 3 (3.png) - appears after connect to power is clicked or when returning after second button */}
                  {currentPage === 2 && !editorMode && (page3ButtonClicked || returningToPage3AfterSecondButton) && (() => {
                    // Speech bubble dimensions from provided data
                    const bubble2Left = 62.30
                    const bubble2Top = 33.73
                    const bubble2Width = 25.18
                    const bubble2Height = 6.64
                    const dot1X = 65.11
                    const dot1Y = 40.38
                    const dot2X = 71.64
                    const dot2Y = 40.38
                    const dot3X = 56.98
                    const dot3Y = 42.69
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    // If returning after second button was clicked, show as disabled with orange edge
                    const isDisabled = page3SecondButtonClicked || returningToPage3AfterSecondButton
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Reduce height by 3px
                    const heightReductionPx = 3
                    const heightReductionPercent = stageHeightPx > 0 ? (heightReductionPx / stageHeightPx) * 100 : 0
                    
                    // Additional adjustments: top edge down 5px, left edge right 4px, right edge left 9px, bottom edge up 7px
                    const topEdgeDownPx = 5
                    const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                    const leftEdgeRightPx = 4
                    const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                    const rightEdgeLeftPx = 9
                    const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                    const bottomEdgeUpPx = 7
                    const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                    
                    // Adjust dot1: move right 7px
                    const dot1RightOffsetPx = 7
                    const dot1RightOffsetPercent = stageWidthPx > 0 ? (dot1RightOffsetPx / stageWidthPx) * 100 : 0
                    const adjustedDot1X = dot1X + dot1RightOffsetPercent
                    
                    // Adjust dot2: move right 4px
                    const dot2RightOffsetPx = 4
                    const dot2RightOffsetPercent = stageWidthPx > 0 ? (dot2RightOffsetPx / stageWidthPx) * 100 : 0
                    const adjustedDot2X = dot2X + dot2RightOffsetPercent
                    
                    const adjustedLeft = Math.max(0, bubble2Left - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, bubble2Top - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, bubble2Width + widthPercentAdjust - rightEdgeLeftPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, bubble2Height + heightPercentAdjust - heightReductionPercent - bottomEdgeUpPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Use stageRelativeScale (same as pages 1 and 2) to scale exactly with the image
                    // Calculate padding that scales with button size
                    // Font size scales exactly with image using stageRelativeScale - no min/max to maintain exact scale
                    // Reduced base size to 14px (from 16px) to fit longer text
                    // This ensures text maintains same visual appearance at 100% zoom regardless of panel width
                    const bubbleFontSize = 14 * stageRelativeScale
                    // Padding scales proportionally with button size
                    const buttonHeightPx = (expandedHeight / 100) * stageHeightPx
                    const buttonWidthPx = (expandedWidth / 100) * stageWidthPx
                    const paddingTopBottom = buttonHeightPx * 0.05
                    const paddingLeftRight = buttonWidthPx * 0.02
                    
                    // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                    // Dot3 is BELOW the box (42.69% > 40.38%), so triangle points downward
                    const triangleBaseLeft = adjustedDot1X  // Left point on bottom edge (adjusted)
                    const triangleBaseRight = adjustedDot2X  // Right point on bottom edge (adjusted)
                    const triangleBaseY = adjustedTop + expandedHeight  // Bottom edge Y position
                    const triangleTipX = dot3X  // Triangle tip X (56.98%)
                    const triangleTipY = dot3Y  // Triangle tip Y (42.69% - below the box)
                    
                    // Calculate rounded rectangle corner radius (reduced for speech bubbles)
                    const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                    // Convert to wrapper-relative SVG coordinates (0-100)
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    // CSS border-radius applies the same pixel value to all corners
                    // Convert to SVG coordinates: use separate X and Y radius values
                    // Horizontal curves (left/right edges) use radius as % of width
                    // Vertical curves (top/bottom edges) use radius as % of height
                    // CSS caps each at 50% of its respective dimension
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    // Convert coordinates from page coordinates to wrapper-relative (0-100)
                    // Wrapper is at adjustedLeft, adjustedTop with size expandedWidth, expandedHeight
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    // Convert triangle points to wrapper-relative coordinates
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    // Build path: rounded rectangle with triangle protrusion on bottom edge (using wrapper-relative coordinates)
                    // Use borderRadiusWrapperX for horizontal curves (left/right), borderRadiusWrapperY for vertical curves (top/bottom)
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    // Border paths - separate segments to exclude bottom edge between the two points
                    // Left border: from top-left corner down to first point on bottom edge
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                    `
                    
                    // Triangle border: two legs only (not the base between the points)
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    // Right border: from second point on bottom edge up to top-right corner
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    // Top border: complete top edge
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isDisabled ? 'has-selected' : ''}`}
                        style={{ ...buttonStyle, zIndex: 2000 }}
                      >
                        {/* Clickable box area - only the rounded rectangle part, not the triangle */}
                        <div
                          className={`speech-bubble-box ${isDisabled ? 'disabled selected' : ''}`}
                          onClick={!isDisabled ? handlePage3SecondButton : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isDisabled ? 'none' : 'auto',
                            cursor: isDisabled ? 'default' : 'pointer',
                            zIndex: 2001,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isDisabled ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            fontWeight: 700,
                            textAlign: 'center',
                            lineHeight: '1.3',
                            padding: `${paddingTopBottom}px ${paddingLeftRight}px`,
                            boxSizing: 'border-box',
                            flexDirection: 'column'
                          }}
                        >
                        </div>
                        {/* SVG for speech bubble shape - single unified shape */}
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 2000
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          {/* Main filled shape */}
                          <path
                            d={speechBubblePath}
                            fill={isDisabled ? 'transparent' : 'rgba(255, 255, 255, 0.95)'}
                            style={{ fill: isDisabled ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          {/* Border paths with pulse animation - excluding the bottom edge between the two points */}
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            {/* Triangle left leg */}
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            {/* Triangle right leg */}
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          {/* Bottom edge between the two points - no border */}
                          <path
                            d={`M ${triangleBaseLeftWrapper},${bottomY} L ${triangleBaseRightWrapper},${bottomY}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* White boxes on page 3 (3.png) - hide when first box is selected or when returning after second button */}
                  {currentPage === 2 && !editorMode && !page3ButtonClicked && !returningToPage3AfterSecondButton && (() => {
                    // Box 1: Left: 6.88%, Top: 41.74%, Width: 86.24%, Height: 54.35%
                    const page3Box1Style = getButtonStyle(6.88, 41.74, 86.24, 54.35)
                    const page3Box1ExpandedStyle = {
                      ...page3Box1Style,
                      left: '6.88%',
                      top: '41.74%',
                      width: '86.24%',
                      height: '54.35%',
                      backgroundColor: 'white',
                      pointerEvents: 'none',
                      zIndex: 1000
                    }

                    // Box 2: Left: 57.80%, Top: 33.38%, Width: 30.81%, Height: 9.60%
                    const page3Box2Style = getButtonStyle(57.80, 33.38, 30.81, 9.60)
                    const page3Box2ExpandedStyle = {
                      ...page3Box2Style,
                      left: '57.80%',
                      top: '33.38%',
                      width: '30.81%',
                      height: '9.60%',
                      backgroundColor: 'white',
                      pointerEvents: 'none',
                      zIndex: 1000
                    }

                    return (
                      <>
                        <div style={page3Box1ExpandedStyle} />
                        <div style={page3Box2ExpandedStyle} />
                      </>
                    )
                  })()}
                  {/* White box with rounded corners on page 3 (3.png) - hide when second button is selected or when returning */}
                  {currentPage === 2 && !editorMode && !page3SecondButtonClicked && !returningToPage3AfterSecondButton && (() => {
                    // Box: Left: 12.51%, Top: 43.83%, Width: 75.20%, Height: 46.69%
                    const page3Box3Style = getButtonStyle(12.51, 43.83, 75.20, 46.69)
                    // Calculate border radius - increased for more rounded corners
                    const borderRadiusPx = Math.min(20, Math.max(12, 20 * stageRelativeScale))
                    const page3Box3ExpandedStyle = {
                      ...page3Box3Style,
                      left: '12.51%',
                      top: '43.83%',
                      width: '75.20%',
                      height: '46.69%',
                      backgroundColor: 'white',
                      borderRadius: `${borderRadiusPx}px`,
                      pointerEvents: 'none',
                      zIndex: 1000
                    }

                    return (
                      <div style={page3Box3ExpandedStyle} />
                    )
                  })()}
                  {/* Small green boxes on page 3 (3.png) - always displayed when white box is hidden, even when returning */}
                  {currentPage === 2 && !editorMode && page3SecondButtonClicked && (() => {
                    // Fixed pixel size for all boxes - 20px  20px squares (increased from 10px)
                    // Convert box size to percentages based on image natural size (not stage size)
                    // This ensures boxes scale correctly when panel width changes
                    const boxSizePx = 20
                    const boxSizeWidthPercent = imageNaturalSize.width > 0 ? (boxSizePx / imageNaturalSize.width) * 100 : 0
                    const boxSizeHeightPercent = imageNaturalSize.height > 0 ? (boxSizePx / imageNaturalSize.height) * 100 : 0
                    // Calculate border radius for rounded corners
                    const borderRadiusPx = 2
                    // Standardized row positions (percentages) - moved up and left
                    const row1Top = 55.84
                    const row2Top = 72.62
                    const row3Top = 87.99
                    
                    // Row 1 boxes (aligned at 55.84%) - moved left by 5px more
                    const greenBoxes = [
                      { left: 19.46, top: row1Top },
                      { left: 40.63, top: row1Top },
                      { left: 62.25, top: row1Top },
                      { left: 78.96, top: row1Top },
                      // Row 2 boxes (aligned at 72.62%) - moved left
                      { left: 19.55, top: row2Top },
                      { left: 40.45, top: row2Top },
                      { left: 61.79, top: row2Top },
                      { left: 79.05, top: row2Top },
                      // Row 3 boxes (aligned at 87.99%) - moved left
                      { left: 40.08, top: row3Top },
                      { left: 61.52, top: row3Top }
                    ]

                    return (
                      <>
                        {greenBoxes.map((box, index) => {
                          const isSelected = selectedGreenBoxes.has(index)
                          // Calculate position adjustments in percentages
                          // Move right 5px and down 5px for all boxes (reduced for previous location)
                          // Row 2 boxes (indices 4-7) get additional offset: down 1px
                          // First row far right box (index 3) and second row far right box (index 7) get additional offset: left 1px
                          // Third row far left box (index 8) gets additional offset: right 1px
                          const isRow1 = index >= 0 && index <= 3
                          const isRow2 = index >= 4 && index <= 7
                          const isRow3 = index >= 8 && index <= 9
                          const isRow1FarRight = index === 3
                          const isRow2FarRight = index === 7
                          const isRow3FarLeft = index === 8
                          const isTopLeft = index === 0
                          // Row 1 boxes: moved left 5px, then adjusted right 2px and down 1px (net: left 3px, up 4px)
                          // Row 2 boxes: moved left 3px and up 2px
                          // Row 3 boxes: moved left 3px and up 3px
                          // Top left box (index 0): move right 1px
                          const baseLeftOffsetPx = (isRow1FarRight || isRow2FarRight) ? 4 : (isRow3FarLeft ? 6 : 5)
                          const row1LeftOffset = isTopLeft ? (baseLeftOffsetPx - 2) : (baseLeftOffsetPx - 3) // Top left: -2px (move right 1px from -3), others: -3px
                          const leftOffsetPx = isRow1 ? row1LeftOffset : (isRow2 ? (baseLeftOffsetPx - 3) : (isRow3 ? (baseLeftOffsetPx - 3) : baseLeftOffsetPx)) // Row 1: -2px for top left, -3px for others; Row 2: -3px; Row 3: -3px
                          const baseTopOffsetPx = isRow2 ? 4 : 3
                          const topOffsetPx = isRow1 ? (baseTopOffsetPx - 4) : (isRow2 ? (baseTopOffsetPx - 2) : (isRow3 ? (baseTopOffsetPx - 3) : baseTopOffsetPx)) // Row 1: -4px, Row 2: -2px, Row 3: -3px (3-3=0)
                          
                          // Convert pixel offsets to percentages based on image natural size (not stage size)
                          // This ensures offsets scale correctly when panel width changes
                          const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                          const topOffsetPercent = imageNaturalSize.height > 0 ? (topOffsetPx / imageNaturalSize.height) * 100 : 0
                          
                          // Calculate adjusted position (center of box) in percentages
                          const adjustedLeft = box.left + leftOffsetPercent
                          const adjustedTop = box.top + topOffsetPercent
                          
                          // Get the base style with proper scaling from wrapper center
                          const baseStyle = getButtonStyle(adjustedLeft, adjustedTop, boxSizeWidthPercent, boxSizeHeightPercent)
                          
                          const greenBoxStyle = {
                            ...baseStyle,
                            backgroundColor: isSelected ? '#3bbf6b' : 'white',
                            border: `0.5px solid #3bbf6b`,
                            borderRadius: `${borderRadiusPx}px`,
                            cursor: 'pointer',
                            pointerEvents: 'auto',
                            zIndex: 3000, // Very high z-index to ensure clickability above everything
                            boxSizing: 'border-box',
                            userSelect: 'none'
                          }
                          return (
                            <div 
                              key={`green-box-${index}`} 
                              style={greenBoxStyle}
                              onClick={(e) => {
                                e.stopPropagation()
                                e.preventDefault()
                                handleGreenBoxClick(index)
                              }}
                              onMouseDown={(e) => {
                                e.stopPropagation()
                              }}
                            />
                          )
                        })}
                      </>
                    )
                  })()}
                  {/* Speech bubble button on page 4 (4.png) */}
                  {currentPage === 3 && !editorMode && (() => {
                    // Speech bubble dimensions from provided data
                    const bubbleLeft = 25.99
                    const bubbleTop = 22.05
                    const bubbleWidth = 24.87
                    const bubbleHeight = 4.21
                    const dot1X = 41.58
                    const dot1Y = 22.05
                    const dot2X = 48.03
                    const dot2Y = 22.05
                    const dot3X = 52.04
                    const dot3Y = 20.15
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const isDisabled = page4SpeechBubbleClicked
                    // Font size scales exactly with image using stageRelativeScale - no min/max to maintain exact scale
                    const bubbleFontSize = 16 * stageRelativeScale
                    // Calculate adjustments based on image natural size for consistent scaling (like safety glasses image)
                    const widthPercentAdjust = imageNaturalSize.width > 0 ? (pixelIncrease / imageNaturalSize.width) * 100 : 0
                    const heightPercentAdjust = imageNaturalSize.height > 0 ? (pixelIncrease / imageNaturalSize.height) * 100 : 0
                    const leftOffsetAdjust = imageNaturalSize.width > 0 ? (halfPixelIncrease / imageNaturalSize.width) * 100 : 0
                    const topOffsetAdjust = imageNaturalSize.height > 0 ? (halfPixelIncrease / imageNaturalSize.height) * 100 : 0
                    
                    // Extend height down by 2px (reduce height reduction from 3px to 1px)
                    const heightReductionPx = 1
                    const heightReductionPercent = imageNaturalSize.height > 0 ? (heightReductionPx / imageNaturalSize.height) * 100 : 0
                    
                    // Additional adjustments: top edge down 4px, right edge left 2px, bottom edge up 5px
                    const topEdgeDownPx = 4
                    const topEdgeDownPercent = imageNaturalSize.height > 0 ? (topEdgeDownPx / imageNaturalSize.height) * 100 : 0
                    const rightEdgeLeftPx = 2
                    const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                    const bottomEdgeUpPx = 5
                    const bottomEdgeUpPercent = imageNaturalSize.height > 0 ? (bottomEdgeUpPx / imageNaturalSize.height) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, bubbleLeft - leftOffsetAdjust)
                    const adjustedTop = Math.max(0, bubbleTop - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, bubbleWidth + widthPercentAdjust - rightEdgeLeftPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, bubbleHeight + heightPercentAdjust - heightReductionPercent - bottomEdgeUpPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Adjust dot2: move left 11px
                    const dot2LeftOffsetPx = 11
                    const dot2LeftOffsetPercent = imageNaturalSize.width > 0 ? (dot2LeftOffsetPx / imageNaturalSize.width) * 100 : 0
                    const adjustedDot2X = dot2X - dot2LeftOffsetPercent
                    
                    // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                    // Dot3 is ABOVE the box (20.15% < 22.05%), so triangle points upward
                    const triangleBaseLeft = dot1X  // Left point on top edge
                    const triangleBaseRight = adjustedDot2X  // Right point on top edge
                    const triangleBaseY = bubbleTop  // Top edge Y position (22.05%)
                    const triangleTipX = dot3X  // Triangle tip X (52.04%)
                    const triangleTipY = dot3Y  // Triangle tip Y (20.15% - above the box)
                    
                    // Calculate rounded rectangle corner radius (reduced for speech bubbles) - scales exactly with image
                    const borderRadiusPx = 10 * stageRelativeScale
                    // Convert to wrapper-relative SVG coordinates (0-100)
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    // CSS border-radius applies the same pixel value to all corners
                    // Convert to SVG coordinates: use separate X and Y radius values
                    // Horizontal curves (left/right edges) use radius as % of width
                    // Vertical curves (top/bottom edges) use radius as % of height
                    // CSS caps each at 50% of its respective dimension
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    // Convert coordinates from page coordinates to wrapper-relative (0-100)
                    // Wrapper is at adjustedLeft, adjustedTop with size expandedWidth, expandedHeight
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    // Convert triangle points to wrapper-relative coordinates
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    // Build path: rounded rectangle with triangle protrusion on top edge (using wrapper-relative coordinates)
                    // Use borderRadiusWrapperX for horizontal curves (left/right), borderRadiusWrapperY for vertical curves (top/bottom)
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      Z
                    `
                    
                    // Border paths - separate segments to exclude top edge between the two points
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                    `
                    
                    // Triangle border: two legs only (not the base between the points)
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    // Right border: from second point on top edge down to bottom-right corner
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    // Bottom border: complete bottom edge
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isDisabled ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        {/* Clickable box area - only the rounded rectangle part, not the triangle */}
                        <div
                          className={`speech-bubble-box ${isDisabled ? 'disabled selected' : ''}`}
                          onClick={!isDisabled ? handlePage4SpeechBubble : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isDisabled ? 'none' : 'auto',
                            cursor: isDisabled ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isDisabled ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            fontWeight: 700,
                            textAlign: 'center'
                          }}
                        >
                        </div>
                        {/* SVG for speech bubble shape - single unified shape */}
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          {/* Main filled shape */}
                          <path
                            d={speechBubblePath}
                            fill={isDisabled ? 'transparent' : 'rgba(255, 255, 255, 0.95)'}
                            style={{ fill: isDisabled ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          {/* Border paths with pulse animation - excluding the top edge between the two points */}
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            {/* Triangle left leg */}
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            {/* Triangle right leg */}
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          {/* Top edge between the two points - no glow, no border */}
                          <path
                            d={`M ${triangleBaseLeftWrapper},${topY} L ${triangleBaseRightWrapper},${topY}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* White infill boxes on page 4 (4.png) - hide when buttons are clicked */}
                  {currentPage === 3 && !editorMode && (() => {
                    // Box 1: Left: 0.00%, Top: 28.63%, Width: 100.00%, Height: 17.07%
                    const page4Box1Style = getButtonStyle(0.00, 28.63, 100.00, 17.07)
                    const page4Box1ExpandedStyle = {
                      ...page4Box1Style,
                      left: '0.00%',
                      top: '28.63%',
                      width: '100.00%',
                      height: '17.07%',
                      backgroundColor: 'white',
                      opacity: page4Box1Fading ? 0 : 1,
                      transition: 'opacity 1.5s cubic-bezier(0.4, 0, 0.2, 1)',
                      pointerEvents: 'none',
                      border: 'none',
                      zIndex: 4000
                    }

                    // Box 2: Left: 0.00%, Top: 45.34%, Width: 100.00%, Height: 25.69%
                    const page4Box2Style = getButtonStyle(0.00, 45.34, 100.00, 25.69)
                    const page4Box2ExpandedStyle = {
                      ...page4Box2Style,
                      left: '0.00%',
                      top: '45.34%',
                      width: '100.00%',
                      height: '25.69%',
                      backgroundColor: 'white',
                      opacity: page4Box2Fading ? 0 : 1,
                      transition: 'opacity 1.5s cubic-bezier(0.4, 0, 0.2, 1)',
                      pointerEvents: 'none',
                      border: 'none',
                      zIndex: 4000
                    }

                    // Box 3: Left: 0.00%, Top: 72.57%, Width: 100.00%, Height: 30.00%
                    // Reduce width by 150px total (reduced by 10px from 140px)
                    const widthReductionPx = 150
                    const widthReductionPercent = imageNaturalSize.width > 0 ? (widthReductionPx / imageNaturalSize.width) * 100 : 0
                    const adjustedBox3Width = 100.00 - widthReductionPercent
                    // Center the box after width reduction
                    const adjustedBox3Left = widthReductionPercent / 2
                    // Reduce height by bringing bottom edge up - calculate based on image natural size
                    const heightReductionPx = 55
                    const heightReductionPercent = imageNaturalSize.height > 0 ? (heightReductionPx / imageNaturalSize.height) * 100 : 0
                    const adjustedBox3Height = 30.00 - heightReductionPercent
                    const page4Box3Style = getButtonStyle(adjustedBox3Left, 72.57, adjustedBox3Width, adjustedBox3Height)
                    const page4Box3ExpandedStyle = {
                      ...page4Box3Style,
                      left: `${adjustedBox3Left}%`,
                      top: '72.57%',
                      width: `${adjustedBox3Width}%`,
                      height: `${adjustedBox3Height}%`,
                      backgroundColor: 'white',
                      opacity: page4Box3Fading ? 0 : 1,
                      transition: 'opacity 1.5s cubic-bezier(0.4, 0, 0.2, 1)',
                      pointerEvents: 'none',
                      border: 'none',
                      zIndex: 4000
                    }

                    return (
                      <>
                        <div style={page4Box1ExpandedStyle} />
                        <div style={page4Box2ExpandedStyle} />
                        <div style={page4Box3ExpandedStyle} />
                      </>
                    )
                  })()}
                  {/* Safety glasses image on page 4 (4.png) */}
                  {currentPage === 3 && !editorMode && (() => {
                    // Move 5px left and 13px up (moved up 2px more) - calculate offsets based on image natural size for consistent scaling
                    const leftOffsetPx = -5
                    const topOffsetPx = -13
                    const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                    const topOffsetPercent = imageNaturalSize.height > 0 ? (topOffsetPx / imageNaturalSize.height) * 100 : 0
                    const adjustedLeft = 13.07 + leftOffsetPercent
                    const adjustedTop = 14.91 + topOffsetPercent
                    
                    // Increase width by 5px proportionally - calculate based on image natural size
                    const widthIncreasePx = 5
                    const widthIncreasePercent = imageNaturalSize.width > 0 ? (widthIncreasePx / imageNaturalSize.width) * 100 : 0
                    const adjustedWidth = 75 + widthIncreasePercent
                    
                    // Calculate height percentage for transform origin (but use 'auto' for actual height)
                    const handleSafetyGlassesLoad = (e) => {
                      if (e.target) {
                        const { naturalWidth, naturalHeight } = e.target
                        if (naturalWidth && naturalHeight) {
                          setSafetyGlassesSize({ width: naturalWidth, height: naturalHeight })
                        }
                      }
                    }
                    
                    // Calculate height percentage based on aspect ratio for transform origin
                    // Use a default aspect ratio if image hasn't loaded yet
                    const imageAspectRatio = safetyGlassesSize.width > 0 && safetyGlassesSize.height > 0 
                      ? safetyGlassesSize.width / safetyGlassesSize.height 
                      : 1 // Default to square if not loaded
                    const adjustedHeight = adjustedWidth / imageAspectRatio
                    
                    // Use getButtonStyle for correct scaling from wrapper center
                    const imageBaseStyle = getButtonStyle(adjustedLeft, adjustedTop, adjustedWidth, adjustedHeight)
                    
                    // Calculate 100px expansion in all directions as percentages
                    // 100px expansion means: left moves -100px, top moves -100px, width increases 200px, height increases 200px
                    // Use safety glasses natural size for percentage calculation
                    const expansionPx = 100
                    const leftExpansionPercent = safetyGlassesSize.width > 0 ? (expansionPx / safetyGlassesSize.width) * 100 : 0
                    const topExpansionPercent = safetyGlassesSize.height > 0 ? (expansionPx / safetyGlassesSize.height) * 100 : 0
                    const widthExpansionPercent = safetyGlassesSize.width > 0 ? ((expansionPx * 2) / safetyGlassesSize.width) * 100 : 0
                    const heightExpansionPercent = safetyGlassesSize.height > 0 ? ((expansionPx * 2) / safetyGlassesSize.height) * 100 : 0
                    
                    return (
                      <img
                        src={safetyGlasses}
                        alt="Safety glasses"
                        onLoad={handleSafetyGlassesLoad}
                        className={safetyGlassesPop ? 'safety-glasses-pop' : ''}
                        style={{
                          ...imageBaseStyle,
                          // Don't override height - use the calculated percentage for proper transform origin
                          zIndex: 10,
                          pointerEvents: 'none',
                          objectFit: 'contain', // Maintain aspect ratio within the bounds
                          // Pass base values and expansion values to CSS for animation
                          ['--base-left']: imageBaseStyle.left,
                          ['--base-top']: imageBaseStyle.top,
                          ['--base-width']: imageBaseStyle.width,
                          ['--base-height']: imageBaseStyle.height,
                          ['--left-expansion']: `${leftExpansionPercent}%`,
                          ['--top-expansion']: `${topExpansionPercent}%`,
                          ['--width-expansion']: `${widthExpansionPercent}%`,
                          ['--height-expansion']: `${heightExpansionPercent}%`
                        }}
                      />
                    )
                  })()}
                  {/* Buttons on page 4 (4.png) - rounded corner boxes without pointers */}
                  {currentPage === 3 && !editorMode && (() => {
                    // Button 1: Left: 13.19%, Top: 30.08%, Width: 68.40% (reduced from 73.40%), Height: 14.48%
                    const button1Left = 13.19
                    const button1Top = 30.08
                    const button1Width = 68.40
                    const button1Height = 14.48
                    
                    // Button 2: Left: 13.87%, Top: 55.49%, Width: 20.45%, Height: 14.48%
                    const button2Left = 13.87
                    const button2Top = 55.49
                    const button2Width = 20.45
                    const button2Height = 14.48
                    
                    // Button 3: Left: 39.55%, Top: 55.32%, Width: 20.45%, Height: 14.48%
                    const button3Left = 39.55
                    const button3Top = 55.32
                    const button3Width = 20.45
                    const button3Height = 14.48
                    
                    // Button 4: Left: 65.68%, Top: 55.49%, Width: 20.45%, Height: 14.48%
                    const button4Left = 65.68
                    const button4Top = 55.49
                    const button4Width = 20.45
                    const button4Height = 14.48
                    
                    // Button 5: Left: 25.81%, Top: 73.77%, Width: 48.39%, Height: 20.40%
                    const button5Left = 25.81
                    const button5Top = 73.77
                    const button5Width = 48.39
                    const button5Height = 20.40
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    // Font size scales exactly with image using stageRelativeScale - no min/max to maintain exact scale
                    const buttonFontSize = 16 * stageRelativeScale
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Calculate border radius for rounded corners - scales exactly with image
                    const borderRadiusPx = 32 * stageRelativeScale
                    
                    const createButton = (left, top, width, height, isDisabled, onClick, buttonIndex) => {
                      // Add 25px extra width for button 1
                      const extraWidthPx = buttonIndex === 1 ? 25 : 0
                      const extraWidthPercent = stageWidthPx > 0 ? (extraWidthPx / stageWidthPx) * 100 : 0
                      // Reduce width by 2px for button 2 (far left small box) - moves right edge to the left
                      // Reduce width by 1px for button 3 (middle small box)
                      // Reduce width by 1px for button 4 (far right small box)
                      // Reduce width by 1px for button 5 (bottom button)
                      const widthReductionPx = buttonIndex === 2 ? 2 : (buttonIndex === 3 ? 1 : (buttonIndex === 4 ? 1 : (buttonIndex === 5 ? 1 : 0)))
                      const widthReductionPercent = stageWidthPx > 0 ? (widthReductionPx / stageWidthPx) * 100 : 0
                      const totalWidth = width + widthPercentAdjust + extraWidthPercent - widthReductionPercent
                      
                      // Center button 1 on the image
                      let adjustedLeft
                      if (buttonIndex === 1) {
                        // Center the button: left = 50% - (width / 2)
                        adjustedLeft = Math.max(0, 50 - (totalWidth / 2))
                      } else {
                        // For button 2 (far left small box), move right by 1px
                        // For button 3 (middle small box), move right by 1px
                        const leftAdjustPx = buttonIndex === 2 ? 1 : (buttonIndex === 3 ? 1 : 0)
                        const leftAdjustPercent = stageWidthPx > 0 ? (leftAdjustPx / stageWidthPx) * 100 : 0
                        adjustedLeft = Math.max(0, left - leftOffsetAdjust + leftAdjustPercent)
                      }
                      
                      // For button 3 (middle small box), move down by 1px
                      // For button 5 (bottom button), move down by 1px
                      const topAdjustPx = buttonIndex === 3 ? 1 : (buttonIndex === 5 ? 1 : 0)
                      const topAdjustPercent = stageHeightPx > 0 ? (topAdjustPx / stageHeightPx) * 100 : 0
                      const adjustedTop = Math.max(0, top - topOffsetAdjust + topAdjustPercent)
                      const expandedWidth = Math.min(100 - adjustedLeft, totalWidth)
                      // Reduce height by 2px for button 2 (far left small box)
                      // Reduce height by 2px for button 3 (middle small box)
                      // Reduce height by 2px for button 4 (far right small box)
                      // Reduce height by 3px for button 5 (bottom button)
                      const heightReductionPx = buttonIndex === 2 ? 2 : (buttonIndex === 3 ? 2 : (buttonIndex === 4 ? 2 : (buttonIndex === 5 ? 3 : 0)))
                      const heightReductionPercent = stageHeightPx > 0 ? (heightReductionPx / stageHeightPx) * 100 : 0
                      const expandedHeight = Math.min(100 - adjustedTop, height + heightPercentAdjust - heightReductionPercent)
                      const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                      
                      const isButton1 = buttonIndex === 1
                      const isSmallButton = buttonIndex === 2 || buttonIndex === 3 || buttonIndex === 4
                      
                      // For button 1, check if 2+ checkboxes are selected to determine disabled state
                      const checkedCount = (page4Checkbox1 ? 1 : 0) + (page4Checkbox2 ? 1 : 0) + (page4Checkbox3 ? 1 : 0)
                      const button1ShouldBeDisabled = isButton1 && checkedCount >= 2
                      const finalIsDisabled = isButton1 ? button1ShouldBeDisabled : isDisabled
                      
                      // Use smaller border radius for small horizontal boxes (buttons 2, 3, 4)
                      // Use slightly larger border radius for button 5 (bottom button)
                      // All scale exactly with image - no min/max constraints
                      const buttonBorderRadiusPx = isSmallButton 
                        ? 26 * stageRelativeScale
                        : (buttonIndex === 5 
                            ? 38 * stageRelativeScale
                            : borderRadiusPx)
                      
                      const expandedButtonStyle = {
                        ...buttonStyle,
                        left: `${adjustedLeft}%`,
                        top: `${adjustedTop}%`,
                        width: `${Math.max(0, expandedWidth)}%`,
                        height: `${Math.max(0, expandedHeight)}%`,
                        backgroundColor: isSmallButton 
                          ? (finalIsDisabled ? 'transparent' : 'rgba(255, 255, 255, 0.95)')
                          : (buttonIndex === 5 
                              ? (finalIsDisabled ? 'transparent' : 'rgba(255, 255, 255, 0.95)')
                              : 'white'),
                        color: '#000',
                        cursor: finalIsDisabled ? 'default' : 'pointer',
                        fontSize: `${buttonFontSize}px`,
                        fontFamily: 'Roboto, sans-serif',
                        fontWeight: 700,
                        borderRadius: `${buttonBorderRadiusPx}px`,
                        border: finalIsDisabled ? '2px solid #f05f40' : '2px solid #0d6efd',
                        display: 'flex',
                        flexDirection: isButton1 ? 'column' : 'row',
                        alignItems: 'center',
                        justifyContent: 'center',
                        textAlign: 'center',
                        zIndex: 11,
                        padding: isButton1 ? `${8 * stageRelativeScale}px` : '0',
                        boxSizing: 'border-box',
                        lineHeight: '1.4',
                        // Allow pointer events on children (checkboxes) even when button is disabled
                        pointerEvents: isButton1 && finalIsDisabled ? 'auto' : undefined
                      }
                      
                      return (
                        <button
                          key={`page4-button-${buttonIndex}`}
                          onClick={(e) => {
                            // Prevent button click if disabled, but allow checkbox clicks to bubble through
                            if (!finalIsDisabled) {
                              onClick()
                            }
                          }}
                          disabled={false}
                          className={`page4-button ${finalIsDisabled ? 'disabled selected' : ''}`}
                          style={expandedButtonStyle}
                        >
                          {isButton1 && (
                            <>
                              <div style={{ marginBottom: `${4 * stageRelativeScale}px` }}>
                                I am wearing safety glasses and<br />will keep them on for the entire Robotics Workshop
                              </div>
                              <div style={{ marginBottom: `${4 * stageRelativeScale}px` }}></div>
                              <div style={{ marginBottom: `${2 * stageRelativeScale}px`, fontWeight: 'normal', position: 'relative', display: 'inline-block', pointerEvents: 'auto' }}>
                                Team member 1:  <span style={{ position: 'relative', display: 'inline-block', marginLeft: `${4 * stageRelativeScale}px`, pointerEvents: 'auto' }}>
                                  <div 
                                    onClick={(e) => {
                                      e.stopPropagation()
                                      e.preventDefault()
                                      setPage4Checkbox1(!page4Checkbox1)
                                    }}
                                    onMouseDown={(e) => {
                                      e.stopPropagation()
                                    }}
                                    style={{
                                      position: 'relative',
                                      width: `${16 * stageRelativeScale}px`,
                                      height: `${16 * stageRelativeScale}px`,
                                      backgroundColor: page4Checkbox1 ? '#f05f40' : 'transparent',
                                      border: `${2 * stageRelativeScale}px solid ${page4Checkbox1 ? '#f05f40' : '#0d6efd'}`,
                                      borderRadius: `${3 * stageRelativeScale}px`,
                                      zIndex: 15,
                                      cursor: 'pointer',
                                      display: 'inline-block',
                                      verticalAlign: 'middle',
                                      pointerEvents: 'auto'
                                    }} 
                                  />
                                </span>
                              </div>
                              <div style={{ marginBottom: `${2 * stageRelativeScale}px`, fontWeight: 'normal', position: 'relative', display: 'inline-block', pointerEvents: 'auto' }}>
                                Team member 2:  <span style={{ position: 'relative', display: 'inline-block', marginLeft: `${4 * stageRelativeScale}px`, pointerEvents: 'auto' }}>
                                  <div 
                                    onClick={(e) => {
                                      e.stopPropagation()
                                      e.preventDefault()
                                      setPage4Checkbox2(!page4Checkbox2)
                                    }}
                                    onMouseDown={(e) => {
                                      e.stopPropagation()
                                    }}
                                    style={{
                                      position: 'relative',
                                      width: `${16 * stageRelativeScale}px`,
                                      height: `${16 * stageRelativeScale}px`,
                                      backgroundColor: page4Checkbox2 ? '#f05f40' : 'transparent',
                                      border: `${2 * stageRelativeScale}px solid ${page4Checkbox2 ? '#f05f40' : '#0d6efd'}`,
                                      borderRadius: `${3 * stageRelativeScale}px`,
                                      zIndex: 15,
                                      cursor: 'pointer',
                                      display: 'inline-block',
                                      verticalAlign: 'middle',
                                      pointerEvents: 'auto'
                                    }} 
                                  />
                                </span>
                              </div>
                              <div style={{ fontWeight: 'normal', position: 'relative', display: 'inline-block', pointerEvents: 'auto' }}>
                                Team member 3:  <span style={{ position: 'relative', display: 'inline-block', marginLeft: `${4 * stageRelativeScale}px`, pointerEvents: 'auto' }}>
                                  <div 
                                    onClick={(e) => {
                                      e.stopPropagation()
                                      e.preventDefault()
                                      setPage4Checkbox3(!page4Checkbox3)
                                    }}
                                    onMouseDown={(e) => {
                                      e.stopPropagation()
                                    }}
                                    style={{
                                      position: 'relative',
                                      width: `${16 * stageRelativeScale}px`,
                                      height: `${16 * stageRelativeScale}px`,
                                      backgroundColor: page4Checkbox3 ? '#f05f40' : 'transparent',
                                      border: `${2 * stageRelativeScale}px solid ${page4Checkbox3 ? '#f05f40' : '#0d6efd'}`,
                                      borderRadius: `${3 * stageRelativeScale}px`,
                                      zIndex: 15,
                                      cursor: 'pointer',
                                      display: 'inline-block',
                                      verticalAlign: 'middle',
                                      pointerEvents: 'auto'
                                    }} 
                                  />
                                </span>
                              </div>
                            </>
                          )}
                        </button>
                      )
                    }
                    
                    return (
                      <>
                        {createButton(button1Left, button1Top, button1Width, button1Height, page4Button1Clicked, handlePage4Button1, 1)}
                        {createButton(button2Left, button2Top, button2Width, button2Height, page4Button2Clicked, handlePage4Button2, 2)}
                        {createButton(button3Left, button3Top, button3Width, button3Height, page4Button3Clicked, handlePage4Button3, 3)}
                        {createButton(button4Left, button4Top, button4Width, button4Height, page4Button4Clicked, handlePage4Button4, 4)}
                        {createButton(button5Left, button5Top, button5Width, button5Height, page4Button5Clicked, handlePage4Button5, 5)}
                      </>
                    )
                  })()}
                  {/* Speech bubble buttons on page 5 (5.png) */}
                  {currentPage === 4 && !editorMode && (() => {
                    // Button 1: Left: 32.64%, Top: 47.41%, Width: 35.84%, Height: 5.87%
                    const button1Left = 32.64
                    const button1Top = 47.41
                    const button1Width = 35.84
                    const button1Height = 5.87
                    const dot1X = 38.59
                    const dot1Y = 53.28
                    const dot2X = 47.06
                    const dot2Y = 53.28
                    const dot3X = 33.05
                    const dot3Y = 57.24
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const isDisabled = page5Button1Clicked
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Adjust dot2: move right 1px (additional, so total 2px right from original)
                    const dot2RightOffsetPx = 2  // Total 2px right (1px from previous + 1px new)
                    const dot2RightOffsetPercent = stageWidthPx > 0 ? (dot2RightOffsetPx / stageWidthPx) * 100 : 0
                    const adjustedDot2X = dot2X + dot2RightOffsetPercent
                    
                    // Adjust dot3: move left 1px (additional to previous left 1px, so total 2px left from original) and down 1px
                    const dot3LeftOffsetPx = 2  // Total 2px left (1px from previous + 1px new)
                    const dot3DownOffsetPx = 1
                    const dot3LeftOffsetPercent = stageWidthPx > 0 ? (dot3LeftOffsetPx / stageWidthPx) * 100 : 0
                    const dot3DownOffsetPercent = stageHeightPx > 0 ? (dot3DownOffsetPx / stageHeightPx) * 100 : 0
                    const adjustedDot3X = dot3X - dot3LeftOffsetPercent
                    const adjustedDot3Y = dot3Y + dot3DownOffsetPercent
                    
                    const heightReductionPx = 3
                    const heightReductionPercent = stageHeightPx > 0 ? (heightReductionPx / stageHeightPx) * 100 : 0
                    
                    // Additional adjustments for box 1: left edge right 2px, right edge left 4px, top edge down 2px, bottom edge up 2px
                    const leftEdgeRightPx = 2
                    const leftEdgeRightPercent = stageWidthPx > 0 ? (leftEdgeRightPx / stageWidthPx) * 100 : 0
                    const rightEdgeLeftPx = 4
                    const rightEdgeLeftPercent = stageWidthPx > 0 ? (rightEdgeLeftPx / stageWidthPx) * 100 : 0
                    const topEdgeDownPx = 2
                    const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                    const bottomEdgeUpPx = 2
                    const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, button1Left - leftOffsetAdjust + leftEdgeRightPercent)
                    const adjustedTop = Math.max(0, button1Top - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, button1Width + widthPercentAdjust - rightEdgeLeftPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, button1Height + heightPercentAdjust - heightReductionPercent - bottomEdgeUpPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                    // Dot3 is BELOW the box (57.24% > 53.28%), so triangle points downward
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = adjustedDot2X
                    const triangleBaseY = adjustedTop + expandedHeight
                    const triangleTipX = adjustedDot3X
                    const triangleTipY = adjustedDot3Y
                    
                    const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isDisabled ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isDisabled ? 'disabled selected' : ''}`}
                          onClick={!isDisabled ? handlePage5Button1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isDisabled ? 'none' : 'auto',
                            cursor: isDisabled ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isDisabled ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                          <span style={{ color: isDisabled ? '#000' : 'rgba(0, 0, 0, 0.05)', lineHeight: '1.3', display: 'block', fontWeight: 'normal' }}>
                          </span>
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isDisabled ? 'transparent' : 'rgba(255, 255, 255, 0.95)'}
                            style={{ fill: isDisabled ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          <path
                            d={`M ${triangleBaseLeftWrapper},${bottomY} L ${triangleBaseRightWrapper},${bottomY}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Second speech bubble button on page 5 (5.png) */}
                  {currentPage === 4 && !editorMode && (() => {
                    // Button 2: Left: 32.64%, Top: 84.81%, Width: 35.84%, Height: 5.87%
                    const button2Left = 32.64
                    const button2Top = 84.81
                    const button2Width = 35.84
                    const button2Height = 5.87
                    const dot1X = 38.14
                    const dot1Y = 84.81
                    const dot2X = 46.39
                    const dot2Y = 84.81
                    const dot3X = 31.04
                    const dot3Y = 82.40
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const isDisabled = page5Button2Clicked
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Adjust dot1: move right 3px
                    const dot1RightOffsetPx = 3
                    const dot1RightOffsetPercent = stageWidthPx > 0 ? (dot1RightOffsetPx / stageWidthPx) * 100 : 0
                    const adjustedDot1X = dot1X + dot1RightOffsetPercent
                    
                    // Adjust dot3: move left 1px and up 1px
                    const dot3LeftOffsetPx = 1
                    const dot3UpOffsetPx = 1
                    const dot3LeftOffsetPercent = stageWidthPx > 0 ? (dot3LeftOffsetPx / stageWidthPx) * 100 : 0
                    const dot3UpOffsetPercent = stageHeightPx > 0 ? (dot3UpOffsetPx / stageHeightPx) * 100 : 0
                    const adjustedDot3X = dot3X - dot3LeftOffsetPercent
                    const adjustedDot3Y = dot3Y - dot3UpOffsetPercent
                    
                    const heightReductionPx = 3
                    const heightReductionPercent = stageHeightPx > 0 ? (heightReductionPx / stageHeightPx) * 100 : 0
                    
                    // Additional adjustments for box 2: top edge down 2px, left and right edges inwards 2px, bottom edge up 1px, right edge left 2px more
                    const topEdgeDownPx = 2
                    const topEdgeDownPercent = stageHeightPx > 0 ? (topEdgeDownPx / stageHeightPx) * 100 : 0
                    const leftEdgeInwardPx = 2
                    const leftEdgeInwardPercent = stageWidthPx > 0 ? (leftEdgeInwardPx / stageWidthPx) * 100 : 0
                    const rightEdgeInwardPx = 4
                    const rightEdgeInwardPercent = stageWidthPx > 0 ? (rightEdgeInwardPx / stageWidthPx) * 100 : 0
                    const bottomEdgeUpPx = 1
                    const bottomEdgeUpPercent = stageHeightPx > 0 ? (bottomEdgeUpPx / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, button2Left - leftOffsetAdjust + leftEdgeInwardPercent)
                    const adjustedTop = Math.max(0, button2Top - topOffsetAdjust + topEdgeDownPercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, button2Width + widthPercentAdjust - rightEdgeInwardPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, button2Height + heightPercentAdjust - heightReductionPercent - bottomEdgeUpPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                    // Dot3 is ABOVE the box (82.40% < 84.81%), so triangle points upward
                    const triangleBaseLeft = adjustedDot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = button2Top
                    const triangleTipX = adjustedDot3X
                    const triangleTipY = adjustedDot3Y
                    
                    const borderRadiusPx = Math.min(10, Math.max(4, 10 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isDisabled ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isDisabled ? 'disabled selected' : ''}`}
                          onClick={!isDisabled ? handlePage5Button2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isDisabled ? 'none' : 'auto',
                            cursor: isDisabled ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isDisabled ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                          <span style={{ color: isDisabled ? '#000' : 'rgba(0, 0, 0, 0.05)', lineHeight: '1.3', display: 'block', fontWeight: 'normal' }}>
                          </span>
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isDisabled ? 'transparent' : 'rgba(255, 255, 255, 0.95)'}
                            style={{ fill: isDisabled ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#3bbf6b" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          <path
                            d={`M ${triangleBaseLeftWrapper},${topY} L ${triangleBaseRightWrapper},${topY}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Red edge red infill dot on page 5 (5.png) - appears when button 1 is selected, not active */}
                  {currentPage === 4 && !editorMode && page5Button1Clicked && (() => {
                    const dotX = 18.55
                    const dotY = 66.89
                    const dotSizePx = 7
                    const dotSizeWidthPercent = stageWidthPx > 0 ? (dotSizePx / stageWidthPx) * 100 : 0
                    const dotSizeHeightPercent = stageHeightPx > 0 ? (dotSizePx / stageHeightPx) * 100 : 0
                    
                    // Center the dot on the specified coordinates
                    const dotLeft = dotX - (dotSizeWidthPercent / 2)
                    const dotTop = dotY - (dotSizeHeightPercent / 2)
                    
                    const dotStyle = getButtonStyle(dotLeft, dotTop, dotSizeWidthPercent, dotSizeHeightPercent)
                    
                    return (
                      <div
                        style={{
                          ...dotStyle,
                          backgroundColor: '#dd1712',
                          border: '1px solid #dd1712',
                          borderRadius: '50%',
                          pointerEvents: 'none',
                          zIndex: 12
                        }}
                      />
                    )
                  })()}
                  {/* White dot with blue edge on page 5 (5.png) - hidden until button is selected */}
                  {currentPage === 4 && !editorMode && page5Button1Clicked && (() => {
                    const dotX = 18.55
                    const dotY = 63.62
                    const dotSizePx = 7
                    const dotSizeWidthPercent = stageWidthPx > 0 ? (dotSizePx / stageWidthPx) * 100 : 0
                    const dotSizeHeightPercent = stageHeightPx > 0 ? (dotSizePx / stageHeightPx) * 100 : 0
                    
                    // Center the dot on the specified coordinates
                    const dotLeft = dotX - (dotSizeWidthPercent / 2)
                    const dotTop = dotY - (dotSizeHeightPercent / 2)
                    
                    const dotStyle = getButtonStyle(dotLeft, dotTop, dotSizeWidthPercent, dotSizeHeightPercent)
                    
                    return (
                      <div
                        onClick={!page5BlueDotSelected ? handlePage5BlueDot : undefined}
                        style={{
                          ...dotStyle,
                          backgroundColor: page5BlueDotSelected ? '#dd1712' : 'white',
                          border: page5BlueDotSelected ? '1px solid #dd1712' : '1px solid #0d6efd',
                          borderRadius: '50%',
                          pointerEvents: page5BlueDotSelected ? 'none' : 'auto',
                          cursor: page5BlueDotSelected ? 'default' : 'pointer',
                          zIndex: 12
                        }}
                      />
                    )
                  })()}
                  {/* Green edge green infill dot on page 5 (5.png) - appears when button 2 is selected, not active */}
                  {currentPage === 4 && !editorMode && page5Button2Clicked && (() => {
                    const dotX = 15.88
                    const dotY = 78.44
                    const dotSizePx = 7
                    const dotSizeWidthPercent = stageWidthPx > 0 ? (dotSizePx / stageWidthPx) * 100 : 0
                    const dotSizeHeightPercent = stageHeightPx > 0 ? (dotSizePx / stageHeightPx) * 100 : 0
                    
                    // Center the dot on the specified coordinates
                    const dotLeft = dotX - (dotSizeWidthPercent / 2)
                    const dotTop = dotY - (dotSizeHeightPercent / 2)
                    
                    const dotStyle = getButtonStyle(dotLeft, dotTop, dotSizeWidthPercent, dotSizeHeightPercent)
                    
                    return (
                      <div
                        style={{
                          ...dotStyle,
                          backgroundColor: '#3bbf6b',
                          border: '1px solid #3bbf6b',
                          borderRadius: '50%',
                          pointerEvents: 'none',
                          zIndex: 12
                        }}
                      />
                    )
                  })()}
                  {/* Blue edge white infill dot that connects to green dot on page 5 (5.png) - hidden until button is selected, inactive until green dot is displayed */}
                  {currentPage === 4 && !editorMode && page5Button1Clicked && (() => {
                    const dotX = 44.46
                    const dotY = 78.39
                    const dotSizePx = 7
                    const dotSizeWidthPercent = stageWidthPx > 0 ? (dotSizePx / stageWidthPx) * 100 : 0
                    const dotSizeHeightPercent = stageHeightPx > 0 ? (dotSizePx / stageHeightPx) * 100 : 0
                    
                    // Center the dot on the specified coordinates
                    const dotLeft = dotX - (dotSizeWidthPercent / 2)
                    const dotTop = dotY - (dotSizeHeightPercent / 2)
                    
                    const dotStyle = getButtonStyle(dotLeft, dotTop, dotSizeWidthPercent, dotSizeHeightPercent)
                    
                    return (
                      <div
                        onClick={!page5GreenDotSelected && page5Button2Clicked ? handlePage5GreenDot : undefined}
                        style={{
                          ...dotStyle,
                          backgroundColor: page5GreenDotSelected ? '#3bbf6b' : 'white',
                          border: page5GreenDotSelected ? '1px solid #3bbf6b' : '1px solid #0d6efd',
                          borderRadius: '50%',
                          pointerEvents: page5GreenDotSelected ? 'none' : (page5Button2Clicked ? 'auto' : 'none'),
                          cursor: page5GreenDotSelected ? 'default' : (page5Button2Clicked ? 'pointer' : 'default'),
                          opacity: 1,
                          zIndex: 12
                        }}
                      />
                    )
                  })()}
                  {/* Dummy blue edge white infill dots on page 5 (5.png) - hidden until button is selected */}
                  {currentPage === 4 && !editorMode && page5Button1Clicked && (() => {
                    const dots = [
                      { x: 24.09, y: 68.11 },
                      { x: 32.43, y: 64.80 },
                      { x: 78.39, y: 63.75 },
                      { x: 12.15, y: 59.58 },
                      { x: 22.96, y: 60.45 },
                      { x: 84.02, y: 59.58 },
                      { x: 54.06, y: 79.42 },
                      { x: 18.59, y: 73.22 },
                      { x: 11.90, y: 72.18 },
                      { x: 89.30, y: 73.22 }
                    ]
                    const dotSizePx = 7
                    const dotSizeWidthPercent = stageWidthPx > 0 ? (dotSizePx / stageWidthPx) * 100 : 0
                    const dotSizeHeightPercent = stageHeightPx > 0 ? (dotSizePx / stageHeightPx) * 100 : 0
                    // Move dot #1 up by 6px (2px + 4px additional)
                    const moveUp6pxPercent = stageHeightPx > 0 ? (6 / stageHeightPx) * 100 : 0
                    
                    return dots.map((dot, index) => {
                      // Apply 6px upward adjustment to dot #1 (index 0)
                      const adjustedY = index === 0 ? dot.y - moveUp6pxPercent : dot.y
                      const dotLeft = dot.x - (dotSizeWidthPercent / 2)
                      const dotTop = adjustedY - (dotSizeHeightPercent / 2)
                      const dotStyle = getButtonStyle(dotLeft, dotTop, dotSizeWidthPercent, dotSizeHeightPercent)
                      
                      return (
                        <div
                          key={`dummy-dot-${index}`}
                          style={{
                            ...dotStyle,
                            backgroundColor: 'white',
                            border: '1px solid #0d6efd',
                            borderRadius: '50%',
                            pointerEvents: 'none',
                            zIndex: 12
                          }}
                        />
                      )
                    })
                  })()}
                  {/* Red line connecting red dot to selected blue edge dot on page 5 */}
                  {/* Red edge red infill box on page 5 (5.png) - appears when blue edge dot is selected */}
                  {currentPage === 4 && !editorMode && page5BlueDotSelected && (() => {
                    const boxLeft = 17.25
                    const boxTop = 64.13
                    const boxWidth = 2.00
                    const boxHeight = 3.55
                    
                    // Move box to the right by 4.25px (4.5px - 0.25px left = 4.25px)
                    const moveRightPx = 4.25
                    const moveRightPercent = stageWidthPx > 0 ? (moveRightPx / stageWidthPx) * 100 : 0
                    const adjustedBoxLeft = boxLeft + moveRightPercent
                    
                    // Move box up by 4px (6px - 2px down = 4px)
                    const moveUpPx = 4
                    const moveUpPercent = stageHeightPx > 0 ? (moveUpPx / stageHeightPx) * 100 : 0
                    const adjustedBoxTop = boxTop - moveUpPercent
                    
                    // Reduce width by 6px (2px + 4px more)
                    const widthReducePx = 6
                    const widthReducePercent = stageWidthPx > 0 ? (widthReducePx / stageWidthPx) * 100 : 0
                    const adjustedBoxWidth = Math.max(0, boxWidth - widthReducePercent)
                    
                    return (
                      <div
                        style={{
                          ...getButtonStyle(adjustedBoxLeft, adjustedBoxTop, adjustedBoxWidth, boxHeight),
                          backgroundColor: '#dd1712',
                          border: '1px solid #dd1712',
                          pointerEvents: 'none',
                          zIndex: 12
                        }}
                      />
                    )
                  })()}
                  {/* Green edge green infill box on page 5 (5.png) - appears when green active box is selected */}
                  {currentPage === 4 && !editorMode && page5GreenDotSelected && (() => {
                    const boxLeft = 13.91
                    const boxTop = 78.11
                    const boxWidth = 29.29
                    
                    // Move box to the right by 10px (8px + 2px = 10px)
                    const moveRightPx = 10
                    const moveRightPercent = stageWidthPx > 0 ? (moveRightPx / stageWidthPx) * 100 : 0
                    const adjustedBoxLeft = boxLeft + moveRightPercent
                    
                    // Reduce width by 5px
                    const widthReducePx = 5
                    const widthReducePercent = stageWidthPx > 0 ? (widthReducePx / stageWidthPx) * 100 : 0
                    const adjustedBoxWidth = Math.max(0, boxWidth - widthReducePercent)
                    
                    // Make height the same as the width of the red edge red infill box
                    // Red box width: 2.00% reduced by 6px
                    const redBoxWidth = 2.00
                    const redBoxWidthReducePx = 6
                    const redBoxWidthReducePercent = stageWidthPx > 0 ? (redBoxWidthReducePx / stageWidthPx) * 100 : 0
                    const adjustedBoxHeight = Math.max(0, redBoxWidth - redBoxWidthReducePercent)
                    
                    return (
                      <div
                        style={{
                          ...getButtonStyle(adjustedBoxLeft, boxTop, adjustedBoxWidth, adjustedBoxHeight),
                          backgroundColor: '#3bbf6b',
                          border: '1px solid #3bbf6b',
                          pointerEvents: 'none',
                          zIndex: 12
                        }}
                      />
                    )
                  })()}
                  {/* White box on page 5 (5.png) - visible when user first lands on page, hides when red active button is selected */}
                  {currentPage === 4 && !editorMode && !page5BlueDotSelected && (() => {
                    const whiteBoxStyle = getButtonStyle(27.73, 81.71, 45.65, 14.83)
                    return (
                      <div
                        style={{
                          ...whiteBoxStyle,
                          left: '27.73%',
                          top: '81.71%',
                          width: '45.65%',
                          height: '14.83%',
                          backgroundColor: 'white',
                          pointerEvents: 'none',
                          border: 'none',
                          zIndex: 5000
                        }}
                      />
                    )
                  })()}
                  {/* White box on page 5 - covers Show Connections button until box 1 is selected */}
                  {currentPage === 4 && !editorMode && !page5Button1Clicked && (
                    <div
                      style={{
                        ...getButtonStyle(34.14, 93.70, 32.17, 6.30),
                        backgroundColor: 'white',
                        border: 'none',
                        pointerEvents: 'none',
                        zIndex: 9000
                      }}
                    />
                  )}
                  {/* "Show Connections" button on page 5 (5.png) - visible only after box 1 is selected */}
                  {currentPage === 4 && !editorMode && page5Button1Clicked && (() => {
                        const boxWidth = 18
                        const boxHeight = 3
                        const isSelected = false // Button is never "selected", it's always clickable
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Add 27px on each side (54px total width increase)
                        const widthExpansionPx = 54
                        const widthExpansionPercent = imageNaturalSize.width > 0 ? (widthExpansionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Reduce height by lowering top edge 7px
                        const heightReductionPx = 7
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (heightReductionPx / imageNaturalSize.height) * 100 : 0
                        
                        // Position button centered horizontally at bottom, 24px up from bottom
                        const bottomOffsetPx = 24
                        const bottomOffsetPercent = imageNaturalSize.height > 0 ? (bottomOffsetPx / imageNaturalSize.height) * 100 : 0
                        
                        // Center horizontally
                        const expandedWidth = boxWidth + widthPercentAdjust + widthExpansionPercent
                        const adjustedLeft = (100 - expandedWidth) / 2
                        
                        // Position from bottom: 100% - boxHeight - bottomOffset
                        const expandedHeight = boxHeight + heightPercentAdjust - heightReductionPercent
                        const adjustedTop = 100 - expandedHeight - bottomOffsetPercent
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        const borderRadiusPx = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        // Rounded corners on top, sharp corners on bottom
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY}
                          L ${topRight},${bottomY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight},${bottomY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft},${bottomY}
                          L ${topRight},${bottomY}
                        `
                        
                        // Determine stroke color and width for box
                        const strokeColor = "#0d6efd"
                        const strokeWidth = "1"
                        // Always show "Show Connections" text for page 5
                        const showHelpText = true
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={{
                              ...buttonStyle, 
                              zIndex: 9999,
                              boxShadow: '0 2px 6px rgba(0, 0, 0, 0.08), 0 0 4px rgba(13, 110, 253, 0.3)',
                              borderRadius: `${borderRadiusPx}px ${borderRadiusPx}px 0 0`
                            }}
                          >
                            <div
                              className="speech-bubble-box"
                              onClick={handlePage5NeedHelp}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'auto',
                                cursor: 'pointer',
                                zIndex: 10000,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: showHelpText ? '#000' : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontStyle: showHelpText ? 'italic' : 'normal',
                                fontWeight: showHelpText ? '300' : 'normal',
                                textAlign: 'center',
                                padding: '2px 4px',
                                boxSizing: 'border-box',
                                userSelect: 'auto',
                                WebkitUserSelect: 'auto',
                                opacity: showHelpText ? 1 : 0
                              }}
                            >
                              {showHelpText && (page5ShowHelpImage ? 'Hide Connections' : 'Show Connections')}
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 9998
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill={showHelpText ? "#ffffff" : "transparent"}
                                style={{ fill: showHelpText ? '#ffffff' : 'transparent' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                  })()}
                  {/* Speech bubble buttons on page 6 (6.png) */}
                  {currentPage === 5 && !editorMode && (() => {
                    // Button 1: Left: 20.62%, Top: 58.98%, Width: 26.53%, Height: 4.38%
                    const button1Left = 20.62
                    const button1Top = 58.98
                    const button1Width = 26.53
                    const button1Height = 4.38
                    const dot1X = 23.88
                    const dot1Y = 63.36
                    const dot2X = 30.95
                    const dot2Y = 63.36
                    const dot3X = 17.10
                    const dot3Y = 65.76
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const isDisabled = page6Button1Clicked
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Additional adjustments: width in 1px each side, bottom up 2px, top down 1px
                    const widthReductionPx = 2  // 1px from each side
                    const widthReductionPercent = stageWidthPx > 0 ? (widthReductionPx / stageWidthPx) * 100 : 0
                    const leftIncreasePx = 1  // Move left edge right by 1px
                    const leftIncreasePercent = stageWidthPx > 0 ? (leftIncreasePx / stageWidthPx) * 100 : 0
                    const topIncreasePx = 1  // Move top down by 1px
                    const topIncreasePercent = stageHeightPx > 0 ? (topIncreasePx / stageHeightPx) * 100 : 0
                    const heightReductionPx = 3  // Move bottom up by 3px (2px + 1px)
                    const heightReductionPercent = stageHeightPx > 0 ? (heightReductionPx / stageHeightPx) * 100 : 0
                    
                    // Move dot1 to the right by 3px (2px + 1px)
                    const dot1RightOffsetPx = 3
                    const dot1RightOffsetPercent = stageWidthPx > 0 ? (dot1RightOffsetPx / stageWidthPx) * 100 : 0
                    const adjustedDot1X = dot1X + dot1RightOffsetPercent
                    
                    const adjustedLeft = Math.max(0, button1Left - leftOffsetAdjust + leftIncreasePercent)
                    const adjustedTop = Math.max(0, button1Top - topOffsetAdjust + topIncreasePercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, button1Width + widthPercentAdjust - widthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, button1Height + heightPercentAdjust - heightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                    // Dot3 is BELOW the box (65.76% > 63.36%), so triangle points downward
                    const triangleBaseLeft = adjustedDot1X
                    const triangleBaseRight = dot2X
                    const triangleBaseY = adjustedTop + expandedHeight
                    const triangleTipX = dot3X
                    const triangleTipY = dot3Y
                    
                    const borderRadiusPx = Math.min(12, Math.max(5, 12 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                      L ${topLeft},${bottomY - borderRadiusWrapperY}
                      Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${bottomY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                      Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                      L ${topRight},${topY + borderRadiusWrapperY}
                      Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    const topBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${topY}
                      L ${topRight - borderRadiusWrapperX},${topY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isDisabled ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isDisabled ? 'disabled selected' : ''}`}
                          onClick={!isDisabled ? handlePage6Button1 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isDisabled ? 'none' : 'auto',
                            cursor: isDisabled ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isDisabled ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isDisabled ? 'transparent' : 'rgba(255, 255, 255, 0.95)'}
                            style={{ fill: isDisabled ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isDisabled ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isDisabled ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={topBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          <path
                            d={`M ${triangleBaseLeftWrapper},${bottomY} L ${triangleBaseRightWrapper},${bottomY}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Second speech bubble button on page 6 (6.png) */}
                  {currentPage === 5 && !editorMode && (() => {
                    // Button 2: Left: 19.29%, Top: 76.21%, Width: 29.21%, Height: 9.21%
                    const button2Left = 19.29
                    const button2Top = 76.21
                    const button2Width = 29.21
                    const button2Height = 9.21
                    const dot1X = 24.09
                    const dot1Y = 76.21
                    const dot2X = 31.00
                    const dot2Y = 76.21
                    const dot3X = 16.88
                    const dot3Y = 67.83
                    
                    const pixelIncrease = 3
                    const halfPixelIncrease = pixelIncrease / 2
                    const isDisabled = page6Button2Clicked
                    const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                    const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                    const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                    const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                    const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                    
                    // Additional adjustments: left and right edges in 1px each, top down 2px, bottom up 1px
                    const widthReductionPx = 2  // 1px from each side
                    const widthReductionPercent = stageWidthPx > 0 ? (widthReductionPx / stageWidthPx) * 100 : 0
                    const leftIncreasePx = 1  // Move left edge right by 1px
                    const leftIncreasePercent = stageWidthPx > 0 ? (leftIncreasePx / stageWidthPx) * 100 : 0
                    const topIncreasePx = 2  // Move top down by 2px
                    const topIncreasePercent = stageHeightPx > 0 ? (topIncreasePx / stageHeightPx) * 100 : 0
                    const heightReductionPx = 3  // Move bottom up by 3px (1px + 2px)
                    const heightReductionPercent = stageHeightPx > 0 ? (heightReductionPx / stageHeightPx) * 100 : 0
                    
                    const adjustedLeft = Math.max(0, button2Left - leftOffsetAdjust + leftIncreasePercent)
                    const adjustedTop = Math.max(0, button2Top - topOffsetAdjust + topIncreasePercent)
                    const expandedWidth = Math.min(100 - adjustedLeft, button2Width + widthPercentAdjust - widthReductionPercent)
                    const expandedHeight = Math.min(100 - adjustedTop, button2Height + heightPercentAdjust - heightReductionPercent)
                    const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                    
                    // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                    // Dot3 is ABOVE the box (67.83% < 76.21%), so triangle points upward
                    // Move dot3 up 1px and left 1px
                    const dot3LeftOffsetPx = 1
                    const dot3UpOffsetPx = 1
                    const dot3LeftOffsetPercent = stageWidthPx > 0 ? (dot3LeftOffsetPx / stageWidthPx) * 100 : 0
                    const dot3UpOffsetPercent = stageHeightPx > 0 ? (dot3UpOffsetPx / stageHeightPx) * 100 : 0
                    const adjustedDot3X = dot3X - dot3LeftOffsetPercent
                    const adjustedDot3Y = dot3Y - dot3UpOffsetPercent
                    
                    // Move dot2 to the right by 1px
                    const dot2RightOffsetPx = 1
                    const dot2RightOffsetPercent = stageWidthPx > 0 ? (dot2RightOffsetPx / stageWidthPx) * 100 : 0
                    const adjustedDot2X = dot2X + dot2RightOffsetPercent
                    
                    const triangleBaseLeft = dot1X
                    const triangleBaseRight = adjustedDot2X
                    const triangleBaseY = button2Top
                    const triangleTipX = adjustedDot3X
                    const triangleTipY = adjustedDot3Y
                    
                    const borderRadiusPx = Math.min(20, Math.max(10, 20 * stageRelativeScale))
                    const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                    const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                    const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                    const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                    
                    const topLeft = 0
                    const topRight = 100
                    const topY = 0
                    const bottomY = 100
                    
                    const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                    const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                    const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                    const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                    
                    const speechBubblePath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                      L ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                      Z
                    `
                    
                    const leftBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                      L ${topLeft},${topY + borderRadiusWrapperY}
                      Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                      ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                    `
                    
                    const triangleLeftLegPath = `
                      M ${triangleBaseLeftWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    const triangleRightLegPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      L ${triangleTipXWrapper},${triangleTipYWrapper}
                    `
                    
                    const rightBorderPath = `
                      M ${triangleBaseRightWrapper},${topY}
                      ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                      Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                      L ${topRight},${bottomY - borderRadiusWrapperY}
                      Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    const bottomBorderPath = `
                      M ${topLeft + borderRadiusWrapperX},${bottomY}
                      L ${topRight - borderRadiusWrapperX},${bottomY}
                    `
                    
                    return (
                      <div 
                        className={`speech-bubble-wrapper ${isDisabled ? 'has-selected' : ''}`}
                        style={buttonStyle}
                      >
                        <div
                          className={`speech-bubble-box ${isDisabled ? 'disabled selected' : ''}`}
                          onClick={!isDisabled ? handlePage6Button2 : undefined}
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: isDisabled ? 'none' : 'auto',
                            cursor: isDisabled ? 'default' : 'pointer',
                            zIndex: 11,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            color: isDisabled ? '#000' : 'rgba(0, 0, 0, 0.05)',
                            fontSize: `${bubbleFontSize}px`,
                            fontFamily: 'Roboto, sans-serif',
                            textAlign: 'center',
                            padding: '4px 8px',
                            boxSizing: 'border-box'
                          }}
                        >
                        </div>
                        <svg
                          className="speech-bubble-svg"
                          style={{
                            position: 'absolute',
                            left: 0,
                            top: 0,
                            width: '100%',
                            height: '100%',
                            pointerEvents: 'none',
                            overflow: 'visible',
                            zIndex: 10
                          }}
                          viewBox="0 0 100 100"
                          preserveAspectRatio="none"
                        >
                          <defs>
                          </defs>
                          <path
                            d={speechBubblePath}
                            fill={isDisabled ? 'transparent' : 'rgba(255, 255, 255, 0.95)'}
                            style={{ fill: isDisabled ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                          />
                          <g className="speech-bubble-border-group">
                            <path
                              d={leftBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleLeftLegPath}
                              fill="none"
                              stroke={isDisabled ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={triangleRightLegPath}
                              fill="none"
                              stroke={isDisabled ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={rightBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                            <path
                              d={bottomBorderPath}
                              fill="none"
                              stroke={isDisabled ? "#ff8c00" : "#0d6efd"}
                              strokeWidth={isDisabled ? "2" : "1"}
                              className="speech-bubble-border"
                              vectorEffect="non-scaling-stroke"
                            />
                          </g>
                          <path
                            d={`M ${triangleBaseLeftWrapper},${topY} L ${triangleBaseRightWrapper},${topY}`}
                            fill="none"
                            stroke="transparent"
                            strokeWidth="0.3"
                            vectorEffect="non-scaling-stroke"
                          />
                        </svg>
                      </div>
                    )
                  })()}
                  {/* Page 7 boxes with blue edges and dots */}
                  {currentPage === 6 && !editorMode && (
                    <>
                      {/* Box 1 - triangle points downward */}
                      {(() => {
                        const boxLeft = 46.53
                        const boxTop = 39.13
                        const boxWidth = 29.46
                        const boxHeight = 5.95
                        const dot1X = 50.47
                        const dot1Y = 45.08
                        const dot2X = 58.80
                        const dot2Y = 45.08
                        const dot3X = 45.94
                        const dot3Y = 46.69
                        // Box 1 is selected if it's clicked OR if box 4 is selected (showing 7.1.png)
                        const isSelected = page7Box1Selected || page7Box4Selected
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Move box 1 top edge down by 5px
                        const topDownOffsetPx = 5
                        const topDownOffsetPercent = imageNaturalSize.height > 0 ? (topDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        
                        // Move box 1 bottom edge up by 9px (reduce height: 8px + 1px)
                        const heightReductionPx = 9
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (heightReductionPx / imageNaturalSize.height) * 100 : 0
                        
                        // Move box 1 left edge right by 4px and right edge left by 3px (reduce width)
                        const leftEdgeRightPx = 4
                        const rightEdgeLeftPx = 3
                        const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                        const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                        const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topDownOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Move dot 1 to the right by 9px (8px + 1px)
                        const dot1RightOffsetPx = 9
                        const dot1RightOffsetPercent = imageNaturalSize.width > 0 ? (dot1RightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const adjustedDot1X = dot1X + dot1RightOffsetPercent
                        
                        // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                        const triangleBaseLeft = adjustedDot1X
                        const triangleBaseRight = dot2X
                        const triangleBaseY = adjustedTop + expandedHeight
                        const triangleTipX = dot3X
                        const triangleTipY = dot3Y
                        
                        const borderRadiusPx = Math.min(15, Math.max(6, 15 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                        const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                        const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                        const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                        
                        const speechBubblePath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                          L ${triangleTipXWrapper},${triangleTipYWrapper}
                          L ${triangleBaseRightWrapper},${bottomY}
                          ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                        `
                        
                        const triangleLeftLegPath = `
                          M ${triangleBaseLeftWrapper},${bottomY}
                          L ${triangleTipXWrapper},${triangleTipYWrapper}
                        `
                        const triangleRightLegPath = `
                          M ${triangleBaseRightWrapper},${bottomY}
                          L ${triangleTipXWrapper},${triangleTipYWrapper}
                        `
                        
                        const rightBorderPath = `
                          M ${triangleBaseRightWrapper},${bottomY}
                          ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        return (
                          <div 
                            className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                            style={buttonStyle}
                          >
                            <div
                              className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                              onClick={!isSelected ? handlePage7Box1 : undefined}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: isSelected ? 'none' : 'auto',
                                cursor: isSelected ? 'default' : 'pointer',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${bubbleFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                textAlign: 'center',
                                padding: '4px 8px',
                                boxSizing: 'border-box',
                                userSelect: page7Box4Selected ? 'none' : 'auto',
                                WebkitUserSelect: page7Box4Selected ? 'none' : 'auto'
                              }}
                            >
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={speechBubblePath}
                                fill={isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)'}
                                style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={triangleLeftLegPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={triangleRightLegPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                              <path
                                d={`M ${triangleBaseLeftWrapper},${bottomY} L ${triangleBaseRightWrapper},${bottomY}`}
                                fill="none"
                                stroke="transparent"
                                strokeWidth="0.3"
                                vectorEffect="non-scaling-stroke"
                              />
                            </svg>
                          </div>
                        )
                      })()}
                      {/* Box 2 - triangle points downward */}
                      {(() => {
                        const boxLeft = 51.94
                        const boxTop = 54.45
                        const boxWidth = 25.18
                        const boxHeight = 7.51
                        const dot1X = 56.29
                        const dot1Y = 61.96
                        const dot2X = 62.09
                        const dot2Y = 61.96
                        const dot3X = 51.13
                        const dot3Y = 64.45
                        // Box 2 is selected if it's clicked OR if box 4 is selected (showing 7.1.png)
                        const isSelected = page7Box2Selected || page7Box4Selected
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Move box 2 top edge down by 4px (reduce height)
                        const topDownOffsetPx = 4
                        const topDownOffsetPercent = imageNaturalSize.height > 0 ? (topDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        // Move box 2 bottom edge up by 8px (reduce height)
                        const heightReductionPx = 8
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (heightReductionPx / imageNaturalSize.height) * 100 : 0
                        
                        // Move box 2 left edge to the right by 5px and right edge to the left by 4px (reduce width)
                        const leftEdgeRightPx = 5
                        const rightEdgeLeftPx = 4
                        const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                        const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                        const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topDownOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Move dot 1 to the right by 2px
                        const dot1RightOffsetPx = 2
                        const dot1RightOffsetPercent = imageNaturalSize.width > 0 ? (dot1RightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const adjustedDot1X = dot1X + dot1RightOffsetPercent
                        
                        // Calculate triangle - it extends DOWNWARD from the bottom edge (between dot1 and dot2) to dot3
                        const triangleBaseLeft = adjustedDot1X
                        const triangleBaseRight = dot2X
                        const triangleBaseY = adjustedTop + expandedHeight
                        const triangleTipX = dot3X
                        const triangleTipY = dot3Y
                        
                        const borderRadiusPx = Math.min(15, Math.max(6, 15 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                        const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                        const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                        const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                        
                        const speechBubblePath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                          L ${triangleTipXWrapper},${triangleTipYWrapper}
                          L ${triangleBaseRightWrapper},${bottomY}
                          ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${bottomY}` : ''}
                        `
                        
                        const triangleLeftLegPath = `
                          M ${triangleBaseLeftWrapper},${bottomY}
                          L ${triangleTipXWrapper},${triangleTipYWrapper}
                        `
                        const triangleRightLegPath = `
                          M ${triangleBaseRightWrapper},${bottomY}
                          L ${triangleTipXWrapper},${triangleTipYWrapper}
                        `
                        
                        const rightBorderPath = `
                          M ${triangleBaseRightWrapper},${bottomY}
                          ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${bottomY}` : ''}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        return (
                          <div 
                            className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                            style={buttonStyle}
                          >
                            <div
                              className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                              onClick={!isSelected ? handlePage7Box2 : undefined}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: isSelected ? 'none' : 'auto',
                                cursor: isSelected ? 'default' : 'pointer',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${bubbleFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                textAlign: 'center',
                                padding: '4px 8px',
                                boxSizing: 'border-box',
                                userSelect: page7Box4Selected ? 'none' : 'auto',
                                WebkitUserSelect: page7Box4Selected ? 'none' : 'auto'
                              }}
                            >
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={speechBubblePath}
                                fill={isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)'}
                                style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={triangleLeftLegPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={triangleRightLegPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                              <path
                                d={`M ${triangleBaseLeftWrapper},${bottomY} L ${triangleBaseRightWrapper},${bottomY}`}
                                fill="none"
                                stroke="transparent"
                                strokeWidth="0.3"
                                vectorEffect="non-scaling-stroke"
                              />
                            </svg>
                          </div>
                        )
                      })()}
                      {/* Box 3 - triangle points upward */}
                      {(() => {
                        const boxLeft = 12.74
                        const boxTop = 69.77
                        const boxWidth = 47.26
                        const boxHeight = 5.25
                        const dot1X = 21.85
                        const dot1Y = 69.77
                        const dot2X = 32.44
                        const dot2Y = 69.77
                        const dot3X = 35.81
                        const dot3Y = 67.06
                        // Box 3 is selected if it's clicked OR if box 4 is selected (showing 7.1.png)
                        const isSelected = page7Box3Selected || page7Box4Selected
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const bubbleFontSize = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Move box 3 top edge down by 3px (reduce height)
                        const topDownOffsetPx = 3
                        const topDownOffsetPercent = imageNaturalSize.height > 0 ? (topDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        // Move box 3 bottom edge up by 4px (reduce height)
                        const heightReductionPx = 7  // 3px from top + 4px from bottom
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (heightReductionPx / imageNaturalSize.height) * 100 : 0
                        
                        // Move box 3 left edge to the right by 3px and right edge to the left by 5px (reduce width)
                        const leftEdgeRightPx = 3
                        const rightEdgeLeftPx = 5
                        const leftEdgeRightPercent = imageNaturalSize.width > 0 ? (leftEdgeRightPx / imageNaturalSize.width) * 100 : 0
                        const rightEdgeLeftPercent = imageNaturalSize.width > 0 ? (rightEdgeLeftPx / imageNaturalSize.width) * 100 : 0
                        const totalWidthReductionPercent = leftEdgeRightPercent + rightEdgeLeftPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + leftEdgeRightPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + topDownOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - totalWidthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Calculate triangle - it extends UPWARD from the top edge (between dot1 and dot2) to dot3
                        const triangleBaseLeft = dot1X
                        const triangleBaseRight = dot2X
                        const triangleBaseY = boxTop
                        const triangleTipX = dot3X
                        const triangleTipY = dot3Y
                        
                        const borderRadiusPx = Math.min(15, Math.max(6, 15 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const triangleBaseLeftWrapper = ((triangleBaseLeft - adjustedLeft) / expandedWidth) * 100
                        const triangleBaseRightWrapper = ((triangleBaseRight - adjustedLeft) / expandedWidth) * 100
                        const triangleTipXWrapper = ((triangleTipX - adjustedLeft) / expandedWidth) * 100
                        const triangleTipYWrapper = ((triangleTipY - adjustedTop) / expandedHeight) * 100
                        
                        const speechBubblePath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                          L ${topLeft},${topY + borderRadiusWrapperY}
                          Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                          ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                          L ${triangleTipXWrapper},${triangleTipYWrapper}
                          L ${triangleBaseRightWrapper},${topY}
                          ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                          Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                          L ${topRight},${bottomY - borderRadiusWrapperY}
                          Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          Q ${topLeft},${bottomY} ${topLeft},${bottomY - borderRadiusWrapperY}
                          L ${topLeft},${topY + borderRadiusWrapperY}
                          Q ${topLeft},${topY} ${topLeft + borderRadiusWrapperX},${topY}
                          ${triangleBaseLeftWrapper > topLeft + borderRadiusWrapperX ? `L ${triangleBaseLeftWrapper},${topY}` : ''}
                        `
                        
                        const triangleLeftLegPath = `
                          M ${triangleBaseLeftWrapper},${topY}
                          L ${triangleTipXWrapper},${triangleTipYWrapper}
                        `
                        const triangleRightLegPath = `
                          M ${triangleBaseRightWrapper},${topY}
                          L ${triangleTipXWrapper},${triangleTipYWrapper}
                        `
                        
                        const rightBorderPath = `
                          M ${triangleBaseRightWrapper},${topY}
                          ${triangleBaseRightWrapper < topRight - borderRadiusWrapperX ? `L ${topRight - borderRadiusWrapperX},${topY}` : ''}
                          Q ${topRight},${topY} ${topRight},${topY + borderRadiusWrapperY}
                          L ${topRight},${bottomY - borderRadiusWrapperY}
                          Q ${topRight},${bottomY} ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        return (
                          <div 
                            className={`speech-bubble-wrapper ${isSelected ? 'has-selected' : ''}`}
                            style={buttonStyle}
                          >
                            <div
                              className={`speech-bubble-box ${isSelected ? 'disabled selected' : ''}`}
                              onClick={!isSelected ? handlePage7Box3 : undefined}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: isSelected ? 'none' : 'auto',
                                cursor: isSelected ? 'default' : 'pointer',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: isSelected ? '#000' : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${bubbleFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                textAlign: 'center',
                                padding: '4px 8px',
                                boxSizing: 'border-box',
                                userSelect: page7Box4Selected ? 'none' : 'auto',
                                WebkitUserSelect: page7Box4Selected ? 'none' : 'auto'
                              }}
                            >
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={speechBubblePath}
                                fill={isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)'}
                                style={{ fill: isSelected ? 'transparent' : 'rgba(255, 255, 255, 0.95)' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={triangleLeftLegPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={triangleRightLegPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke={isSelected ? "#ff8c00" : "#0d6efd"}
                                  strokeWidth={isSelected ? "2" : "1"}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                              <path
                                d={`M ${triangleBaseLeftWrapper},${topY} L ${triangleBaseRightWrapper},${topY}`}
                                fill="none"
                                stroke="transparent"
                                strokeWidth="0.3"
                                vectorEffect="non-scaling-stroke"
                              />
                            </svg>
                          </div>
                        )
                      })()}
                      {/* White box on 7.png - displayed over box 4 until all boxes 1-3 are selected */}
                      {currentPage === 6 && !editorMode && !page7Box4Selected && !(page7Box1Selected && page7Box2Selected && page7Box3Selected) && (() => {
                        const boxLeft = 5.21
                        const boxTop = 39.66
                        const boxWidth = 21.12
                        const boxHeight = 7.76
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        const borderRadiusPx = Math.min(8, Math.max(3, 8 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={{...buttonStyle, zIndex: 14}}
                          >
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 14
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#ffffff"
                                style={{ fill: '#ffffff' }}
                              />
                            </svg>
                          </div>
                        )
                      })()}
                      {/* "Show Wiring Diagram" button on page 7 (7.png) - visible when boxes 1, 2, 3 are selected */}
                      {currentPage === 6 && !editorMode && !page7Box4Selected && page7Box1Selected && page7Box2Selected && page7Box3Selected && (() => {
                        const boxWidth = 18
                        const boxHeight = 3
                        
                        const pixelIncrease = 3
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Add 27px on each side (54px total width increase)
                        const widthExpansionPx = 54
                        const widthExpansionPercent = imageNaturalSize.width > 0 ? (widthExpansionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Reduce height by lowering top edge 7px
                        const heightReductionPx = 7
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (heightReductionPx / imageNaturalSize.height) * 100 : 0
                        
                        // Position button centered horizontally at bottom, 24px up from bottom
                        const bottomOffsetPx = 24
                        const bottomOffsetPercent = imageNaturalSize.height > 0 ? (bottomOffsetPx / imageNaturalSize.height) * 100 : 0
                        
                        // Center horizontally
                        const expandedWidth = boxWidth + widthPercentAdjust + widthExpansionPercent
                        const adjustedLeft = (100 - expandedWidth) / 2
                        
                        // Position from bottom: 100% - boxHeight - bottomOffset
                        const expandedHeight = boxHeight + heightPercentAdjust - heightReductionPercent
                        const adjustedTop = 100 - expandedHeight - bottomOffsetPercent
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        const borderRadiusPx = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        // Rounded corners on top, sharp corners on bottom
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY}
                          L ${topRight},${bottomY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight},${bottomY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft},${bottomY}
                          L ${topRight},${bottomY}
                        `
                        
                        const strokeColor = "#0d6efd"
                        const strokeWidth = "1"
                        const showHelpText = true
                        // Use faded text color (10% gray) when button hasn't been selected yet (Next button inactive)
                        const textColor = page7Box4EverSelected ? '#000' : 'rgba(0, 0, 0, 0.1)'
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={{
                              ...buttonStyle, 
                              zIndex: 9999,
                              boxShadow: '0 2px 6px rgba(0, 0, 0, 0.08), 0 0 4px rgba(13, 110, 253, 0.3)',
                              borderRadius: `${borderRadiusPx}px ${borderRadiusPx}px 0 0`
                            }}
                          >
                            <div
                              className="speech-bubble-box"
                              onClick={handlePage7ShowConnections}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'auto',
                                cursor: 'pointer',
                                zIndex: 10000,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: showHelpText ? textColor : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontStyle: showHelpText ? 'italic' : 'normal',
                                fontWeight: showHelpText ? '300' : 'normal',
                                textAlign: 'center',
                                padding: '2px 4px',
                                boxSizing: 'border-box',
                                userSelect: 'auto',
                                WebkitUserSelect: 'auto',
                                opacity: showHelpText ? 1 : 0
                              }}
                            >
                              {showHelpText && 'Show Wiring Diagram'}
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 9998
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill={showHelpText ? "#ffffff" : "transparent"}
                                style={{ fill: showHelpText ? '#ffffff' : 'transparent' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                    </>
                  )}
                  {/* Button boxes on 7.1.png only */}
                  {currentPage === 6 && !editorMode && page7Box4Selected && (
                    <>
                      {/* Button box */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce button box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5  // Increased from 3px to 5px
                        const additionalWidthReductionPx = 5
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move button box: right 10px, then left 4px, then right 3px (net: right 9px), and down 10px
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const downOffsetPx = 10
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const buttonFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: 'white',
                                fontSize: `${buttonFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              Button
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#099b4d"
                                style={{ fill: '#099b4d' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* Duplicate button box on 7.1.png - "Ground" button */}
                      {(() => {
                        const boxLeft = 44.28
                        const boxTop = 57.58
                        const boxWidth = 7.16
                        const boxHeight = 2.00
                        
                        const pixelIncrease = 3
                        const halfPixelIncrease = pixelIncrease / 2
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        const leftOffsetAdjust = stageWidthPx > 0 ? (halfPixelIncrease / stageWidthPx) * 100 : 0
                        const topOffsetAdjust = stageHeightPx > 0 ? (halfPixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Reduce button box height by 5px and width by 15px, then additional reductions
                        const heightReductionPx = 5
                        const widthReductionPx = 15
                        // Additional reductions for height and width
                        const additionalHeightReductionPx = 5
                        const additionalWidthReductionPx = 5
                        const totalHeightReductionPx = heightReductionPx + additionalHeightReductionPx
                        const totalWidthReductionPx = widthReductionPx + additionalWidthReductionPx
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (totalHeightReductionPx / imageNaturalSize.height) * 100 : 0
                        const widthReductionPercent = imageNaturalSize.width > 0 ? (totalWidthReductionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Move button box: right 10px, then left 4px, then right 3px (net: right 9px), and down 10px
                        // Then for duplicate: left 25px (15px + 10px) and down 86px (50px + 40px - 4px)
                        const rightOffsetPx = 10
                        const leftOffsetPx = 4
                        const additionalRightOffsetPx = 3
                        const downOffsetPx = 10
                        const duplicateLeftOffsetPx = 25
                        const duplicateDownOffsetPx = 86
                        const rightOffsetPercent = imageNaturalSize.width > 0 ? (rightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const leftOffsetPercent = imageNaturalSize.width > 0 ? (leftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const additionalRightOffsetPercent = imageNaturalSize.width > 0 ? (additionalRightOffsetPx / imageNaturalSize.width) * 100 : 0
                        const downOffsetPercent = imageNaturalSize.height > 0 ? (downOffsetPx / imageNaturalSize.height) * 100 : 0
                        const duplicateLeftOffsetPercent = imageNaturalSize.width > 0 ? (duplicateLeftOffsetPx / imageNaturalSize.width) * 100 : 0
                        const duplicateDownOffsetPercent = imageNaturalSize.height > 0 ? (duplicateDownOffsetPx / imageNaturalSize.height) * 100 : 0
                        const netRightOffsetPercent = rightOffsetPercent - leftOffsetPercent + additionalRightOffsetPercent - duplicateLeftOffsetPercent
                        
                        const adjustedLeft = Math.max(0, boxLeft - leftOffsetAdjust + netRightOffsetPercent)
                        const adjustedTop = Math.max(0, boxTop - topOffsetAdjust + downOffsetPercent + duplicateDownOffsetPercent)
                        const expandedWidth = Math.min(100 - adjustedLeft, boxWidth + widthPercentAdjust - widthReductionPercent)
                        const expandedHeight = Math.min(100 - adjustedTop, boxHeight + heightPercentAdjust - heightReductionPercent)
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        // Reduced corner radius for button box only
                        const borderRadiusPx = Math.min(4, Math.max(2, 4 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY - borderRadiusWrapperY}
                          Q ${topLeft},${bottomY} ${topLeft + borderRadiusWrapperX},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight - borderRadiusWrapperX},${bottomY}
                          Q ${topRight},${bottomY} ${topRight},${bottomY - borderRadiusWrapperY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${bottomY}
                          L ${topRight - borderRadiusWrapperX},${bottomY}
                        `
                        
                        // Font size scales exactly with image using stageRelativeScale
                        const buttonFontSize = 10.5 * stageRelativeScale
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={buttonStyle}
                          >
                            <div
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                zIndex: 11,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: '#595959',
                                fontSize: `${buttonFontSize}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontWeight: 'bold',
                                textAlign: 'center',
                                boxSizing: 'border-box',
                                userSelect: 'none',
                                WebkitUserSelect: 'none'
                              }}
                            >
                              Ground
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 10
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill="#ffffff"
                                style={{ fill: '#ffffff' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke="#595959"
                                  strokeWidth="1"
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                      {/* "Hide Wiring Diagram" button on 7.1.png */}
                      {(() => {
                        const boxWidth = 18
                        const boxHeight = 3
                        
                        const pixelIncrease = 3
                        const widthPercentAdjust = stageWidthPx > 0 ? (pixelIncrease / stageWidthPx) * 100 : 0
                        const heightPercentAdjust = stageHeightPx > 0 ? (pixelIncrease / stageHeightPx) * 100 : 0
                        
                        // Add 27px on each side (54px total width increase)
                        const widthExpansionPx = 54
                        const widthExpansionPercent = imageNaturalSize.width > 0 ? (widthExpansionPx / imageNaturalSize.width) * 100 : 0
                        
                        // Reduce height by lowering top edge 7px
                        const heightReductionPx = 7
                        const heightReductionPercent = imageNaturalSize.height > 0 ? (heightReductionPx / imageNaturalSize.height) * 100 : 0
                        
                        // Position button centered horizontally at bottom, 24px up from bottom
                        const bottomOffsetPx = 24
                        const bottomOffsetPercent = imageNaturalSize.height > 0 ? (bottomOffsetPx / imageNaturalSize.height) * 100 : 0
                        
                        // Center horizontally
                        const expandedWidth = boxWidth + widthPercentAdjust + widthExpansionPercent
                        const adjustedLeft = (100 - expandedWidth) / 2
                        
                        // Position from bottom: 100% - boxHeight - bottomOffset
                        const expandedHeight = boxHeight + heightPercentAdjust - heightReductionPercent
                        const adjustedTop = 100 - expandedHeight - bottomOffsetPercent
                        const buttonStyle = getButtonStyle(adjustedLeft, adjustedTop, expandedWidth, expandedHeight)
                        
                        const borderRadiusPx = Math.min(16, Math.max(6, 16 * stageRelativeScale))
                        const wrapperWidthPx = (expandedWidth / 100) * stageWidthPx
                        const wrapperHeightPx = (expandedHeight / 100) * stageHeightPx
                        const borderRadiusWrapperX = Math.min(wrapperWidthPx > 0 ? (borderRadiusPx / wrapperWidthPx) * 100 : 0, 50)
                        const borderRadiusWrapperY = Math.min(wrapperHeightPx > 0 ? (borderRadiusPx / wrapperHeightPx) * 100 : 0, 50)
                        
                        const topLeft = 0
                        const topRight = 100
                        const topY = 0
                        const bottomY = 100
                        
                        // Rounded corners on top, sharp corners on bottom
                        const roundedRectPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY}
                          L ${topRight},${bottomY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                          Z
                        `
                        
                        const leftBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          Q ${topLeft},${topY} ${topLeft},${topY + borderRadiusWrapperY}
                          L ${topLeft},${bottomY}
                        `
                        
                        const rightBorderPath = `
                          M ${topRight},${bottomY}
                          L ${topRight},${topY + borderRadiusWrapperY}
                          Q ${topRight},${topY} ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const topBorderPath = `
                          M ${topLeft + borderRadiusWrapperX},${topY}
                          L ${topRight - borderRadiusWrapperX},${topY}
                        `
                        
                        const bottomBorderPath = `
                          M ${topLeft},${bottomY}
                          L ${topRight},${bottomY}
                        `
                        
                        const strokeColor = "#0d6efd"
                        const strokeWidth = "1"
                        const showHelpText = true
                        
                        return (
                          <div 
                            className="speech-bubble-wrapper no-pulse"
                            style={{
                              ...buttonStyle, 
                              zIndex: 9999,
                              boxShadow: '0 2px 6px rgba(0, 0, 0, 0.08), 0 0 4px rgba(13, 110, 253, 0.3)',
                              borderRadius: `${borderRadiusPx}px ${borderRadiusPx}px 0 0`
                            }}
                          >
                            <div
                              className="speech-bubble-box"
                              onClick={handlePage7ShowConnections}
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'auto',
                                cursor: 'pointer',
                                zIndex: 10000,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                color: showHelpText ? '#000' : 'rgba(0, 0, 0, 0.05)',
                                fontSize: `${Math.min(16, Math.max(6, 16 * stageRelativeScale))}px`,
                                fontFamily: 'Roboto, sans-serif',
                                fontStyle: showHelpText ? 'italic' : 'normal',
                                fontWeight: showHelpText ? '300' : 'normal',
                                textAlign: 'center',
                                padding: '2px 4px',
                                boxSizing: 'border-box',
                                userSelect: 'auto',
                                WebkitUserSelect: 'auto',
                                opacity: showHelpText ? 1 : 0
                              }}
                            >
                              {showHelpText && 'Hide Wiring Diagram'}
                            </div>
                            <svg
                              className="speech-bubble-svg"
                              style={{
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                width: '100%',
                                height: '100%',
                                pointerEvents: 'none',
                                overflow: 'visible',
                                zIndex: 9998
                              }}
                              viewBox="0 0 100 100"
                              preserveAspectRatio="none"
                            >
                              <defs>
                              </defs>
                              <path
                                d={roundedRectPath}
                                fill={showHelpText ? "#ffffff" : "transparent"}
                                style={{ fill: showHelpText ? '#ffffff' : 'transparent' }}
                              />
                              <g className="speech-bubble-border-group">
                                <path
                                  d={leftBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={rightBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={topBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                                <path
                                  d={bottomBorderPath}
                                  fill="none"
                                  stroke={strokeColor}
                                  strokeWidth={strokeWidth}
                                  className="speech-bubble-border"
                                  vectorEffect="non-scaling-stroke"
                                />
                              </g>
                            </svg>
                          </div>
                        )
                      })()}
                    </>
                  )}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div className="page-navigation">
        <div className="nav-button-left">
          {currentPage >= 1 && (
            <button 
              onClick={handlePrevious}
              className="btn-modern btn-nav btn-nav-previous"
              aria-label="Previous page"
            >
              Back
            </button>
          )}
        </div>
        <div className="zoom-controls">
          <button 
            onClick={handleZoomOut}
            disabled={zoom <= 50}
            className="btn-modern btn-zoom"
            aria-label="Zoom out"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1">
              <circle cx="12" cy="12" r="10"/>
              <path d="M8 12h8"/>
            </svg>
          </button>
          <div className="reset-button-container">
            {zoom !== 100 ? (
              <button 
                onClick={handleReset}
                className="btn-modern btn-zoom btn-reset"
                aria-label="Reset zoom"
              >
                Reset
              </button>
            ) : (
              <span className="zoom-text">zoom</span>
            )}
          </div>
          <button 
            onClick={handleZoomIn}
            disabled={zoom >= 300}
            className="btn-modern btn-zoom"
            aria-label="Zoom in"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1">
              <circle cx="12" cy="12" r="10"/>
              <path d="M12 8v8M8 12h8"/>
            </svg>
          </button>
        </div>
        <div className="nav-button-right">
          <button 
            onClick={handleNext}
            disabled={
              currentPage === pages.length - 1 || 
              (currentPage === 0 && !visitedPages.has(0)) ||
              (currentPage === 1 && !visitedPages.has(1)) ||
              (currentPage === 2 && (!page3ButtonClicked || !page3SecondButtonClicked)) ||
              (currentPage === 3 && !page4Button5Clicked) ||
              (currentPage === 4 && !page5GreenDotSelected) ||
              (currentPage === 5 && (!page6Button1Clicked || !page6Button2Clicked)) ||
              (currentPage === 6 && !page7Box4EverSelected) ||
              (currentPage === 7 && page8Box2Selected && !page8Box4Selected) ||
              (currentPage === 8 && !page9Box2Selected) ||
              (currentPage === 9 && !page10Box4Selected) ||
              (currentPage === 10 && !page11Box4Selected) ||
              (currentPage === 11 && !page12Box4Selected) ||
              (currentPage === 12 && !page13Box1Selected) ||
              (currentPage === 14 && !page15Box3Selected) ||
              (currentPage === 16 && !page17Box4bSelected) ||
              (currentPage === 17 && (!page18Box1Selected || !page18Box2Selected || !page18Box3Selected || !page18Box4Selected)) ||
              (currentPage === 18 && !page19Box3Selected) ||
              (currentPage === 19 && !page20Box6Selected) ||
              (currentPage === 20 && !page21Box2Selected) ||
              (currentPage === 21 && !page22Box6Selected) ||
              (currentPage === 23 && !page24Box1Selected)
            }
            className={`btn-modern btn-nav ${(currentPage === 2 && page3SecondButtonClicked && !returningToPage3AfterSecondButton) || (currentPage === 3 && page4Button5Clicked) || (currentPage === 4 && page5GreenDotSelected) || (currentPage === 5 && page6Button1Clicked && page6Button2Clicked) || (currentPage === 6 && page7Box4EverSelected) || (currentPage === 7 && (page8Box1Selected || page8Box4Selected)) || (currentPage === 8 && page9Box2Selected) || (currentPage === 9 && page10Box4Selected) || (currentPage === 10 && page11Box4Selected) || (currentPage === 11 && page12Box4Selected) || (currentPage === 12 && page13Box1Selected) || (currentPage === 14 && page15Box3Selected) || (currentPage === 16 && page17Box4bSelected) || (currentPage === 17 && page18Box1Selected && page18Box2Selected && page18Box3Selected && page18Box4Selected) || (currentPage === 18 && page19Box3Selected) || (currentPage === 19 && page20Box6Selected) || (currentPage === 20 && page21Box2Selected) || (currentPage === 21 && page22Box5Selected) || (currentPage === 23 && page24Box1Selected) ? 'btn-nav-blue' : ''}`}
            aria-label="Next page"
          >
            Next
          </button>
        </div>
      </div>
    </div>
  )
}

export default InstructionsPanel

