<!-- ========================== ROUND 1 ========================== -->
<div class="round-container" id="round1">
  <!-- Title section -->
  <div style="text-align: center;">
      <!-- Spacer for fixed navbar -->
      <div style="height: 50px;"></div>
      <h2 style="font-family: 'Roboto', sans-serif; color: #000000; font-size: 40px; font-weight: bold; line-height: 1;">Round 1</h2>  
      <h2 style="font-size: 40px; font-family: 'Roboto', sans-serif; color: #f05f40;  font-weight: bold; line-height: 1;">
          Human Neural Network
      </h2>
      <hr class="main-page-hr" />
      <br/>

      <!-- Example image (optional) -->
      <img 
        src="img/27-nn.png" 
        alt="27-NN" 
        style="
          display: block; 
          margin: 0 auto; 
          max-width: 1000px; 
          width: 100%; 
          height: auto;
        "
      />

      <br/>
  
      <h3 class="title-box-a">Sensor Nodes (A)</h3>
  </div>
  {% include node-generator-27.html %}

  <div style="text-align: center;">
    <h3 class="title-box-b">Hidden Layer Nodes (B & C)</h3>
    <h4>
      (B) Nodes: Write down sensor input and roll the dice 
      <br/><br/>
      (C) Nodes: Find your connections write down your input and roll the dice
    </h4>
    <br/><br/>

    <div style="text-align: center;">
      <h3 class="title-box-out">Output Node (OUT)</h3>
    </div>
    <br/>

    <!-- INTERACTIVE TABLE (Round 1) -->
    <table class="interactive-table" id="interactiveTable">
      <thead>
        <tr>
          <th>Node</th>
          <th>Input</th>
          <th>Numeric</th>
          <th>x</th>
          <th>Weight</th>
          <th>=</th>
          <th>Value</th>
        </tr>
      </thead>

      <tbody>
        <!-- Row Template (C1..C9) -->
        <tr id="row1">
          <td>C1</td>
          <td>
            <select id="inputDropdown1" onchange="updateRow(1)">
              <option value="" disabled selected>Select</option>
              <option value="RED">RED</option>
              <option value="GREEN">GREEN</option>
            </select>
          </td>
          <td id="numericCell1">
            <!-- User input for Numeric -->
            <input 
              type="number" 
              id="numericInput1" 
              style="width: 60px;" 
              oninput="updateRow(1)"
            />
            <!-- Auto-computed display for Numeric -->
            <span class="cell-number-span" id="numericSpan1"></span>
          </td>
          <td>x</td>
          <td id="weightCell1">
            <!-- User input for Weight -->
            <input 
              type="number" 
              id="weightInput1" 
              style="width: 60px;" 
              oninput="updateRow(1)"
            />
            <!-- Auto-computed display for Weight -->
            <span class="cell-number-span" id="weightSpan1">20</span>
          </td>
          <td>=</td>
          <td id="valueCell1">
            <!-- User input for Value -->
            <input 
              type="number" 
              id="valueInput1" 
              style="width: 60px;"
              oninput="updateRow(1)"
            />
            <!-- Auto-computed display for Value -->
            <span class="cell-number-span" id="valueSpan1"></span>
          </td>
        </tr>

        <tr id="row2">
          <td>C2</td>
          <td>
            <select id="inputDropdown2" onchange="updateRow(2)">
              <option value="" disabled selected>Select</option>
              <option value="RED">RED</option>
              <option value="GREEN">GREEN</option>
            </select>
          </td>
          <td id="numericCell2">
            <input type="number" id="numericInput2" style="width: 60px;" oninput="updateRow(2)" />
            <span class="cell-number-span" id="numericSpan2"></span>
          </td>
          <td>x</td>
          <td id="weightCell2">
            <input type="number" id="weightInput2" style="width: 60px;" oninput="updateRow(2)" />
            <span class="cell-number-span" id="weightSpan2">20</span>
          </td>
          <td>=</td>
          <td id="valueCell2">
            <input type="number" id="valueInput2" style="width: 60px;" oninput="updateRow(2)" />
            <span class="cell-number-span" id="valueSpan2"></span>
          </td>
        </tr>

        <tr id="row3">
          <td>C3</td>
          <td>
            <select id="inputDropdown3" onchange="updateRow(3)">
              <option value="" disabled selected>Select</option>
              <option value="RED">RED</option>
              <option value="GREEN">GREEN</option>
            </select>
          </td>
          <td id="numericCell3">
            <input type="number" id="numericInput3" style="width: 60px;" oninput="updateRow(3)" />
            <span class="cell-number-span" id="numericSpan3"></span>
          </td>
          <td>x</td>
          <td id="weightCell3">
            <input type="number" id="weightInput3" style="width: 60px;" oninput="updateRow(3)" />
            <span class="cell-number-span" id="weightSpan3">20</span>
          </td>
          <td>=</td>
          <td id="valueCell3">
            <input type="number" id="valueInput3" style="width: 60px;" oninput="updateRow(3)" />
            <span class="cell-number-span" id="valueSpan3"></span>
          </td>
        </tr>

        <tr id="row4">
          <td>C4</td>
          <td>
            <select id="inputDropdown4" onchange="updateRow(4)">
              <option value="" disabled selected>Select</option>
              <option value="RED">RED</option>
              <option value="GREEN">GREEN</option>
            </select>
          </td>
          <td id="numericCell4">
            <input type="number" id="numericInput4" style="width: 60px;" oninput="updateRow(4)" />
            <span class="cell-number-span" id="numericSpan4"></span>
          </td>
          <td>x</td>
          <td id="weightCell4">
            <input type="number" id="weightInput4" style="width: 60px;" oninput="updateRow(4)" />
            <span class="cell-number-span" id="weightSpan4">20</span>
          </td>
          <td>=</td>
          <td id="valueCell4">
            <input type="number" id="valueInput4" style="width: 60px;" oninput="updateRow(4)" />
            <span class="cell-number-span" id="valueSpan4"></span>
          </td>
        </tr>

        <tr id="row5">
          <td>C5</td>
          <td>
            <select id="inputDropdown5" onchange="updateRow(5)">
              <option value="" disabled selected>Select</option>
              <option value="RED">RED</option>
              <option value="GREEN">GREEN</option>
            </select>
          </td>
          <td id="numericCell5">
            <input type="number" id="numericInput5" style="width: 60px;" oninput="updateRow(5)" />
            <span class="cell-number-span" id="numericSpan5"></span>
          </td>
          <td>x</td>
          <td id="weightCell5">
            <input type="number" id="weightInput5" style="width: 60px;" oninput="updateRow(5)" />
            <span class="cell-number-span" id="weightSpan5">20</span>
          </td>
          <td>=</td>
          <td id="valueCell5">
            <input type="number" id="valueInput5" style="width: 60px;" oninput="updateRow(5)" />
            <span class="cell-number-span" id="valueSpan5"></span>
          </td>
        </tr>

        <tr id="row6">
          <td>C6</td>
          <td>
            <select id="inputDropdown6" onchange="updateRow(6)">
              <option value="" disabled selected>Select</option>
              <option value="RED">RED</option>
              <option value="GREEN">GREEN</option>
            </select>
          </td>
          <td id="numericCell6">
            <input type="number" id="numericInput6" style="width: 60px;" oninput="updateRow(6)" />
            <span class="cell-number-span" id="numericSpan6"></span>
          </td>
          <td>x</td>
          <td id="weightCell6">
            <input type="number" id="weightInput6" style="width: 60px;" oninput="updateRow(6)" />
            <span class="cell-number-span" id="weightSpan6">20</span>
          </td>
          <td>=</td>
          <td id="valueCell6">
            <input type="number" id="valueInput6" style="width: 60px;" oninput="updateRow(6)" />
            <span class="cell-number-span" id="valueSpan6"></span>
          </td>
        </tr>

        <tr id="row7">
          <td>C7</td>
          <td>
            <select id="inputDropdown7" onchange="updateRow(7)">
              <option value="" disabled selected>Select</option>
              <option value="RED">RED</option>
              <option value="GREEN">GREEN</option>
            </select>
          </td>
          <td id="numericCell7">
            <input type="number" id="numericInput7" style="width: 60px;" oninput="updateRow(7)" />
            <span class="cell-number-span" id="numericSpan7"></span>
          </td>
          <td>x</td>
          <td id="weightCell7">
            <input type="number" id="weightInput7" style="width: 60px;" oninput="updateRow(7)" />
            <span class="cell-number-span" id="weightSpan7">20</span>
          </td>
          <td>=</td>
          <td id="valueCell7">
            <input type="number" id="valueInput7" style="width: 60px;" oninput="updateRow(7)" />
            <span class="cell-number-span" id="valueSpan7"></span>
          </td>
        </tr>

        <tr id="row8">
          <td>C8</td>
          <td>
            <select id="inputDropdown8" onchange="updateRow(8)">
              <option value="" disabled selected>Select</option>
              <option value="RED">RED</option>
              <option value="GREEN">GREEN</option>
            </select>
          </td>
          <td id="numericCell8">
            <input type="number" id="numericInput8" style="width: 60px;" oninput="updateRow(8)" />
            <span class="cell-number-span" id="numericSpan8"></span>
          </td>
          <td>x</td>
          <td id="weightCell8">
            <input type="number" id="weightInput8" style="width: 60px;" oninput="updateRow(8)" />
            <span class="cell-number-span" id="weightSpan8">20</span>
          </td>
          <td>=</td>
          <td id="valueCell8">
            <input type="number" id="valueInput8" style="width: 60px;" oninput="updateRow(8)" />
            <span class="cell-number-span" id="valueSpan8"></span>
          </td>
        </tr>

        <tr id="row9">
          <td>C9</td>
          <td>
            <select id="inputDropdown9" onchange="updateRow(9)">
              <option value="" disabled selected>Select</option>
              <option value="RED">RED</option>
              <option value="GREEN">GREEN</option>
            </select>
          </td>
          <td id="numericCell9">
            <input type="number" id="numericInput9" style="width: 60px;" oninput="updateRow(9)" />
            <span class="cell-number-span" id="numericSpan9"></span>
          </td>
          <td>x</td>
          <td id="weightCell9">
            <input type="number" id="weightInput9" style="width: 60px;" oninput="updateRow(9)" />
            <span class="cell-number-span" id="weightSpan9">20</span>
          </td>
          <td>=</td>
          <td id="valueCell9">
            <input type="number" id="valueInput9" style="width: 60px;" oninput="updateRow(9)" />
            <span class="cell-number-span" id="valueSpan9"></span>
          </td>
        </tr>
      </tbody>

      <!-- Auto Buttons Row -->
      <tfoot>
        <tr class="auto-button-row">
          <td></td>
          <td></td>
          <!-- Numeric Column Auto Button -->
          <td style="text-align: center;">
            <button id="autoNumericBtn">Auto</button>
          </td>
          <td></td>
          <!-- Weight Column Auto Button -->
          <td style="text-align: center;">
            <button id="autoWeightBtn">Auto</button>
          </td>
          <td></td>
          <!-- Value Column Auto Button -->
          <td style="text-align: center;">
            <button id="autoValueBtn">Auto</button>
          </td>
        </tr>
      </tfoot>
    </table>

    <br/>
    <hr/>
    <br/>

    <!-- DECISION TABLE (Round 1) -->
    <div style="text-align: center;">
      <h4>Sum and Output Node</h4>
    </div>
    <table class="decision-table" id="decisionTable">
      <thead>
        <tr>
          <th>Sum</th>
          <th>Output Node</th>
        </tr>
      </thead>
      <tbody>
        <!-- THIS ROW GETS COLORED RED OR GREEN BASED ON SUM -->
        <tr id="decisionRow">
          <td id="sumCell">---</td>
          <td id="outputCell">---</td>
        </tr>
      </tbody>
    </table>

    <!-- TRAFFIC LIGHT STATE (single row) -->
    <table class="decision-table" id="trafficLightStateTable">
      <tbody>
        <tr>
          <td id="trafficLightStateCell" style="font-weight:bold;">Traffic Light State: ---</td>
        </tr>
      </tbody>
    </table>

    <br/>
    <br/>

    <!-- NETWORK STATUS TABLE (Round 1) -->
    <div style="text-align: center;">
      <h3 class="title-box-summary">Summary</h3>
    </div>

    <table class="decision-table" id="networkStatusTable">
      <thead>
        <tr>
          <th>Round</th>
          <th>Network Status</th>
          <th>Sum</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td id="networkStatusCell"></td>
          <td id="networkSumCell"></td>
        </tr>
      </tbody>
    </table>

    <!-- Bar Chart for Round 1 -->
    <div style="text-align:center; margin-top:30px; margin-bottom:30px;">
      <canvas id="round1BarChart" width="500" height="200" style="border:1px solid #000;">
        Your browser does not support Canvas.
      </canvas>
    </div>

    <br/><br/><br/>
    <div style="text-align:center; margin: 20px 0;">
      <button id="resetButton" onclick="location.reload()">Reset Table</button>
      <br/><br/>
      <select id="headerColorDropdown" onchange="updateHeaderColor()">
        <option value="" disabled selected>Change Heading Color</option>
        <option value="#f05f40">Orange</option>
        <option value="blue">Blue</option>
      </select>
    </div>

    <!-- Button to toggle/hide user input boxes for Round 1 -->
    <div style="text-align:center; margin: 20px;">
      <button id="toggleUserInputsBtn" onclick="toggleUserInputOverlays()">
        Hide User Boxes
      </button>
    </div>

    {% include copyright.html %}
  </div>

  <!-- STYLES for coloring red/green rows -->
  <style>
    .row-red {
      background-color: red !important;
      color: #ffffff !important;
    }
    .row-green {
      background-color: green !important;
      color: #ffffff !important;
    }
    .cell-red {
      background-color: red !important;
      color: #ffffff !important;
    }
    .cell-green {
      background-color: green !important;
      color: #ffffff !important;
    }
    .select-red {
      background-color: red !important;
      color: #ffffff !important;
    }
    .select-green {
      background-color: green !important;
      color: #ffffff !important;
    }

    /* Removes border from row with the auto buttons */
    .auto-button-row td {
      border: none !important;
    }

    /* Optional class to hide inputs if user toggles them globally */
    .hide-inputs input {
      display: none !important;
    }
  </style>

  <!-- SCRIPT FOR ROUND 1 -->
  <script>
    /**********************************************
     * GLOBAL "AUTO" FLAGS (start as false => show user boxes)
     **********************************************/
    let numericAutoActive = false;  // User inputs shown on load
    let weightAutoActive  = false;  // User inputs shown on load
    let valueAutoActive   = false;  // User inputs shown on load

    /**********************************************
     * TRAFFIC LIGHT Handling (Optional)
     **********************************************/
    const colorRedBtn   = document.getElementById('colorRed');
    const colorGreenBtn = document.getElementById('colorGreen');
    const redCircle     = document.getElementById('redCircle');
    const greenCircle   = document.getElementById('greenCircle');

    if (colorRedBtn && colorGreenBtn && redCircle && greenCircle) {
      colorRedBtn.addEventListener('click', () => {
        colorRedBtn.classList.add('active');
        colorGreenBtn.classList.remove('active');
        redCircle.classList.remove('inactive-red');
        redCircle.classList.add('red');
        greenCircle.classList.remove('green');
        greenCircle.classList.add('inactive-green');

        updateNetworkStatusTable();
        updateRound2Weights();
      });

      colorGreenBtn.addEventListener('click', () => {
        colorGreenBtn.classList.add('active');
        colorRedBtn.classList.remove('active');
        greenCircle.classList.remove('inactive-green');
        greenCircle.classList.add('green');
        redCircle.classList.remove('red');
        redCircle.classList.add('inactive-red');

        updateNetworkStatusTable();
        updateRound2Weights();
      });
    }

    function updateNetworkStatusTable() {
      const trafficLightStateCell = document.getElementById('trafficLightStateCell');
      if (!trafficLightStateCell) return;

      let stateText = 'Traffic Light State: ---';
      if (colorRedBtn && colorRedBtn.classList.contains('active')) {
        stateText = 'Traffic Light State: RED';
        trafficLightStateCell.style.backgroundColor = 'red';
        trafficLightStateCell.style.color = 'white';
      } else if (colorGreenBtn && colorGreenBtn.classList.contains('active')) {
        stateText = 'Traffic Light State: GREEN';
        trafficLightStateCell.style.backgroundColor = 'green';
        trafficLightStateCell.style.color = 'white';
      } else {
        trafficLightStateCell.style.backgroundColor = '';
        trafficLightStateCell.style.color = '';
      }
      trafficLightStateCell.textContent = stateText;

      // Compare final Output Node with chosen traffic light state
      const decisionOutput = document.getElementById('outputCell').textContent;
      const currentLightState = stateText.replace('Traffic Light State:', '').trim();

      let networkStatus;
      if (decisionOutput === 'UNDECIDED') {
        networkStatus = 'UNDECIDED';
      } else if (currentLightState === '---') {
        networkStatus = 'INCORRECT';
      } else if (decisionOutput === currentLightState) {
        networkStatus = 'CORRECT';
      } else {
        networkStatus = 'INCORRECT';
      }
      document.getElementById('networkStatusCell').textContent = networkStatus;

      const sumValue = document.getElementById('sumCell').textContent;
      document.getElementById('networkSumCell').textContent = sumValue;
    }

    /**********************************************
     * MAIN UPDATE LOGIC FOR EACH ROW
     **********************************************/
    function updateRow(rowIdx) {
      const dropdown   = document.getElementById("inputDropdown" + rowIdx);
      const numericInp = document.getElementById("numericInput" + rowIdx);
      const numericSpn = document.getElementById("numericSpan" + rowIdx);
      const weightInp  = document.getElementById("weightInput" + rowIdx);
      const weightSpn  = document.getElementById("weightSpan" + rowIdx);
      const valueInp   = document.getElementById("valueInput" + rowIdx);
      const valueSpn   = document.getElementById("valueSpan" + rowIdx);

      // Clear color classes
      dropdown.parentElement.classList.remove('cell-red','cell-green');
      dropdown.classList.remove('select-red','select-green');

      // 1) Numeric
      let numericFinal;
      if (numericAutoActive) {
        // If auto => numeric depends on RED/GREEN
        if (dropdown.value === "RED") {
          numericFinal = -1;
        } else if (dropdown.value === "GREEN") {
          numericFinal = 1;
        } else {
          numericFinal = 0;
        }
        numericSpn.textContent = (dropdown.value ? numericFinal : "");
      } else {
        // If not auto => use user's numeric input
        let userNumeric = parseFloat(numericInp.value) || 0;
        numericFinal = userNumeric;
      }

      // 2) Weight
      let weightFinal;
      if (weightAutoActive) {
        // If auto => default "20" for Round 1
        weightFinal = 20;
        weightSpn.textContent = "20";
      } else {
        let userWeight = parseFloat(weightInp.value) || 0;
        weightFinal = userWeight;
      }

      // 3) Value
      let computedVal = numericFinal * weightFinal;
      let valueFinal;
      if (valueAutoActive) {
        valueFinal = computedVal;
        valueSpn.textContent = (dropdown.value ? valueFinal : "");
      } else {
        let userValue = parseFloat(valueInp.value) || 0;
        valueFinal = userValue;
      }

      // Color the input cell according to the selection
      if (dropdown.value === "RED") {
        dropdown.parentElement.classList.add('cell-red');
        dropdown.classList.add('select-red');
      } else if (dropdown.value === "GREEN") {
        dropdown.parentElement.classList.add('cell-green');
        dropdown.classList.add('select-green');
      }

      // Update decision table
      updateDecision();
      // Update Round2 weights if needed
      updateRound2Weights();
    }

    // Recompute sum & output
    function updateDecision() {
      let sum = 0;
      for (let i = 1; i <= 9; i++) {
        sum += getFinalValue(i);
      }
      document.getElementById("sumCell").textContent = sum;

      let output;
      if (sum > 0) {
        output = "GREEN";
      } else if (sum < 0) {
        output = "RED";
      } else {
        output = "UNDECIDED";
      }
      document.getElementById("outputCell").textContent = output;

      // Color the sum/output row
      const decisionRow = document.getElementById("decisionRow");
      decisionRow.classList.remove('row-red','row-green');
      if (sum > 0) {
        decisionRow.classList.add('row-green');
      } else if (sum < 0) {
        decisionRow.classList.add('row-red');
      }

      updateNetworkStatusTable();
    }

    // Helper: returns the "active" Value for row i
    function getFinalValue(rowIdx) {
      const dropdown   = document.getElementById("inputDropdown" + rowIdx);
      const numericInp = document.getElementById("numericInput" + rowIdx);
      const weightInp  = document.getElementById("weightInput" + rowIdx);
      const valueInp   = document.getElementById("valueInput" + rowIdx);

      // numeric
      let numericVal;
      if (numericAutoActive) {
        if (dropdown.value === "RED") numericVal = -1;
        else if (dropdown.value === "GREEN") numericVal = 1;
        else numericVal = 0;
      } else {
        numericVal = parseFloat(numericInp.value) || 0;
      }

      // weight
      let weightVal;
      if (weightAutoActive) {
        weightVal = 20;
      } else {
        weightVal = parseFloat(weightInp.value) || 0;
      }

      // value
      if (valueAutoActive) {
        return numericVal * weightVal;
      } else {
        return parseFloat(valueInp.value) || 0;
      }
    }

    /**********************************************
     * ROUND 2 WEIGHTS UPDATE (if applicable)
     **********************************************/
    function updateRound2Weights() {
      // If you have Round 2 cells with IDs like "weightCell2_1", etc.
      let round1Light = null;
      if (colorRedBtn && colorRedBtn.classList.contains('active')) {
        round1Light = 'RED';
      } else if (colorGreenBtn && colorGreenBtn.classList.contains('active')) {
        round1Light = 'GREEN';
      }

      // Example code if Round 2 exists
      for (let i = 1; i <= 9; i++) {
        const r2WeightCell = document.getElementById('weightCell2_' + i);
        if (!r2WeightCell) continue;

        let w;
        if (weightAutoActive) {
          w = 20;
        } else {
          w = parseFloat(document.getElementById('weightInput'+ i).value) || 0;
        }

        const round1Input = document.getElementById('inputDropdown' + i).value;
        if (round1Light && round1Input) {
          if (round1Input === round1Light) {
            w += 10;
          } else {
            w -= 10;
          }
        }
        r2WeightCell.textContent = w;
      }
    }

    /**********************************************
     * HEADER COLOR DROPDOWN
     **********************************************/
    function updateHeaderColor() {
      const newColor = document.getElementById('headerColorDropdown').value;
      const allHeaders = document.querySelectorAll(
        '#round1 .interactive-table th, #round1 .decision-table th'
      );
      allHeaders.forEach(th => {
        th.style.backgroundColor = newColor;
        th.style.color = '#ffffff';
      });
    }

    /**********************************************
     * BAR CHART FOR ROUND 1 (optional)
     **********************************************/
    function drawBarChartRound1() {
      const canvas = document.getElementById('round1BarChart');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');

      // Gather final weight values from Round 1
      let weights = [];
      for (let i = 1; i <= 9; i++) {
        let w;
        if (weightAutoActive) {
          w = 20; 
        } else {
          w = parseFloat(document.getElementById('weightInput'+ i).value) || 0;
        }
        weights.push(w);
      }

      // Clear the canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      let minVal = Math.min(...weights);
      let maxVal = Math.max(...weights);
      if (minVal === maxVal) {
        minVal -= 10;
        maxVal += 10;
      }
      const padding = 5;
      minVal -= padding;
      maxVal += padding;

      const chartW = canvas.width;
      const chartH = canvas.height;
      const margin = 30;
      const usableW = chartW - margin * 2;
      const usableH = chartH - margin * 2;

      // Where 0 sits on the Y-axis
      let zeroY;
      if (minVal < 0 && maxVal > 0) {
        zeroY = margin + (maxVal / (maxVal - minVal)) * usableH;
      } else if (maxVal < 0) {
        zeroY = margin + usableH;
      } else {
        zeroY = margin;
      }
      zeroY = Math.max(margin, Math.min(margin + usableH, zeroY));

      // X-axis
      ctx.strokeStyle = 'black';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(margin, zeroY);
      ctx.lineTo(margin + usableW, zeroY);
      ctx.stroke();

      // Y-axis
      ctx.beginPath();
      ctx.moveTo(margin, margin);
      ctx.lineTo(margin, margin + usableH);
      ctx.stroke();

      // Bars
      const barSpacing = usableW / 9;
      const barWidth   = 5;
      ctx.fillStyle    = '#f05f40';

      for (let i = 0; i < 9; i++) {
        const wVal = weights[i];
        const xCenter = margin + barSpacing * i + barSpacing / 2;
        const scale = usableH / (maxVal - minVal);
        const barHeight = Math.abs(wVal * scale);

        const barX = xCenter - barWidth / 2;
        const barY = (wVal >= 0) ? zeroY - barHeight : zeroY;

        ctx.fillRect(barX, barY, barWidth, barHeight);

        // Label bars as C1..C9
        ctx.fillStyle = 'black';
        ctx.font = '12px sans-serif';
        ctx.fillText('C' + (i + 1), xCenter - 6, zeroY + 15);
        ctx.fillStyle = '#f05f40';
      }
    }
    // Re-draw chart periodically
    setInterval(drawBarChartRound1, 1000);

    /**********************************************
     * AUTO-BUTTON EVENT HANDLERS
     **********************************************/
    const autoNumericBtn = document.getElementById('autoNumericBtn');
    const autoWeightBtn  = document.getElementById('autoWeightBtn');
    const autoValueBtn   = document.getElementById('autoValueBtn');

    if (autoNumericBtn) {
      autoNumericBtn.addEventListener('click', () => {
        // Toggle numeric auto mode
        numericAutoActive = !numericAutoActive;
        toggleNumericColumn(numericAutoActive);
        // Recalc all rows
        for (let i = 1; i <= 9; i++) {
          updateRow(i);
        }
      });
    }

    if (autoWeightBtn) {
      autoWeightBtn.addEventListener('click', () => {
        // Toggle weight auto mode
        weightAutoActive = !weightAutoActive;
        toggleWeightColumn(weightAutoActive);
        // Recalc
        for (let i = 1; i <= 9; i++) {
          updateRow(i);
        }
      });
    }

    if (autoValueBtn) {
      autoValueBtn.addEventListener('click', () => {
        // Toggle value auto mode
        valueAutoActive = !valueAutoActive;
        toggleValueColumn(valueAutoActive);
        // Recalc
        for (let i = 1; i <= 9; i++) {
          updateRow(i);
        }
      });
    }

    // Show/hide numeric input vs. span
    function toggleNumericColumn(isAuto) {
      for (let i = 1; i <= 9; i++) {
        const numericInp = document.getElementById("numericInput" + i);
        const numericSpn = document.getElementById("numericSpan" + i);
        if (isAuto) {
          numericInp.style.display = "none";
          numericSpn.style.display = "inline";
        } else {
          numericInp.style.display = "inline";
          numericSpn.style.display = "none";
        }
      }
    }

    // Show/hide weight input vs. span
    function toggleWeightColumn(isAuto) {
      for (let i = 1; i <= 9; i++) {
        const weightInp = document.getElementById("weightInput" + i);
        const weightSpn = document.getElementById("weightSpan" + i);
        if (isAuto) {
          weightInp.style.display = "none";
          weightSpn.style.display = "inline";
        } else {
          weightInp.style.display = "inline";
          weightSpn.style.display = "none";
        }
      }
    }

    // Show/hide value input vs. span
    function toggleValueColumn(isAuto) {
      for (let i = 1; i <= 9; i++) {
        const valueInp = document.getElementById("valueInput" + i);
        const valueSpn = document.getElementById("valueSpan" + i);
        if (isAuto) {
          valueInp.style.display = "none";
          valueSpn.style.display = "inline";
        } else {
          valueInp.style.display = "inline";
          valueSpn.style.display = "none";
        }
      }
    }

    // Initialize columns to user mode on load
    window.addEventListener("DOMContentLoaded", () => {
      toggleNumericColumn(numericAutoActive);
      toggleWeightColumn(weightAutoActive);
      toggleValueColumn(valueAutoActive);
    });

    /**********************************************
     * TOGGLE/HIDE ALL USER INPUTS (global)
     **********************************************/
    function toggleUserInputOverlays() {
      const table = document.getElementById('interactiveTable');
      if (!table) return;

      const isHidden = table.classList.toggle('hide-inputs');
      document.getElementById('toggleUserInputsBtn').textContent = 
        isHidden ? 'Show User Boxes' : 'Hide User Boxes';
    }
  </script>
</div> <!-- /round1 -->
