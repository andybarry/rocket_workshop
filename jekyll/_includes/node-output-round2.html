<!-- ========================== ROUND 2 ========================== -->
<div class="round-container" id="round2">

  <!-- Title Section -->
  <div style="text-align: center;">
    <div style="height: 30px;"></div>
    <h2 style="font-family: 'Roboto', sans-serif; color: #000000; font-size: 1.8em; font-weight: bold; line-height: .5;">
      Round 2
    </h2>
    <h2 style="font-size: 1.8em; font-family: 'Roboto', sans-serif; color: #f05f40; font-weight: bold; line-height: .5;">
      Human Neural Network - 27
    </h2>
    <hr class="main-page-hr" />
    <br/>

    <!-- Example Image (Optional) -->
    <img 
      src="img/27-nn.png" 
      alt="27-NN" 
      style="
        display: block; 
        margin: 0 auto; 
        max-width: 900px; 
        width: 100%; 
        height: auto;"
    />

    <br/>
    <h3 class="title-box-a">Sensor Nodes (A)</h3>
  </div>

  {% include node-generator-27.html %}

  <div style="text-align: center;">
    <h3 class="title-box-b">Hidden Layer Nodes (B &amp; C)</h3>
    <h4>
      (B) Nodes: Write down sensor input and roll the dice 
      <br/><br/>
      (C) Nodes: Find your connections, write down your input, and roll the dice
    </h4>
    <br/><br/>

    <div style="text-align: center;">
      <h3 class="title-box-out">Output Node (OUT)</h3>
    </div>
    <br/>

    <!-- Container for Round 2 main table -->
    <div style="text-align: center;">
      <div style="display: inline-block; vertical-align: top; position: relative;">
      
        <h3 style="text-align:center;">Round 2</h3>

        <table class="interactive-table" id="interactiveTable2" style="margin: 0 auto;">
          <thead>
            <tr>
              <th>Node</th>
              <th>Input</th>
              <th>Numeric</th>
              <th>x</th>
              <th>Weight</th>
              <th>=</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody>
            <!-- Rows C1..C9 -->
            <tr id="row2_1">
              <td>C1</td>
              <td>
                <select id="inputDropdown2_1" onchange="updateRow2(1)">
                  <option value="" disabled selected>Select</option>
                  <option value="RED">RED</option>
                  <option value="GREEN">GREEN</option>
                </select>
              </td>
              <td>
                <input 
                  type="number"
                  id="numericInput2_1" 
                  style="width: 60px;" 
                  oninput="updateRow2(1)"
                />
                <span class="cell-number-span" id="numericSpan2_1"></span>
              </td>
              <td>x</td>
              <td>
                <input 
                  type="number" 
                  id="weightInput2_1" 
                  style="width: 60px;" 
                  oninput="updateRow2(1)"
                />
                <span class="cell-number-span" id="weightSpan2_1"></span>
              </td>
              <td>=</td>
              <td>
                <input 
                  type="number" 
                  id="valueInput2_1" 
                  style="width: 60px;" 
                  oninput="updateRow2(1)"
                />
                <span class="cell-number-span" id="valueSpan2_1"></span>
              </td>
            </tr>

            <tr id="row2_2">
              <td>C2</td>
              <td>
                <select id="inputDropdown2_2" onchange="updateRow2(2)">
                  <option value="" disabled selected>Select</option>
                  <option value="RED">RED</option>
                  <option value="GREEN">GREEN</option>
                </select>
              </td>
              <td>
                <input 
                  type="number"
                  id="numericInput2_2" 
                  style="width: 60px;" 
                  oninput="updateRow2(2)"
                />
                <span class="cell-number-span" id="numericSpan2_2"></span>
              </td>
              <td>x</td>
              <td>
                <input 
                  type="number" 
                  id="weightInput2_2" 
                  style="width: 60px;" 
                  oninput="updateRow2(2)"
                />
                <span class="cell-number-span" id="weightSpan2_2"></span>
              </td>
              <td>=</td>
              <td>
                <input 
                  type="number" 
                  id="valueInput2_2" 
                  style="width: 60px;" 
                  oninput="updateRow2(2)"
                />
                <span class="cell-number-span" id="valueSpan2_2"></span>
              </td>
            </tr>

            <tr id="row2_3">
              <td>C3</td>
              <td>
                <select id="inputDropdown2_3" onchange="updateRow2(3)">
                  <option value="" disabled selected>Select</option>
                  <option value="RED">RED</option>
                  <option value="GREEN">GREEN</option>
                </select>
              </td>
              <td>
                <input 
                  type="number"
                  id="numericInput2_3" 
                  style="width: 60px;" 
                  oninput="updateRow2(3)"
                />
                <span class="cell-number-span" id="numericSpan2_3"></span>
              </td>
              <td>x</td>
              <td>
                <input 
                  type="number" 
                  id="weightInput2_3" 
                  style="width: 60px;" 
                  oninput="updateRow2(3)"
                />
                <span class="cell-number-span" id="weightSpan2_3"></span>
              </td>
              <td>=</td>
              <td>
                <input 
                  type="number" 
                  id="valueInput2_3" 
                  style="width: 60px;" 
                  oninput="updateRow2(3)"
                />
                <span class="cell-number-span" id="valueSpan2_3"></span>
              </td>
            </tr>

            <tr id="row2_4">
              <td>C4</td>
              <td>
                <select id="inputDropdown2_4" onchange="updateRow2(4)">
                  <option value="" disabled selected>Select</option>
                  <option value="RED">RED</option>
                  <option value="GREEN">GREEN</option>
                </select>
              </td>
              <td>
                <input 
                  type="number" 
                  id="numericInput2_4" 
                  style="width: 60px;" 
                  oninput="updateRow2(4)"
                />
                <span class="cell-number-span" id="numericSpan2_4"></span>
              </td>
              <td>x</td>
              <td>
                <input 
                  type="number" 
                  id="weightInput2_4" 
                  style="width: 60px;" 
                  oninput="updateRow2(4)"
                />
                <span class="cell-number-span" id="weightSpan2_4"></span>
              </td>
              <td>=</td>
              <td>
                <input 
                  type="number" 
                  id="valueInput2_4" 
                  style="width: 60px;" 
                  oninput="updateRow2(4)"
                />
                <span class="cell-number-span" id="valueSpan2_4"></span>
              </td>
            </tr>

            <tr id="row2_5">
              <td>C5</td>
              <td>
                <select id="inputDropdown2_5" onchange="updateRow2(5)">
                  <option value="" disabled selected>Select</option>
                  <option value="RED">RED</option>
                  <option value="GREEN">GREEN</option>
                </select>
              </td>
              <td>
                <input 
                  type="number" 
                  id="numericInput2_5" 
                  style="width: 60px;" 
                  oninput="updateRow2(5)"
                />
                <span class="cell-number-span" id="numericSpan2_5"></span>
              </td>
              <td>x</td>
              <td>
                <input 
                  type="number" 
                  id="weightInput2_5" 
                  style="width: 60px;" 
                  oninput="updateRow2(5)"
                />
                <span class="cell-number-span" id="weightSpan2_5"></span>
              </td>
              <td>=</td>
              <td>
                <input 
                  type="number" 
                  id="valueInput2_5" 
                  style="width: 60px;" 
                  oninput="updateRow2(5)"
                />
                <span class="cell-number-span" id="valueSpan2_5"></span>
              </td>
            </tr>

            <tr id="row2_6">
              <td>C6</td>
              <td>
                <select id="inputDropdown2_6" onchange="updateRow2(6)">
                  <option value="" disabled selected>Select</option>
                  <option value="RED">RED</option>
                  <option value="GREEN">GREEN</option>
                </select>
              </td>
              <td>
                <input 
                  type="number" 
                  id="numericInput2_6" 
                  style="width: 60px;" 
                  oninput="updateRow2(6)"
                />
                <span class="cell-number-span" id="numericSpan2_6"></span>
              </td>
              <td>x</td>
              <td>
                <input 
                  type="number" 
                  id="weightInput2_6" 
                  style="width: 60px;" 
                  oninput="updateRow2(6)"
                />
                <span class="cell-number-span" id="weightSpan2_6"></span>
              </td>
              <td>=</td>
              <td>
                <input 
                  type="number" 
                  id="valueInput2_6" 
                  style="width: 60px;" 
                  oninput="updateRow2(6)"
                />
                <span class="cell-number-span" id="valueSpan2_6"></span>
              </td>
            </tr>

            <tr id="row2_7">
              <td>C7</td>
              <td>
                <select id="inputDropdown2_7" onchange="updateRow2(7)">
                  <option value="" disabled selected>Select</option>
                  <option value="RED">RED</option>
                  <option value="GREEN">GREEN</option>
                </select>
              </td>
              <td>
                <input 
                  type="number" 
                  id="numericInput2_7" 
                  style="width: 60px;" 
                  oninput="updateRow2(7)"
                />
                <span class="cell-number-span" id="numericSpan2_7"></span>
              </td>
              <td>x</td>
              <td>
                <input 
                  type="number" 
                  id="weightInput2_7" 
                  style="width: 60px;" 
                  oninput="updateRow2(7)"
                />
                <span class="cell-number-span" id="weightSpan2_7"></span>
              </td>
              <td>=</td>
              <td>
                <input 
                  type="number" 
                  id="valueInput2_7" 
                  style="width: 60px;" 
                  oninput="updateRow2(7)"
                />
                <span class="cell-number-span" id="valueSpan2_7"></span>
              </td>
            </tr>

            <tr id="row2_8">
              <td>C8</td>
              <td>
                <select id="inputDropdown2_8" onchange="updateRow2(8)">
                  <option value="" disabled selected>Select</option>
                  <option value="RED">RED</option>
                  <option value="GREEN">GREEN</option>
                </select>
              </td>
              <td>
                <input 
                  type="number" 
                  id="numericInput2_8" 
                  style="width: 60px;" 
                  oninput="updateRow2(8)"
                />
                <span class="cell-number-span" id="numericSpan2_8"></span>
              </td>
              <td>x</td>
              <td>
                <input 
                  type="number" 
                  id="weightInput2_8" 
                  style="width: 60px;" 
                  oninput="updateRow2(8)"
                />
                <span class="cell-number-span" id="weightSpan2_8"></span>
              </td>
              <td>=</td>
              <td>
                <input 
                  type="number" 
                  id="valueInput2_8" 
                  style="width: 60px;" 
                  oninput="updateRow2(8)"
                />
                <span class="cell-number-span" id="valueSpan2_8"></span>
              </td>
            </tr>

            <tr id="row2_9">
              <td>C9</td>
              <td>
                <select id="inputDropdown2_9" onchange="updateRow2(9)">
                  <option value="" disabled selected>Select</option>
                  <option value="RED">RED</option>
                  <option value="GREEN">GREEN</option>
                </select>
              </td>
              <td>
                <input 
                  type="number" 
                  id="numericInput2_9" 
                  style="width: 60px;" 
                  oninput="updateRow2(9)"
                />
                <span class="cell-number-span" id="numericSpan2_9"></span>
              </td>
              <td>x</td>
              <td>
                <input 
                  type="number" 
                  id="weightInput2_9" 
                  style="width: 60px;" 
                  oninput="updateRow2(9)"
                />
                <span class="cell-number-span" id="weightSpan2_9"></span>
              </td>
              <td>=</td>
              <td>
                <input 
                  type="number" 
                  id="valueInput2_9" 
                  style="width: 60px;" 
                  oninput="updateRow2(9)"
                />
                <span class="cell-number-span" id="valueSpan2_9"></span>
              </td>
            </tr>
          </tbody>

          <!-- Auto Buttons Row (Round 2) -->
          <tfoot>
            <tr class="auto-button-row">
              <td></td>
              <td></td>
              <td style="text-align: center;">
                <button id="autoNumericBtn2">Auto</button>
              </td>
              <td></td>
              <td style="text-align: center;">
                <button id="autoWeightBtn2">Auto</button>
              </td>
              <td></td>
              <td style="text-align: center;">
                <button id="autoValueBtn2">Auto</button>
              </td>
            </tr>
          </tfoot>
        </table>
      </div> <!-- /Round 2 table -->
    </div> <!-- /container for Round 2 -->

    <br/>
    <hr/>
    <br/>

    <!-- DECISION TABLE (Round 2) -->
    <table class="decision-table" id="decisionTable2" style="margin: 0 auto; text-align: center;">
      <thead>
        <tr>
          <th style="text-align: center;">Sum of (C) Node Values</th>
          <th style="text-align: center;">Networks Decision</th>
        </tr>
      </thead>
      <tbody>
        <tr id="decisionRow2">
          <td id="sumCell2">---</td>
          <td id="outputCell2">---</td>
        </tr>
      </tbody>
    </table>

    <br/>
    <hr/>
    <br/>

    <!-- TRAFFIC LIGHT STATE (Round 2) -->
    <table class="decision-table" id="trafficLightStateTable2" style="margin: 20px auto; width: 150px;">
      <tbody>
        <tr>
          <td id="trafficLightStateCell2" style="font-weight:bold;">
            Traffic Light State (R2):<br/>---
          </td>
        </tr>
      </tbody>
    </table>

    <div style="text-align: center;">
      <div class="traffic-light" id="trafficLightRound2">
        <div class="light inactive-red" id="redCircleRound2"></div>
        <div class="light inactive-green" id="greenCircleRound2"></div>
      </div>
    </div>

    <br/><br/><br/><br/>

    <!-- NETWORK STATUS TABLE (Round 2) -->
    <div style="text-align: center;">
      <h3 class="title-box-summary">Summary</h3>
      <br/><br/>
    </div>
    <table class="decision-table" id="networkStatusTable2" style="margin: 0 auto;">
      <thead>
        <tr>
          <th>Round</th>
          <th>Network Status</th>
          <th>Sum</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>2</td>
          <td id="networkStatusCell2"></td>
          <td id="networkSumCell2"></td>
        </tr>
      </tbody>
    </table>
    <br/>
    <hr/>
    <br/>

    <div style="text-align: center;">
      <h4>C Node Weights (Round 2)</h4>
    </div>
    <div style="text-align:center; margin-top:10px; margin-bottom:30px;">
      <canvas id="round2BarChart" width="500" height="200" style="border:1px solid #000;">
        Your browser does not support Canvas.
      </canvas>
    </div>

    <button id="toggleRound2Btn">Update Weights</button>
    <br/><br/><br/>

    <hr class="main-page-hr" />
    <br/><br/><br/><br/>

    <div style="text-align:center; margin: 20px 0;">
      <button id="resetButton2" onclick="location.reload()">Reset Table</button>
      <br/><br/>
      <select id="headerColorDropdown2" onchange="updateHeaderColor2()">
        <option value="" disabled selected>Change Heading Color</option>
        <option value="#f05f40">Orange</option>
        <option value="blue">Blue</option>
      </select>
    </div>

  </div>

  <!-- STYLES for coloring red/green rows (Round 2) -->
  <style>
    #round2 .row-red {
      background-color: red !important;
      color: #ffffff !important;
    }
    #round2 .row-green {
      background-color: green !important;
      color: #ffffff !important;
    }
    #round2 .cell-red {
      background-color: red !important;
      color: #ffffff !important;
    }
    #round2 .cell-green {
      background-color: green !important;
      color: #ffffff !important;
    }
    #round2 .select-red {
      background-color: red !important;
      color: #ffffff !important;
    }
    #round2 .select-green {
      background-color: green !important;
      color: #ffffff !important;
    }
    .auto-button-row td {
      border: none !important;
    }
    .cell-number-span {
      display: none; /* Hidden until auto toggles on */
    }
  </style>

  <!-- SCRIPT FOR ROUND 2 -->
  <script>
    /**********************************************
     * 0) HELPER: Read Round 1 node color & weight
     **********************************************/
    function getRound1NodeColor(rowIdx) {
      // For C1..C9 in Round 1: ID = "inputDropdown1", "inputDropdown2", etc.
      const dd = document.getElementById("inputDropdown" + rowIdx);
      return dd ? dd.value.toUpperCase() : "";
    }

    function getRound1NodeWeight(rowIdx) {
      // If Round 1's auto weight is ON => 20, otherwise parse user typed from "weightInputX".
      const r1WeightAuto = window.weightAutoActive || false;
      if (r1WeightAuto) {
        return 20;
      } else {
        const el = document.getElementById("weightInput" + rowIdx);
        return el ? parseFloat(el.value) || 0 : 0;
      }
    }

    /**********************************************
     * 1) GLOBAL "AUTO" FLAGS FOR ROUND 2
     **********************************************/
    let numericAutoActive2 = false;
    let weightAutoActive2  = false;
    let valueAutoActive2   = false;

    const autoNumericBtn2 = document.getElementById('autoNumericBtn2');
    const autoWeightBtn2  = document.getElementById('autoWeightBtn2');
    const autoValueBtn2   = document.getElementById('autoValueBtn2');

    if (autoNumericBtn2) {
      autoNumericBtn2.addEventListener('click', () => {
        numericAutoActive2 = !numericAutoActive2;
        toggleNumericColumn2(numericAutoActive2);
        for (let i = 1; i <= 9; i++) updateRow2(i);
      });
    }
    if (autoWeightBtn2) {
      autoWeightBtn2.addEventListener('click', () => {
        weightAutoActive2 = !weightAutoActive2;
        toggleWeightColumn2(weightAutoActive2);
        for (let i = 1; i <= 9; i++) updateRow2(i);
      });
    }
    if (autoValueBtn2) {
      autoValueBtn2.addEventListener('click', () => {
        valueAutoActive2 = !valueAutoActive2;
        toggleValueColumn2(valueAutoActive2);
        for (let i = 1; i <= 9; i++) updateRow2(i);
      });
    }

    function toggleNumericColumn2(isAuto) {
      for (let i = 1; i <= 9; i++) {
        const numericInp = document.getElementById("numericInput2_" + i);
        const numericSpn = document.getElementById("numericSpan2_" + i);
        if (!numericInp || !numericSpn) continue;
        if (isAuto) {
          numericInp.style.display = "none";
          numericSpn.style.display = "inline";
        } else {
          numericInp.style.display = "inline";
          numericSpn.style.display = "none";
        }
      }
    }
    function toggleWeightColumn2(isAuto) {
      for (let i = 1; i <= 9; i++) {
        const weightInp = document.getElementById("weightInput2_" + i);
        const weightSpn = document.getElementById("weightSpan2_" + i);
        if (!weightInp || !weightSpn) continue;
        if (isAuto) {
          weightInp.style.display = "none";
          weightSpn.style.display = "inline";
        } else {
          weightInp.style.display = "inline";
          weightSpn.style.display = "none";
        }
      }
    }
    function toggleValueColumn2(isAuto) {
      for (let i = 1; i <= 9; i++) {
        const valueInp = document.getElementById("valueInput2_" + i);
        const valueSpn = document.getElementById("valueSpan2_" + i);
        if (!valueInp || !valueSpn) continue;
        if (isAuto) {
          valueInp.style.display = "none";
          valueSpn.style.display = "inline";
        } else {
          valueInp.style.display = "inline";
          valueSpn.style.display = "none";
        }
      }
    }

    /**********************************************
     * 2) updateRow2 => main logic for each row (C1..C9)
     **********************************************/
    function updateRow2(rowIdx) {
      const dropdown   = document.getElementById("inputDropdown2_" + rowIdx);
      const numericInp = document.getElementById("numericInput2_" + rowIdx);
      const numericSpn = document.getElementById("numericSpan2_" + rowIdx);
      const weightInp  = document.getElementById("weightInput2_" + rowIdx);
      const weightSpn  = document.getElementById("weightSpan2_" + rowIdx);
      const valueInp   = document.getElementById("valueInput2_" + rowIdx);
      const valueSpn   = document.getElementById("valueSpan2_" + rowIdx);

      // Remove old red/green classes
      dropdown.parentElement.classList.remove('cell-red','cell-green');
      dropdown.classList.remove('select-red','select-green');

      // (A) Numeric column logic: auto => -1 if RED, +1 if GREEN.
      let numericVal;
      if (numericAutoActive2) {
        if (dropdown.value === "RED") numericVal = -1;
        else if (dropdown.value === "GREEN") numericVal = 1;
        else numericVal = 0;
        numericSpn.textContent = dropdown.value ? numericVal : "";
      } else {
        numericVal = parseFloat(numericInp.value) || 0;
      }

      // (B) Weight column logic: auto => Round1Weight ±10, else typed.
      let weightVal;
      if (weightAutoActive2) {
        const r1Color = getRound1NodeColor(rowIdx);   // e.g. "RED"
        const r1Weight = getRound1NodeWeight(rowIdx); // e.g. 20 if typed in Round 1
        const trafficLight = (window.selectedTrafficLightColor || "").toUpperCase(); 
        let newW = r1Weight;
        if (r1Color && trafficLight) {
          if (r1Color === trafficLight) {
            // MATCH => +10
            newW = r1Weight + 10;
          } else {
            // MISMATCH => -10
            newW = r1Weight - 10;
          }
        }
        weightVal = newW;
        weightSpn.textContent = weightVal;
      } else {
        weightVal = parseFloat(weightInp.value) || 0;
      }

      // (C) Value = numericVal * weightVal
      let computed = numericVal * weightVal;
      let finalVal;
      if (valueAutoActive2) {
        finalVal = computed;
        valueSpn.textContent = dropdown.value ? finalVal : "";
      } else {
        finalVal = parseFloat(valueInp.value) || 0;
      }

      // Color the cell if Round 2 user picks RED or GREEN in the dropdown.
      if (dropdown.value === "RED") {
        dropdown.parentElement.classList.add('cell-red');
        dropdown.classList.add('select-red');
      } else if (dropdown.value === "GREEN") {
        dropdown.parentElement.classList.add('cell-green');
        dropdown.classList.add('select-green');
      }

      // Recompute Round 2 sum + decision.
      updateDecision2();
    }

    // Summation helper for Round 2 => used by updateDecision2.
    function getFinalValue2(rowIdx) {
      const dropdown   = document.getElementById("inputDropdown2_" + rowIdx);
      const numericInp = document.getElementById("numericInput2_" + rowIdx);
      const weightInp  = document.getElementById("weightInput2_" + rowIdx);
      const valueInp   = document.getElementById("valueInput2_" + rowIdx);

      // Numeric part
      let numericVal;
      if (numericAutoActive2) {
        if (dropdown.value === "RED") numericVal = -1;
        else if (dropdown.value === "GREEN") numericVal = 1;
        else numericVal = 0;
      } else {
        numericVal = parseFloat(numericInp.value) || 0;
      }

      // Weight part => Round1Weight ±10 if mismatch or match
      let weightVal;
      if (weightAutoActive2) {
        const r1Color = getRound1NodeColor(rowIdx);
        const r1Weight = getRound1NodeWeight(rowIdx);
        const trafficLight = (window.selectedTrafficLightColor || "").toUpperCase();
        let newW = r1Weight;
        if (r1Color && trafficLight) {
          if (r1Color === trafficLight) newW = r1Weight + 10;
          else newW = r1Weight - 10;
        }
        weightVal = newW;
      } else {
        weightVal = parseFloat(weightInp.value) || 0;
      }

      // Value => numericVal * weightVal if auto, else user typed in Value col.
      if (valueAutoActive2) {
        return numericVal * weightVal;
      } else {
        return parseFloat(valueInp.value) || 0;
      }
    }

    /**********************************************
     * 3) Final SUM + Decision for Round 2
     **********************************************/
    function updateDecision2() {
      let sum2 = 0;
      for (let i = 1; i <= 9; i++) {
        sum2 += getFinalValue2(i);
      }

      document.getElementById('sumCell2').textContent = sum2;

      // negative => RED, positive => GREEN, else UNDECIDED.
      let outputVal2 = 'UNDECIDED';
      if (sum2 < 0) outputVal2 = 'RED';
      if (sum2 > 0) outputVal2 = 'GREEN';
      document.getElementById('outputCell2').textContent = outputVal2;

      // color the row if sum < 0 or > 0.
      const decisionRow2 = document.getElementById('decisionRow2');
      decisionRow2.classList.remove('row-red','row-green');
      if (sum2 < 0) {
        decisionRow2.classList.add('row-red');
      } else if (sum2 > 0) {
        decisionRow2.classList.add('row-green');
      }

      // optional: reflect correctness vs. Round 2 traffic light.
      updateNetworkStatusTable2();
    }

    /**********************************************
     * 4) Round 2 Network Status (optional)
     **********************************************/
    function updateNetworkStatusTable2() {
      let chosenColor2 = window.selectedTrafficLightColorRound2 || 'NONE';
      let decision2    = document.getElementById('outputCell2').textContent;

      let status2 = '';
      if (decision2 === 'UNDECIDED') {
        status2 = 'UNDECIDED';
      } else if (chosenColor2 === 'NONE') {
        status2 = 'INCORRECT';
      } else if (decision2 === chosenColor2) {
        status2 = 'CORRECT';
      } else {
        status2 = 'INCORRECT';
      }

      document.getElementById('networkStatusCell2').textContent = status2;
      document.getElementById('networkSumCell2').textContent =
        document.getElementById('sumCell2').textContent;
    }

    /**********************************************
     * 5) OPTIONAL: Bar chart for Round 2 weights
     **********************************************/
    function drawBarChartRound2() {
      const canvas = document.getElementById('round2BarChart');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');

      // gather each node's weight for Round 2 (auto or user typed)
      let w2 = [];
      for (let i = 1; i <= 9; i++) {
        let val;
        if (weightAutoActive2) {
          const r1Color = getRound1NodeColor(i);
          const r1Weight = getRound1NodeWeight(i);
          const trafficLight = (window.selectedTrafficLightColor || "").toUpperCase();
          let newW = r1Weight;
          if (r1Color && trafficLight) {
            newW = (r1Color === trafficLight) ? (r1Weight + 10) : (r1Weight - 10);
          }
          val = newW;
        } else {
          val = parseFloat(document.getElementById('weightInput2_'+ i).value) || 0;
        }
        w2.push(val);
      }

      // chart logic
      ctx.clearRect(0,0,canvas.width,canvas.height);
      let minVal = Math.min(...w2);
      let maxVal = Math.max(...w2);
      if (minVal === maxVal) { minVal -= 10; maxVal += 10; }
      const padding=5; 
      minVal -= padding; 
      maxVal += padding;

      const chartW = canvas.width;
      const chartH = canvas.height;
      const margin = 30;
      const usableW = chartW - margin*2;
      const usableH = chartH - margin*2;

      let zeroY;
      if (minVal<0 && maxVal>0) {
        zeroY = margin + (maxVal / (maxVal - minVal)) * usableH;
      } else if (maxVal<0) {
        zeroY = margin + usableH;
      } else {
        zeroY = margin;
      }
      zeroY = Math.max(margin, Math.min(margin+usableH, zeroY));

      // x-axis
      ctx.strokeStyle='black';
      ctx.lineWidth=1;
      ctx.beginPath();
      ctx.moveTo(margin, zeroY);
      ctx.lineTo(margin+usableW, zeroY);
      ctx.stroke();

      // y-axis
      ctx.beginPath();
      ctx.moveTo(margin, margin);
      ctx.lineTo(margin, margin+usableH);
      ctx.stroke();

      // bars C1..C9
      const barSpacing=usableW/9;
      const barWidth=5;
      ctx.fillStyle='#f05f40';

      for (let i=0; i<9; i++) {
        const wVal = w2[i];
        const xCenter = margin + barSpacing*i + barSpacing/2;
        const scale = usableH / (maxVal - minVal);
        const barHeight = Math.abs(wVal*scale);
        const barX = xCenter - barWidth/2;
        const barY = (wVal >= 0) ? (zeroY - barHeight) : zeroY;

        ctx.fillRect(barX, barY, barWidth, barHeight);

        // label 'C1'..'C9'
        ctx.fillStyle='black';
        ctx.font='12px sans-serif';
        ctx.fillText('C'+(i+1), xCenter - 6, zeroY + 15);
        ctx.fillStyle='#f05f40';
      }
    }
    // call every 1s (demo)
    setInterval(drawBarChartRound2, 1000);

    /**********************************************
     * 6) Round 2 heading color, etc.
     **********************************************/
    function updateHeaderColor2() {
      const newColor2 = document.getElementById('headerColorDropdown2').value;
      const headers2 = document.querySelectorAll(
        '#round2 .interactive-table th, #round2 .decision-table th'
      );
      headers2.forEach(th => {
        th.style.backgroundColor = newColor2;
        th.style.color = '#ffffff';
      });
    }

    /**********************************************
     * ON DOM LOAD => hide auto spans by default
     **********************************************/
    window.addEventListener('DOMContentLoaded', () => {
      toggleNumericColumn2(false);
      toggleWeightColumn2(false);
      toggleValueColumn2(false);

      // if you have sideSpan from Round 1 => copy them into Round 2 inputs initially
      for (let i=1; i<=9; i++){
        let sideSpan = document.getElementById('round2WeightSpan'+ i);
        let mainW = document.getElementById('weightInput2_'+ i);
        if (sideSpan && mainW){
          mainW.value = parseFloat(sideSpan.textContent) || 0;
        }
      }
    });
  </script>

</div> <!-- /round2 -->
